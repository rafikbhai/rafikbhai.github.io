(function(b){var d=window.AmazonUIPageJS||window.P,e=d._namespace||d.attributeErrors,a=e?e("WidgetStreamer"):d;a.guardFatal?a.guardFatal(b)(a,window):a.execute(function(){b(a,window)})})(function(b,d,e){b.register("widget-streamer-jquery-action",function(){return function(a){if(!a||3>a.length)throw Error("Can not create update action, insufficient data in chunk: "+JSON.stringify(a));return{action:a[0],selector:a[1],html:a[2]}}});"use strict";b.when("jQuery","widget-streamer-jquery-action").register("widget-streamer-action-ws-update",
function(a,b){return function(f){var c=b(f);return{execute:function(){a(c.selector).html(c.html)}}}});"use strict";b.when("jQuery","widget-streamer-jquery-action").register("widget-streamer-action-ws-append",function(a,b){return function(f){var c=b(f);return{execute:function(){var b=a(c.selector);b.html(b.html()+c.html)}}}});"use strict";b.when("jQuery","widget-streamer-jquery-action").register("widget-streamer-action-ws-prepend",function(a,b){return function(f){var c=b(f);return{execute:function(){var b=
a(c.selector);b.html(c.html+b.html())}}}});"use strict";b.register("widget-streamer-utils",function(){return{isStreamingAjax:function(a){if(a&&"function"===typeof a.getResponseHeader)a=a.getResponseHeader("Content-Type");else if(a&&a.http&&"function"===typeof a.http.getResponseHeader)a=a.http.getResponseHeader("Content-Type");else throw Error("Unable to retrive headers for the given xhr object: "+a);return"application/json-amazonui-streaming"===a}}});"use strict";b.when("A","jQuery").register("widget-streamer",
function(a,d){return function(a){function c(a){var c,d="widget-streamer-action-"+a[0];b.now(d).execute(function(b){if(b)c=b(a);else throw Error("Operation: "+a[0]+" is not supported. Register component "+d+" to handle this action");});return c}var d=a||{},g=[],e=!d.isPrefetch,h=!0;return{onNewChunk:function(a){h&&d.before&&(h=!1,d.before());a=c(a);e?a.execute():g.push(a)},execute:function(){for(var a=0;a<g.length;a++)g[a].execute();g=[];e=!0}}}})});
/* ******** */
(function(r){var t=window.AmazonUIPageJS||window.P,qa=t._namespace||t.attributeErrors,ka=qa?qa("CheckoutCommonAsset"):t;ka.guardFatal?ka.guardFatal(r)(ka,window):ka.execute(function(){r(ka,window)})})(function(r,t,qa){r.register("polyfill-indexof",function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a,n){var k;if(null==this)throw new TypeError('"this" is null or not defined');var m=Object(this),f=m.length>>>0;if(0===f)return-1;k=+n||0;Infinity===Math.abs(k)&&(k=0);if(k>=f)return-1;
for(k=Math.max(0<=k?k:f-Math.abs(k),0);k<f;){if(k in m&&m[k]===a)return k;k++}return-1})});"use strict";r.register("polyfill-filter",function(){Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var n=Object(this),k=n.length>>>0;if("function"!==typeof a)throw new TypeError;for(var m=[],f=2<=arguments.length?arguments[1]:void 0,h=0;h<k;h++)if(h in n){var g=n[h];a.call(f,g,h,n)&&m.push(g)}return m})});"use strict";r.register("polyfill-json-stringify",
function(){"object"!==typeof JSON&&(JSON={});(function(){function a(a){return 10>a?"0"+a:a}function n(){return this.valueOf()}function k(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var d=y[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function m(a,b){var c,p,q,f,l=e,g,h=b[a];h&&"object"===typeof h&&"function"===typeof h.toJSON&&(h=h.toJSON(a));"function"===typeof A&&(h=A.call(b,a,h));switch(typeof h){case "string":return k(h);
case "number":return isFinite(h)?String(h):"null";case "boolean":case "null":return String(h);case "object":if(!h)return"null";e+=d;g=[];if("[object Array]"===Object.prototype.toString.apply(h)){f=h.length;for(c=0;c<f;c+=1)g[c]=m(c,h)||"null";q=0===g.length?"[]":e?"[\n"+e+g.join(",\n"+e)+"\n"+l+"]":"["+g.join(",")+"]";e=l;return q}if(A&&"object"===typeof A)for(f=A.length,c=0;c<f;c+=1)"string"===typeof A[c]&&(p=A[c],(q=m(p,h))&&g.push(k(p)+(e?": ":":")+q));else for(p in h)Object.prototype.hasOwnProperty.call(h,
p)&&(q=m(p,h))&&g.push(k(p)+(e?": ":":")+q);q=0===g.length?"{}":e?"{\n"+e+g.join(",\n"+e)+"\n"+l+"}":"{"+g.join(",")+"}";e=l;return q}}var f=/^[\],:{}\s]*$/,h=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,c=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=n,Number.prototype.toJSON=n,String.prototype.toJSON=n);var e,d,y,A;"function"!==typeof JSON.stringify&&(y={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=
function(a,b,c){var p;d=e="";if("number"===typeof c)for(p=0;p<c;p+=1)d+=" ";else"string"===typeof c&&(d=c);if((A=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return m("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,d){function e(a,b){var l,c,p=a[b];if(p&&"object"===typeof p)for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(c=e(p,l),void 0!==c?p[l]=c:delete p[l]);return d.call(a,b,p)}var c;a=String(a);b.lastIndex=
0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(f.test(a.replace(h,"@").replace(g,"]").replace(p,"")))return c=eval("("+a+")"),"function"===typeof d?e({"":c},""):c;throw new SyntaxError("JSON.parse");})})()});"use strict";r.when("A","jQuery","client-side-metrics","weblab-helper","polyfill-filter","polyfill-json-stringify").register("ajax-wrapper",function(a,n,k,m){function f(a,l){function d(a,l){for(var b=0;b<a._options.length;b++){var e=a._options[b];
if(e=l.call(a,e,"object"===typeof e?e.name:e))return e}}this._options=a instanceof f&&l&&l.length?a._options.concat(l):a instanceof f?a._options:a&&a.length?a:[];this.filter=function(a){var l={};d(this,function(d,b){b in a&&(l[b]=a[b])});return l};this.getOption=function(a){return d(this,function(l,b){if(b===a)return l})};return this}function h(a){this._options=a.allowedOptions;this._messageForViolation=a.messageForViolation;this._messageForViolationWithValue=a.messageForViolationWithValue;this._optionName=
a.optionName;this._valueName=a.valueName;this.validate=function(a){for(var l in a)if(a.hasOwnProperty(l)){var b=this._options.getOption(l);if(!b)throw b=this._messageForViolation.replace(this._optionName,l),Error(b);if("object"===typeof b&&!b.validate(a[l]))throw b=this._messageForViolationWithValue.replace(this._optionName,l),b=b.replace(this._valueName,a[l]),Error(b);}};return this}function g(a){try{O.validate(a)}catch(l){console.error(l)}var b=u.filter(a),b=n.extend(b,p(a));return n.ajax(b)}function p(a){if(a.params){if(a.data&&
a.params)throw Error("The option data can not be present with the emulated params option. Merge both and use just one.");return{data:a.params}}}function c(c){try{l.validate(c)}catch(p){console.error(p)}var f={url:void 0,options:q.filter(c)},g=new n.Deferred;f.url=c.url;if(c.data){if(c.data&&c.params)throw Error("Unsupported options. 'params' and 'data' options are both specified. Remove one of them.");if("object"===typeof c.data)f.options.params=c.data;else if("string"===typeof c.data)f.url+="?"+
c.data;else throw Error("Unsupported type provided in the 'data' attribute of an AJAX call");}if(c.type){if(c.type&&c.method)throw Error("Unsupported options. 'type' and 'method' options are both specified. Remove one of them.");f.options.method=c.type}if("crossDomain"in c){if("crossDomain"in c&&"withCredentials"in c)throw Error("Unsupported options. 'crossDomain' and 'withCredentials' options are both specified. Remove one of them.");f.options.withCredentials=c.crossDomain}f=e(f,c,g);f=b(f,c,g);
f=y(f,c,g);f=d(f,c,g);f=A(f,c,g);c.beforeSend&&c.beforeSend(f.options);f=z(f,c,g);c=a.ajax(f.url,f.options);return c=g.promise(c)}function b(a,l,b){var d=a.options.success;a.options.success=function(a,l,c){d&&d(a,l,c);b.resolve(a,l,c)};var c=a.options.error;a.options.error=function(a,l,d){c&&c(a,l,d);b.reject(a,l,d)};var e=a.options.abort;a.options.abort=function(a){e&&e(a);b.reject(a,"abort")};return a}function e(a,l){if(!l.complete)return a;var b=a.options.success;a.options.success=function(a,d,
c){b&&b(a,d,c);l.complete(c,"success")};var d=a.options.error;a.options.error=function(a,b,c){d&&d(a,b,c);l.complete(a,"error")};var c=a.options.abort;a.options.abort=function(a){c&&c(a);l.complete(a,"abort")};return a}function d(a,l){var b=a.options.success;a.options.success=function(a,d,c){b&&("text"===l.dataType&&"object"===typeof a&&(a=JSON.stringify(a)),b(a,d,c))};return a}function y(a,l){if(!l.useXMLHttp)return a;var b=a.options.success;a.options.success=function(a,l,d){d&&(d=d.http);b(a,l,
d)};var d=a.options.error;a.options.error=function(a,l,b){a&&(a=a.http);d(a,l,b)};var c=a.options.abort;a.options.abort=function(a){a&&(a=a.http);c(a)};return a}function A(a,l){var b=a.options.success;a.options.success=function(a,l,d){d&&304===d.http.status?b(a,"notmodified",d):b(a,"success",d)};var d=a.options.error;a.options.error=function(a,l,c){a&&a.http.readyState<w.DONE?d(a,"timeout",c):a&&200<=a.http.status&&300>a.http.status&&a.http.readyState===w.DONE?b(a.http.responseText,"success",a):a&&
0==a.http.status?d(a,"abort",c):d(a,"error",c)};return a}function z(a,l){var b=a.options.success;a.options.success=function(a,l,d){C(d,"success");b(a,l,d)};var d=a.options.error;a.options.error=function(a,l,b){C(a,"error");d(a,l,b)};return a}function C(a,l){a?(k.increaseCount("AUI:Ajax:"+l+":xhr:defined"),a.http?k.increaseCount("AUI:Ajax:"+l+":xhr:http:defined"):void 0===a.http?k.increaseCount("AUI:Ajax:"+l+":xhr:http:undefined"):null===a.http&&k.increaseCount("AUI:Ajax:"+l+":xhr:http:null")):void 0===
a?k.increaseCount("AUI:Ajax:"+l+":xhr:undefined"):null===a&&k.increaseCount("AUI:Ajax:"+l+":xhr:null")}var w={UNSET:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},u=new f("accepts async beforeSend cache complete contents contentType context converters crossDomain data dataFilter dataType error global headers ifModified isLocal jsonp jsonpCallback method mimeType password processData scriptCharset statusCode success timeout traditional type url username xhr xhrFields".split(" ")),q=new f("abort accepts cache chunk contentType error headers indicator method params success timeout withCredentials".split(" "));
m=new f(q,[{name:"async",validate:function(a){return a}},"useXMLHttp","beforeSend","complete","crossDomain","dataType","data","type","url"]);var v=new f(u,["params"]),l=new h({allowedOptions:m,messageForViolation:"The option %O is not supported in AUI ajax calls and default ajax. Consider using jQuery ajax.",messageForViolationWithValue:"The option %O with value %V is not supported in AUI ajax calls and default ajax. Consider using jQuery ajax.",optionName:"%O",valueName:"%V"}),O=new h({allowedOptions:v,
messageForViolation:"The option %O is not supported in jQuery ajax calls and default ajax. Consider using AUI ajax.",messageForViolationWithValue:"The option %O with value %V is not supported in jQuery ajax calls and default ajax. Consider using AUI ajax.",optionName:"%O",valueName:"%V"}),K=n("meta[name\x3ddefaultAJAX]").attr("content");"jQuery"!==K&&"AUI"!==K&&(K="jQuery");return{default:function(a){try{l.validate(a),O.validate(a)}catch(b){console.error(b)}if("jQuery"===K)g(a);else if("AUI"===K)c(a);
else throw Error("Unknown AJAX method: "+K);},jQuery:g,aui:c,READY_STATE:w}});"use strict";r.when("jQuery").register("weblab-helper",function(a){return{isAJAXWeblabOn:function(){return"1"===a("meta[name\x3dPAGE_CONDUCTOR_AUI_AJAX]").attr("content")},isNavCFWeblabOn:function(){return"1"===a("meta[name\x3dEMIT_NAV_CF]").attr("content")}}});"use strict";r.when("A","client-side-metrics").register("weekend-availability-expander-helper",function(a,n){function k(a){return(a=g[a])?h("#weekend-availability-expander-header-text-"+
a).text():h("#weekend-availability-default").text()}function m(a,c){return a&&c?"BOTH":a?"SAT":c?"SUN":"NONE"}function f(a){var c=!1,b=!1;if("BOTH"===a||"OTH"===a||"SAT"===a)c=!0;if("BOTH"===a||"OTH"===a||"SUN"===a)b=!0;return{isSaturdayChecked:c,isSundayChecked:b}}function f(a){var c=!1,b=!1;if("BOTH"===a||"OTH"===a||"SAT"===a)c=!0;if("BOTH"===a||"OTH"===a||"SUN"===a)b=!0;return{isSaturdayChecked:c,isSundayChecked:b}}var h=a.$,g={BOTH:"both",SAT:"sat",SUN:"sun",NONE:"none"};return{logExpanderState:function(a,
c,b,e){n.increaseCount("checkout:delivery-preferences:"+a+":expander:"+c+":"+(b&&e?"neverExpanded":e?"collapsed":"expanded"),1)},stateToCheckboxes:f,updateAllOptOutMessages:function(a){a.isSaturdayChecked||a.isSundayChecked?a.isSaturdayChecked?a.isSundayChecked?h(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!0):(h(".weekend-availability-opt-out-message").text(h("#weekend-availability-opt-out-sun-text").text()),h(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):(h(".weekend-availability-opt-out-message").text(h("#weekend-availability-opt-out-sat-text").text()),
h(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):(h(".weekend-availability-opt-out-message").text(h("#weekend-availability-opt-out-both-text").text()),h(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1))},updateAllTitles:function(a){a=m(a.isSaturdayChecked,a.isSundayChecked);h(".sat-sun-expander-heading-text").text(k(a))},updateAllWeekendAvailabilityStates:function(a){a=m(a.isSaturdayChecked,a.isSundayChecked);h("input[name\x3d'BusinessHours']").attr("value",a)}}});
"use strict";r.when("A","loading-spinner-controller","page-transition-controller","page-conductor","checkout-general-utils","address-utilities","page-detector-current-page","client-side-metrics").register("address-popovers",function(a,n,k,m,f,h,g,p){function c(a){a.getResponseHeader("x-amz-checkout-popover-valid")||m.redirect({conductoraction:{url:"/gp/cart/view.html",type:"redirect"}})}function b(b,d,e){f.protectAgainstDoubleAction("show-add-address-popover",200)||(l=b.popover,!v('input[name\x3d"preloadAddressPopover"]').length||
d.is(":empty")?(d.empty(),d.css("min-height",397),l.updatePosition(!0),n.showSpinner(d,!1,l),b=(new Date).getTime(),e="itemselect"===g.getCurrentPage()?1:0,v.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/display.html?cachebuster\x3d"+b,data:{isBilling:F,isMultiAddress:e},async:!0,cache:!1,headers:{"x-amz-checkout-page":"itemselect"},success:function(a,l,b){c(b);d.css("min-height",0);w(d,a)},error:m.ajaxRedirect})):(h.customizeFormFromIdentity(d),h.countrySpecificPopoverOptimizationCheck(v("html")),
e&&a.trigger("identity-assets")))}function e(a,b){if(!f.protectAgainstDoubleAction("add-new-address",200)){p.resetMetrics();var d=!1;v(".identity-protect-from-errant").each(function(){var a=v(this),a=a.is("input")?a:a.find("input:first");-1!==a.val().search(/(\d[ -]?){13}/)&&(d=!0)});if(d){var e=v(".address-form-security-error:first");e.length?alert(e.text()):alert("Please check that the address you have entered is correct.")}else{b.$event.preventDefault();n.showSpinner(a,!1,l);var q=v("#domestic-address-popover-form, #international-address-popover-form, #address-popover-suggestions-form").filter(":visible"),
e=q.serialize(),g=(new Date).getTime(),u=b.$currentTarget.find('input[type\x3d"submit"]').attr("name");"useSelectedAddress"===u?e+="\x26fromSuggestionPage\x3d1":"fromAddressEditToContinue"===u&&(e+="\x26fromAddressEditToContinue\x3d1");v("#addAddressOnly").length&&(e+="\x26addOnly\x3d1");F&&(e+="\x26isBilling\x3d1");var h="/gp/buy/addressselect/handlers/popover/new.html";if(l){if("domestic-address-popover-form"===q.attr("id")&&(q.find(".enterAddressFormField").blur(),q="#"+a.attr("id")+" div[id^\x3donblur-character-validation-error-]",
0<v(q).size())){n.hideSpinner(a);return}(q=l.$trigger.children(":first"))&&(q=q.data("addAddressRef"))&&(h+="/ref\x3d"+q);m.isSPP()&&(l.lock(11),setTimeout(function(){l.unlock(12)},2E3))}var k=null!==O&&void 0!==O&&null!==K&&void 0!==K;"useSelectedAddress"===u&&!F&&k&&(e+="\x26fromSTMAPopover\x3d1");v("#international-address-popover-form").filter(":visible").length&&(e+="\x26showSecondaryForm\x3d1");v.ajax({type:"POST",url:h+"?cachebuster\x3d"+g,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",
data:e,async:!0,cache:!1,error:m.ajaxRedirect,success:function(b,d,e){m.isSPP()&&l.unlock(12);c(e);e.getResponseHeader("x-amz-checkout-open-new-popover")?y(b,d,e):e.getResponseHeader("x-amz-checkout-reload-popover")?w(a,b):k?A(e):z("added")}})}}}function d(a){if(!f.protectAgainstDoubleAction("show-edit-address-popover",200)){var b=v("#address-suggestions-popover");a.$event.preventDefault();n.showSpinner(b,!1,l);a=v("#address-popover-suggestions-form");var d=a.serialize();a.find('input[type\x3d"radio"]').each(function(){var a=
v(this);a.attr("checked")&&(d+="\x26edit_"+a.val()+"\x3d1")});F&&(d+="\x26isBilling\x3d1");l&&m.isSPP()&&(l.lock(11),setTimeout(function(){l.unlock(12)},2E3));a=(new Date).getTime();v.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+a,data:d,async:!0,cache:!1,error:m.ajaxRedirect,success:function(a,b,d){m.isSPP()&&l.unlock(12);c(d);y(a,b,d)}})}}function y(l,b,d){v('input[name\x3d"preloadAddressPopover"]').remove();b=d.getResponseHeader("x-amz-checkout-open-new-popover");
"suggestions"===b?(v("#address-suggestions-popover").empty().append(l),v("#address-suggestions-popover-link").trigger("click")):"edit"===b&&(B=1,b=v("#edit-address-popover"),b.empty().append(l),v("#edit-address-popover-link").trigger("click"),w(b,l));a.trigger("identity-assets")}function A(a){a=a.getResponseHeader("x-amz-checkout-new-address-id");var l=(new Date).getTime();v.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html?cachebuster\x3d"+l,data:{action:"update-address",lineitems:O,
quantities:K,addresses:a+".home..",returnHTML:0},async:!0,cache:!1,error:m.ajaxRedirect,success:function(a,l,b){z("applied")}})}function z(l){var b=(new Date).getTime();if(v('input[name\x3d"shipToAddress"]').length)l=function(){m.isSPP()?(k.blockAllActions(),k.shrinkPanel(v(".spp-panel.expanded"),!0)):k.show()},m.isNonBlockingAnimationEnabled()?a.delay(l,0):l(),l=g.getCurrentPage(),m.loadPage(l,"",void 0);else{var d=m.setAjaxTransitionHeader();v.ajax({type:"POST",headers:d,url:"/gp/buy/shared/handlers/pipeline-dispatch.html?cachebuster\x3d"+
b,data:{useCase:"multiAddress",showAddressAdded:l,page:"itemselect"},dataType:"text",async:!0,cache:!1,error:m.ajaxRedirect,success:function(a,l,b){m.ajaxUpdatePage(a,l,b);v(".a-button-close").trigger("click");f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}})}}function C(a){a=v("#"+a);a.length&&a.empty()}function w(b,d){b.html(d);h.customizeFormFromIdentity(b);l.updatePosition(!0);a.trigger("identity-assets");h.countrySpecificPopoverOptimizationCheck(v("html"))}function u(a){a=
a.$currentTarget.closest(".lineitem");O=a.find('input[name^\x3d"lineItemEntityID."]').val();K=a.find('input[name^\x3d"quantity."]').val();a=v("#add-address-popover-link");a.length?a.trigger("click"):v("#add-new-address-popover").trigger("click")}function q(){F=v("#isBilling").length?1:0}var v=a.$,l,O,K,B=0,F=0;if(!v("html").hasClass("a-ie6"))return a.on("a:popover:show:add-address",function(a){C("edit-address-popover");C("add-billing-address-popover");F=0;b(a,v("#add-address-popover"),!1)}),a.on("a:popover:show:add-billing-address",
function(a){C("edit-address-popover");C("add-address-popover");b(a,v("#add-billing-address-popover"),!0)}),a.on("a:popover:show:address-suggestions",function(a){l=a.popover}),a.on("a:popover:show:edit-address",function(a){l=a.popover;if(f.protectAgainstDoubleAction("show-edit-address-popover",200)||B)B=0;else{var b=v("#edit-address-popover"),d=l.$trigger.closest(".address-edit-link").find("a").attr("href");b.empty();C("add-address-popover");C("add-billing-address-popover");var e=v("#delete-address-popover-button");
e.length&&e.addClass("aok-hidden").addClass("a-disabled");a.popover.updatePosition(!0);n.showSpinner(b,!1,l);a=(new Date).getTime();v.ajax({type:"POST",url:d+"\x26cachebuster\x3d"+a,async:!0,cache:!1,success:function(a,l,d){c(d);w(b,a);e.length&&v("#delete-address-button").length&&e.removeClass("aok-hidden").removeClass("a-disabled")},error:m.ajaxRedirect})}}),a.on("a:popover:show:select-billing-address",function(l){if(!f.protectAgainstDoubleAction("show-select-billing-address-popover",200)){var b=
v("#select-billing-address-popover");b.empty();b.css("min-height",250);l.popover.updatePosition(!0);n.showSpinner(b,!1,l.popover);var d=(new Date).getTime(),e="/gp/buy/billingaddressselect/handlers/popover.html";m.isSPP()&&(e+="/ref\x3dchk_pay_billing_change_coll");v.ajax({type:"POST",url:e+"?cachebuster\x3d"+d,async:!0,cache:!1,success:function(d,e,q){c(q);b.html(d);a.trigger("checkout:reload:spp-billing-address");b.css("min-height",0);l.popover.updatePosition(!0)},error:m.ajaxRedirect})}}),a.on("a:expander:delivery-expander:toggle:expand",
function(a){a=v(".a-expander-content");h.fixOverflow(a)}),a.declarative("close-delete-popover",["click","touchend"],function(a){r.when("a-popover-base").execute(function(b){(b=b.get(a.data.popoverName))&&b.hide()})}),a.declarative("rm-address-action",["click","touchend"],function(a){r.when("a-popover-base").execute(function(b){(b=b.get(a.data.popoverName))&&b.hide()});r.when("page-conductor").execute(function(b){b.continueClicked(null,a.$target)})}),a.declarative("select-billing-address-action",["click",
"touchend"],function(a){r.when("a-popover-base").execute(function(a){a.get("select-billing-address").hide()});r.when("page-conductor").execute(function(b){b.continueClicked(null,a.$target)})}),v(document).delegate("a.prevent-default-marker","click",function(a){a.preventDefault()}),a.declarative("select-billing-address-in-popover",["click","touchend"],function(a){r.when("a-popover-base").execute(function(a){a.get("select-billing-address").hide()})}),a.declarative("trigger-popover-from-link",["click",
"touchend"],function(a){f.protectAgainstDoubleAction("trigger-popover-from-link",200)||(K=O=null,v("#add-address-popover-link").trigger("click"))}),a.declarative("add-address-popover-submit",["click","touchend"],function(a){e(v("#add-address-popover"),a)}),a.declarative("add-billing-address-popover-submit",["click","touchend"],function(a){e(v("#add-billing-address-popover"),a)}),a.declarative("edit-address-popover-submit",["click","touchend"],function(a){e(v("#edit-address-popover"),a)}),a.declarative("address-suggestions-submit",
["click","touchend"],function(a){e(v("#address-suggestions-popover"),a)}),a.declarative("delete-address-popover-submit",["click","touchend"],function(a){a=v("#delete-address-button");0<a.length&&a.click()}),a.declarative("edit-address-suggestions",["click","touchend"],d),a.declarative("add-address-popover-edit",["click","touchend"],function(a){if(!f.protectAgainstDoubleAction("add-address-popover-edit",200)){a.$event.preventDefault();var b=v("#add-address-popover");n.showSpinner(b,!1,l);a=v("#address-popover-suggestions-form").serialize()+
"\x26"+a.$currentTarget.find('input[type\x3d"submit"]').attr("name")+"\x3d1";var d=(new Date).getTime();v.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+d,data:a,async:!0,cache:!1,error:m.ajaxRedirect,success:function(a,l,d){c(d);w(b,a)}})}}),a.declarative("add-address-popover-toggle",["click","touchend"],function(a){f.protectAgainstDoubleAction("add-address-popover-toggle",200)||(a.$event.preventDefault(),a=a.$currentTarget.closest(".enter-address-form"),
h.toggleAddressForm(a,a.siblings(".enter-address-form")))}),a.declarative("select-radio-option",["click","touchend"],function(a){a=a.$currentTarget.find(".radio-option");a.find('input[type\x3d"radio"]').attr("checked","checked");a.closest(".radio-option-list").find(".radio-option").removeClass("radio-option-selected");a.addClass("radio-option-selected")}),a.declarative("trigger-address-popover",["click","touchend"],function(a){f.protectAgainstDoubleAction("trigger-address-popover",200)||v("#add-address-popover-link").trigger("click")}),
a.on("checkout:reload:spp-shipaddress",q),a.on("checkout:reload:spp-billing-address",q),a.on("checkout:reload:itemselect",q),a.on("checkout:reload:spp-itemselect",q),{actionTriggerPopoverFromDropdown:u}});"use strict";r.when("A").register("address-book-controller",function(a){function n(){k("div.address-book").unbind("recalculate-address-height").bind("recalculate-address-height",function(){var a,f=k(),h=0,g=k("div.address-book .js-same-height"),p=g.length;g.css({height:"auto"}).each(function(c){var b=
k(this);a=a||b.offset().top;a!==b.offset().top&&(f.height(h),f=k(),h=0,a=b.offset().top);var e=b.height();f=f.add(b);e>h&&(h=e);c===p-1&&0<h&&f.height(h)})}).trigger("recalculate-address-height");k(t).unbind("resize.checkout-as").bind("resize.checkout-as",function(){k("div.address-book").trigger("recalculate-address-height")})}var k=a.$;a.on("checkout:reload:spp-shipaddress",n);a.on("checkout:reload:shipaddressselect",n);a.on("checkout:reload:billingaddressselect",n);a.on("checkout:reload:spp-billing-address",
n)});"use strict";r.when("A","client-side-metrics").register("address-utilities",function(a,n){function k(a){a.find("input").each(function(){var a=g(this),b=a.outerWidth(!0),e=a.parent().outerWidth(!0);b>e&&a.attr("size")&&(document.getElementById(a.attr("id")).removeAttribute("size"),a.width("100%"))})}function m(a){if(g('input[name\x3d"useLiveAUI"]').length)r.when("p-detect").execute(function(b){b.capabilities.inputPlaceholder&&a.find(".field-description").each(function(){var a=g(this),b=a.text(),
e=a.closest(".a-col-right").find(":not(.address-form-skip-js-tweaks):not(.address-form-skip-js-tweaks *) input");e.attr("maxlength")<b.length&&e.attr("size",b.length);e.attr("placeholder",a.text())})}),a.find("input").each(function(){g(this).outerWidth()}),a.find("input[type\x3d'text'], select").each(function(){var a=g(this).closest(".full-width-config"),b=g(this);0===a.find(".a-popover-trigger").length&&b.width("96%")});else{r.when("p-detect").execute(function(b){b.capabilities.inputPlaceholder?
a.find(".field-description").each(function(){var a=g(this),b=a.text(),e=a.closest(".a-column").find(":not(.address-form-skip-js-tweaks):not(.address-form-skip-js-tweaks *) input");e.attr("maxlength")<b.length&&e.attr("size",b.length);e.attr("placeholder",a.text())}):a.find(".field-description").each(function(){var a=g(this);a.find("br").remove();a.show()})});a.find(".popover-field-label").each(function(){var a=g(this);a.find("b").each(function(){var a=g(this);a.text(g.trim(a.text()))});a.find("font").each(function(){var a=
g(this);"-2"===a.attr("size")&&a.remove()})});var c=g(".enter-address-form");k(c);var b=0,c=a.find(".one-new-address-form-field").first();c.length&&c.find(".a-column").each(function(){b+=g(this).outerWidth()});a.width(0<b?b:"")}}function f(f){function c(){h=e.val();(k=m[h])&&d.find(".learn-more a").text(k.popOverLinkText)}var b=t.P&&t.P.AUI_BUILD_DATE,e=f.find("#enterAddressCountryCode"),d=f.find(".country-specific-form-input"),g,m;b?(g=d.find("input"),m=f.find(".country-specific-config").data("popovercountryconfig")):
(n.increaseCount("removeauijs2"),g=d.find("#"+d.data("inputid")),m=d.find(".country-specific-config").data("popovercountryconfig"));if(e.length&&d.length&&g.length&&m){var h=e.val(),k=m[h];e.unbind("change.countryChangeConfigUpdate").bind("change.countryChangeConfigUpdate",c);c();var w=b?"show":"beforeShow";a.on("a:popover:"+w+":checkout-"+d.data("inputid")+"Name",function(a){"beforeShow"===w&&n.increaseCount("removeauijs3");k&&(a.popover.$popover.find(".a-popover-header h4").html(k.popOverTitle),
a.popover.$popover.find(".a-popover-inner").html(k.popOverText),a.popover.updatePosition())})}}function h(a){function c(){var a=e.val();(a=m[a])?(a=(a=a.label)||"",f.attr("placeholder",g("\x3cdiv /\x3e").html(a).text().replace(":","")),d.show()):d.hide()}var b=t.P&&t.P.AUI_BUILD_DATE,e=a.find("#enterAddressCountryCode"),d=a.find(".country-specific-form-input-mobile"),f,m;b?(f=d.find("input"),m=a.find(".country-specific-config").data("labelcountryconfig")):(n.increaseCount("removeauijs3"),f=d.find("#"+
d.data("inputid")),m=d.find(".country-specific-config").data("labelcountryconfig"));e.length&&d.length&&f.length&&m&&(e.unbind("change.countryChangeLabelUpdate").bind("change.countryChangeLabelUpdate",function(){d.hasClass("initial-edit-value")?d.removeClass("initial-edit-value"):f.val("");c()}),c())}var g=a.$;r.when("a-checkbox").execute(function(f){a.declarative("delivery-preferences-weekend-availability-checkbox-triggered","click",function(a){if("undefined"!==typeof a.$target){var b=a.$target.val();
a.$target.is(":checked")&&("NONE"===b?(f("#delivery-preferences-weekend-availability-sat").uncheck(),f("#delivery-preferences-weekend-availability-sun").uncheck()):"SAT"!==b&&"SUN"!==b||f("#delivery-preferences-weekend-availability-none").uncheck())}})});return{toggleAddressForm:function(a,c){a.hide();c.find("div.a-alert-error:not(.js-originally-shown-imb)").hide();a.find("input[type\x3d'text'], select, input[type\x3d'radio']:checked, input[type\x3d'hidden']").each(function(){var a=g(this),e=a.attr("name")||
a.data("copyto")||a.attr("id");if(!a.is(":disabled")&&!a.find(":selected").is(".js-not-a-value")){var d=c.find("input[name\x3d'"+e+"']");"enterAddressLandmark"===e&&(d=c.find("input[name\x3d'Landmark']"));"Landmark"!==e||d.length||(d=c.find("input[name\x3d'enterAddressLandmark']"));1<d.length&&a.is("input[type\x3d'radio']")?d.filter("[value\x3d'"+a.val()+"']").attr("checked",!0):d.is("select")?d.find("option[value\x3d'"+a.val()+"']").attr("selected",!0):a.is("input[type\x3d'hidden']")||d.is("input[type\x3d'hidden']")||
d.val(a.val())}});c.show();k(c);m(c)},customizeFormFromIdentity:m,fixOverflow:k,countrySpecificLabelOptimizationCheck:function(a){var c=a.find(".enter-address-form");1===c.data("taxidOpt")?setTimeout(function(){h(c)},100):h(c)},countrySpecificPopoverOptimizationCheck:function(a){var c=a.find(".enter-address-form");1===c.data("taxidOpt")?setTimeout(function(){f(c)},100):f(c)}}});"use strict";r.when("A","client-side-metrics").register("action-logger",function(a,n){var k=a.$;a.declarative("ue-count",
["click","touchend"],function(a){n.increaseCount(a.data.countFlag,a.data.countValue)});return{logUsedPrefetch:function(a,f){k.ajax({type:"GET",url:"/gp/buy/shared/handlers/log-used-prefetch.html",data:"pageType\x3d"+a+"\x26subPageType\x3d"+f,dataType:"text",cache:!1})}}});"use strict";r.when("A","weblab-helper").register("ajax-utility",function(a,n){return{jsonify:function(k){var m;if(m=n.isAJAXWeblabOn()){m=k instanceof Function;var f=k instanceof Array,h=k instanceof String;m=k instanceof Object&&
!f&&!m&&!h}if(m)return k;try{k=a.$.parseJSON(k)}catch(g){k=null}return k}}});"use strict";r.when("A","page-conductor","client-side-metrics").register("button-blocker",function(a,n,k){function m(a,e,c){n.isSPP()?e.closest("span.a-declarative").data("blockerText",c):e.find("input.a-button-text").data("blockerText",c);b?(a.addClass("aok-hidden"),e.removeClass("aok-hidden"),f("#hasTVNavigation").length&&r.when("a-tv").execute(function(b){b.remove(a)})):(k.increaseCount("removeauijs10"),a.hide(),e.show(),
e.hasClass("aok-hidden")&&e.removeClass("aok-hidden"))}var f=a.$,h={},g=[],p,c,b=t.P&&t.P.AUI_BUILD_DATE,e=!1;a.on("checkout:beforeReload",function(){g=[];h={};p=""});return{show:function(a,b){if(!e){var c=f(".continue-button");if(c.length)if(b){var k=f(".continue-button-blocker");if(k.length){if(0===g.length||h[a]!==b)m(c,k,b),p=a;void 0===h[a]&&g.push(a);h[a]=b}}else t.console&&t.console.error&&console.error("showBlockerOnContinue should not be called with an empty tooltip.")}},hide:function(a){if(!e){if(void 0!==
h[a]){delete h[a];var c=f.inArray(a,g);g.splice(c,1)}var A=f(".continue-button");A.length&&(c=f(".continue-button-blocker"),c.length&&(0===g.length?b?(c.addClass("aok-hidden"),A.removeClass("aok-hidden"),f("#hasTVNavigation").length&&r.when("a-tv").execute(function(a){a.add(A)})):(k.increaseCount("removeauijs11"),c.hide(),A.show(),A.hasClass("aok-hidden")&&A.removeClass("aok-hidden")):p===a&&(p=g[0],m(A,c,h[p]))))}},lock:function(){e=!0},unlock:function(){e=!1},getButtonBlocker:function(){c||(c=f(".continue-button-blocker"));
return c}}});"use strict";r.when("A","page-detector","button-blocker","client-side-metrics").register("button-blocker-controller",function(a,n,k,m){function f(a){return void 0!==c[a]?1:0}function h(a,b){f(a)&&c[a].state!==b&&(c[a].state=b,g())}function g(){var a=!0,f;p.each(c,function(c,g){f=g.owner;if(g.state===e.DISABLE_CONTINUE)return a=!1,k.show(f,g.toolTipMessage),b||(m.increaseCount("removeauijs12"),p(".continue-button-blocker").css("display","inline-block")),!1});a&&k.hide(f)}var p=a.$,c={},
b=t.P&&t.P.AUI_BUILD_DATE,e={ENABLE_CONTINUE:"enableContinue",DISABLE_CONTINUE:"disableContinue"};a.on("checkout:beforeReload",function(){c={}});return{disableContinue:function(a,b,p){f(b)||(p?(f(b)||(c[b]={state:e.ENABLE_CONTINUE,owner:a,toolTipMessage:p}),g()):t.console&&t.console.error&&console.error("_registerElement should not be called with an empty tooltip."));h(b,e.DISABLE_CONTINUE)},enableContinue:function(a){f(a)&&h(a,e.ENABLE_CONTINUE)}}});"use strict";r.when("jQuery").register("cache-page-data-controller",
function(a){var n={};return{clearCache:function(){n={}},setCachedPageData:function(k,m,f,h,g){var p=[],c=!0;a(".cacheable-spp-panel").each(function(){var b=a(this),d;d=!b||b.find(".is-scheduled-delivery").length?!1:!0;if(!d)return c=!1;b.find(".expand-panel-button").removeClass("a-button-focus");p.push({id:b.attr("id"),content:b[0].outerHTML})});if(c){var b={panels:p};a(".cacheable-spp-section").each(function(){var c=a(this);b[c.attr("id")]=c[0].outerHTML});n[k+"-"+m]={curPageData:b,state:t.history?
history.state:f,page:k,title:document.title||h,url:t.location.href||g}}},getCachedPageData:function(a,m){return n[a+"-"+m]}}});"use strict";r.when("A").register("checkout-general-utils",function(a){var n=a.$,k={moveToNextInput:function(a){a=a.nextAll(":visible").find("input").get(0);a!==[]&&a.focus()},hide:function(a){a.hide()},show:function(a){t.P&&t.P.AUI_BUILD_DATE&&a.hasClass("aok-hidden")&&a.removeClass("aok-hidden");a.show()},getAssocParamValuesFromUrl:function(a){var f={};if("string"!==typeof a||
-1===a.indexOf("?"))return f;a=a.slice(a.indexOf("?")+1).split("\x26");for(var h=0;h<a.length;h++){var g=a[h].split("\x3d");f[g[0]]=g[1]}return f},addQueryStringParameter:function(a,f,h){var g=k.getAssocParamValuesFromUrl(a);g[f]=h;a=0<=a.indexOf("?")?a.substring(0,a.indexOf("?")):a;return a=a+"?"+n.param(g,1)},redirectWithJavascript:function(a){t.location=k.addQueryStringParameter(a,"hasWorkingJavascript","1")},migrateHelpLinksToMobile:function(a){a&&a.selector&&a.length&&a.find("a[href*\x3d'/gp/help/customer/display.html'][href*\x3d'nodeId\x3d']").each(function(){var a=
k.getAssocParamValuesFromUrl(n(this).attr("href"))||{},a=parseInt(a.nodeId,10);0<a&&n(this).attr("href","/gp/aw/help/?id\x3d"+a)})},bindActionEnterKeyOnButton:function(a){a.keyup(function(a){13===a.which&&n(a.target).trigger("click")})},toggleExpanderContent:function(a){a=a.$target.closest(".a-box");a.hasClass("a-single")?a.removeClass("a-single").addClass("a-first"):a.addClass("a-single").removeClass("a-first")},validateNumber:function(a,f,h){n.trim(a);return/^\d+$/.test(a)&&a>=f&&a<=h}};k.protectAgainstDoubleAction=
function(){var a={};return function(f,h){if(!f)return t.console&&t.console.error&&console.error("Function is not used properly, use a unique owner to identify the caller."),!1;if(a.hasOwnProperty(f))return!0;a[f]=1;setTimeout(function(){delete a[f]},h||100);return!1}}();k.logError=function(a){t.ueLogError&&t.ueLogError({message:a});t.console&&t.console.error&&console.error(a)};k.updateCartByMash=function(a){r.when("safe-mash").execute(function(f){null!==a&&void 0!==a&&"1"===n("#updateCartByMash").attr("content")&&
f&&f.cart&&f.cart.didUpdate&&f.cart.didUpdate({newCartQuantity:a})})};k.getPosition=function(a,f,h){for(var g=0,p=a.length,c=0;c<p;c++)if(a.charAt(c)===f&&(g++,g===h))return c;return-1};k.limitInputToNumbers=function(a){var f=a.$event.keyCode;-1!==n.inArray(f,[46,8,9,37,39])||-1!==n.inArray(f,[65,67,86])&&!0===a.ctrlKey||(a.$event.shiftKey||(48>f||57<f)&&(96>f||105<f))&&a.$event.preventDefault()};k.nukeDropdowns=function(a){r.when("a-popover-base").execute(function(f){n.each(n(a),function(){f.remove(this.name)})})};
a.on("checkout:reload",function(){n('input[name\x3d"useLiveAUI"]').length||a.defer(function(){n(".a-declarative, .a-button").filter("[data-action]").unbind("keypress.checkout-page").bind("keypress.checkout-page",function(a){13===a.which&&n(this).trigger("click")})})});a.on("checkout:beforeLoadPage",function(){n("div.a-popover").find(".a-declarative:first:[data-action\x3dcustom-popover-close|a-popover-close]").click()});return k});"use strict";r.when("A").register("client-side-metrics",function(a){var n=
a.$,k=null,m=null,f=0,h,g=function(a){t.ue&&t.ue.t&&t.uet(a,k)},p=function(a){t.ue&&t.uex&&t.uex(a,k)},c=function(a){t.ue&&t.ues&&t.ues("id",k,a)},b=function(){t.ue&&t.ues&&t.ues("ctb",k,"1")},e=function(){t.ue&&t.ues&&(t.ues("t0",k,(new Date).getTime()),g("ue"),g("bb"))},d=function(a){a?m="ctbajax"+f++:k="ajax"+f++},y=function(a){if(a&&a.length){var b=k;k=m;c(a);k=b}},A=function(){void 0===h&&(h=0<n("#transitionLogging").length);return h};return{getscope:function(){return k},getasyncscope:function(){return m},
setmarker:g,sendue:p,setrid:c,setctb:b,resetue:e,createscope:d,setscope:function(a){k=a},increaseCount:function(a,b,d){"undefined"!==typeof t.ue&&"undefined"!==typeof t.ue.count&&(b=b?b:1,d?t.ue.count(a,(t.ue.count(a)||0)+1):t.ue.count(a,b))},resetMetrics:function(){k=m;b();e()},setAsyncRequestId:y,sendUEPageLoadStats:function(){p("ld");d(1)},isTransitionLoggingEnabled:A,logPageTransition:function(a,b,d,c){if(A()){var e=(new Date).getTime();n.ajax({type:"POST",url:"/gp/buy/shared/handlers/log-page-transition.html?cachebuster\x3d"+
e,data:{fromPage:a,toPage:b},async:!0,cache:!1,timeout:1E3,success:function(a,b,c){var e=c.getResponseHeader("x-amz-checkout-requestid");y(e);d&&d.call(this,a,b,c)},complete:function(a,b){c&&c.call(this,a,b)}})}}}});"use strict";r.register("currency-formatter",function(){function a(n,k){isNaN(k)||(n=Number(n).toFixed(k));n=n.toString();var m=0<=n.lastIndexOf(".")?n.lastIndexOf("."):n.length;return 3>=m?n:a(n.substring(0,m-3),0)+","+n.substring(m-3)}return{getNumberWithSeparators:a}});"use strict";
r.when("A","client-side-metrics","page-conductor","page-detector").register("delivery-preferences-csm-helper",function(a,n,k,m){function f(a){var c=k.isSPP()?"spp":"mpp",b="desktop";m.isMobile()?b="mobile":m.isTablet()&&(b="tablet");n.increaseCount("checkout:delivery-preferences:"+b+":"+c+":"+a,1)}function h(a){return 0===a.length?"NoValueSet":a}var g=a.$;return{recordCSM:f,recordCSMWithCurrentFieldValues:function(a,c,b){c=g("input[name\x3d"+c+"]:checked");c.length&&(c=c.val(),f(a+":preference:"+
h(c)));b=g("input[name\x3d"+b+"]");b.length&&f(a+":set-as-default:"+(b.is(":checked")?"yes":"no"))},recordCSMForEligiblePages:function(a){a=a||"";f(a+"eligible-page-displayed");var c=g("input[name\x3ddelivery-preferences-preference-set]");c.length&&f(a+"summary-displayed:preference:"+h(c.val()))}}});"use strict";r.when("page-detector-current-page","A").register("error-feature-detection",function(a,n){function k(a){t.errorFeatureDetection&&t.errorFeatureDetection.safelyLogError?t.errorFeatureDetection.safelyLogError(a):
(t.ueLogError&&t.ueLogError(a),t.console&&t.console.error&&console.error(a))}try{n.on("page-detector:page-changed",function(){var f=a.getCurrentPage();if(f&&"spc"===f)try{t.errorFeatureDetection&&t.errorFeatureDetection.enableErrorHandling&&t.errorFeatureDetection.enableErrorHandling()}catch(h){k(h)}else try{t.errorFeatureDetection&&t.errorFeatureDetection.disableErrorHandling&&t.errorFeatureDetection.disableErrorHandling()}catch(g){k(g)}})}catch(m){k(m)}return{registerFeature:function(a,h){try{t.errorFeatureDetection&&
t.errorFeatureDetection.registerFeature&&t.errorFeatureDetection.registerFeature(a,h)}catch(g){k(g)}},markFeatureAvailable:function(a){try{t.errorFeatureDetection&&t.errorFeatureDetection.markFeatureAvailable&&t.errorFeatureDetection.markFeatureAvailable(a)}catch(h){k(h)}},markFeatureUnavailable:function(a){try{t.errorFeatureDetection&&t.errorFeatureDetection.markFeatureUnavailable&&t.errorFeatureDetection.markFeatureUnavailable(a)}catch(h){k(h)}}}});r.when("error-feature-detection").execute(function(a){a.registerFeature("continue-action",
0);a.markFeatureAvailable("javascript-detection");a.markFeatureAvailable("continue-action")});"use strict";r.when("A","loading-spinner-controller","ajax-utility","currency-formatter","page-conductor","page-transition-controller").register("inline-points-register-controller",function(a,n,k,m,f,h){function g(a){var b=new RegExp(String.fromCharCode(65340),"g"),d=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(d,String.fromCharCode(92));a=a.replace(/\\1/g,
String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))}function p(a){var b=A.$popover.find(".rewards-registration");n.hideSpinner(b);b.children("div").hide();b=b.find(".rewards-registration-error");a&&a.error?(a=b.find("[data-error\x3d'"+a.error+"']"),a.length?a.show():b.find("[data-error\x3d'rewards_SystemUnavailable']").show()):b.find("[data-error\x3d'rewards_SystemUnavailable']").show();b.fadeIn(300)}function c(a){A=a.popover;var b=A.$popover.find(".rewards-registration");
n.showSpinner(b,!1,A);a=b.data("issuer-id");var d=b.data("program-id"),c=b.data("cc-issuer"),e=b.data("cc-brand"),b=b.data("parent-payment-method-id"),l="/gp/buy/payselect/handlers/get-rewards-configuration.html?cachebuster\x3d"+(new Date).getTime();y.ajax({type:"POST",url:l,data:"programid\x3d"+d+"\x26partner\x3d"+a+"\x26ccpaymentinstrumentid\x3d"+b+"\x26issuer\x3d"+c+"\x26brand\x3d"+e+"\x26hasWorkingJavascript\x3d1",dataType:"text",async:!0,cache:!1,dataFilter:function(a){return k.jsonify(a)},success:function(a,
b,l){b=A.$popover.find(".rewards-registration");n.hideSpinner(b);l=a.fields||{};for(var d in l)if(l.hasOwnProperty(d)){var c=l[d],e=b.find("[data-field\x3d'"+c.type+"']");c.value&&e.filter("input").attr("value",c.value);e.parents(".rewardsfield").show()}a.termshtml&&b.find(".rewardstermstext").html(g(a.termshtml));a.billingzip&&b.find("[data-field\x3dBILLING_POSTAL_CODE]").attr("value",a.billingzip);if(a.displaydata){d=b.find("[data-field]");for(var f in a.displaydata)a.displaydata.hasOwnProperty(f)&&
d.filter("[data-field\x3d"+f+"]").html(a.displaydata[f])}a.marketinglink&&b.find("[data-field\x3d'rewards_marketing_link']").html(a.marketinglink);b.find("#rewards-registration-image").show();b.find(".rewards-registration-main").fadeIn(300);A.updatePosition(!0)},error:function(a){p(a)}})}function b(){if(A){var a=A.$popover.find(".rewards-registration");n.hideSpinner(a);a.find(".rewards-registration-success").hide();a=a.find(".rewards-registration-error");a.hide();a.find("h4").hide();z&&(h.show(),
f.isSPP()?f.reloadPage():y("div.pay").length?f.loadPage("payselect","payselect"):y("div.spc").length&&f.loadPage("spc","spc"))}}function e(a){return a.is("input")?a:a.find("input")}function d(){if(A){var a=A.$popover.find(".rewards-registration");a.find(".rewards-registration-main").hide();a.find("#rewards-registration-image").hide();n.showSpinner(a,!1,A);var b=(new Date).getTime(),d="programid\x3d"+encodeURIComponent(a.data("programId")),d=d+("\x26paymentinstrumentid\x3d"+encodeURIComponent(a.data("parent-payment-method-id"))+
"\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1\x26cachebuster\x3d"+b),c=a.find("[data-field]");c.each(function(){var a=y(this).attr("data-field");if("CVV2"===a)d+="\x26registerRewardsCreditCardVerificationNumber\x3d"+encodeURIComponent(y(this).val());else if(y(this).data("entryindex")){if(1===y(this).data("entryindex")){var b=c.filter("[data-field\x3d"+a+"]").sort(function(a,b){return Number(y(a).data("entryindex"))-Number(y(b).data("entryindex"))});d+="\x26"+a+"\x3d";b.each(function(){d+=encodeURIComponent(y(this).val())})}}else"TERMS_AND_CONDITIONS"===
a?e(y(this)).is(":checked")&&(d+="\x26"+a+"\x3dtrue"):d+="\x26"+a+"\x3d"+encodeURIComponent(y(this).val())});b="ox_pay_page_swp_reg_popover_submit";a.data("programId")&&(b+="_"+a.data("programId"));a="/gp/buy/payselect/handlers/register-rewards-account.html/ref\x3d"+b+"?cachebuster\x3d"+(new Date).getTime();y.ajax({type:"POST",url:a,data:d,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return k.jsonify(a)},success:function(a,b,d){a?a&&0===a.success?p(a):A&&(b=A.$popover.find(".rewards-registration-success"),
b.find(".customername").text(a.customername),a.dollarbalancedisplay&&a.pointsbalance&&(b.find("[data-field\x3d'rewardsamount']").html(a.dollarbalancedisplay),b.find("[data-field\x3d'pointsamount']").html(m.getNumberWithSeparators(a.pointsbalance,a.rewardsdecimalplaces)),b.find(".rewardsuccessbalance").show()),a.showwarnmessage&&b.find(".warnmessage").show(),z=!0,b.fadeIn(300),n.hideSpinner(A.$popover.find(".rewards-registration"))):p()},error:function(a){p(a)}})}}var y=a.$,A,z=!1;a.on("a:popover:show:rewards-registration",
c);a.on("a:popover:hide:rewards-registration",b);a.declarative("close-rewards",["click"],function(a){a.$event.preventDefault();a.$target.closest(".a-popover").find(".a-button-close").trigger("click")});a.declarative("rewards-signup",["click"],function(a){a.$event.preventDefault();d(a)});a.declarative("toggle-reward-signup-button","change",function(a){a=a.$target;var b=A.$popover.find(".rewards-registration");a&&a.is(":checked")?(b.find("#reward-signup-button").removeClass("aok-hidden"),b.find("#disabled-reward-signup-button").addClass("aok-hidden")):
(b.find("#reward-signup-button").addClass("aok-hidden"),b.find("#disabled-reward-signup-button").removeClass("aok-hidden"))});a.on("a:popover:beforeShow:cvv2helpcontent",function(a){a.popover.$popover.find(".a-popover-inner").html(y(".cvv2helpcontent").text());a.popover.updatePosition()});return{displayRewardsRegister:c,hideRewardsRegister:b}});"use strict";r.when("A","error-feature-detection","safe-mash","ready").register("shared-kitchensink",function(a,n,k){function m(a){var f={15015711:"901888"};
if(/.+?nodeId=(\w+?)&.*/.test(a)){var p=RegExp.$1,p=f[p]?f[p]:p;return a.replace(/(.+?)(\?.+)/,"/gp/aw/help/id\x3d"+p+"$2")}return a}var f=a.$;a.on("checkout:reload",function(){(f("body.a-touch").length||f("div.a-touch:first").length)&&f("html").addClass("a-touch");f("form").each(function(){var a=f(this).find('input[name\x3d"hasWorkingJavascript"]');a&&0<a.length?a.val("1"):f(this).append('\x3cinput type\x3d"hidden" name\x3d"hasWorkingJavascript" value\x3d"1" /\x3e')});k&&(f("div.checkout-tablet a[target\x3d'AmazonHelp']").each(function(){var a=
f(this).attr("href"),a=a+(0<=a.indexOf("?")?"\x26app-nav-type\x3dmodal":"?app-nav-type\x3dmodal"),a=a.replace("#",""),a=m(a);f(this).attr("href",a);f(this).removeAttr("data-action");f(this).removeAttr("data-help-popup");f(this).removeAttr("onclick")}),f("div.checkout.mobile a[target\x3d'AmazonHelp']").each(function(){var a=f(this).attr("href"),a=a.replace("#",""),a=m(a);f(this).attr("href",a);f(this).removeAttr("data-help-popup");f(this).removeAttr("onclick");f(this).addClass("a-declarative help-popup");
f(this).attr("data-action","help-popup")}));if(0<f("div.checkout-tablet").length)for(var a=document.getElementsByTagName("a"),g=0;g<a.length;g++)a[g].href||(a[g].href="#")});f(document).bind("jsdetection",function(){n.markFeatureAvailable("javascript-detection")})});r.when("A","safe-mash","ready").execute(function(a,n){var k=a.$;a.declarative("mash-navigate",["click"],function(a){a=a.$currentTarget.attr("href");n&&n.navigate?n.navigate({url:a}):t.location.href=a});a.declarative("expander-scroll-there",
["click"],function(a){if("false"!==a.$currentTarget.closest(".a-expander-container").find(".a-expander-content").attr("aria-expanded")){var f=k(t),h=k(document),g=a.$currentTarget.offset().top,p=0,c=0,b=function(){t.setTimeout(function(){f.scrollTop(g);p===h.height()?c++:(c=0,p=h.height());10>c&&b()},10)};b()}})});t.amz_js_PopWin=function(a,n,k){(a=t.open(a,n,k))&&a.focus&&a.focus();return!1};var ka=!1;t.confirmPurchase_onSubmit||(t.confirmPurchase_onSubmit=function(){return ka?!1:ka=!0});"use strict";
r.when("A","error-feature-detection","loading-spinner-spp-controller").register("loading-spinner-controller",function(a,n,k){function m(a){if(h&&g){var d,c,u;b&&y?(a=b.getContent(),d=a.innerHeight(),c=a.innerWidth()):(d=a.height(),c=a.width());u=a.offset();a=g.width();var q=g.height();if(p)u="1"===f("input[name\x3dfromAnywhere]").val()?f(document).height():f(t).height(),h.width(f(document).width()).height(u).css("left","0px").css("z-index",2E3),g.css("left",c/2-a/2+"px").css("top",d/2-q/2+"px").css("z-index",
4E3).show();else{var k=f(t),l=y?k.scrollLeft():0;h.css("position","fixed").width(c).height(d).css("z-index",3E3).css("left",u.left-l).css("top",u.top-k.scrollTop());e?g.css("position","fixed").css("left",u.left-l+(c/2-a/2)+"px").css("top",u.top-k.scrollTop()+(d/2-q/2)+"px").css("z-index",4E3).show():g.css("left",c/2-a/4+"px").css("top",d/2-q/4+"px").css("z-index",4E3).show()}}}var f=a.$,h,g,p,c,b,e=!1,d=!1,y=!1,A=!1;a.on("a:popover:positionUpdated",function(a){if(y&&b&&b.name===a.popover.name&&h&&
g){var d=b.getContent();a=d.innerHeight();var c=d.innerWidth(),d=d.offset(),e=f(t);h.width(c).height(a).css("left",d.left-e.scrollLeft()).css("top",d.top-e.scrollTop());g.css("left",d.left-e.scrollLeft()+(c/2-g.width()/2)+"px").css("top",d.top-e.scrollTop()+(a/2-g.height()/2)+"px")}});a.on("checkout:reload",function(){var a="https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-4x._V391853216_.gif",b=f("#first-pipeline-load-page-spinner-img");b.length&&(a=f.trim(b.attr("src")));
1>f("#loading-spinner-blocker-doc").length&&(a=f(['\x3cdiv class\x3d"template loading-spinner" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading-spinner-blocker"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading-spinner-inner"\x3e','\x3cimg id\x3d"loading-spinner-img" class\x3d"loading-spinner-img" src\x3d"'+a+'"/\x3e','\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"loading-spinner-blocker-doc" class\x3d"loading-spinner-blocker" style\x3d"display:none;"\x3e\x3c/div\x3e\x3cdiv id\x3d"spinner-anchor" class\x3d"spinner-anchor" style\x3d"display:none"\x3e\x3c/div\x3e'].join("")),
g=h=c=null,"1"===f("#showSpinnerWithoutBox").attr("content")&&a.find(".loading-spinner-inner").addClass("loading-spinner-inner-no-box"),f("body").prepend(a));f("input[name\x3duseModifiedSpinnerResizeFn]").length&&(e=!0);f("#useRelativeSpinner").length&&(d=!0);f("#modifiedBlockerDivSize").length&&(y=!0)});return{showSpinner:function(a,C,w){if(d&&!C&&y&&e&&w)return A=!0,k.showSpinner(a,w);A=!1;0!==a.length&&(b=(p=C)?void 0:w,c||(c=f(".loading-spinner.template").clone().removeClass("template"),c.show()),
a.append(c),p?(h=f("#loading-spinner-blocker-doc"),a.find(".loading-spinner-blocker").hide()):h=a.find(".loading-spinner-blocker"),h.show(),p&&n.markFeatureUnavailable("continue-action"),g=a.find(".loading-spinner-inner"),m(a))},hideSpinner:function(a,b){if(A)return A=!1,k.hideSpinner(a,b);A=!1;h&&(p&&(h.hide(),n.markFeatureAvailable("continue-action")),c.detach());b&&a.hide()},adjustSize:function(a){return A?k.adjustSize():m(a)}}});"use strict";r.when("A","error-feature-detection").register("loading-spinner-spp-controller",
function(a,n){function k(){if(f&&h){var a=p.innerHeight(),c=p.innerWidth();f.width(c).height(a);h.css("left",c/2-h.width()/2+"px").css("top",a/2-h.height()/2+"px")}}var m=a.$,f,h,g,p,c;a.on("a:popover:positionUpdated",function(a){c&&c.name===a.popover.name&&k()});a.on("checkout:reload",function(){var a="https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-4x._V391853216_.gif",c=m("#first-pipeline-load-page-spinner-img");c.length&&(a=m.trim(c.attr("src")));1>m(".loading-spinner-spp").length&&
(a=m(['\x3cdiv class\x3d"template loading-spinner-spp" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading-spinner-spp-blocker"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading-spinner-spp-inner"\x3e','\x3cimg class\x3d"loading-spinner-spp-img" src\x3d"'+a+'"/\x3e',"\x3c/div\x3e\x3c/div\x3e"].join("")),h=f=g=null,"1"===m("#showSpinnerWithoutBox").attr("content")&&a.find(".loading-spinner-inner").addClass("loading-spinner-inner-no-box"),m("body").prepend(a))});return{showSpinner:function(a,e){0!==a.length&&
(c=e,p=a,g||(g=m(".loading-spinner-spp.template").clone().removeClass("template"),g.show()),e.getContent().before(g),p.prepend(g),f=p.find(".loading-spinner-spp-blocker"),f.show(),h=p.find(".loading-spinner-spp-inner"),k())},hideSpinner:function(a,c){f&&g.detach();c&&a.hide()},adjustSize:k}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-detector-current-page","checkout-general-utils","client-side-metrics","safe-mash","cache-page-data-controller","ajax-wrapper","widget-streamer",
"widget-streamer-utils","weblab-helper").register("page-conductor",function(a,n,k,m,f,h,g,p,c,b,e,d){function y(a){t.ueLogError&&t.ueLogError({message:a},{logLevel:"WARN",attribution:"CheckoutCommonAsset-PageConductor"})}function A(a){ba&&(a?(a["x-amz-checkout-transition"]||(a["x-amz-checkout-transition"]="ajax"),a["x-amz-checkout-type"]||(a["x-amz-checkout-type"]="spp")):a={"x-amz-checkout-transition":"ajax","x-amz-checkout-type":"spp"});return a}function z(){ha=!1;X=null;oa=0;ia=!1;la=null}function C(a){var b=
parseInt(G("#checkoutDisplayPage").data("delaySetTitle"),10)||0;b?t.setTimeout(function(){document.title=a},b):document.title=a}function w(b){a.trigger("checkout:beforeReload");a.trigger("checkout:reload");b&&("spp-revieworder"===b?a.trigger("checkout:reload:spc"):a.trigger("checkout:reload:"+b));a.trigger("checkout:afterReload")}function u(a){n.show();var b="/gp/buy/addtocart/handlers/display.html";a&&(b+="?errorType\x3d"+a);t.location=b}function q(b,l){var d;if(l.getResponseHeader("x-amz-force-full-page-update"))v(b);
else{if(l.getResponseHeader("x-amz-checkout-redirect-addtocart")){(d=k.jsonify(b))?u(d.errorCode):u();return}d=sa(b)}var c=G("#pipelinedPageTitle").text();C(c);var e=l.getResponseHeader("x-amz-checkout-page");ba?a.delay(function(){h.setmarker&&h.setmarker("cf");w(e)},d):w(e)}function v(a){var b=document.open("text/html","replace");b.write(a);b.close()}function l(a,b){try{if(b.getResponseHeader("x-amz-force-full-page-update"))v(a);else{if(!za)throw Error("Member _updateDisplayPageContent not set in page-conductor. Make sure 'initFunc' is called.");
za(a)}}catch(l){var d="Error while replacing page content.";l.message&&(d+="  Error message: "+l.message);r.error(d,"page-conductor","replaceDisplayPage",l)}h.setmarker&&h.setmarker("cf");d=G("#pipelinedPageTitle").text();C(d);d=b.getResponseHeader("x-amz-checkout-page");w(d)}function O(a){var b=parseInt(G("#showPageTransition").attr("content"),10);(b=isNaN(b)?1:b)||n.hide();b="/gp/buy/shared/handlers/dispatch.html";a&&(a.conductoraction&&a.conductoraction.url?b=a.conductoraction.url:a.pipedata&&
a.pipedata.conductoraction&&a.pipedata.conductoraction.url&&(b=a.pipedata.conductoraction.url));b=0<b.indexOf("?")?b+"\x26":b+"?";G("input[name\x3dfromAnywhere][value\x3d1]").length&&(b+="fromAnywhere\x3d1");b=Z(b);g&&G("html").hasClass("a-tablet")&&-1<b.indexOf("/gp/cart/view.html")&&(b="/gp/aw/c?app-action\x3dcart");t.location=b}function K(a,b,l,d){d=d||{};d.pushNewFrame=d.pushNewFrame||"true";d.anchor=d.anchor||void 0;z();"true"===d.pushNewFrame&&g&&g.navigate&&G("#checkoutDisplayPage").data("useMashNavigateForTransitions")?
g.navigate({url:null,transitionEffect:"slide",successCallback:function(){F(a,b,l,d)},failCallback:function(a){}}):F(a,b,l,d);d.keepCachedPagesData||p.clearCache()}function B(){var a=G("input#isPipelinedPage");return 0<a.length&&"1"===a.val()}function F(a,b,c,f){f=f||{};f.pushNewFrame=f.pushNewFrame||"true";f.anchor=f.anchor||void 0;var g=c.getResponseHeader("x-amz-checkout-page");m.setCurrentPage(g);if(f.freshLoad)f.freshLoad=!1,r.when("first-load-dependencies").execute(function(d){F(a,b,c,f)});else if(g){ba&&
h.setmarker&&h.setmarker("af");G("head .aui-page-asset").removeAttr("disabled");G("head .old-pipeline-asset").removeAttr("disabled");var u=c.getResponseHeader("x-amz-checkout-requestid");h.setAsyncRequestId(u);if(u=c.getResponseHeader("x-amz-checkout-redirect"))O({conductoraction:{url:u,type:"redirect"}});else{var u=c.getResponseHeader("x-amz-checkout-url"),p=c.getResponseHeader("x-amz-checkout-additional-page-args");d.isAJAXWeblabOn()&&e.isStreamingAjax(c)?Q(a,g):0<G("#checkoutDisplayPage").length?
l(a,c):q(a,c);var v=G("#pipelinedPageTitle").text();B()&&v&&u&&t.history&&t.history.pushState&&(u=Z(u),f.anchor&&(u+=f.anchor),"true"===f.pushNewFrame&&history.state&&history.state.page!==g&&history.pushState({page:g,additionalURLArgs:p},v,u));f.anchor&&(g=G(f.anchor),0===g.length&&(g=f.anchor.replace("#",""),g=G(document.getElementsByName(g))),g.length&&G(document).scrollTop(g.offset().top));f.logUsedPrefetch&&r.when("action-logger").execute(function(a){a.logUsedPrefetch(c.getResponseHeader("x-amz-checkout-page-type"),
c.getResponseHeader("x-amz-checkout-sub-page-type"))})}}else{if(t.getOldAjaxSuccessCallback)return t.getOldAjaxSuccessCallback("ajaxConductor","generalErrorHandling","generalErrorHandling")(a,b,c);a=k.jsonify(a);O(a)}}function Q(a,b){a.execute();var d=G("#pipelinedPageTitle").text();C(d);w(b)}function L(){t.location=H?"/gp/buy/addtocart/handlers/display.html":"/gp/buy/payselect/handlers/error.html"}function J(b,l,f,g,q){g=g||{};g.refTag=g.refTag||"";g.pushNewFrame=g.pushNewFrame||"true";g.anchor=
g.anchor||void 0;g.refTag&&0!==g.refTag.indexOf("/ref\x3d")&&(g.refTag="/ref\x3d"+g.refTag);b="fromPage\x3d"+b+"\x26page\x3d"+l;f&&(b+="\x26"+f);f=function(){};l=function(){};var u,p;"function"===typeof g.resultscallback?(u=function(a,b,d){g.resultscallback(a,b,d)},p=function(a,b,d){g.resultscallback(void 0,b,a)}):(f=function(b){a.trigger("checkout:beforeLoadPage");ja&&ja.abort();ja=b},u=function(a,b,l){d.isAJAXWeblabOn()&&e.isStreamingAjax(l)||g.callbackBeforePageUpdate&&g.callbackBeforePageUpdate();
K(a,b,l,g);g.callbackAfterPageUpdate&&g.callbackAfterPageUpdate()},p=function(a,b,d){E(a,b);"abort"!==b&&("error"===b&&a.readyState===c.READY_STATE.UNSET?r.when("a-tv","mash").execute(function(a,b){t.cordova.exec(null,null,"MASHDisplayErrorPlugin","execute",{})}):L())},l=function(a){ja=null});q={type:"GET",url:(q?q:"/gp/buy/shared/handlers/pipeline-dispatch.html")+g.refTag,data:b,dataType:"text",async:!0,beforeSend:f,success:u,error:p,complete:l,cache:!1};ba&&(q.headers=A({"x-amz-checkout-transition":"ajax"}));
return d.isAJAXWeblabOn()?(q.useXMLHttp=!0,q=P(q,g.callbackBeforePageUpdate),c.aui(q)):G.ajax(q)}function P(a,d){a.timeout=5E4;a.data=S(a.data,"acceptsStreaming\x3d1");var l;l=a.data.match(/.*isAsync=1.*/)?!0:!1;var c=b({isPrefetch:l,before:d});a.chunk=c.onNewChunk;var f=a.success;a.success=function(a,b,d){f&&e.isStreamingAjax(d)?f(c,b,d):f&&f(a,b,d)};return a}function S(a,b){return a?a+"\x26"+b:b}function E(a,b){h.increaseCount("Checkout:PageConductor:Ajax:Error");d.isAJAXWeblabOn()?(a?(h.increaseCount("Checkout:AUI:Ajax:jqXHR:defined"),
y("jqXHR defined throw CheckoutErrorAW under AJAX Weblab, textStatus:"+b+" stateCode:"+a.state+" readyState:"+a.readyState)):void 0===a?(h.increaseCount("Checkout:AUI:Ajax:jqXHR:undefined"),y("jqXHR undefined throw CheckoutErrorAW under AJAX Weblab")):null===a&&(h.increaseCount("Checkout:AUI:Ajax:jqXHR:null"),y("jqXHR null throw CheckoutErrorAW under AJAX Weblab")),h.increaseCount("Checkout:AUI:Ajax:Error:textStatus:"+b),h.increaseCount("Checkout:AUI:Ajax:Error:statusCode:"+a.status),h.increaseCount("Checkout:AUI:Ajax:Error:readyState:"+
a.readyState)):(a?(h.increaseCount("Checkout:jQuery:Ajax:jqXHR:defined"),y("jqXHR defined throw CheckoutErrorAW using jQuery, textStatus:"+b+" stateCode:"+a.state+" readyState:"+a.readyState)):void 0===a?(h.increaseCount("Checkout:jQuery:Ajax:jqXHR:undefined"),y("jqXHR undefined throw CheckoutErrorAW using jQuery")):null===a&&(h.increaseCount("Checkout:jQuery:Ajax:jqXHR:null"),y("jqXHR null throw CheckoutErrorAW using jQuery")),h.increaseCount("Checkout:jQuery:Ajax:Error:textStatus:"+b),h.increaseCount("Checkout:jQuery:Ajax:Error:statusCode:"+
a.status),h.increaseCount("Checkout:jQuery:Ajax:Error:readyState:"+a.readyState))}function T(a,b,l,e){b=S(b,"isClientTimeBased\x3d1");var f=a.indexOf("?");0<f&&(b+="\x26"+a.substring(f+1),a=a.substring(0,f));f=a.indexOf("/gp/buy/");0<f&&(a=a.substring(f));if(-1===a.indexOf(".html"))return!1;var g=a.indexOf(".html"),f=a.substring(g+5);a=a.substring(0,g+5);b+="\x26handler\x3d"+a;f&&-1===f.indexOf("ref\x3d")&&(f="");a={type:"POST",url:"/gp/buy/shared/handlers/async-continue.html"+f,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
headers:A({"x-amz-checkout-transition":"ajax"}),data:b,dataType:"text",async:!0,success:l,error:function(a,b,d){E(a,b);"abort"!==b&&("error"===b&&a.readyState===c.READY_STATE.UNSET?r.when("a-tv","mash").execute(function(a,b){t.cordova.exec(null,null,"MASHDisplayErrorPlugin","execute",{})}):"function"===typeof e&&e())},cache:!1};return d.isAJAXWeblabOn()?(a.useXMLHttp=!0,P(a),c.aui(a)):G.ajax(a)}function U(a,b,d,l,c){c=c&&c.action?c.action:a.attr("action");a=a.serialize();l&&(a+="\x26isAsync\x3d1");
return T(c,a,b,d)}function aa(a,b,d,l){a=Z(a.attr("href"));l&&(a+="\x26isAsync\x3d1");return T(a,"",b,d)}function da(a){a=a||{};a.logUsedPrefetch=1;K(X.data,X.status,X.response,a)}function Z(a){-1===a.toLowerCase().indexOf("hasworkingjavascript")&&(a+=(0<=a.indexOf("?")?"\x26":"?")+"hasWorkingJavascript\x3d1");return a}function W(a){ia=!1;ma&&clearTimeout(ma);if(a.is("form"))V(a)?da():U(a,K,L);else if(a.is("a"))if(ea(a)){var b;1===parseInt(a.data("keepCachedPagesData"),10)&&(b={keepCachedPagesData:1});
da(b)}else aa(a,K,L);else r.error("function called without a trigger","page-conductor","handleContinueAction")}function V(a){return a.is("form")&&null!==X&&X.serializedValue===a.serialize()}function ea(a){return a.is("a")&&null!==X&&Z(X.serializedValue)===Z(a.attr("href"))}function x(a,b,l,c,f){function g(f,u,v){var m=!0;if("success"===u){if(!d.isAJAXWeblabOn()||!e.isStreamingAjax(v)){var w=k.jsonify(f);null!==w&&w&&w.result&&"noPrefetch"===w.result&&(X=null,m=!1)}m&&(X={},X.serializedValue=p,X.data=
f,X.status=u,X.response=v)}else X=null;ha=!1;ba&&r.when("spp-button-blocker").execute(function(a){a.hideDefaultContinueBtnBlocker()});if(ia)return W(la),!0;if(m){var O=function(){c?x(a,b,l,!0):Y(a)};if(null===X||"form"===q&&X.serializedValue!==a.serialize())return O(),!0;b&&(0===b?h.increaseCount("checkoutPrefetchTimeoutSetToZero",1):ma=setTimeout(function(){X=null;O()},1E3*b))}return!0}if(!B()||0===a.length)return!1;var q=a.get(0).tagName.toLowerCase();if("form"!==q&&"a"!==q||"function"===typeof f&&
!f(q))return!1;b=b||0;l=l||0;c=c||!1;if(ha||oa>=l)return!1;ha=!0;ba&&r.when("spp-button-blocker").execute(function(a){a.showDefaultContinueBtnBlocker()});oa++;ma&&clearTimeout(ma);var u,p=null;"form"===q?(p=a.serialize(),u=d.isAJAXWeblabOn()?U(a,g,g,!0):U(a,null,null,!0)):"a"===q&&(p=Z(a.attr("href")),u=d.isAJAXWeblabOn()?aa(a,g,g,!0):aa(a,null,null,!0));d.isAJAXWeblabOn()||u.always(g)}function Y(a){var b=parseInt(a.data("prefetchTimeout"),10),d=parseInt(a.data("maxPrefetches"),10);return x(a,b,d,
!1,function(b){return a.find("input:checked").hasClass("no-prefetch")||"1"===G("input#block-prefetch").val()||"1"===G("input#block-all-prefetch").val()||"form"===b&&!a.data("checkoutFormReady")?!1:!0})}function R(b,d){b&&b.preventDefault();var l=b?G(b.currentTarget):d,c=function(){if(ba){n.blockAllActions();var a=l.data("shrink-panel"),b=l.data("loading-text");(a=G("#"+a))&&a.length?a.hasClass("expanded")||n.shrinkPanel(G(".spp-panel.expanded"),!1):a=G(".spp-panel.expanded");n.shrinkPanel(a,!0,b)}else n.show()};
h.resetMetrics();!ra||V(l)||ea(l)?c():a.delay(c,0);try{ia=!0,la=l,ha||W(l)}catch(e){c="An error occured while click on the continue button.",e.message&&(c+="  Error message: "+e.message),r.error(c,"page-conductor","continueClicked",e)}}var G=a.$,ha,ja,X,oa,ia,la,ma,ua,za,sa=function(a){if(!ua)throw Error("Member _updatePageContent not set in page-conductor. Make sure 'initFunc' is called.");return ua(a)},ba=!1,H=!1,na=!1,ra=!1,N=!1;z();a.declarative("page-transit-no-update-action","click",function(b){if(!na){b.$event.preventDefault();
h.resetMetrics();var l=b.data.targetDeclarativeActionId;if(l&&(l=G("#"+l),l.length)){l.trigger("click");return}var c=b.data.toPage,l=b.data.fromPage||m.getCurrentPage(),e=b.data.refTag||"chk_"+l+"_cancel_pri",f=b.data.args,g=b.$currentTarget.find("a.checkout-pipeline-pref-link");ba&&p.setCachedPageData(l,c);if(p.getCachedPageData(c,l)){h.increaseCount("checkout:"+l+":cancelpri",1);e=p.getCachedPageData(c,l);z();m.setCurrentPage(e.page);var q;q=d.isAJAXWeblabOn()?sa(e.curPageData):sa(JSON.stringify(e.curPageData));
if(ba)if(h.isTransitionLoggingEnabled()){var u=(new Date).getTime();h.logPageTransition(l+"-cached",c,void 0,function(b){b=(new Date).getTime()-u;b<q?a.delay(function(){w(c)},q-b):w(c)})}else a.delay(function(){w(c)},q);else w(c);e.title&&e.url&&t.history&&t.history.pushState&&history.state&&history.state.page!==e.page&&history.pushState(e.state,e.title,e.url)}else g.length?R(null,g):(h.increaseCount("checkoutSPPCancelNoCachedData",1),g=function(){if(ba)if(n.blockAllActions(),b.data.noShrink)n.show();
else{var a=b.data.loadingText,l=G("#"+b.data.shrinkPanel);l.length||(l=b.$currentTarget.closest("div.spp-panel"));n.shrinkPanel(l,!0,a)}else n.show()},ra?a.delay(g,0):g(),J(l,c,f,{refTag:e,keepCachedPagesData:1}))}});a.on("ready",function(){ra=0<G("#executeNonBlockingAnimations").length;N=0<G("#prefetchFromAddressEnabled").length});a.on("checkout:afterReload",function(){n.hide();h.sendUEPageLoadStats();if(B()){var a=G("form.checkout-page-form:not(:disabled):first"),b=G("a.checkout-continue-link:not(:disabled):first");
G("#useFirstActivePrefetch").length&&(b=G("a.checkout-continue-link:not(:disabled)").filter(function(){return 0<(parseInt(G(this).data("maxPrefetches"),10)||0)}).first());var l=!1;a.length&&(l=Y(a));!l&&b.length&&(l=Y(b));!l&&ba&&(a=G("a.checkout-pipeline-pref-link:not(:disabled):first"),a.length&&(b=a.data("fromPage"),l=a.data("toPage"),p.getCachedPageData(l,b)||(l=Y(a))))}});return{ajaxUpdatePage:K,ajaxRedirect:O,ajaxSorryPage:L,isPageLoadRequestInProgress:function(){return ja?1:0},submitFormAjax:U,
reloadPage:function(){var a=m.getCurrentPage();J(a,a)},loadPage:J,usePrefetch:da,makePrefetch:Y,makePrefetchWithParams:x,isPrefetchValidFor:function(a){if(null!==X){var b=X.response.getResponseHeader("x-amz-checkout-page");return a===b}return!1},redirect:O,continueClicked:R,initFunc:function(a,b){ua=a;za=b},overrideIsSPP:function(a){ba=a},isSPP:function(){return ba},overrideAddToCart:function(a){H=a},isAnimating:function(){return na},overrideIsAnimating:function(a){na=a},setAjaxTransitionHeader:A,
isPipeliningOn:B,disablePageNoUpdateTransition:function(){N&&r.when("a-button").execute(function(a){var b=G(".spp-panel.expanded").data("stepIndex");G(".expand-collapsed-panel-trigger").each(function(){var l=G(this),d=l.parents(".spp-panel").data("stepIndex");if(!b||!d||d>b)l.filter(".clickable-heading").removeClass("clickable-heading").addClass("off-clickable-heading"),a(l.filter(".expand-panel-button")).disable(),l.filter("a.expand-panel-button").addClass("disabled-link"),l.parents(".a-declarative").addClass("off-declarative").removeClass("a-declarative")});
G(".panel-cancel-row").hide()})},enablePageNoUpdateTransition:function(){N&&r.when("a-button").execute(function(a){G(".off-clickable-heading").addClass("clickable-heading").removeClass("off-clickable-heading");a(".expand-collapsed-panel-trigger.expand-panel-button").enable();G(".off-declarative").addClass("a-declarative").removeClass("off-declarative")})},isNonBlockingAnimationEnabled:function(){return ra},isPrefetchFromAddressEnabled:function(){return N}}});r.when("jQuery","page-transition-controller",
"ajax-utility","page-detector-current-page","checkout-general-utils","page-conductor","cache-page-data-controller","client-side-metrics","ready").execute(function(a,n,k,m,f,h,g,p){if(h.isPipeliningOn()){t.history&&a(t).bind("popstate",function(){var b=this.history.state,c=m.getCurrentPage();b&&b.page&&c&&(b.page!==c||h.isPageLoadRequestInProgress())&&(n.show(),c=a("#checkoutDisplayPage"),c.data("wipeOnPipelineBackTransition")&&c.empty(),p.resetMetrics(),a("#useFastBackButton").length&&h.isPrefetchValidFor(b.page)?
h.usePrefetch({pushNewFrame:!1}):(c="spc"===b.page?"":b.page,h.loadPage(m.getCurrentPage(),c,b.additionalURLArgs,{refTag:"pipelinedBackButton",pushNewFrame:"false"})))});a(document).delegate("form.checkout-page-form","change",function(b){a(b.target).parent().hasClass("no-prefetch-on-change")||(b=a(b.currentTarget),h.makePrefetch(b))});a(document).delegate("form.checkout-page-form","submit",function(a){h.continueClicked(a)});a(document).delegate("a.checkout-continue-link","click",function(a){h.continueClicked(a)});
a(document).delegate("form.checkout-page-form .submit-button-with-name","click",function(b){b=a(b.currentTarget);a("\x3cinput\x3e").attr({type:"hidden",name:b.attr("name"),value:b.val()}).appendTo(b.closest("form.checkout-page-form"))});var c=!1;a(document).delegate("a.pipeline-link, div.pipeline-link","touchmove",function(a){c=!0});a(document).delegate("a.pipeline-link, div.pipeline-link","click keypress touchend",function(b){if(c)c=!1,b.preventDefault();else if(f.protectAgainstDoubleAction("pipeline-link"))b.preventDefault();
else if("keypress"!==b.type||13===b.which){var e=a(b.currentTarget),d=e.data("pipelineLinkFromPage"),k=e.data("pipelineLinkToPage"),m=e.data("pipelineLinkAnchor"),z=e.data("pipelineLinkRef"),e=e.data("pipelineLinkArgs");k&&(p.resetMetrics(),b.preventDefault(),h.isSPP()&&g.setCachedPageData(d,k),n.show(),b={refTag:z,anchor:m},h.isSPP()&&(b.keepCachedPagesData=1),h.loadPage(d,k,e,b))}});a(document).delegate("a.spclite-dispatch-link","click keypress touchend",function(b){if("keypress"!==b.type||13===
b.which){var c=a(b.currentTarget),d=c.data("spcliteLinkFromPage"),f=c.data("spcliteLinkToPage");c.data("spcliteLinkAnchor");var g=c.data("spcliteLinkRef"),c=c.data("spcliteLinkArgs"),p=a("input#executionId").val(),c=c?c+("\x26executionId\x3d"+p):"executionId\x3d"+p;f&&(b.preventDefault(),n.show(),h.loadPage(d,f,c,{refTag:g},"/gp/buy/shared/handlers/spclite-dispatch.html"))}})}a(document).delegate("input.submit","click touchend",function(){p.resetMetrics()});a(document).delegate("form","submit",function(){p.resetMetrics()});
a(document).delegate(".panel-cancel-row a, .clickable-heading","click",function(){p.isTransitionLoggingEnabled()&&p.resetMetrics()})});"use strict";r.when("A","a-popover-base","a-popover-util").register("checkout-modal-popover",function(a,n,k){function m(b){return b.disableHide?function(){}:function(){var d=this;d.animating=!0;a.fadeOut(this.$popover,250);b.secondaryPopover||c("#a-popover-modal").hide();a.delay(function(){d.animating=!1},250)}}function f(a,c){var e=m(c),f=a.$event.triggerPositioningElement?
a.$event.triggerPositioningElement:a.$declarativeParent;(b=n.show({$trigger:f,name:c.name,skin:d(c.header,c.closeButton,c.closeTextOverride),content:c.content,url:c.url,data:c.data,update:A,alone:c.alone?"true"===c.alone:!0,position:c.position||"triggerVertical",hide:e}))&&b.$trigger!==f&&(b.$trigger=f,b.updatePosition())}function h(a,b){b.disableHide=!0;var d=m(b);e=!1;(d=n.show({$trigger:a.$declarativeParent,skin:y(b.header,b.footer,b.closeButton,b.contentClass),name:b.name,requestURL:b.url,position:"windowCenter",
update:A,data:b.data,updatePosition:b.allowScrollOnPage?z:C,modal:!0,alone:b.alone?"true"===b.alone:!0,show:function(){this.animating=!0;this.$popover.show();c("#a-popover-modal").show();this.animating=!1},hide:d}))&&d.$trigger!==a.$declarativeParent&&(d.$trigger=a.$declarativeParent,d.updatePosition())}function g(b){var d=b.$declarativeParent;a.delay(function(){p(b,d)},250)}function p(d,c){b&&(k.eventOccursWithin(d,c)||k.eventOccursWithin(d,b.$popover))?a.delay(function(){p(d,c)},250):n.hide(c)}
var c=a.$,b,e=!1,d=function(a,b,d){return function(e){var l=d;void 0===d&&(l=c("input#closeButtonText").val()||"");var f="";l&&(f='\x3ca href\x3d"#" data-action\x3d"custom-popover-close" class\x3d"a-declarative popover-close-link"\x3e'+l+"\x3c/a\x3e\x26nbsp;");l="false"===b?"":['\x3cdiv class\x3d"popover-close-section"\x3e',f,'\x3c/div\x3e\x3cbutton data-action\x3d"custom-popover-close" class\x3d"a-button-close a-declarative" role\x3d"button"\x3e\x3ci class\x3d"a-icon a-icon-close"\x3e\x3c/i\x3e\x3c/button\x3e'].join("");
return['\x3cdiv class\x3d"a-popover"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',a||l?['\x3cdiv class\x3d"a-popover-header"\x3e\x3ch4\x3e',a,"\x3c/h4\x3e",l,"\x3c/div\x3e"].join(""):"",'\x3cdiv class\x3d"a-popover-inner"\x3e',e,'\x3c/div\x3e\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")}},y=function(a,b,d,e){return function(l){var f=c("input#closeButtonText").val()||"",g="";f&&(g='\x3ca href\x3d"#" data-action\x3d"custom-popover-close" class\x3d"a-declarative popover-close-link"\x3e'+
f+"\x3c/a\x3e\x26nbsp;");f="false"===d?"":['\x3cdiv class\x3d"popover-close-section"\x3e',g,'\x3c/div\x3e\x3cbutton data-action\x3d"custom-popover-close" class\x3d"a-button-close a-declarative" role\x3d"button"\x3e\x3ci class\x3d"a-icon a-icon-close"\x3e\x3c/i\x3e\x3c/button\x3e'].join("");f=a||f?['\x3cdiv class\x3d"a-popover-header huawei-device-header-fix"\x3e\x3ch4\x3e',a,"\x3c/h4\x3e",f,"\x3c/div\x3e"].join(""):"";g="";if(b){var p=c("#a-popover-footer-"+b);0<p.length&&(g=['\x3cdiv class\x3d"a-popover-footer"\x3e',
p.html(),"\x3c/div\x3e"].join(""))}return['\x3cdiv class\x3d"a-popover a-popover-modal"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',f,'\x3cdiv class\x3d"a-popover-inner ',e,'"\x3e',l,"\x3c/div\x3e",g,'\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")}};a.declarative("custom-popover-close",["click","touchend"],function(b){b.$event.preventDefault();var d=b.$target;c("html").hasClass("a-ie6")||c("html").hasClass("a-ie7")||
c("html").hasClass("a-ie8")?d.closest(".a-popover").hide():a.fadeOut(d.closest(".a-popover"),250);c("#a-popover-modal").hide();a.trigger("a:declarative:a-popover-close:click",{$target:d,$event:b.$event,$currentTarget:b.$currentTarget})});a.on("a:popover:positionUpdated",function(a){a=a.popover.$popover;0>a.offset().left&&a.offset({left:0});0>a.offset().top&&a.offset({top:0})});a.on("a:popover:show",function(a){if(a.popover&&a.popover.$trigger){var b=a.popover.$trigger.data("aCheckoutModalPopover");
b&&b.allowScrollOnPage&&a.popover.$popover.css("position","absolute")}});var A=function(a){c(".a-popover-inner",this.$popover).html(a)},z=function(a){if(!e||a)C.call(this,!0),e=!0},C=function(a){var b=c(t),d=b.height()/2,e=b.width()/2,l=this.$popover.height()/2,f=this.$popover.width()/2,d=d-l;if(a||"fixed"!==this.$popover.css("position"))d+=b.scrollTop();a=Math.max(0,e-f);d=Math.max(0,d);this.$popover.css({top:d,left:a})};a.declarative("a-checkout-popover",["click","mouseenter","mouseleave","keyup",
"touchend"],function(a){a.data.showOnHover&&"touchend"!==a.type?"mouseenter"===a.type||"click"===a.type?f(a,a.data):"mouseleave"===a.type&&g(a):("click"===a.type||"touchend"===a.type||"keyup"===a.type&&a.$event.manualTrigger)&&f(a,a.data)});a.declarative("a-checkout-modal-popover",["click","keyup","touchend"],function(a){("click"===a.type||"touchend"===a.type||"keyup"===a.type&&a.$event.manualTrigger)&&h(a,a.data)});a.on("checkout:reload",function(){a.defer(function(){0===c("#a-popover-modal").length&&
c("body").append('\x3cdiv id\x3d"a-popover-modal" /\x3e')})});return{hideById:function(a){n.hide(a)},createModal:h}});"use strict";(function(){var a=!1;r.when("A").register("page-detector",function(n){function k(){return m("checkout-as")}function m(a){p||(p={});p.hasOwnProperty(a)||(p[a]=0<g("div."+a).length);return p[a]}function f(){return m("checkout.pay")}function h(){return m("checkout.spc")}var g=n.$,p;n.on("checkout:reload",function(){p={};a||r.when("page-detector-current-initializer").execute(function(a){a.initializeDetectorWithCurrentPage(null)})});
return{isAddressSelect:k,isAddressTranslation:function(){return m("translate-address-form")},isDesktopPayment:function(){return f()&&m("pay-desktop")},isDesktopSpc:function(){return h()&&m("spc-desktop")},isMobileAddressSelect:function(){return k()&&m("checkout-as-mobile")},isMobilePayment:function(){return f()&&m("pay-mobile")},isMobileSpc:function(){return h()&&m("spc-mobile")},isTabletAddressSelect:function(){return k()&&m("checkout-as-tablet")},isTabletPayment:function(){return f()&&m("pay-tablet")},
isTabletSpc:function(){return h()&&m("spc-tablet")},isSpcLite:function(){return h()&&m("spclite")},isPayment:f,isSosp:function(){return m("checkout.sosp")},isSpc:h,isMobile:function(){return m("checkout.mobile")},isTablet:function(){return m("checkout.tablet")}}});r.register("page-detector-current-initializer",function(){return{initializeDetectorWithCurrentPage:function(n){if(!a){var k=n;r.register("page-detector-current-page",function(){return{getCurrentPage:function(){return k},setCurrentPage:function(a){k=
a;r.when("A").execute(function(a){a.trigger("page-detector:page-changed")})}}});a=!0}}}})})();"use strict";r.when("jQuery","loading-spinner-controller").register("page-spinner-controller",function(a,n){function k(){"function"===typeof z.blockAllActions&&z.blockAllActions()}function m(){"function"===typeof z.unblockAllActions&&z.unblockAllActions()}function f(a){"function"===typeof z.showTransitionInContainer&&z.showTransitionInContainer(a)}function h(){var b=a(t).width(),c=a(t).height(),e=a(t),f=
0;null!==A&&(f=A.outerHeight()-a(t).scrollTop(),0>f&&(f=0));d.css("top",e.scrollTop()+f+"px").css("left",e.scrollLeft()+"px").width(b).height(c);"1"!==a("input[name\x3dfromAnywhere]").val()&&a("#loading-spinner-blocker-doc").css("top",e.scrollTop()+f+"px").css("left",e.scrollLeft()+"px").width(b).height(c)}function g(){var b;b=document.activeElement?a(document.activeElement):a(":focus:first");b.is("button, a, input:enabled")&&b.blur()}function p(){if(C){k();r.when("spp-button-blocker").execute(function(a){a.hideContinueBtnBlocker()});
var c=a(".spp-panel.expanded");if(0<c.length&&c.is(":visible")){f(c,1);return}}if(y)return d.length&&d.find(".loading-spinner-inner").show(),!1;y=!0;g();d=a("#spinner-anchor");d.find(".loading-spinner-inner").show();a("#unblockHeader").length&&(A=a("#header"));b=d.css("z-index");a(t).unbind("scroll.checkout-page-spinner").bind("scroll.checkout-page-spinner",function(a){e&&t.clearTimeout(e);e=setTimeout(function(){h();e=null},50)});a(t).unbind("resize.checkout-page-spinner").bind("resize.checkout-page-spinner",
function(){h();n.adjustSize(d)});a(t).unbind("orientationchange.checkout-page-spinner").bind("orientationchange.checkout-page-spinner",function(){h();n.adjustSize(d)});h();d.show();d.css("z-index",2E3);n.showSpinner(d,!0);return!0}function c(){if(C)m(),"function"===typeof z.hideSpinner&&z.hideSpinner();else{a("#first-pipeline-load-page-spinner").remove();if(!y)return!1;y=!1;d.length&&d.find(".loading-spinner-inner").show();d&&(a(t).unbind(".checkout-page-spinner"),d.hide(),d.css("z-index",b),n.hideSpinner(d));
return!0}}var b,e=null,d,y=!1,A=null,z={},C=!1;return{show:p,showPageTransition:function(){return"0"===a("#showPageTransition").attr("content")?!1:p()},hide:c,hidePageTransition:function(){"0"===a("#showPageTransition").attr("content")&&c();return!0},hideAnimatedSpinnerImage:function(){d.length&&d.find(".loading-spinner-inner").hide()},initFunc:function(a){null!==a&&(z=a,C=!0)},blockAllActions:k,unblockAllActions:m,showTransitionInContainer:f,shrinkPanel:function(a,b,d){"function"===typeof z.shrinkPanel&&
z.shrinkPanel(a,b,d)},clearFocus:g}});"use strict";r.when("A").execute(function(a){a=a.$;var n="",n="mash-transitions"===a("input[name\x3dpageTransitionType]").val()?"page-mash-transition-controller":"page-spinner-controller";r.when(n).register("page-transition-controller",function(a){r.when("A").execute(function(m){m.declarative("page-spinner-show",["click"],{allowLinkDefault:!0},function(f){f=f.$target;f.hasClass("a-button-disabled")||f.closest(".a-button-disabled").length||a.showPageTransition()})});
r.when("A").execute(function(m){m.declarative("page-spinner-show-on-submit",["submit"],{allowLinkDefault:!0},function(f){a.showPageTransition()})});return{show:a.show,hide:a.hide,showPageTransition:a.showPageTransition,hidePageTransition:a.hidePageTransition,blockAllActions:a.blockAllActions,unblockAllActions:a.unblockAllActions,showTransitionInContainer:a.showTransitionInContainer,shrinkPanel:a.shrinkPanel}})});"use strict";r.when("A","page-conductor","client-side-metrics","page-detector-current-page",
"a-popover","ready").execute(function(a,n,k,m){function f(a,c,b){n.isSPP()&&k.setmarker&&k.setmarker("af");k.sendUEPageLoadStats()}var h=a.$,g=!1;a.on("a:popover:afterHide",function(a){a.popover&&(g=!1)});a.on("a:popover:beforeShow",function(a){var c=a.popover;c&&(g=!0,c.$trigger.find(".modal-parameters").each(function(){h.each(h(this).data(),function(a,e){c.attrs(a,e)})}))});a.on("a:popover:dismiss",function(a){a=a.popover;if(k.isTransitionLoggingEnabled()&&a&&g){g=!1;var c,b;"prime-acquisition-spc-popover"===
a.name&&(c="prime-acquisition",b=m.getCurrentPage());c||b||!a.attrs||(c=a.attrs("returnfrom"),b=a.attrs("returnto"));c&&b&&(k.resetMetrics(),k.logPageTransition(c,b,f))}})});"use strict";r.when("A","page-detector-current-page","checkout-general-utils","client-side-metrics","afterReady").register("first-load-dependencies-base",function(a,n,k,m){function f(){a.trigger("checkout:beforeReload");a.trigger("checkout:reload");g&&("spp-revieworder"===g?a.trigger("checkout:reload:spc"):a.trigger("checkout:reload:"+
g));a.trigger("checkout:afterReload");setTimeout(function(){var a=h("#first-pipeline-load-page-spinner");a.is(":visible")&&(a.remove(),k.logError("The page has taken more than 90 seconds to load, or there was a JS error preventing it from loading, hiding page spinner."))},9E4)}var h=a.$,g=n.getCurrentPage();return{allDependenciesCheck:function(a){if(a&&a.length){var c=!1,b={};h.each(a,function(a,c){b[c]=1;r.when(c).execute(function(){delete b[c]})});var e=setTimeout(function(){if(!c){var a=[];h.each(b,
function(b){a.push(b)});var e="Page ("+g+") is missing dependencies ["+a.join(", ")+"] after 5 secs.";0<h("#assets-prefetch").length?m.increaseCount("checkout:dependency:missed"):k.logError(e);f()}},5E3);r.when.apply(r,a).execute(function(){c=!0;t.clearTimeout&&e&&t.clearTimeout(e);f()})}else f()}}});"use strict";r.when("A","page-detector","client-side-metrics").register("gift-utility",function(a,n,k){var m=a.$,f=/[^\s\u0020-\u007E\u00A0-\u00FF]/g,h=t.P&&t.P.AUI_BUILD_DATE;return{getInput:function(a){return a.is("input")?
a:a.find("input")},getCharCount:function(a,f){return f?t.unescape(encodeURIComponent(a)).length:a.length},getLineCount:function(a,f){var c=a.split("\n").length;f=Math.floor(f);for(var b=a.split("\n"),e=0;e<b.length;e++)b[e].length>f&&(c+=Math.floor(b[e].length/f),0===b[e].length%f&&c--);return c},getNameWithNoTitle:function(a){var f=!1;a=a.split(" ");/^(?:Dr|Mr|Mrs|Ms|Mme|Lt|Attn|Attn:|Prof|Pt|The)\.?$/i.test(a[0])&&(f=!0);f&&a.shift();return a.join(" ")},getFirstName:function(a){var f=!1,c="";a=
a.split(" ");/^(?:Dr|Mr|Mrs|Ms|Mme|Lt|Attn|Attn:|Prof|Pt|The)\.?$/i.test(a[0])&&(f=!0);f&&a.shift();return c=a.shift()},toggleGiftMessageWarning:function(a,p){var c=p.find(".gift-message-warning");if(f.test(a.val())){var b=p.find(".gift-message-preview-trigger"),e=a.val().replace(f,"?");h?r.when("a-popover").execute(function(a){var c=a.get(b);c?c.update({content:e}):a.create(b,{inlineContent:e,position:"triggerVertical",closeButton:"false"})}):(k.increaseCount("removeauijs13"),b.unbind("click.preview").bind("click.preview",
function(a){r.when("a-popover-base").execute(function(b){var c=m(a.target);c.data("popoverid")&&(b=b.get(c.data("popoverid")))&&(b.update(e),b.updatePosition())})}));a.addClass("a-form-error");c.show()}else a.removeClass("a-form-error"),c.hide()}}});"use strict";r.when("A","page-detector","page-detector-current-page","safe-mash","client-side-metrics").register("help-popup",function(a,n,k,m,f){function h(){if(g("div#help-popover").length){g(t).unbind("resize.checkout-help-popover");var a=g("#help-popover-frame")[0];
g(a.contentWindow?a.contentWindow:a.contentDocument.defaultView).undelegate("a","click");g("div#help-popover").remove()}}var g=a.$;n=n.isMobile();k=g("input#isPipelinedPage");k=0<k.length&&"1"===k.val();var p=n&&k&&m&&m.navigate;a.declarative("help-popup",["click"],function(a){if(!g(".a-touch").length||p){a.$event.preventDefault();a.data&&"1"===a.data.stopPropagation&&a.$event.stopPropagation();var b=a.$target.attr("href");a=a.data;p?m.navigate({url:b,transitionEffect:"slide"}):(a.width||(a.width=
"340"),a.height||(a.height="340"),t.open(b,"AmazonHelp","width\x3d"+a.width+",height\x3d"+a.height+",left\x3d10,top\x3d10,resizable\x3dyes,scrollbars\x3dyes,menubar\x3dno,toolbar\x3dyes,location\x3dno,directories\x3dno,status\x3dyes"))}else t.open(a.$target.attr("href"),"AmazonHelp")});if(p)a.on("checkout:reload",h)});"use strict";r.when("jQuery","page-conductor").register("quantity-service",function(a,n){function k(k,f){f=f||{};var h;f.additionalData&&(h=f.additionalData);var g="/gp/buy/pipeline/handlers/update-quantity.html",
p={returnFullHTML:1,cachebuster:(new Date).getTime(),isClientTimeBased:0,hasWorkingJavascript:1};h&&h.deletePrimeMembership&&h.primeMembershipASIN&&(p.deletePrimeMembershipItemIn=h.deletePrimeMembership,p.deletedPrimeMembershipASINIn=h.primeMembershipASIN);f.ref&&(g+="/ref\x3d"+f.ref,delete f.ref);h=f.success;delete f.success;var c=n.ajaxRedirect;f.error&&(c=f.error,delete f.error);a.extend(p,f);var b=[],e;for(e in k)void 0!==k[e]&&(b.push(e),p[e]=k[e]);p.entityids=b;e=n.setAjaxTransitionHeader({"x-amz-checkout-page":"spc",
"x-amz-checkout-transition":"ajax"});a.ajax({type:"POST",url:g,data:a.param(p,!0),dataType:"text",async:!0,cache:!1,headers:e,success:h,error:c})}return{callBatch:function(a,f,h){k(f,h)},call:function(a,f,h){var g={};g[a]=f;k(g,h)}}});"use strict";r.when("jQuery").register("scroll-controller",function(a){return{scrollToTop:function(){a(t).scrollTop(0)},toggleScrollOn:function(){a(document).unbind("touchmove")},toggleScrollOff:function(){a(document).bind("touchmove",function(a){a.preventDefault()})}}});
"use strict";r.when("A","checkout-general-utils","ready").execute(function(a,n){a.$("#checkout-mash-will-load").length?r.when("mash").execute(function(a){var m;"object"===typeof a?m=a:t.amazon&&t.amazon.mash&&(m=t.amazon.mash);"object"!==typeof m?n.logError("MASH is expected but can't be found"):r.register("safe-mash",function(){return m})}):r.register("safe-mash",function(){})});"use strict";r.when("A","scheduled-delivery-external-interface","shipping-speed-selection-controller","page-detector",
"ready").register("scheduled-delivery-controller",function(a,n,k,m){var f=a.$,h={};k=function(){h={};f("div.fake-label input[type\x3d'radio']:checked").each(function(){var a=f(this),p=a.closest("div.fake-label");(p=n.getSdWidgetRootId(p))&&(h[a.attr("name")]=p)})};a.on("checkout:reload:shipoptionselect",k);a.on("checkout:reload:spp-revieworder",k);m.isSosp()&&k();f(document).delegate("div.fake-label","click",function(){if(m.isSosp()){var g=f(this),p=g.find("input[type\x3d'radio']");p.attr("disabled")||
(p=p.attr("name"),g=n.getSdWidgetRootId(g),a.trigger("scheduled-delivery:ship-option-changed",{current:g,previous:h[p]}),h[p]=g)}});f(document).delegate(".ship-option.is-scheduled-delivery","click",function(){if(m.isSpc()){var g=f(this);g.find("input[type\x3d'radio']").attr("disabled")||(g=n.getSdWidgetRootId(g))&&a.trigger("scheduled-delivery:ship-option-changed",{current:g,previous:null})}});a.on("scheduled-delivery:unblock-continue",function(){r.when("button-blocker").execute(function(a){a.hide("scheduled-delivery")})});
a.on("scheduled-delivery:block-continue",function(a){r.when("button-blocker").execute(function(f){f.show("scheduled-delivery",a)})});a.on("scheduled-delivery:disable-ship-option",function(a,h){var c,b;c=f("#"+a);if(0!==c.length){if(m.isSpc())c=c.closest(".shipping-speed");else if(m.isSosp())c=c.closest("div.fake-label.a-box");else return;b=c.find("input[type\x3d'radio']");b.attr("disabled",!0);b.is(":checked")&&h&&(b=f("input[name\x3d"+b.attr("name")+"]:radio:not(:disabled):first"),b.prop("checked",
!0),b.triggerHandler("click"));c.addClass("sd-disabled")}});a.on("scheduled-delivery:enable-ship-option",function(a){var h;a=f("#"+a);if(0!==a.length){if(m.isSpc())a=a.closest(".shipping-speed");else if(m.isSosp())a=a.closest("div.fake-label.a-box");else return;h=a.find("input[type\x3d'radio']");h.removeAttr("disabled");a.removeClass("sd-disabled")}})});"use strict";r.when("A","ready").register("mobile-nav-bar-back-controller",function(a){a.capabilities.history&&(a=a.$,a=a("#mobile-top-bar-navigation-back"),
1<=a.length&&a.click(function(a){a.preventDefault();t.history.back()}))});"use strict";r.when("A","page-spinner-controller","page-detector","page-conductor","ready").execute(function(a,n,k,m){function f(a,b){var c=[];a.addressId||c.push("addressId");a.slotKey||c.push("slotKey");a.shippingOfferingId||c.push("shippingOfferingId");a.conflictItems&&!e.isArray(a.conflictItems)&&c.push("conflictItems");if(0<c.length){for(var f="Error calling fresh widget callback on "+b+": Bad or Missing Input: "+c[0],
g=1;g<c.length;g++)f+=", "+c[g];console.error(f);return 0}return 1}function h(){e("#freshSlotKey").val("");e("#freshAddressId").val("");e("#freshReservationToCancel").val("");e("#freshConflictingItems").val("");e("#freshShipOfferingId").val("")}function g(a){var b="";if(a&&e.isArray(a)&&0<a.length)for(var b=a[0].asin+":"+a[0].merchantId,c=1;c<a.length;c++)b+="-"+a[c].asin+":"+a[c].merchantId;return b}function p(a){var b;b="page\x3dspc\x26returnFullHTML\x3d1\x26callSetters\x3d1\x26freshSlotKey\x3d"+
a.addressId;b+="\x26freshAddressId\x3d"+a.slotKey;a.reservationToCancel&&(b+="\x26freshReservationToCancel\x3d"+a.reservationToCancel);(a=g(a.conflictItems))&&(b+="\x26freshConflictingItems\x3d"+a);a=m.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});n.show();e.ajax({type:"POST",url:"/gp/buy/shared/handlers/handle-fresh-widget-results.html/ref\x3dset-fresh-information",data:b,dataType:"text",async:!0,cache:!1,headers:a,success:function(a,b,c){return c.getResponseHeader("x-amz-checkout-page")?
m.ajaxUpdatePage(a,b,c):m.redirect(a)},error:function(a,b,c){m.ajaxRedirect(a,b,c)}})}function c(){e(".sosp-continue-button").removeClass("js-hide").removeClass("aok-hidden");e(".continue-button-blocker").addClass("aok-hidden")}function b(){e(".sosp-continue-button").addClass("aok-hidden");e(".continue-button-blocker").removeClass("aok-hidden")}var e=a.$;a.on("handle-fresh-results",function(a){if(e("#isfresh").val())if(a)if(k.isSosp())if(f(a,"sosp")){e("#freshSlotKey").val(a.slotKey);e("#freshAddressId").val(a.addressId);
e("#freshReservationToCancel").val(a.reservationToCancel);var n=g(a.conflictItems);e("#freshConflictingItems").val(n);e("#freshShipOfferingId").val(a.shippingOfferingId);n&&0<n.length?e("input#block-prefetch").val(1):e("input#block-prefetch").val(0);n=e("#shippingOptionFormId");a.conflictItems&&0<a.conflictItems.length||m.makePrefetch(n);c()}else h(),b();else k.isSpc()?f(a,"spc")&&p(a):console.error("remote fresh widget JS callback called on unsupported page.");else console.error("remote fresh widget JS callback called with empty data.");
else console.error("remote fresh widget JS callback called without isfresh flag on page")});a.on("block-continue",function(a){e("#isfresh").val()?a?"undefined"===typeof a.blockContinue?console.error("block continue callback - missing blockContinue"):k.isSosp()?1===a.blockContinue?(b(),h()):0===a.blockContinue?c():console.error("block continue callback - invalid value"):console.error("block continue callback called on unsupported page."):console.error("block continue callback called with no argument"):
console.error("block continue callback called without isfresh flag on page")});a.on("confirm-and-continue",function(){e("div.sosp-fresh #shippingOptionFormId").submit()});a.on("redirect-to-spc",function(){m.redirect({conductoraction:{url:'/gp/buy/spc/handlers/display.html/ref\x3d"cancel-fresh-address-select"',type:"redirect"}})})});"use strict";r.when("A","ready").execute(function(a){function n(){(0<k(".change-preference-block").length||0<k(".mobile-change-preference-block").length)&&!1===m&&(r.register("loadVasRcxCheckoutAsset",
function(){}),m=!0)}var k=a.$,m=!1;n();a.on("checkout:reload:spc",n);a.on("checkout:reload:shipoptionselect",n);a.on("checkout:reload:spp-revieworder",n)});"use strict";r.register("time-left-formatter",function(){function a(a,m,f,h,g){return 0>=m?a:a+m+" "+(1===m?g.HOUR:g.HOURS)+(!h&&0<f?" "+g.AND+" ":"")}function n(a,m,f,h,g){return 0>=m?a:a+m+" "+(1===m?g.MINUTE:g.MINUTES)+(!h&&1>f?" "+g.AND+" ":"")+(1===h&&1>f?" ":"")}return{getTimeLeftFormatted:function(k,m,f){var h="",g=86400<k?(k-k%86400)/86400:
0,p=3600<k?(k-k%3600)/3600:0;k-=3600*p;var c=60<k?(k-k%60)/60:0;k-=60*c;if(m&&0<g)return h+g+" "+(1===g?f.DAY:f.DAYS);if(m&&0<p)return a(h,p,c,m,f);if(m&&5<=c)return n(h,c,p,m,f);h=a(h,p,c,m,f);h=n(h,c,p,m,f);1<=p||(h=h+k+" "+(1===k?f.SECOND:f.SECONDS));return h}}});"use strict";r.when("A","checkout-general-utils","page-detector","page-detector-current-page","safe-mash","loading-spinner-controller").register("shipoptionselect-controller",function(a,n,k,m,f,h){function g(a){var b=d(".delivery-window-groups .more-window");
h.showSpinner(b,!1);a=a.$currentTarget.closest(".delivery-window-groups").data("orderid");a="lineitemids\x3d"+d("input[name\x3dlineItemEntityIds_"+a+"]").attr("value")+"\x26orderid\x3d"+a+"\x26isMobile\x3d1\x26fromPage\x3dsosp";d.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/long-calendar-content.html",data:a,dataType:"json",async:!0,cache:!1,headers:{"x-amz-checkout-page":"sosp"},success:function(a){h.hideSpinner();if(a&&a.deliveryWindowGroups){var b=d(".delivery-window-groups .a-box-group");
b.empty();d.each(a.deliveryWindowGroups,function(a,c){b.append(c)});a=d(".delivery-window-groups .selected-group");a.length&&a.trigger("click")}}})}function p(a,b){var c=d("div.one-shipment:visible"),l;l=w?d("div.one-shipment").slice(parseInt(a,10),parseInt(b,10)+1):d("div.one-shipment#"+a);A&&0!==l.size()&&c.last().attr("id")!==l.last().attr("id")&&(c.hide(),l.show(),d(t).scrollTop(0))}function c(){if(A){var a=(location.hash?location.hash.replace("#",""):"0-"+C).split("-");2===a.length&&p(a[0],a[1])}}
function b(){0<d(".prime-calendar-container").length&&d(".prime-calendar-container").contents().each(function(a,b){8===b.nodeType&&d(b).replaceWith(b.nodeValue)});var b=d(".delivery-window-groups .selected-group");b.length&&b.trigger("click");y=d(".sosp-continue-button");A="1"===d("#isClientSidePagingEnabled").val()?1:0;C=(d("div.one-shipment:visible").length-1).toString();z="1"===d("#useMashNavigateForClientSidePaging").val()?1:0;w="1"===d("#collapseDigitalShipmentsEnabled").val()?1:0;var g=(b=t.P&&
t.P.AUI_BUILD_DATE)?"selectable-box":"fake-label";A&&(d(".one-shipment:gt("+C+")").hide(),c());y.bind("click",function(b){function c(a,b){var l=m.getCurrentPage();if(t.history&&t.history.pushState){var e=location.href;0<e.indexOf("#")&&(e=e.substring(0,e.indexOf("#")));e+="#"+a.attr("id")+"-"+b.attr("id");history.pushState({page:l,id:a.attr("id")},d("title"),e)}}var g=!1;d("div.one-shipment:visible input[type\x3d'radio'][checked]").each(function(){if(d(this).data("blockingOn"))return alert(d(this).data("blockingOn")),
b.preventDefault(),g=!0,!1});if(g)return!1;e();var q=d("div.one-shipment:visible").nextAll("div.one-shipment:hidden");if(0<q.length){b.preventDefault();var h=q.first(),k=h;w&&(k=q.filter(".shipment-with-ship-options"),k=1<k.length?k.eq(1).prev():q.last());z&&f&&f.navigate?f.navigate({url:null,transitionEffect:"slide",successCallback:function(){c(h,k)},failCallback:function(a){}}):c(h,k);p(h.attr("id"),k.attr("id"));a.trigger("active-shipment-changed")}});d(t).bind("popstate",function(a){k.isSosp()&&
c()});d(document).delegate("div."+g,"click",function(a){a=d(this);a.find("input[type\x3d'radio']").trigger("change",["setActive"]);a.parent().hasClass("timeslot-picker")&&(a=a.find(".a-button-selected").length,y&&y.length&&(a?y.removeClass("a-button-disabled").addClass("a-button-primary").find("input").prop("disabled",!1):y.removeClass("a-button-primary").addClass("a-button-disabled").find("input").prop("disabled",!0)))});d(document).delegate("div."+g+" input[type\x3d'radio']","change",function(a,
b){var c=d(this);if("setActive"===b){if(c.attr("disabled"))return;c.attr("checked",!0)}if("disabling"===b)if(c.attr("disabled",!0),c.is(":checked"))c.removeAttr("checked");else return;var e=c.closest("div."+g);c.is(":checked")?(e.siblings("div."+g+".selected").removeClass("selected").find(".a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"),e.addClass("selected").find(".a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active")):
e.removeClass("selected").find(".a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive")});d("div."+g+" input[type\x3d'radio']:checked").change();d("h3").children().removeAttr("style");0===d("div."+g+".scheduled-delivery").length&&d("form.checkout-page-form").data("checkoutFormReady",!0).change();b&&d(document).delegate(".a-touch-radio a","click",function(a){f&&f.navigate?f.navigate({url:d(a.target).attr("href"),transition:"slide"}):a.preventDefault=
!1})}function e(){if(1===d("div.store-upsell-ship-options").length){var a="/gp/buy/shared/handlers/store-upsell-async.html",b="ox_store_upsell_continue_",c=d("div.ship-speed, div.store-upsell-ship-options").find("input.shipping-option, input.store-upsell-ship-option"),l=[],e;d.each(c,function(a,c){var f=d(c),g=f.attr("value");l.push(g.toLowerCase());f.is(":checked")&&(e=f.attr("value"),b=f.hasClass("store-upsell-ship-option")?b+"success":b+"failure")});a=n.addQueryStringParameter(a,"ref",b);d.ajax({url:a,
type:"POST",async:!0,data:{shown:l.toString(),clicked:e}})}}var d=a.$,y,A,z,C,w=0;a.declarative("sosp-change-quantity-link",["click"],function(a){var b=a.$currentTarget,c=d("\x3cinput type\x3d'hidden' /\x3e").attr("name","change-quantities-or-delete").val("1");b.hasClass("pipeline-link")?(a.$event.preventDefault(),b.closest("form").removeClass("checkout-page-form").append(c).find(".sosp-continue-button:first").trigger("click")):b.closest("form").removeClass("checkout-page-form").append(c).find(".sosp-continue-button:first").trigger("click").end().trigger("submit")});
a.declarative("sosp-extender-toggle",["click","touchend"],function(a){if(!n.protectAgainstDoubleAction("sosp-extender-toggle")){var b=a.$target.closest("a"),c=d(".delivery-window-groups .a-box-group").find(".lazy-loaded");if(b.hasClass("aui-extender"))c.length?c.remove():g(a);else{var l=b.find("i"),b=b.closest("div.extender-section");l.hasClass("a-icon-extender-expand")?(b.find(".collapsed").hide(),b.find(".expanded").slideDown("fast"),l.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse"),
g(a)):(b.find(".collapsed").show(),b.find(".expanded").slideUp("fast"),l.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"),c.length&&c.remove())}}});a.declarative("sosp-select-prime-slot",["click","touchend"],function(a){if(!n.protectAgainstDoubleAction("sosp-select-prime-slot")){a=a.$currentTarget;var b=a.closest(".valid-slot");if(b.closest(".prime-calendar").hasClass("long-calendar")){var c=b.closest(".prime-calendar").data("orderid"),l=d("#calendar-"+c),c=d("#calendar-delivery-message-"+
c),e=a.closest(".long-calendar");e.find(".selected-slot").removeClass("selected-slot");0<b.length&&b.addClass("selected-slot");d(".a-button-close").trigger("click");b=a.data("slotid");b=l.find(".slot-"+b);if(0<b.length)l.show(),c.parent().hide(),b.closest(".prime-calendar").find(".selected-slot").removeClass("selected-slot"),b.closest(".valid-slot").addClass("selected-slot");else{var f=a.parent()[0],g=a.parent().parent().find(".rhead")[0],b=g.innerText;b||(b=g.textContent);f=f.cellIndex;e=e.find("th")[f];
f=e.innerText;f||(f=e.textContent);c.text(f+" "+b);l.hide();c.parent().show()}}else c=b.closest(".prime-calendar-container").data("orderid"),l=d("#calendar-"+c).find(".selected-slot"),0<l.length&&(l.removeClass("selected-slot"),0<b.length&&b.addClass("selected-slot"));l=a.closest(".prime-calendar-container").data("orderid");a.data("key")&&d("#order_"+l+"_ShippingSpeed").val(a.data("key"));a.data("isscheduleddeliveryslot")&&d("#sdData"+l).val(a.data("sddatastring"))}});a.declarative("sosp-select-delivery-window",
["click","touchend"],function(a){if(!n.protectAgainstDoubleAction("sosp-select-delivery-window")){a=a.$currentTarget;a.length&&!a.hasClass("dwg-button")&&(a=a.find(".dwg-button"));d(".dwg-button").removeClass("selected-dwg-button");a.addClass("selected-dwg-button");var b=a.closest(".delivery-window-groups").data("orderid"),c=a.data("key");!c&&a.find("button").length&&(c=a.find("button").data("key"));c&&d("#order_"+b+"_ShippingSpeed").val(c);c=a.data("isscheduleddeliveryslot");!c&&a.find("button").length&&
(c=a.find("button").data("isscheduleddeliveryslot"));c&&(c=a.data("sddatastring"),!c&&a.find("button").length&&(c=a.find("button").data("sddatastring")),d("#sdData"+b).val(c))}});a.on("checkout:reload:shipoptionselect",b);a.on("checkout:reload:spp-shipoption",b)});r.when("jQuery","page-detector").register("deliv-prefs-sosp",function(a,n){function k(){a(".sosp .order-delivery-time-preference").each(function(){var k=a(this);k.bind("selectionChanged",function(){0===k.find(".delivery-time-preference-group").length?
k.hide():(k.show(),0===k.find("input:checked").length&&k.find("input:first").trigger("change",["setActive"]))}).bind("empty",function(){k.find(".delivery-time-preference-group").detach()});var f=k.closest(".one-shipment").find("input.shipping-option");k.find(".delivery-time-preference-group").each(function(){var f=a(this),g=f.data("shippingoptionid"),g=a("#"+g);f.is(".template")&&f.detach().removeClass("template");g.change(function(){k.trigger("empty");f.appendTo(k);k.trigger("selectionChanged")}).addClass("hasDeliveryTimePreference")});
f.not(".hasDeliveryTimePreference").change(function(f,g){"disabling"===g||a(this).is(":disabled")||(k.trigger("empty"),k.trigger("selectionChanged"))});k.trigger("selectionChanged")})}r.when("A").execute(function(a){a.on("checkout:reload:shipoptionselect",k)})});r.when("A","shipoptionselect-controller").execute(function(a){var n=a.$,k={},m={};a.on("checkout:reload:shipoptionselect",function(){var a=n("#shippingOptionFormId"),h=a.find("input[name\x3dtrialKey]");if(1===h.length){for(var g in k)k.hasOwnProperty(g)&&
(k[g].abort(),delete k[g]);k={};m={};var p=function(a){return a.join("::").replace(/\s+/g,"_")},c=function(){return n.map(a.find("input[type\x3dradio]:checked"),function(a){return a.name})},b=function(){return n.map(a.find("input[type\x3dradio]:checked"),function(a){return a.value})},e=function(a,b){if(k.hasOwnProperty(a)||m.hasOwnProperty(a))return!1;console.debug('initiating ajax call for trial key "'+a+'"');var c=n.ajax({type:"POST",url:"/gp/buy/shipoptionselect/handlers/launch-delivery-trial.html",
contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:{"x-amz-checkout-transition":"ajax"},data:b,dataType:"json",async:!0,success:function(b){b?console.debug('trial "'+a+'" success'):console.debug('trial "'+a+'" failed');m[a]=b;delete k[a]},error:function(b,c,d){delete k[a];"abort"!==d&&(console.debug("trial "+a+" error"),r.error("issue with set-delivery-options trial: "+c,d))},cache:!1});k[a]=c;return!0},d=function(){for(var a=b(),a=p(a),c=Object.keys(k),d=0;d<c.length;++d){var e=
c[d];e!==a&&(console.debug('removing ajax call for trial key "'+e+'"'),k[e].abort(),delete k[e])}};n(document).delegate("#shippingOptionFormId","change",function(g){g=b();if(p(g)!==h.val())a:{d(),g=c();var k=b(),m=p(k);h.val(m);var C=e(m,a.serialize()),m=0;C&&++m;for(var w=0;w<g.length;++w)for(var u=a.find('input[type\x3dradio][name\x3d"'+g[w]+'"][value!\x3d"'+k[w]+'"]'),q=0;q<u.length;++q){var v=u[q],C=k.slice(0);C[w]=v.value;for(var C=p(C),l=v.name,v=v.value,O=a.serializeArray(),K=0;K<O.length;++K)O[K].name===
l&&(O[K].value=v),"trialKey"===O[K].name&&(O[K].value=C);l=n.param(O);if((C=e(C,l))&&5===++m)break a}}});n(document).delegate("#shippingOptionFormId","submit",function(a){d()})}})});r.when("A","button-blocker","page-detector").register("scheduled-delivery-readiness-checker",function(a,n,k){function m(){k.isMobile()&&k.isSosp()&&g("div.scheduled-delivery").length&&(g(document).delegate("div."+c+":visible input[type\x3d'radio'].shipping-option","change",function(){h(g(this).closest("div."+c))}),a.on("active-shipment-changed",
h))}function f(a){p||(a.hasClass("scheduled-delivery-loading")?p=a.find(".loading-tooltip").text():a.hasClass("scheduled-delivery-picking")&&(p=a.find(".picking-tooltip").text()))}function h(a){p=null;a?f(a):g("div.one-shipment:visible div."+c+".scheduled-delivery").each(function(){var a=g(this);a.find("input").is(":checked")&&f(a)});p?n.show("scheduled-delivery",p):n.hide("scheduled-delivery")}var g=a.$,p,c=t.P&&t.P.AUI_BUILD_DATE?"selectable-box":"fake-label";if(k.isMobile())a.on("checkout:reload:shipoptionselect",
m);return{check:h}});"use strict";r.when("A","quantity-service","page-conductor","page-detector","ajax-utility","page-transition-controller","gift-utility","client-side-metrics").register("gift-form-base-controller",function(a,n,k,m,f,h,g,p){function c(a){a.is(":checked")||(Y?a.is(":checked")||a.closest("label").click():(p.increaseCount("removeauijs4"),a.attr("checked",!0).trigger("change")))}function b(a){a.attr("disabled","disabled");Y&&a.closest("div").bind("click.disable",function(a){a.stopPropagation()})}
function e(a){a.removeAttr("disabled");Y&&a.closest("div").unbind("click.disable")}function d(){r.when("a-dropdown").execute(function(a){var b=x(".select-recipient");b.empty();for(var c=0;c<W.length;c++){var l=x("\x3coption/\x3e").attr({value:W[c].value}).text(W[c].text);b.append(l)}b.each(function(){var b=x(this).closest(".gift-connection-section"),c=b.find(".include-gift-connection-checkbox").is(":checked"),l=b.find(".item-id").val(),d=b.find(".item-giftlist-type-id").val(),e;!d||"0"!==d&&"1"!==
d&&"2"!==d?d&&"3"===d&&(e=b.find(".item-giftlist-id").val()):e=d;!e&&c&&(c=b.find(".item-registry-id").val())&&ea&&ea[c]&&(e=ea[c]);e&&(a.setValue(x(this).attr("id"),e),(d&&"1"===d||"2"===d)&&b.find(".gift-connection-recipient-extra").removeClass("aok-hidden").show(),v(l))})})}function y(){x(".gift-connection-recipient-section").unbind("click").bind("click",function(){if(!V)return x(this).find(".select-recipient-spinner").removeClass("aok-hidden").show(),!1});x(".select-recipient").each(function(){x(this).unbind("change").bind("change",
function(){var a=x(this),b=a.next().find(".a-dropdown-prompt"),c=x("\x3cdiv/\x3e").html(a.find(":selected").text()).clone().html();setTimeout(function(){b.html(c)},0)})});r.when("a-dropdown").execute(function(a){x(".gift-connection-section").each(function(){var b=x(this),c=b.find(".item-id").val(),l=b.find(".item-giftlist-type-id").val();b.find(".item-giftlist-id").val();var d=b.find(".item-occasion-id").val(),e=b.find(".item-occasion-month").val(),f=b.find(".item-occasion-day").val(),g=b.find(".item-age").val();
b.find("#input-recipient-first-name-"+c).unbind("keyup").keyup(function(){v(c)});b.find("#input-recipient-last-name-"+c).unbind("keyup").keyup(function(){v(c)});if("1"===l||"2"===l)a.setValue(b.find(".select-recipient").attr("id"),l),b.find(".gift-connection-recipient-extra").removeClass("aok-hidden").show();a.setValue(b.find(".select-occasion").attr("id"),d);a.setValue(b.find(".select-occasion-month").attr("id"),e);a.setValue(b.find(".select-occasion-day").attr("id"),f);a.setValue(b.find(".select-occasion-age").attr("id"),
g);if("1"===d||"2"===d)b.find(".gift-connection-occasion-extra").removeClass("aok-hidden").show(),"2"===l&&b.find(".select-occasion-age-row").removeClass("aok-hidden").show();"1"!==d&&"2"!==d&&"3"!==d&&v(c)})});var a="/gp/buy/pipeline/handlers/list-of-giftlists.html",b=x(".item-registry-id").map(function(){if(x(this).val())return x(this).val()}).get().join();b&&(a+="?fromRegistryIds\x3d"+b);W?(d(),x(".select-recipient-spinner").hide(),V=!0):(V=!1,x.ajax({type:"POST",url:a,dataType:"json",async:!0,
cache:!1,timeout:5E3,success:function(a){!W&&a.options&&0<a.options.length&&(W=a.options);a.registryIdMapping&&(ea=a.registryIdMapping);W&&d();x(".select-recipient-spinner").hide();V=!0},error:function(a,b,c){x(".select-recipient-spinner").hide();V=!0}}))}function A(){Z=[];a.state("giftNotificationEmailConstraints",[]);a.state("giftDeliveryDateConstraints",[]);x('[data-action\x3d"gift-form-element"]').each(function(){var a=x(this);a.is("span")?a.find("input, textarea, select:first").trigger({type:"change",
isInit:!0}):a.trigger({type:"change",isInit:!0})});x("textarea").unbind("keyup.gift-textarea click.gift-textarea").bind("keyup.gift-textarea click.gift-textarea",function(){x(this).trigger("change")});0<x(".enable-gift-connections").length&&y()}function z(a,b){var c=31;if("1"===b)c=0===a%4&&0!==a%100||0===a%400?29:28;else if("3"===b||"5"===b||"8"===b||"10"===b)c=30;return c}function C(a,b,c){a=f.jsonify(a);k.redirect(a)}function w(a){r.when("a-dropdown").execute(function(b){x(".gift-connection-recipient-extra-"+
a).hide();b.setValue("select-recipient-"+a,"0");x("#input-recipient-first-name-"+a).val("");x("#input-recipient-last-name-"+a).val("")})}function u(a){r.when("a-dropdown").execute(function(b){x(".gift-connection-occasion-extra-"+a).hide();b.setValue("select-occasion-"+a,"0");b.setValue("select-occasion-month-"+a,"0");b.setValue("select-occasion-day-"+a,"0");b.setValue("select-occasion-age-"+a,"-1");x("#occasion-has-reminder-checkbox-"+a).attr("checked",!0)})}function q(a,b){r.when("a-dropdown").execute(function(c){for(var l=
0;l<W.length;l++)b&&b===W[l].value&&W[l].bMonth&&W[l].bDay&&(c.setValue("select-occasion-month-"+a,W[l].bMonth),c.setValue("select-occasion-day-"+a,W[l].bDay))})}function v(a){r.when("a-dropdown").execute(function(b){var c=x("#select-recipient-"+a).find(":selected").val();"0"!==c&&("1"!==c&&"2"!==c||x("#input-recipient-first-name-"+a).val()||x("#input-recipient-last-name-"+a).val())?b.updateSelect("select-occasion-"+a,{status:"enabled"}):(u(a),b.updateSelect("select-occasion-"+a,{status:"disabled"}))})}
function l(a,b,c){"1"===b&&"2"===c?x("#select-occasion-age-row-"+a).removeClass("aok-hidden").show():x("#select-occasion-age-row-"+a).hide()}function O(){var a=x("#hidePricesCheckbox"),b=x("#kindle-reg-radio-your-account");Y?b.is(":checked")?x("#kindle-reg-radio-another-account").closest("label").click():a.is(":checked")||a.closest("label").click():(p.increaseCount("removeauijs6"),a.is(":checked")||a.attr("checked","checked").trigger("change"),b.is(":checked")&&(b.removeAttr("checked").trigger("change"),
x("#kindle-reg-radio-another-account").attr("checked","checked").trigger("change")))}function K(){var a=x("#hidePricesCheckbox"),b=x("#kindle-reg-radio-another-account");Y?b.is(":checked")?x("#kindle-reg-radio-your-account").closest("label").click():a.is(":checked")&&a.closest("label").click():(p.increaseCount("removeauijs7"),a.is(":checked")&&a.removeAttr("checked").trigger("change"),b.is(":checked")&&(b.removeAttr("checked").trigger("change"),x("#kindle-reg-radio-your-account").attr("checked","checked").trigger("change")))}
function B(){x("#hidePricesCheckboxLabel").hide();var a=x("#hidePricesCheckbox");Y&&(a.is(":checked")||a.closest("label").click());a.attr("disabled",!0).hide().trigger("change");x("#kindle-reg-radio-another-account").attr("disabled",!0).trigger("change");x("#kindle-reg-radio-your-account").attr("disabled",!0).trigger("change");x("#hidePricesDisabledMessage").show();x("#hidePricesDisabledMessage").removeClass("aok-hidden");Y&&(x("label.a-touch-checkbox.hide-prices-checkbox").addClass("a-touch-selector-disabled").bind("click.disable",
function(a){a.stopPropagation()}),x("label.a-touch-radio.kindle-reg-option").addClass("a-touch-selector-disabled").bind("click.disable",function(a){a.stopPropagation()}))}function F(a){var b=!1;x(".afn-wrap-checkbox").each(function(){var a=x(this),a=a.is("input")?a:a.find("input");if(a.is(":checked"))return b=!0,!1});x(".mfn-no-wrap-radio").each(function(){var a=x(this),a=a.is("input")?a:a.find("input");if(!a.is(":checked"))return b=!0,!1});if(b)O(),B();else if(x("#hidePricesCheckbox").is(":disabled"))x("#hidePricesCheckboxLabel").show(),
x("#hidePricesCheckbox").removeAttr("disabled").show().trigger("change"),x("#kindle-reg-radio-another-account").removeAttr("disabled").trigger("change"),x("#kindle-reg-radio-your-account").removeAttr("disabled").trigger("change"),x("#hidePricesDisabledMessage").hide(),Y&&(x("label.a-touch-checkbox.hide-prices-checkbox").removeClass("a-touch-selector-disabled").unbind("click.disable"),x("label.a-touch-radio.kindle-reg-option").removeClass("a-touch-selector-disabled").unbind("click.disable"));else if(a.is("input")||
(a=a.find("input")),"hidePricesCheckbox"===a.attr("id"))a.is(":checked")?O():K();else if("kindle-reg-radio-another-account"===a.attr("id")||"kindle-reg-radio-your-account"===a.attr("id"))x("#kindle-reg-radio-your-account").is(":checked")?K():O()}function Q(a){var b=x("#giftwrap-carousel-wrap-pane-"+a+" ul li").size();b&&(x("#giftwrap-carousel-wrap-holder-"+a).css("width",90*b),x("#giftwrap-carousel-wrap-pane-"+a).css("width",360));L(a)}function L(a){x("#giftwrap-carousel-wrap-holder-"+a).find("ul li, ol li").each(function(b,
c){var l=x(c);l.find("input").is(":checked")&&J(l,{itemId:a})})}function J(a,b){a.parent().find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");a.find(".giftwrap-carousel-item-image").addClass("selected-giftwrap-image");var c=b.itemId,l=b.wrapNo,d=k.isSPP();if(a.hasClass("noshi-wrap")&&!a.hasClass("none-wrap")){k.isSPP();var e="#item-"+c;x("#gift-message-noshi-warning-"+c).removeClass("aok-hidden");x("#includeMessageCheckbox-"+c).attr("disabled","disabled");aa()?(x("#afn-message-span-"+
c,x(e)).addClass("aok-hidden"),x("#gift-message-"+c).addClass("aok-hidden")):(x("#afn-message-span",x(e)).removeClass("enable-message-area").addClass("disable-message-area"),x("#message-area-"+c).attr("disabled","disabled"))}else e="#item-"+c,aa()&&(x("#afn-message-span-"+c,x(e)).removeClass("aok-hidden"),x("#gift-message-"+c).removeClass("aok-hidden")),x("#gift-message-noshi-warning-"+c).addClass("aok-hidden"),x("#afn-message-span",x(e)).removeClass("disable-message-area").addClass("enable-message-area"),
x("#includeMessageCheckbox-"+c).removeAttr("disabled"),x("#message-area-"+c).removeAttr("disabled");e=a.find("input[type\x3dradio]");e.attr("checked",!0);d||(d=a.data("giftwrap-id"),e.val(d).change());var d=a.data("wrap-no"),e=x("#giftwrap-option-preview-imagearea-default-"+c),f=x("#giftwrap-option-preview-imagearea-image-"+c),g=x(".selectedWrapLargeLink","#item-"+c),c=x(".wrapNo-"+c+"-"+l);a.hasClass("none-wrap")?(e.removeClass("aok-hidden"),f.addClass("aok-hidden"),g.length&&(g.addClass("aok-hidden"),
g.removeClass("selectedWrapLargeLink"))):(l=a.find("img").attr("src"),f.find("img").attr("src",l),e.addClass("aok-hidden"),f.removeClass("aok-hidden"),g.length&&(g.addClass("aok-hidden"),g.removeClass("selectedWrapLargeLink")),c.length&&(c.addClass("selectedWrapLargeLink"),c.removeClass("aok-hidden")));c=x(".selectedWrapLargeLink");l=x(".larger-image-link-carousel-"+d);c.removeClass("selectedWrapLargeLink").addClass("aok-hidden");l.removeClass("aok-hidden").addClass("selectedWrapLargeLink")}function P(a,
b){var c="",c="",l,d,c=b.itemId;l=x("#giftwrap-option-preview-imagearea-default-"+c);d=x("#giftwrap-option-preview-imagearea-image-"+c);a.hasClass("none-wrap")?(l.removeClass("aok-hidden"),d.addClass("aok-hidden")):(c=a.find("img").attr("src"),d.find("img").attr("src",c),l.addClass("aok-hidden"),d.removeClass("aok-hidden"))}function S(a,b){var c=b.itemId,l=x("#giftwrap-option-preview-imagearea-default-"+c),c=x("#giftwrap-option-preview-imagearea-image-"+c);if(a.parent().find(".selected-giftwrap-image").parents("li").hasClass("none-wrap"))l.removeClass("aok-hidden"),
c.addClass("aok-hidden");else{var d=".selected-giftwrap-image img";k.isSPP()&&(d="img.selected-giftwrap-image");d=a.parent().find(d).attr("src");c.find("img").attr("src",d);l.addClass("aok-hidden");c.removeClass("aok-hidden")}}function E(a,b){var c=a.find(".empty-message-warning"),l=a.find(".no-receipt-warning"),d=a.find("textarea"),e=a.find(".message-counter");b&&!l.is(":visible")?(e.hide(),c.show(),d.addClass("gift-warning")):(c.hide(),d.removeClass("gift-warning"),e.show())}function T(a){var b=
x("#"+a.id),c=g.getCharCount(b.val(),a.useByteSize),b=g.getLineCount(b.val(),a.maxChars/a.maxLines);return{length:c,charDelta:a.maxChars-c,lineDelta:a.maxLines-b}}function U(a,b){var c=x("#item-"+b.itemId),l=a.is(":checked")&&!a.hasClass("mfn-no-wrap-radio");aa()&&(l=!a.hasClass("mfn-no-wrap-radio"));l?(c.find(".gift-message-pslip").hide(),c.find(".gift-message-card").show()):(c.find(".gift-message-card").hide(),c.find(".gift-message-pslip").show())}function aa(){return k.isSPP()&&x("#carouselGiftWrap").length}
function da(b,c){var l=c.itemId,d=k.isSPP()?c.currentTab:b.data("current-tab"),e=x("#afn-gift-options-wrapper-"+l).data("active-tab");if(d!==e){b.parent().find(".selected-giftwrap-tab").removeClass("selected-giftwrap-tab");b.addClass("selected-giftwrap-tab");x("#afn-gift-options-wrapper-"+l).data("active-tab",d);var e="#item-"+l,f=k.isSPP()?x("#giftwrap-carousel-wrap-holder-"+l,e):e;f.length&&a.trigger("checkout:gift:changeCarouselWrapOptions",f,d,l);d=x(".none-wrap",x(e)).find("input");d.prop("checked",
!0);d.val("").change();k.isSPP()?(d=x("#afn-gift-options-wrapper-"+l),d.length&&(d=d.data("active-tab"),a.trigger("checkout:gift:adaptCarouselGiftPanel",l,d))):a.trigger("checkout:gift:adaptCarousel",l);x("#giftwrap-carousel-wrap-holder-"+l).find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");x("#giftwrap-carousel-item-image-"+l).addClass("selected-giftwrap-image");x("#giftwrap-option-preview-imagearea-default-"+l).removeClass("aok-hidden");x("#giftwrap-option-preview-imagearea-image-"+
l).addClass("aok-hidden");d=x(".selectedWrapLargeLink");d.length&&(d.addClass("aok-hidden"),d.removeClass("selectedWrapLargeLink"));d=k.isSPP();e="#item-"+l;x("#gift-message-noshi-warning-"+l).addClass("aok-hidden");x("#includeMessageCheckbox-"+l).removeAttr("disabled");d?x("#afn-message-span-"+l,x(e)).removeClass("aok-hidden"):(x("#afn-message-span",x(e)).removeClass("disable-message-area").addClass("enable-message-area"),x("#gift-message-heading-"+l).removeClass("disable-message-area").addClass("enable-message-area"),
x("#message-area-"+l).removeAttr("disabled"))}}var Z,W,V=!1,ea,x=a.$,Y=t.P&&t.P.AUI_BUILD_DATE&&m.isMobile(),R=g.getInput;a.declarative("save-gift-for-later",["click"],function(a){h.show();a=a.$currentTarget.data("entityId")||a.data.entityId;n.call(a,0,{success:C})});var G={toggleGiftDataAndDeliveryOptions:function(a){a=a.closest(".gift-options-wrapper");var b=R(a.find(".includeMessageCheckbox"));b&&b.is(":checked")?(a.find(".gift-delivery-option").show(),a.find(".item-wrap-span").show(),a.find(".item-wrap-row").show(),
a.find(".item-gift-message-span").show()):(a.find(".gift-delivery-option").hide(),a.find(".item-wrap-span").hide(),a.find(".item-wrap-row").hide(),a.find(".item-gift-message-span").hide())},toggleGiftDeliveryOptions:function(a){var b=a.closest(".gift-options-wrapper");a.is("input[type\x3dcheckbox]")?a.is(":checked")?b.find(".gift-notification-email").removeClass("a-form-disabled"):b.find(".gift-notification-email").addClass("a-form-disabled"):(b.find(".gift-notification-email").removeClass("a-form-disabled"),
a=b.find(".includeMessageCheckbox"),c(a.find("input[type\x3dcheckbox]")),Y&&(a=a.find("i.a-icon"),a.length&&(a.removeClass("a-icon-checkbox-inactive"),a.removeClass("a-icon-touch-checkbox-inactive"),a.addClass("a-icon-checkbox-active"),a.addClass("a-icon-touch-checkbox-active"))))},initGiftNotificationEmail:function(b){var c=a.state("giftNotificationEmailConstraints");c.push({id:b.attr("id")});a.state("giftNotificationEmailConstraints",c)},initGiftDeliveryDate:function(b){var c=a.state("giftDeliveryDateConstraints");
b.hasClass("year-select")||(b=b.parents("div.del-opt-date-section").find("select.year-select:first"));c.push({id:b.attr("id")});a.state("giftDeliveryDateConstraints",c)},updateDateDropdown:function(a){var b=a.closest(".gift-options-wrapper");a=b.find(".month-select").val();var c=b.find(".day-select");c.val();var b=b.find(".year-select").val(),l=z(b,a);if(c.hasClass("a-native-dropdown"))r.when("a-dropdown").execute(function(a){a=a.getSelect(c);if(a.getOptions().size()>l)for(var b=a.getOptions().size()-
1;b>=l;b--)a.removeOption(b);else for(b=a.getOptions().size();b<l;b++)a.addOption({text:b+1,value:b+1},b)});else{if(c.find("option").length>l)c.find("option:gt("+(l-1)+")").remove();else for(a=c.find("option").length+1;a<=l;a++)c.append(x("\x3coption\x3e",{value:a}).text(a));c.trigger("change")}},initSelectedTabAndWrapHolderWidth:Q,initGiftMessage:function(a,b){Y&&!a.is("textarea")&&(a=a.find("textarea"));Z.push({id:a.attr("id"),maxChars:parseInt(b.maxChars,10),maxLines:parseInt(b.maxLines,10),useByteSize:b.useByteSize});
R(a.closest(".gift-options-wrapper").find(".includeMessageCheckbox")).is(":checked")||a.addClass("a-form-disabled");if("1"===x("#multipleAFNGiftWrapOption").val()){var c=a.attr("id").substring(a.attr("id").lastIndexOf("-")+1,a.attr("id").size);Q(c)}},enforceSelectorParity:F,enforceGiftReceiptParity:function(a,l){var d=x("#item-"+l.itemId);if(0!==d.length){var f=d.find(".item-receipt-row label"),g=R(d.find(".includeReceiptCheckbox")),q=d.find(".mfn-hide-price-row label"),k=R(d.find(".mfnHidePriceCheckbox")),
h=d.find(".item-message-row label"),p=R(d.find(".includeMessageCheckbox")).is(":checked"),m=!1;0<d.find(".afn-wrap-checkbox").length?R(d.find(".afn-wrap-checkbox")).is(":checked")&&(m=!0):0<d.find(".mfn-no-wrap-radio").length&&(R(d.find(".mfn-no-wrap-radio")).is(":checked")||(m=!0));if(m||p)c(g),c(k);m||p&&h.is(":visible")?(b(g),f.addClass("checkout-gift-option-disabled"),b(k),q.addClass("checkout-gift-option-disabled")):(e(g),e(k),f.removeClass("checkout-gift-option-disabled"),q.removeClass("checkout-gift-option-disabled"))}},
enforceHidePriceParity:function(a){var b=!1;x(".includeReceiptCheckbox").each(function(){if(R(x(this)).is(":checked"))return b=!0,!1});var c=!1;x(".mfnHidePriceCheckbox").each(function(){if(R(x(this)).is(":checked"))return c=!0,!1});b||c?(O(),x(".kindle-reg-msg-your-account").hide(),x(".kindle-reg-msg-another-account").show()):(K(),x(".kindle-reg-msg-another-account").hide(),x(".kindle-reg-msg-your-account").show())},toggleNoReceiptWarning:function(a){var b=R(a).is(":checked"),l=a.closest(".gift-options-wrapper");
a=l.find(".no-receipt-warning");var d=l.find(".empty-message-warning"),l=l.find(".item-message-row").find(".includeMessageCheckbox"),e=R(l);b?(a.hide(),l.is(":visible")||c(e)):(d.hide(),a.show(),e.is(":checked")&&(Y?e.is(":checked")&&e.closest("label").click():(p.increaseCount("removeauijs5"),e.removeAttr("checked").trigger("change"))))},toggleMessageArea:function(a){var b=a.closest(".gift-options-wrapper");if(a.is("textarea"))b=R(b.find(".includeMessageCheckbox")),c(b);else{a=R(b.find(".includeMessageCheckbox")).is(":checked");
var l=b.find(".item-message-row label").is(":visible"),d=0<b.find(".empty-message-warning").length,e=b.find("textarea"),f=e.data("default-text"),g=0<e.val().length;a?(b.find(".gift-message-edit").show(),b.find(".gift-message-label").removeClass("a-color-secondary"),e.removeClass("a-form-disabled"),f&&e.val(f)):(l&&b.find(".gift-message-edit").hide(),b.find(".gift-message-label").addClass("a-color-secondary"),e.addClass("a-form-disabled"),f&&e.val(""));d&&(a&&g?E(b,!1):E(b,!0))}},toggleMessageLocationText:U,
toggleMessageBoxDisplay:function(l,d){var f=x("#item-"+d.itemId);if(0!==f.length){var g=f.find(".item-message-row"),q=f.find(".item-receipt-row"),k=f.find(".gift-message-on-card"),h=f.find(".gift-message-on-receipt"),p=g.find("label"),g=R(g.find(".includeMessageCheckbox")),m=a.trim(f.find(".gift-message-default-placeholder").text()),v=a.trim(f.find(".gift-message-with-wrap-placeholder").text()),f=f.find("textarea"),u=l.hasClass("mfn-no-wrap-radio")||l.closest("div").hasClass("mfn-no-wrap-radio");
R(l).is(":checked")&&!u?(h.hide(),k.show(),f.attr("placeholder",v),q.is(":visible")&&(c(g),p.is(":visible")&&(b(g),p.addClass("checkout-gift-option-disabled")))):(k.hide(),h.show(),f.attr("placeholder",m),e(g),p.removeClass("checkout-gift-option-disabled"))}},updateContinueButtons:function(){for(var b=!0,c,l=0;l<Z.length;l++)if(c=x("#"+Z[l].id),c.closest(".gift-options-wrapper").find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]').is(":checked")&&(c=T(Z[l]),0>c.charDelta||0>c.lineDelta))b=
!1;b?(x(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").show(),x(".save-gift-button-box span.a-button-disabled").hide()):(x(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").hide(),b=x(".save-gift-button-box span.a-button-disabled"),b.removeClass("aok-hidden"),b.show());a.trigger("orderSummary:primaryActionButton:mirrorPanelBtnState")},updateMessageCounter:function(a){Y&&!a.is("textarea")&&(a=a.find("textarea"));for(var b,c=0;c<Z.length;c++)a.attr("id")===
Z[c].id&&(b=T(Z[c]));if(b){a=a.closest(".gift-options-wrapper");c=a.find(".message-counter");c.find(".remaining-count").hide();if(0<a.find(".empty-message-warning").length){if(0===b.length){E(a,!0);return}E(a,!1)}(-1>b.charDelta?c.find(".remaining-char-over-multiple").show():0>b.charDelta?c.find(".remaining-char-over-single").show():1===b.charDelta?c.find(".remaining-char-single").show():c.find(".remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(b.charDelta));(-1>b.lineDelta?
c.find(".remaining-line-over-multiple").show():0>b.lineDelta?c.find(".remaining-line-over-single").show():1===b.lineDelta?c.find(".remaining-line-single").show():c.find(".remaining-line-multiple").show()).find(".lines-remaining").html(Math.abs(b.lineDelta));c.show()}},updateSelectedGiftWrap:J,clearGiftConnection:function(a,b){x("#include-gift-connection-checkbox-"+b.itemId).is(":checked")||(w(b.itemId),v(b.itemId))},toggleGiftConnectionAgeDropdown:l,toggleGiftConnectionRecipientArea:function(a,b){var c=
x("#select-recipient-"+b.itemId).find(":selected").val(),d=x("#select-occasion-"+b.itemId).find(":selected").val();!c||"1"!==c&&"2"!==c?(x(".gift-connection-recipient-extra-"+b.itemId).hide(),"1"===d&&c&&q(b.itemId,c)):x(".gift-connection-recipient-extra-"+b.itemId).removeClass("aok-hidden").show();l(b.itemId,d,c);v(b.itemId)},toggleGiftConnectionOccasionArea:function(a,b){var c=x("#select-occasion-"+b.itemId).find(":selected").val(),d=x("#select-recipient-"+b.itemId).find(":selected").val();!c||
"1"!==c&&"2"!==c?x(".gift-connection-occasion-extra-"+b.itemId).hide():("1"===c&&d&&"1"!==d&&"2"!==d&&q(b.itemId,d),x(".gift-connection-occasion-extra-"+b.itemId).removeClass("aok-hidden").show());l(b.itemId,c,d)},includeGiftConnection:function(a,b){var c=x("#select-recipient-"+b.itemId).find(":selected").val();c&&"0"===c||x("#include-gift-connection-checkbox-"+b.itemId).attr("checked",!0)},updateGiftOptionsTabSelection:da,updatePreviewImageOnMouseEnter:P,updatePreviewImageOnMouseLeave:S,toggleGiftMessageWarning:function(a){var b=
x("#"+a.attr("id"));g.toggleGiftMessageWarning(b,a.closest(".item-gift-message-span"))}};a.declarative("gift-form-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(G[b[c]])G[b[c]](a.$target,a.data)});a.declarative("gift-form-element","click mouseenter mouseleave",function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(G[b[c]])G[b[c]](a.$currentTarget,
a.data,a)});a.declarative("select-gift-wrap","click",function(a){J(a.$target.parents("li"),{itemId:a.data.itemId,wrapNo:a.data.wrapNo});F(a.$target);var b=a.$target.parents("li").find(".gift-hidden-radio");U(b,{itemId:a.data.itemId})});a.declarative("select-gift-wrap","mouseenter",function(a){P(a.$target.parents("li"),a.data)});a.declarative("select-gift-wrap","mouseleave",function(a){S(a.$target.parents("li"),a.data)});a.declarative("update-gift-options-tab-selection",["click"],function(a){var b=
a.$target.parents("li");b.attr("data",a.data);da(b,a.data)});a.on("checkout:reload:giftselect",A);a.on("checkout:reload:spp-giftoptions",A);return{extendFunctions:function(a){x.extend(G,a)}}});"use strict";r.when("A","page-transition-controller","page-conductor").register("gift-form-del-opt-controller",function(a,n,k){function m(a){var b=a.closest(".expando-box");b&&(b=b.find(".a-expander-header"),a.closest(".expando-content").is(":hidden")&&b.click())}function f(a){var b=a.closest(".gift-options-wrapper"),
e=b.find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]');if(e&&!e.is(":checked"))return!0;e=b.find(".email-error-selector");b.find(".gift-notification-email-error").hide();e.removeClass("a-form-error");if(64<t.unescape(encodeURIComponent(a.val())).length)return e.addClass("a-form-error"),b.find(".gift-notification-email-length-exceeded-error").removeClass("aok-hidden").show(),!1;if(/^\S+[@]\S+[.]\S+$/.test(a.val()))return!0;e.addClass("a-form-error");b.find(".gift-notification-invalid-email-error").removeClass("aok-hidden").show();
return!1}function h(){p("#giftForm").find(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").unbind("click").bind("click",function(a){a.preventDefault();g(a)});p(".checkout-gift-image-preview-trigger \x3e a").show();p("#gift-kindle-imb").show()}function g(c){c=p("#giftForm");var b=c.find('input[name\x3d"hidePrices"]'),e=b.is(":disabled");e&&b.removeAttr("disabled");for(var d=!0,g=a.state("giftNotificationEmailConstraints"),h=a.state("giftDeliveryDateConstraints"),z=0;z<g.length;z++){var C=
p("#"+g[z].id);f(C)||(d=!1,m(C))}for(g=0;g<h.length;g++){z=p("#"+h[g].id);var C=z.closest(".gift-options-wrapper"),w=C.find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]');if(w&&!w.is(":checked"))C=!0;else{var u=C.find(".month-select").val(),q=C.find(".day-select").val(),w=C.find(".year-select"),v=w.val(),l=C.find("#current-date").val().split("-"),u=new Date(v,u,q),l=new Date(l[0],l[1]-1,l[2]),q=new Date(l.getTime());q.setMonth(q.getMonth()+12);C.find(".gift-delivery-date-error").hide();
v=C.find(".date-error-selector");w=w.hasClass("a-native-dropdown")?"error-border a-form-error":"a-form-error";v.removeClass(w);u>=q||u<l?(C.find(".gift-delivery-date-error").removeClass("aok-hidden").show(),v.addClass(w),C=!1):C=!0}C||(d=!1,m(z))}a.state("continueAction",{enable:d});if(a.state("continueAction").enable)k.isSPP()||n.showPageTransition(),c.submit();else return p("html, body").animate({scrollTop:p(".a-form-error").closest("div").offset().top},500),!1;e&&b.attr("disabled",!0)}var p=a.$;
a.declarative("submit-gift-options","click",function(a){g(a)});a.declarative("discard-gift-options","click",function(a){p('#giftForm input[type\x3d"checkbox"]').prop("checked",!1);p("#giftForm textarea").addClass("a-form-disabled");g(a)});a.on("checkout:reload:giftselect",h);a.on("checkout:reload:spp-giftoptions",h)});"use strict";r.when("A").register("teen-message-controller",function(a){var n=a.$;a.declarative("teen-message-form-element","click keyup",function(a){a=a.data.maxChars;var m=n("#teen-message-box").val(),
f=m.match(/(\r\n|\n|\r)/g),h=0;f&&(h=f.length);m=m.length+h;n(".remaining-char").text(Math.max(a-m,0))})});"use strict";r.when("A","page-transition-controller","page-conductor","loading-spinner-controller").register("concealment-form-del-opt-controller",function(a,n,k,m){function f(a){var c=g("#concealmentForm");a=c.find("input:checked").length?a.data.saveConcealmentRefTag:a.data.cancelConcealmentRefTag;c.find("input[name\x3dref]").val(a);c.attr("action",c.attr("action")+"/ref\x3d"+a)}function h(a){a=
g("#concealmentForm");k.isSPP()||n.showPageTransition();a.submit()}var g=a.$;a.declarative("submit-concealment-options","click",function(a){f(a);h(a)});a.declarative("discard-concealment-options","click",function(a){g('#concealmentForm input[type\x3d"checkbox"]').prop("checked",!1);f(a);h(a)});a.declarative("submit-concealment-form","click",function(a){f(a);a.$target.closest(".a-button").addClass("a-button-disabled");m.showSpinner(a.$target.closest("form"))})});"use strict";r.when("A","page-transition-controller",
"page-conductor","address-popovers","checkout-general-utils","client-side-metrics").register("itemselect-address-controller",function(a,n,k,m,f,h){function g(){c(".lineitem").each(function(a,b){var e=c(b);e.find(".no-js-address-dropdown").remove();e.find(".no-js-address-select").remove();e.find(".js-address-dropdown").prop("disabled",!1);e.find(".address-dropdown").removeClass("a-button-disabled")});c("#suppressAddAddressPopover").val()&&c('select[name^\x3d"addressID."]').find("option").each(function(){var a=
c(this);"New"===a.val()&&a.closest("optgroup").remove()})}function p(a){var b=(new Date).getTime(),e=k.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});c.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-address\x26cachebuster\x3d"+b,data:a,dataType:"text",headers:e,error:k.ajaxRedirect,success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-fatal-error");null!==d&&void 0!==d?t.location=d:(k.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}})}
var c=a.$,b,e;a.declarative("itemselect-get-address",["click","touchend"],function(a){f.protectAgainstDoubleAction("itemselect-get-address",200)||(e=a.$currentTarget.find(".js-address-dropdown").val())});a.declarative("itemselect-update-address",["change"],function(a){if(!f.protectAgainstDoubleAction("itemselect-update-address",200)){h.resetMetrics();var c=a.$currentTarget.is("select")?a.$currentTarget:a.$currentTarget.find("select");b=c.val();if("New"===b)m.actionTriggerPopoverFromDropdown(a),r.when("a-dropdown").execute(function(a){a.setValue(c.attr("id").replace(/\./g,
"\\."),e)});else{n.show();var g=c.closest(".lineitem");a=g.find('input[name^\x3d"lineItemEntityID."]').val();var k=g.find('input[name^\x3d"quantity."]').val(),g=g.find(".js-address-dropdown").val();p({lineitems:a,addresses:g,quantities:k})}}});a.declarative("itemselect-update-pantry-address",["change"],function(a){if(!f.protectAgainstDoubleAction("itemselect-update-pantry-address",200)){b=a.$currentTarget.val();n.show();var e="";a=a.$currentTarget.closest(".pantry-row");c(a).find(".pantry-item").each(function(a,
d){var f=c(d);e+="lineitems\x3d"+f.find('input[name^\x3d"lineItemEntityID."]').val()+"\x26";e+="addresses\x3d"+b+"\x26";e+="quantities\x3d"+f.find('input[name^\x3d"quantity."]').val()+"\x26"});p(e)}});a.on("checkout:reload:itemselect",g);a.on("checkout:reload:spp-itemselect",g)});"use strict";r.when("A","page-transition-controller","page-conductor","checkout-general-utils","a-popover","client-side-metrics").register("itemselect-delete-controller",function(a,n,k,m,f,h){function g(a,b){p(a,null===b||
void 0===b?a.$currentTarget.closest(".lineitem"):b)}function p(a,c){a.$event.preventDefault();if(!m.protectAgainstDoubleAction("itemselect-delete-single-item",200)){h.resetMetrics();n.show();y=c;z=a.$currentTarget.is("select")?a.$currentTarget.closest(".quantity-dropdown"):a.$currentTarget;var e=y.find('input[name^\x3d"lineItemEntityID."]').val(),f=0;(new Date).getTime();var g=d("#addon-indicator");g.length&&"true"===g.attr("data-has-addon-items")&&(f=1);b({lineitems:e,isTrial:f})}}function c(a,c){a.$event.preventDefault();
if(!m.protectAgainstDoubleAction("itemselect-delete-multiple-items",200)){n.show();A=c;z=a.$currentTarget;var e="",f=0,g=d("#addon-indicator");g.length&&"true"===g.attr("data-has-addon-items")&&(f=1);g=A.hasClass("pantry-row")?!0:!1;A.find(g?".pantry-item":".lineitem").each(function(a,b){e+="lineitems\x3d"+d(b).find('input[name^\x3d"lineItemEntityID."]').val()+"\x26"});b(e+"isTrial\x3d"+f)}}function b(a){var b=(new Date).getTime(),c=d('input[name\x3d"useCase"]').val(),f=k.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});
d.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3ddelete\x26useCase\x3d"+c+"\x26cachebuster\x3d"+b,data:a,dataType:"text",headers:f,error:k.ajaxRedirect,success:e})}function e(a,b,c){var e;e=c.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==e&&void 0!==e?(t.location=e,e=!0):e=!1;e||(e=c.getResponseHeader("x-amz-checkout-fatal-error"),null!==e&&void 0!==e?t.location=e:(e=c.getResponseHeader("x-amz-checkout-show-addon-warning"),null!==e&&void 0!==e?(a=c.getResponseHeader("x-amz-checkout-show-addon-warning"),
a=d("#addon-warning-"+a+"-launcher"),a.length&&(d("#a-popover-addon-warning-normal .delete-title").show(),d("#a-popover-addon-warning-normal .reduce-title").hide(),d("input[name\x3duseLiveAUI]").length?f.get(a).attrs({$trigger:z,position:"triggerHorizontal"}).show():(b=d.Event("keyup",{triggerPositioningElement:z,manualTrigger:!0}),a.trigger(b))),n.hide()):(k.ajaxUpdatePage(a,b,c),m.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))))}var d=a.$,y,A,z;a.declarative("itemselect-delete-item",
["click","touchend"],g);a.declarative("itemselect-delete-item-row",["click","touchend"],function(a){c(a,a.$currentTarget.closest(".item-row"))});a.declarative("addon-delete-items",["click","touchend"],function(a){if(void 0!==z&&!m.protectAgainstDoubleAction("itemselect-delete-addons",200)){d(".a-button-close").trigger("click");n.show();var c="";null!==A&&void 0!==A?(a=A.hasClass("pantry-row")?A.find(".pantry-item"):A.find(".lineitem"),d(a).each(function(a,b){c+="lineitems\x3d"+d(b).find('input[name^\x3d"lineItemEntityID."]').val()+
"\x26"})):null!==y&&void 0!==y&&(c+="lineitems\x3d"+y.find('input[name^\x3d"lineItemEntityID."]').val()+"\x26");b(c+"isTrial\x3d0\x26deleteAddons\x3d1")}});a.declarative("itemselect-delete-pantry-item",["click","touchend"],function(a){p(a,a.$currentTarget.closest(".pantry-item"))});a.declarative("itemselect-delete-pantry",["click","touchend"],function(a){c(a,a.$currentTarget.closest(".pantry-row"))});a.declarative("itemselect-delete-popover-item",["click","touchend"],function(a){var b=a.$currentTarget.data("entityidtodelete");
c(a,d('a[data-entityid\x3d"'+b+'"]').closest(".item-row"))});return{actionDeleteItem:g}});"use strict";r.when("A","page-transition-controller","page-conductor","itemselect-delete-controller","checkout-general-utils","a-popover","client-side-metrics").register("itemselect-quantity-controller",function(a,n,k,m,f,h,g){function p(){d(".lineitem").each(function(a,b){var c=d(b);c.find(".no-js-quantity").remove();var e=c.find(".quantity-dropdown");e.is(":visible")?(c.find(".js-select").prop("disabled",!1),
e.removeClass("a-button-disabled")):(c=c.find(".quantity-input"),c.prop("disabled",!1),c.removeClass("a-form-disabled"))})}function c(a){a.find(".quantity-input").val(a.find('input[name^\x3d"previousQuantity."]').val())}function b(a){a.$event.preventDefault();if(!f.protectAgainstDoubleAction("itemselect-update-quantity",200)){g.resetMetrics();z=a.$currentTarget.closest(".lineitem");var b=z.find(".js-address-dropdown").val(),q=a.$currentTarget.find("select"),p=q.length?q:a.$currentTarget;y=p.is("select")?
p.val():z.find(".quantity-input").val();if(0===parseInt(y,10)||""===y)c(z);else if("Delete"===y)r.when("a-dropdown").execute(function(a){a.setValue(p.attr("id").replace(/\./g,"\\."),A)}),m.actionDeleteItem(a,z);else{n.show();a=z.find('input[name^\x3d"lineItemEntityID."]').val();var q=0,l=(new Date).getTime(),O=d("#useCase").val(),K=d("#addon-indicator");C=p.is("select")?p.parent():z.find(".quantity-input");K.length&&"true"===K.attr("data-has-addon-items")&&(q=1);K=k.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});
d.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+l,data:{lineitems:a,quantities:y,address:b,isTrial:q,returnHTML:1,useCase:O},dataType:"text",headers:K,error:k.ajaxRedirect,success:function(a,b,c){var l=c.getResponseHeader("x-amz-checkout-fatal-error");null!==l&&void 0!==l?t.location=l:(l=c.getResponseHeader("x-amz-checkout-show-addon-warning"),null!==l&&void 0!==l?(a=c.getResponseHeader("x-amz-checkout-show-addon-warning"),a=d("#addon-warning-"+
a+"-launcher"),a.length&&0<a.length&&(d("#a-popover-addon-warning-normal .delete-title").hide(),d("#a-popover-addon-warning-normal .reduce-title").show(),d("input[name\x3duseLiveAUI]").length?h.get(a).attrs({$trigger:C}).show():(b=d.Event("keyup",{triggerPositioningElement:C,manualTrigger:!0}),a.trigger(b))),e(void 0===A?z.find('input[name^\x3d"previousQuantity."]').val():A,c),n.hide()):(k.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")))}})}}}function e(a,
b){10>a?(r.when("a-dropdown").execute(function(b){var c=z.find('select[name^\x3d"quantity."]');b.setValue(c.attr("id").replace(/\./g,"\\."),a);c.find("option").removeAttr("selected");c.find('option[value\x3d"'+a+'"]').attr("selected","selected")}),z.find(".quantity-dropdown").show(),z.find(".quantity-text-field").hide(),z.find(".js-select").prop("disabled",!1),z.find(".quantity-input").prop("disabled",!0)):(z.find(".quantity-dropdown").hide(),z.find(".quantity-text-field").show(),z.find(".update-quantity-link").hide(),
z.find(".js-select").prop("disabled",!0),z.find(".quantity-input").prop("disabled",!1));z.find(".quantity-input").val(a);z.find('input[name^\x3d"previousQuantity."]').val(a)}var d=a.$,y,A,z,C;a.declarative("itemselect-get-quantity",["click","touchend"],function(a){f.protectAgainstDoubleAction("itemselect-get-quantity",200)||a.$currentTarget.find("select").length&&(A=a.$currentTarget.find("select").val())});a.declarative("itemselect-update-quantity",["change"],b);a.declarative("addon-delete-items",
["click","touchend"],function(a){if(void 0!==C&&!f.protectAgainstDoubleAction("itemselect-delete-addons",200)){d(".a-button-close").trigger("click");n.show();a=z.find('input[name^\x3d"lineItemEntityID."]').val();var b=(new Date).getTime(),c=d("#useCase").val(),e=k.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});d.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+b,data:{lineitems:a,quantities:y,isTrial:0,deleteAddons:1,returnHTML:1,
useCase:c},headers:e,error:k.ajaxRedirect,success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-fatal-error");null!==d&&void 0!==d?t.location=d:(k.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}})}});a.declarative("itemselect-sanitize-input",["keydown"],function(a){f.limitInputToNumbers(a)});a.declarative("itemselect-update-quantity-text-field",["click","touchend"],b);a.declarative("itemselect-show-update-button",["change","keyup"],function(a){var b=
a.$currentTarget.closest(".quantity-text-field").find(".update-quantity-link"),d=a.$currentTarget.is("input")?a.$currentTarget.val():a.$currentTarget.find("input").val();0===parseInt(d,10)||""===d?("change"===a.type&&c(a.$currentTarget.closest(".lineitem")),b.hide()):(a=a.$currentTarget.closest(".lineitem").find('input[name^\x3d"previousQuantity."]').val(),d!==a?b.show():b.hide())});a.on("checkout:reload:itemselect",p);a.on("checkout:reload:spp-itemselect",p)});"use strict";r.when("A","page-transition-controller",
"page-conductor","checkout-general-utils","client-side-metrics").register("itemselect-ship-to-multiple-controller",function(a,n,k,m,f){var h=a.$;a.declarative("itemselect-ship-to-multiple",["click","touchend"],function(a){a.$event.preventDefault();f.resetMetrics();if(!m.protectAgainstDoubleAction("itemselect-ship-to-multiple",200)){n.show();var p=null,c=null,b=null;a.$currentTarget.closest(".item-row").find(".lineitem").each(function(a,e){var f=h(e),g=f.find('select[name^\x3d"quantity."]'),k=f.find('input[type\x3d"number"]');
if(f.find(".quantity-dropdown").is(":visible")&&1<g.val())return p=f.find('input[name^\x3d"lineItemEntityID."]').val(),c=g.val(),b=f.find(".js-address-dropdown").val(),!1;if(f.find(".quantity-text-field").is(":visible")&&1<k.val())return p=f.find('input[name^\x3d"lineItemEntityID."]').val(),c=k.val(),b=f.find(".js-address-dropdown").val(),!1});if(null!==p){a=(new Date).getTime();var e=k.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});h.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dship-to-multiple\x26cachebuster\x3d"+
a,data:{lineitem:p,quantity:c,address:b},headers:e,dataType:"text",error:k.ajaxRedirect,success:function(a,b,c){var e=c.getResponseHeader("x-amz-checkout-fatal-error");null!==e&&void 0!==e?t.location=e:(k.ajaxUpdatePage(a,b,c),m.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}})}}})});"use strict";r.when("A","page-detector","checkout-general-utils").register("pay-common-lib",function(a,n,k){function m(a,c){c.attr("name")&&(a[c.attr("name")]=c.val());c.attr("id")&&(a[c.attr("id")]=
c.val())}function f(a,c){if(!c)return a;for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);return a}function h(a,c,d){g.each(c,function(c,e){a[c]=d?d.find(e):g(e)})}var g=a.$,p="checkbox hidden password radio text number tel month".split(" "),c={};a.declarative("move-to-next-field",["keypress"],function(a){13===a.$event.charCode&&(k.moveToNextInput(a.$declarativeParent),a.$event.preventDefault())});a.declarative("scroll-to-input",["keypress"],function(a){13===a.$event.charCode&&(g(t).scrollTop(a.$declarativeParent.offset().top),
a.$event.preventDefault())});return{getAttributeData:function(a,c){if(a)return a.attr(c)||a.attr("data-"+c)||a.data(c)},getElements:function(a,c){var d={};h(d,a,c);return d},getInputValues:function(a){var c=a.find(".data-row").data()||{};a.find("input").each(function(){var a=g(this),b=a.attr("type");("radio"!==b&&"checkbox"!==b||a.is(":checked"))&&-1<g.inArray(b,p)&&m(c,a)});a.find("select").each(function(){m(c,g(this))});return c},isDesktopCX:n.isDesktopPayment,isMobileCX:n.isMobilePayment,isPayPage:n.isPayment,
isTouchCX:n.isTabletPayment,mergeFrom:function(a,c){c=f({},c);return f(c,a)},prop:function(a,e,d){if(a){if(1<arguments.length)return void 0===e?delete c[a]:c[a]={isOneTime:d?1:0,value:e},e;var f=c[a];if(f)return f.isOneTime&&delete c[a],f.value}},refreshElements:h,scrollTopTo:function(a){a&&a.length&&g("html,body").animate({scrollTop:a.offset().top-20},"fast")},selectDefaultPaymentMethodIfNotSelected:function(){var a=g("#existing-payment-methods .payment-row").find('input[type\x3d"radio"][name\x3d"paymentMethod"]'),
c=a.closest("div.payment-selected");c&&0<c.length||(a=a.closest("div.default-payment-marker"))&&a.length&&(a.addClass("payment-selected"),a.find("[name\x3dpaymentMethod]").attr("checked",!0))},processSubmissionParameters:function(a){for(var c={},d=0;d<a.length;d++)c[a[d].name]=a[d].value;return c}}});"use strict";r.when("A","pay-common-lib","a-popover-base","ajax-utility","loading-spinner-controller","page-conductor","page-transition-controller").register("pay-desktop-util",function(a,n,k,m,f,h,g){function p(a){a.$event.preventDefault();
a.$target.closest(".a-popover").hide();a.$target.siblings("span.error-message").hide()}function c(a){a.preventDefault();var b=q(a.currentTarget),c=b.closest("div.expando-section");a=c.find("div.expando-content");var c=c.find("div.expando-reverse-content"),l=a.is(":visible"),d=function(){var a=b.find("i");a.hasClass("a-icon-collapse")||a.hasClass("a-icon-expand")?l?(a.removeClass("a-icon-collapse").addClass("a-icon-expand"),b.find("div.expando-toggle-text-show").show(),b.find("div.expando-toggle-text-hide").hide()):
(a.removeClass("a-icon-expand").addClass("a-icon-collapse"),b.find("div.expando-toggle-text-show").hide(),b.find("div.expando-toggle-text-hide").show()):l?(a.removeClass("a-icon-section-collapse").addClass("a-icon-section-expand"),b.find("div.expando-toggle-text-show").show(),b.find("div.expando-toggle-text-hide").hide()):(a.removeClass("a-icon-section-expand").addClass("a-icon-section-collapse"),b.find("div.expando-toggle-text-show").hide(),b.find("div.expando-toggle-text-hide").show())};l?(c.slideDown("fast"),
a.slideUp("fast",d)):(c.slideUp("fast"),a.slideDown("fast",d))}function b(a){var b=a.$target.closest("a");a=b.closest("div.extender-section");b=b.find("i");b.hasClass("a-icon-extender-expand")?(a.find(".collapsed").hide(),a.find(".expanded").slideDown("fast"),b.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse")):(a.find(".collapsed").show(),a.find(".expanded").slideUp("fast"),b.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"))}function e(a){B.msgPopovers.filter(":visible").hide();
a.$event.preventDefault();a.$event.stopPropagation();a=a.$target.parent().find(".a-popover");a.is(":visible")||a.show()}function d(a,b,c){var l=a||{},d="string"===typeof a;c=c&&c.useSif?q('input[type\x3d"hidden"][name\x3d"isAmazonApp"]').val():0;d?(l+="\x26ajaxResponse\x3d1\x26returnjson\x3d1",c&&(l+="\x26isAmazonApp\x3d1")):(l.ajaxResponse=1,l.returnjson=1,c&&(l.isAmazonApp=1));for(c=0;c<K.length;c++){var e=K[c],f=q("input[name\x3d"+e+"]").val();d?-1===b.search(e)&&-1===a.search(e)&&(l=l+"\x26"+
e+"\x3d"+f):l[e]=f}return l}function y(a,b){if(0>a)return 0;isNaN(b)||(a=Number(a).toFixed(b));a=a.toString();var c=0<=a.lastIndexOf(".")?a.lastIndexOf("."):a.length;return 3>=c?a:y(a.substring(0,c-3),0)+","+a.substring(c-3)}function A(a,b,c,l){a="timeout"===b?"pay-ajax-timeout":"abort"===b?"pay-ajax-abort":"abort-for-cleanup"===b?"pay-ajax-abort-for-cleanup":"parsererror"===b?"pay-ajax-parsererror":500===a.status?"pay-ajax-500":"pay-ajax-error";if(c){a=c=-1===c.lastIndexOf(".html?")?c+("?ref\x3d"+
a):c+("\x26ref\x3d"+a);B.pageContainer.find("#tempForm").remove();c=q('\x3cform id\x3d"#tempForm" method\x3d"post"\x3e\x3c/form\x3e');c.attr("action",a);if("string"===typeof l){a={};b=l.split("\x26");for(var d=0;d<b.length;d++){var e=b[d].split("\x3d");2===e.length&&(a[e[0]]=e[1])}}else a=l;for(var f in a)"ajaxResponse"!==f&&"returnjson"!==f&&(a=q('\x3cinput type\x3d"hidden"/\x3e').attr("name",f).val(l[f]),c.append(a));B.pageContainer.append(c);c.submit()}}function z(a,b,c,e){var f=h.setAjaxTransitionHeader({"x-amz-checkout-page":"payselect"}),
f={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:d(b,a,e),dataType:"text",headers:f,timeout:l,type:"POST",url:a,beforeSend:function(a,b){c&&c.beforeHandler&&c.beforeHandler(a,b)},complete:function(a,b){c&&c.completeHandler&&c.completeHandler(a,b)},error:function(l,d){c&&c.errorHandler?c.errorHandler(l,d):A(l,d,a,b)},success:function(a,b,l){var d=l.getResponseHeader("x-amz-checkout-page");if("payselect"!==d&&"spp-payment"!==d)return a=m.jsonify(a),h.redirect(a);c&&c.successHandler?
c.successHandler(a,b,l):h.ajaxUpdatePage(a,b,l)}};q.extend(f,e);O.push(q.ajax(f))}function C(a,b,c,e){var f=h.setAjaxTransitionHeader({"x-amz-checkout-page":"payselect"}),f={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:d(b,a,e),dataType:"text",headers:f,timeout:l,type:"POST",url:a,error:function(l,d){c&&c.errorHandler?c.errorHandler(l,d):A(l,d,a,b)},success:function(a,b,l){var d=l.getResponseHeader("x-amz-checkout-page");"payselect"!==d&&"spp-payment"!==d&&c&&c.pageUpdater?
c.pageUpdater(a):h.ajaxUpdatePage(a,b,l)}};q.extend(f,e);O.push(q.ajax(f))}function w(){l=parseInt(q("input[type\x3d'hidden'][name\x3d'paypageTimeoutValue']").val(),10);l=isNaN(l)?1E4:l;n.isMobileCX()?v&&(v=!1):(B=n.getElements(F),v&&(a.declarative("close-popover",["click"],p),a.declarative("toggle-msg-popover",["click"],e),a.declarative("a-extender-toggle",["click"],b),v=!1),B.pageContainer.undelegate(".expando-link","click").delegate(".expando-link","click",c),B.pageContainer.find("form select.a-touch-select-input").unbind("change",
u).bind("change",u),q(".a-dropdown-container").each(function(){k.remove(q(this).find("select").attr("name"))}),q(document).bind("click",function(a){a.isPropagationStopped()||0===q(a.target).closest(".pay-popover-msg").length&&B.msgPopovers.filter(":visible").hide()}))}function u(a){var b=q(a.currentTarget);a=b.siblings("a.a-placeholder");b=b.find(":selected").text();a.html(b);return!1}var q=a.$,v=!0,l,O=[],K=["forceResponsive","fromAnywhere","hasWorkingJavascript"],B={},F={msgPopovers:"div.pay-popover-msg",
pageContainer:"div.a-container"};a.on("checkout:reload:payselect",w);a.on("checkout:reload:spp-payment",w);return n.mergeFrom({decodeJSONResponse:function(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))},elements:B,getNumberWithSeparators:y,handleForm:function(a,b,c){a.$event.preventDefault();
var l=a.$declarativeParent;l.is("span")&&(l=l.find("form"));l=l.serializeArray();l=n.processSubmissionParameters(l);z(a.data.action,l,b,c)},makeAjaxCall:z,handleAjaxError:A,handlePaymentsPortalForm:function(a,b,c,l){a=n.processSubmissionParameters(a.submissionParameters);z(b,a,c,l)},handlePaymentsPortalRedeemClaimCodeTransition:function(a,b,c,l){a=n.processSubmissionParameters(a.submissionParameters);a.embedOnlyData=1;C(b,a,c,l)}},n)});"use strict";r.when("A","pay-common-lib","page-transition-controller").register("pay-mobile-util",
function(a,n,k){function m(a,b,c){a=a||{};var e=z.fromAnywhereField.val();c=c&&c.useSif?d('input[type\x3d"hidden"][name\x3d"isAmazonApp"]').val():0;var f=g();"string"===typeof a?(a=a+"\x26ajaxResponse\x3d1\x26currentPage\x3d"+f,-1===b.search("fromAnywhere")&&-1===a.search("fromAnywhere")&&(a=a+"\x26fromAnywhere\x3d"+e),c&&(a+="\x26isAmazonApp\x3d1")):(a.ajaxResponse=1,a.currentPage=f,-1===b.search("fromAnywhere")&&(a.fromAnywhere=e),c&&(a.isAmazonApp=1));return a}function f(){y&&y.abort("abort-for-cleanup");
y=null}function h(a,c,l,d){a=a&&a.status;c="timeout"===c?"pay-ajax-timeout":"abort"===c?"pay-ajax-abort":"abort-for-cleanup"===c?"pay-ajax-abort-for-cleanup":"parsererror"===c?"pay-ajax-parsererror":500===a?"pay-ajax-500":"unknown"===a?"pay-unknown-page":"pay-ajax-error";l&&(l=-1===l.lastIndexOf(".html?")?l+("?ref\x3d"+c):l+("\x26ref\x3d"+c),b(l,d))}function g(){var a;d.each(A,function(b,c){if(c.pageId&&d(c.pageId).is(":visible"))return a=b,!1});return a}function p(a){(a=A[a]&&A[a].componentId)&&
r.when(a).execute(function(a){a.init&&a.init()})}function c(a,b,c,e,f){f&&f.suppressSpinner||k.show();f={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:m(b,a,e),dataType:"text",timeout:u,type:"POST",url:a,beforeSend:function(a,b){c&&c.beforeHandler&&c.beforeHandler(a,b)},complete:function(a,b){c&&c.completeHandler&&c.completeHandler(a,b);k.hide()},error:function(d,e){c&&c.errorHandler?c.errorHandler(d,e):h(d,e,a,b)},success:function(d,e,f){var g=f.getResponseHeader("x-amz-checkout-pay-page-name");
if(g){var k=f.getResponseHeader("x-amz-checkout-pay-page-title");k&&z.pageTitle.text(decodeURIComponent(k));c&&c.successHandler?c.successHandler(d,e,f):z.pageContainer.html(d);p(g)}else h(null,"unknown",a,b)}};d.extend(f,e);y=d.ajax(f)}function b(a,b,c){var e=d("#tempForm",z.pageContainer);0<e.length&&e.remove();e=d('\x3cform method\x3d"post"\x3e\x3c/form\x3e');e.attr("action",a);c&&c.target&&e.attr("target",c.target);if("string"===typeof b)for(a=b.split("\x26"),b=0;b<a.length;b++)c=a[b].split("\x3d"),
2===c.length&&"ajaxResponse"!==c[0]&&(c=d('\x3cinput type\x3d"hidden"/\x3e').attr("name",c[0]).val(c[1]),e.append(c));else for(var f in b)"ajaxResponse"!==f&&e.append(d('\x3cinput type\x3d"hidden"/\x3e').attr("name",f).val(b[f]));z.pageContainer.append(e);e.submit()}function e(a,b,c,e,f){f&&f.suppressSpinner||k.show();f={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:m(b,a,e),dataType:"text",timeout:u,type:"POST",url:a,complete:function(a,b){c&&c.completeHandler&&c.completeHandler(a,
b);k.hide()},error:function(d,e){c&&c.errorHandler?c.errorHandler(d,e):h(d,e,a,b)},success:function(a,b,d){var e=d.getResponseHeader("x-amz-checkout-pay-page-name");if(!e&&c&&c.pageUpdater)c.pageUpdater(a);else{var f=d.getResponseHeader("x-amz-checkout-pay-page-title");f&&z.pageTitle.text(decodeURIComponent(f));c&&c.successHandler?c.successHandler(a,b,d):z.pageContainer.html(a);p(e)}}};d.extend(f,e);y=d.ajax(f)}var d=a.$,y=null,A={main:{componentId:"page-main",pageId:"#select-payments-view"},"credit-card-rewards":{componentId:"page-rewards",
pageId:"#select-payment-rewards-view"},"financial-offer":{componentId:"page-financial-offer",pageId:"#select-payment-financial-offer-view"},"new-payment-methods":{pageId:"#new-payments-view"}},z={},C={cvvHelper:"div#cvv-help-popover",fromAnywhereField:"input[name\x3dfromAnywhere]",jppoints:"div#jppoints",pageContainer:"div#page-container",pageTitle:"head title"},w=!0,u;return n.mergeFrom({decodeJSonResponse:function(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,
92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))},elements:z,getCurrentPage:function(){return z.pageContainer.children("div.page").filter(":visible")},getCurrentPageName:g,getPageId:function(a){a=a.getResponseHeader("x-amz-checkout-pay-page-name");return A[a]&&A[a].pageId},handleForm:function(a,b,l){a.$event.preventDefault();c(a.data.action,a.$target.serialize(),
{successHandler:function(a,c,l){b(a,c,l)}},l)},submitFormRequest:b,init:function(){n.isMobileCX()&&(t.onbeforeunload=f,n.refreshElements(z,C),u=parseInt(d("input[type\x3d'hidden'][name\x3d'paypageTimeoutValue']").val(),10),u=isNaN(u)?1E4:u,w&&(w=!1,d("div.pay-mobile").bind("keypress",function(a){n.prop("activeGoElement",13===a.keyCode?document.activeElement:null,!0)})))},makeAjaxCall:c,handleAjaxError:h,pages:A,handlePaymentsPortalForm:function(a,b,l,d){a=n.processSubmissionParameters(a.submissionParameters);
c(b,a,l,d)},handlePaymentsPortalRedeemClaimCodeTransition:function(a,b,c,d){a=n.processSubmissionParameters(a.submissionParameters);a.embedOnlyData=1;e(b,a,c,d)}},n)});"use strict";r.when("page-detector","pay-desktop-util","pay-mobile-util").register("pay-common-util",function(a,n,k){return a.isMobile()?k:n});"use strict";r.when("A","pay-common-util","pay-rewards-currency").register("pay-validator",function(a,n,k){function m(){function a(b,c,d,e){u.push({identifier:b,priority:d||100,target:c,isPincodeError:e})}
function p(a){if(!a)return null;var b=new RegExp(String.fromCharCode(32),"g"),c=new RegExp(String.fromCharCode(45),"g");return a.replace(b,"").replace(c,"")}function c(){return 0<u.length}function b(a){if(!a||0===a.length)return!1;for(var b=0,c=!1,d=a.length-1;0<=d;--d){var e=a.charAt(d);c&&(e*=2,9<e&&(e-=9));b+=parseInt(e,10);c=!c}return 0===b%10}function e(a,b){return a&&a.match(/^[0-9]+$/)&&a.length===b}function d(a,b,c){return a&&a.match(/^[0-9A-Za-z]+$/)&&a.length>=b&&a.length<=c}function m(a,
b){if(!a||!b)return!1;var c=parseInt(a,10),d=parseInt(b,10);return A(c,d)}function A(a,b){var c=new Date,d=c.getFullYear();return b>d||b===d&&a>=c.getMonth()+1}function z(a){a=a.val();return!a||0===a.length}function C(b){var c=b.find("#existingCvvNum");if(0!==c.length){var d=c.val();b=h?b.data("validcvvlength"):b.attr("validcvvlength");e(d,parseInt(b,10))||a("continue_BadSecurityCode",c)}}function w(b){b=b.find("#existingPincodeNum");if(0!==b.length){var c=b.val();c?d(c,4,8)||a("existingCreditCard_PincodeInvalid",
b,null,!n.isMobileCX()):a("continue_EmptyPincode",b)}}var u=[],q=null,v=null;return{displayErrors:function(a,b){(q=a)&&q.hide().find(".error-message").hide().addClass("hidden");(v=b)&&v.find(".a-form-error").removeClass("a-form-error");if(c()){for(var d=0;d<u.length;d++){var e=u[d];if(e.target){var g=e.target.parent();g.hasClass("a-input-text-wrapper")&&!g.hasClass("a-form-error")?g.addClass("a-form-error"):e.target.hasClass("a-form-error")||e.target.addClass("a-form-error")}e=e.identifier;(q&&q.length?
q.find("#"+e):f("#"+e)).show().removeClass("hidden")}q&&q.length&&q.show()}},getHighestErrorId:function(){for(var a={priority:100},b=0;b<u.length;b++){var c=u[b],d;(d=c.identifier)?(d=q&&q.length?q.find("#"+d):f("#"+d),d=parseInt(n.getAttributeData(d,"priority"),10),d=isNaN(d)?100:d):d=100;d<=a.priority&&(a={identifier:c.identifier,priority:d,isPincodeError:c.isPincodeError,target:c.target})}return a},hasErrors:c,isValidCardCVV:e,isValidCardPincode:d,validateBankAccountNum:function(b,c){z(b)&&a("addBankAccount_NoAccountNumber",
c)},validateBankAccountNumConfirm:function(b,c,d){b.val()!==c.val()&&a("addBankAccount_AccountNumberMismatch",d)},validateBankDriverLicense:function(b,c){z(b)&&a("addBankAccount_NoDLNumber",c)},validateBankDriverLicenseState:function(b,c){void 0!==b.val()&&""!==b.val()&&"0"!==b.val()||a("addBankAccount_NoDLState",c)},validateBankHolderName:function(b,c){z(b)&&a("addBankAccount_NoName",c)},validateBankRoutingNum:function(b,c){9!==b.val().length&&a("addBankAccount_ShortRoutingNumber",c)},validateCreditCardCVV2:function(b,
c,d){d="true"===b.attr("isaddresschallenge")?b.attr("issuer"):d&&d.charAt(0);"R"!==d&&(b=b.val(),e(b,"A"===d?4:3)||a("addCreditCard_BadSecurityCode",c))},validateCreditCardDate:function(b,c,d,e){m(b.val(),d.val())||(a("addCreditCard_BadExpiration",c),a("addCreditCard_BadExpiration",e))},validateCreditCardMobile:function(b,c){var d=b.val();d&&d.replace(/[^0-9]/g,"").match(/^1[34578]{1}[0-9]{9}$/)||a("addCreditCard_BadMobileNumber",c)},validateCreditCardPincode:function(b,c){var d=b.val();d&&d.match(/^[a-zA-Z0-9]{4,8}$/)||
a("addCreditCard_BadPincode",c)},validateCreditCardName:function(b,c){z(b)&&a("addCreditCard_NoName",c)},validateCreditCardNumber:function(c,d){var e=p(c.val());e&&10<e.length&&b(e)||a("addCreditCard_BadNumber",d);var e=f("#creditCardIssuersBlocked").val(),k=c.data("issuer");e&&""!==e&&k&&""!==k&&-1<f.inArray(k,e.split(","))&&a("addCreditCard_IssuerUnsupported",d)},isAMEXCreditCard:function(a){a=p(a.val());return null!==a?0===a.indexOf("37")||0===a.indexOf("34"):!1},validateCreditCardTail:function(c,
d){var e=p(c.val());if(e&&10<e.length&&b(e)){var f=(n.isMobileCX()&&h?c.parent().data():c.data()).tail+"";e.substr(e.length-f.length)!==f&&a("addCreditCard_NotMatch",d)}else a("addCreditCard_NotMatch",d)},validateCreditCardType:function(b,c){if(b.is(":visible")){var d=b.val();d&&d.match(/^[A-Z][0-9]*$/)||a("addCreditCard_NoType",c)}},validateRegistrationResult:function(b){b.cardStatus?1===b.checkStatusCount&&a("addCreditCard_RegisterFailed"):0<b.errors.length&&a("addCreditCard_RegisterFailed")},validateDirectDebitAccountName:function(b,
c){z(b)&&a("addDirectDebit_NoAccountOwnerName",c)},validateDirectDebitAccountNum:function(b,c){z(b)&&a("addDirectDebit_NoAccountNumber",c)},validateDirectDebitRoutingNum:function(b,c){z(b)&&a("addDirectDebit_NoRoutingNumber",c)},validateInvoiceFirstName:function(b,c){z(b)&&a("addInvoiceAccount_NoFirstName",c)},validateInvoiceLastName:function(b,c){z(b)&&a("addInvoiceAccount_NoLastName",c)},validateLocName:function(b,c){z(b)&&a("addLoc_NoName",c)},validateLocNumber:function(b,c){z(b)&&a("addLoc_BadNumber",
c)},validateNewGiftPromotion:function(b,c){z(b)&&a("addGiftCardOrPromo_NoCode",c)},validatePayment:function(b){if(n.isMobileCX()){if(b&&b.length)for(var c=0;c<b.length;c++){var d=f(b[c]);C(d);w(d);"netBanking"===d.find('input[name\x3d"paymentMethod"]').val()&&(f("#netBanking_select").val(),f("#net-banking-list").find("option:selected").data("isdisabled")&&a("continue_BankTemporarilyNotAvailable"))}}else if(c=f("#pm_pay_by_check").is(":checked"),d=f("#existing-balance [paymentmethodid\x3d'availablebalance'] input").is(":checked"),
c&&d&&a("continue_BadCombinationCheckExistingBalance"),b&&b.length){for(c=0;c<b.length;c++){d=f(b[c]);"true"===n.getAttributeData(d,"isaddresschallenge")&&a("continue_AddressChallenge");"true"===n.getAttributeData(d,"isverifiedfail")&&a("continue_VerifiedFail");"true"===n.getAttributeData(d,"iscupcardexpired")&&a("continue_CUPExpired");var e=d.find(".currency-list");if(e.length&&e.is(":visible")){var h=e.find("[type\x3dradio]:checked").val(),e=e.find("#cardCurrencyDropDown option:selected").val();
h&&("Other"!==h||"-1"!==e&&"-2"!==e)||a("continue_SelectCardCurrency")}C(d);w(d);var h=d,e=h.find("#newMonth"),p=h.find("#newYear"),h=h.find("#newExpDate");!(e=e.length&&!m(e.val(),p.val()))&&(e=h.length)&&((h=h.val())?(e=h.split("-"),h=parseInt(e[0],10),e=parseInt(e[1],10),h=A(e,h)):h=!1,e=!h);e&&a("continue_BadExpiration");h=d;"domesticCards"===h.find('input[name\x3d"paymentMethod"]').val()&&((h=h.find("select").val())&&h.match(/^[0-9]*$/)||a("continue_BlankSlate"));e=d;h=f("#existing-balance input[name\x3duseFlexiblePayments]").is(":checked");
e=n.getAttributeData(e,"paymentmethodtype");h&&"creditCard"!==e&&a("continue_FlexiblePaymentsNeedsCreditCard");h=d;"thirdPartyAccounts"===h.find('input[name\x3d"paymentMethod"]').val()&&((h=h.find("select").val())&&0!==h.length||a("continue_BlankSlate"));p=d.find(".rewards-list");if(p.length&&p.find('input[type\x3d"radio"][value\x3d"rewardscustom"]').is(":checked"))if(h=p.find("input.custom-rewards-input"),e=h.val(),p.hasClass("show-currency-input-widget-new")){var p=h.data("country-code"),q=k.getCurrencyFormatByCountryCode(p),
p=h.data("min"),e=k.getAmount(e,q.decimalPlace);e<p&&a("continue_BadRewardsMin")}else/^\s*$/.test(e)||isNaN(e)?a("continue_BadRewardsValue"):(e=parseFloat(h.val()),p=h.data("min"),0>=e||e<p?a("continue_BadRewardsMin"):e>h.data().max&&a("continue_BadRewardsMax"));h=d;e=h.find('input[name\x3d"paymentMethod"]').val();"verifiedCreditCard"===e?a("continue_BlankSlate"):"verifiedDebitCard"===e&&(h=h.find("#vdcBanksSelect").val(),(""===h||"OtherBanks"===h||"1"===f("#save_citi_card").val()&&"CIT"===h)&&a("continue_BlankSlate"));
e=d;"netBanking"===e.find('input[name\x3d"paymentMethod"]').val()&&(h=e.find("#net-banking-select-list").val(),e=e.find("option:selected").prop("disabled"),""===h&&a("continue_BlankSlate"),e&&a("continue_BankTemporarilyNotAvailable"));h=d;"morePaymentMethod"===h.find('input[name\x3d"paymentMethod"]').val()&&""===h.find("#more-payment-methods-select-list").val()&&a("continue_BlankSlate");h=d;e=h.find('input[name\x3d"paymentMethod"]').val();if("StandaloneInstallment"===e||"StandaloneCreditCardInstallment"===
e)h.find('input[name\x3d"gilShowContinueBlocker"]').val()&&("StandaloneCreditCardInstallment"===e?a("continue_GilCCContinueError"):a("continue_GilContinueError")),h.find('input[name\x3d"gilShowContinueBlockerIfPromotions"]').val()&&0<f("#existing-balance input[name\x3duseAvailableBalance]:checked").length&&("StandaloneCreditCardInstallment"===e?a("continue_GilCCContinueErrorPromotions"):a("continue_GilContinueErrorPromotions"));"cashOnDeliveryCash"===d.find('input[name\x3d"paymentMethod"]').val()&&
d.find(".phonenumberNotVerified").length&&a("continue_OTPforCOD")}f("#jppoints").length&&(c=!1,1===b.length&&"jppoints"===b.attr("id")?(e=b,c=!0):e=b.filter("#jppoints"),e&&e.find("#redeemPoints").is(":checked")&&(b=e.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),b=parseInt(b,10),f('input[type\x3d"checkbox"][name\x3d"useAvailableBalance"]').is(":checked")&&(b-=parseInt(e.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]').val(),10)),d=parseInt(e.find("#redeemableAmount").text(),
10),h=e.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),e.find("#jpPointsMax").is(":checked")?e=d:(e=parseInt(h.val(),10))||(e=0),e>d?a("continue_jpPointsExceedsRedeemableAmount",h):c&&e<b?a("continue_notEnoughJPPoints"):e>b&&a("continue_jpPointsExceedsTotalPurchase")))}else a("continue_BlankSlate")},validateGetCreditCardTypeResult:function(b){if(b.errors&&0<b.errors.length)for(var c=0;c<b.errors.length;c++)a(b.errors[c])}}}var f=a.$,h=t.P&&t.P.AUI_BUILD_DATE;return{create:function(){return new m}}});
"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator").register("pay-credit-card",function(a,n,k,m){function f(a,b,e,d){a&&a.length&&(b=e+"-"+b,(e=k.prop(b))&&(a=a.find(d).val(e))&&a.length&&(k.isMobileCX()?a.closest(".card-cvv-field").hide().data("isHidden",1):a.closest(".a-column").hide(),k.prop(b,void 0)))}var h=a.$,g={cc:!1,vcc:!1,vdc:!1},p=t.P&&t.P.AUI_BUILD_DATE;return{confirmCreditCard:function(a,b,e){a.currentPaymentInstrumentID=a.paymentmethodid;a.recommendedPaymentMethodId=
a.paymentmethodid;if(a.newMonth&&a.newYear)a.month=a.newMonth,a.year=a.newYear;else if(a.newExpDate){var d=a.newExpDate.split("-");a.year=parseInt(d[0],10);a.month=parseInt(d[1],10)}else a.expmonth&&a.expyear&&(a.month=a.expmonth,a.year=a.expyear);(d="existingCvvNum"in a?a.addCreditCardVerificationNumber=a.existingCvvNum:a.addCreditCardVerificationNumber)&&k.prop("cvv-"+a.paymentmethodid,d);(d="existingPincodeNum"in a?a.addCreditCardPincode=a.existingPincodeNum:a.addCreditCardPincode)&&k.prop("pincode-"+
a.paymentmethodid,d);k.makeAjaxCall(e,a,{successHandler:b,errorHandler:function(b,d){a.handler="confirm-credit-card";k.handleAjaxError(b,d,"/gp/buy/payselect/handlers/submit.html",a)}},{useSif:!0})},handleCreditCardType:function(a,b){var e=a.$target,d=a.data.type,f=m.create();a.$currentTarget.data("issuer","");f.validateCreditCardNumber(e,e);f.hasErrors()||(g[d]=!0,k.makeAjaxCall(a.data.url,{addCreditCardNumber:e.val(),returnjson:1},{completeHandler:function(){g[d]=!1},successHandler:function(e){e=
n.jsonify(e);b(e,d);a.$currentTarget.data("issuer",e.issuer)}},{useSif:!0},{suppressSpinner:!0}))},isWaitingForType:function(a){return g[a]},runConfirmCardValidator:function(a,b){var e=a.find("#existingCvvNum"),e=e.length?e:a.find("#addCreditCardVerificationNumber"),d=a.find("#addCreditCardNumber"),f=a.find("#newMonth"),g=a.find("#newYear"),h=m.create();h.validateCreditCardTail(d,d);f.length&&g.length&&h.validateCreditCardDate(f,f.closest(".card-date").find(".a-button"),g,g.closest(".card-date").find(".a-button"));
e.length&&(d=(d=a.find("#issuer"))&&d.val(),h.validateCreditCardCVV2(e,e,d));h.displayErrors(b,a);return h.hasErrors()},setDateSelectorStatus:function(a,b){var e=b.find(".card-date").find("select");e&&e.length&&r.when("a-dropdown").execute(function(b){e.each(function(){var e=h(this).attr("id"),f="",f="21"===a.brand&&"G"===a.issuer?"disabled":"enabled";b.updateSelect(e,{status:f})})})},setNewCardCVVInputStatus:function(a){(k.prop("cvv-newcard")||k.prop("pincode-newcard"))&&a.each(function(){var a=
h(this);if("1"===(p?a.data("isnewcard")+"":a.attr("isnewcard")))return f(a,"newcard","cvv","#existingCvvNum"),f(a,"newcard","pincode","#existingPincodeNum"),!1})},setCardPasswordInputStatus:f}});"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator","page-transition-controller","page-conductor","pay-credit-card").register("pay-credit-card-reregistration",function(a,n,k,m,f,h,g){function p(a,c){var f=m.create(),g=b("#cupMobileNumber-"+a),h=b("#cupSecurityCode-"+a),k=b("#reRegisterCCErrors-"+
a),p=b("#reRegisterCCInputs-"+a);f.validateCreditCardCVV2(h,h,c);f.validateCreditCardMobile(g,g);f.displayErrors(k,p);return f.hasErrors()}function c(a,b,c){h.ajaxUpdatePage(a,b,c)}var b=a.$;return{actionReregisterCardInBox:function(a){a.$event.preventDefault();f.show();var d=a.data.type,h=b("#cupMobileNumber-"+a.data.paymentMethodID).val(),m=b("#cupSecurityCode-"+a.data.paymentMethodID).val();p(a.data.paymentMethodID,d)?f.hide():(d={isReregistering:a.data.isReregistering,currentPaymentInstrumentID:a.data.paymentMethodID,
name:a.data.holderName,year:a.data.expiredYear,month:a.data.expiredMonth,addCreditCardMobileNumber:h,addCreditCardVerificationNumber:m},h={useSif:k.isMobileCX()?!0:!1,success:function(a,d,e){a=n.jsonify(a);d=b("#reRegisterCCErrors-"+a.paymentInstrumentId);g.waitForCreditCardStatus(a,c,d)}},a.$event.preventDefault(),k.makeAjaxCall(a.data.url,d,null,h))}}});"use strict";r.when("A","client-side-metrics","ajax-utility","pay-common-util","pay-validator","existing-payments","page-conductor","checkout-modal-popover",
"page-transition-controller","pay-credit-card","pay-gil").register("new-payments",function(a,n,k,m,f,h,g,p,c,b,e){function d(a){a.$event.preventDefault();var e=a.data.type;if(b.isWaitingForType(e))c.show(),setTimeout(function(){d(a)},50);else{var f="vdc"===e?G.newVDC:G.newVCC;if(V(f,e))c.hide();else{c.show();var l=m.getInputValues(f),g="vdc"===e?"_VDC":"_VCC",f=l["addCreditCardVerificationNumber"+g],h=l["addCreditCardPincode"+g],e={addCreditCardNumber:l["addCreditCardNumber"+g],addCreditCardVerificationNumber:f,
addCreditCardPincode:h,handler:l["handler"+g],month:l["month"+g],name:l["name"+g],newPaymentType:e,year:l["year"+g],cctype:l["cctype"+g]};m.prop("cvv-newcard",f);h&&m.prop("pincode-newcard",h);m.makeAjaxCall(a.data.url,e,{successHandler:function(a,c,d){q(a,c,d);b.setNewCardCVVInputStatus(G.paymentRows)}},{useSif:!0})}}}function y(a){a.$event.preventDefault();var d=a.data.type;if(b.isWaitingForType(d))c.show(),setTimeout(function(){y(a)},50);else{var e=G.newCCFormContent;if(V(e,d))c.hide();else{c.show();
d=m.getInputValues(e);d.handler=d.handler_addCCInBox;var e=a.data.url,f={};x("#cupSecurityCode").is(":visible")&&x("#cupMobileNumber").is(":visible")?(e="/gp/buy/payselect/handlers/add-credit-card.html",f={successHandler:function(a){a=k.jsonify(a);l(a)}}):f={successHandler:q};m.makeAjaxCall(e,d,f,{useSif:!0})}}}function A(a){a.$event.preventDefault();var b=x("#new-giftcard-promotion"),b=m.getInputValues(b);x("input[name\x3disUnifiedActionsDesignEnabled]").length&&z(a)||(b.handler=b.handler_addGCInBox,
a=a.data.url,c.show(),m.makeAjaxCall(a,b,{successHandler:function(a,b,c){g.ajaxUpdatePage(a,b,c);R||m.scrollTopTo(x("#existing-balance"))}},{useSif:!0}))}function z(a){a=a.$declarativeParent;var b=x("#gcpromoinput"),c=f.create();c.validateNewGiftPromotion(b,b);c.displayErrors(G.newGCErrors,a);return c.hasErrors()}function C(a){var b=x(a.currentTarget).parents("div.new-payment-line").find(".card-date select");if(b&&b.length){var c=x(a.currentTarget).val();r.when("a-dropdown").execute(function(a){b.each(function(){var b=
x(this).attr("id"),d="",d="G21"===c?"disabled":"enabled";a.updateSelect(b,{status:d})})})}}function w(a){var b=x(a.currentTarget).val(),c=G.newVDC.find(".vdc-form-fields").hide(),d=G.newVDC.find(".vdc-selected-bank-prompt").hide(),e=G.newVDC.find("#vdc-logo-prompt").hide(),f=G.newVDC.find(".top-cell").removeClass("bottom-line");"OtherBanks"===b||"1"===x("#save_citi_card").val()&&"CIT"===b?(f.addClass("bottom-line"),e.show(),c.show()):""!==b&&(a=x(a.currentTarget).find("option:selected").text(),d.show().find(".bank-name-text").html(a))}
function u(a){b.handleCreditCardType(a,ea)}function q(a,b,c){g.ajaxUpdatePage(a,b,c);R||m.scrollTopTo(h.getSelectedPayment())}function v(a){a.$event.preventDefault();var d=a.data.type;b.isWaitingForType(d)?(c.show(),setTimeout(function(){v(a)},50)):V(a.$declarativeParent,d)?c.hide():(ma&&ma.hide(),ja&&ja.hide(),c.show(),x("#cupSecurityCode").is(":visible")&&x("#cupMobileNumber").is(":visible")?(d=a.$declarativeParent.serializeArray(),d=m.processSubmissionParameters(d),m.makeAjaxCall("/gp/buy/payselect/handlers/add-credit-card.html",
d,{successHandler:function(a){a=k.jsonify(a);l(a)}},{useSif:!0})):m.handleForm(a,{successHandler:q},{useSif:!0}))}function l(a){var b={};b.paymentInstrumentId=a.paymentInstrumentId;a.checkStatusCount&&(b.checkStatusCount=a.checkStatusCount);var d={successHandler:function(a){a=k.jsonify(a);var b=f.create();"VERIFIED"===a.cardStatus?m.makeAjaxCall("/gp/buy/payselect/handlers/submit.html",{newPaymentMethodId:a.paymentInstrumentId},{successHandler:q}):"PENDING"===a.cardStatus?(a.checkStatusCount?(a.checkStatusCount=
parseInt(a.checkStatusCount,10),isNaN(a.checkStatusCount)&&(a.checkStatusCount=1)):a.checkStatusCount=3,b.validateRegistrationResult(a),1===a.checkStatusCount?(c.hide(),b.displayErrors(G.newCCErrors)):(--a.checkStatusCount,l(a))):(b.validateRegistrationResult(a),c.hide(),b.displayErrors(G.newCCErrors))}};setTimeout(function(){m.makeAjaxCall("/gp/buy/payselect/handlers/check-credit-card-status.html",b,d)},2500)}function O(a){a.$event.preventDefault();var b=a.$declarativeParent,d=b.find("#loc-name"),
e=b.find("#loc-number"),l=f.create();l.validateLocName(d,d);l.validateLocNumber(e,e);l.displayErrors(b.find("#error-box-new-loc"),b);l.hasErrors()||(oa&&oa.hide(),c.show(),m.handleForm(a,{successHandler:q}))}function K(a){a.$event.preventDefault();var b=a.$declarativeParent,d=b.find("#gcpromoinput");b.find("#gcpromosuccessblock").hide();var e=f.create();e.validateNewGiftPromotion(d,d);e.displayErrors(G.newGCErrors,b);e.hasErrors()||(c.show(),m.handleForm(a,{successHandler:function(a,b,c){g.ajaxUpdatePage(a,
b,c);R?G.newGCErrors.is(":visible")&&x("#gc-link-expander").trigger("click"):m.scrollTopTo(x("#existing-balance"))}}))}function B(a){a.$event.preventDefault();x("#ccAddCard").trigger("submit")}function t(a){a.$event.preventDefault();x("#bank-address-popover-submit").trigger("submit")}function Q(a){a.$event.preventDefault();x("#direct-debit-popover-submit").trigger("submit")}function L(a){a.$event.preventDefault();x("#new-loc-popover-submit").trigger("submit")}function J(a){a.$event.preventDefault();
x("#new-invoice-popover-submit").trigger("submit")}function P(a){a.$event.preventDefault();x("#brdcAddCard").trigger("submit")}function S(a){a.$event.preventDefault();var b=a.$declarativeParent,d=f.create(),e=b.find("#bank-name"),l=b.find("#bank-routing-number"),g=b.find("#bank-account-number"),h=b.find("#bank-account-number-confirm"),k=b.find("#bank-dl"),p=b.find("#bank-dl-state");d.validateBankHolderName(e,e);d.validateBankRoutingNum(l,l);d.validateBankAccountNum(g,g);d.validateBankAccountNumConfirm(g,
h,h);d.validateBankDriverLicense(k,k);d.validateBankDriverLicenseState(p,p.parents("div.a-button-dropdown"));d.displayErrors(b.find("#new-bank-error-box"),b);d.hasErrors()||(X&&X.hide(),c.show(),m.handleForm(a,{successHandler:q}))}function E(a){a.$event.preventDefault();var b=a.$declarativeParent,d=f.create(),e=b.find("#debit-bank-routing-number"),l=b.find("#debit-account-number"),g=b.find("#debit-account-name");d.validateDirectDebitRoutingNum(e,e);d.validateDirectDebitAccountNum(l,l);d.validateDirectDebitAccountName(g,
g);d.displayErrors(b.find("#new-direct-debit-error"),b);d.hasErrors()||(ia&&ia.hide(),c.show(),m.handleForm(a,{successHandler:q}))}function T(a){a.$event.preventDefault();var b=a.$declarativeParent,d=f.create(),e=b.find("#invoice-first-name"),l=b.find("#invoice-last-name");d.validateInvoiceFirstName(e,e);d.validateInvoiceLastName(l,l);d.displayErrors(b.find("#new-invoice-error-box"),b);d.hasErrors()||(la&&la.hide(),c.show(),m.handleForm(a,{successHandler:q}))}function U(a){a=x("#order-summary-total");
var b=x("#order-summary-container");a.prev().addClass("a-first");b.addClass("a-box-group");a.show();m.isTouchCX()&&b.parent().find(".bottom-order-summary").show();G.newCCFormContent.is(":visible")||x("#wrapper-new-cc").find("a.a-link-expander").trigger("click");x("#ecard-help-link").show()}function aa(a){var b="Unknown";m.isDesktopCX()?b="Desktop":m.isMobileCX()?b="Mobile":m.isTouchCX()&&(b="Tablet");n.increaseCount("PayPage-ClientSide-AddCupClick-"+b,1);b=x("#cupForm");if(0<b.length)b.submit();else{var c=
x("\x3cform\x3e\x3c/form\x3e");c.attr({target:"_blank",method:"POST",action:a.data.url});x("#cup-dc").find("input").each(function(){var a=x(this);"hidden"===a.attr("type")&&a.clone().appendTo(c)});x("body").append(c);c.submit();c.remove()}}function da(b){var d=b.$target.closest(".a-popover"),e=d.data("a-popover-id");p.hideById(e);d.hide();x("#a-popover-modal").hide();c.show();m.makeAjaxCall(b.data.url,void 0,{successHandler:function(b){x("#existing-payment-methods").replaceWith(x(b).find("#existing-payment-methods"));
a.trigger("checkout:reload:payselect");c.hide()}})}function Z(a){a.$event.preventDefault();a=a.data;c.show();e.submitNewGilPayment(a.subtype)}function W(){if(!m.isMobileCX()){0===x("#form-add-credit-card").length&&(x("#ccAddCard").parents("div.cc-submit").hide(),x("#ccAddCardWithButton").parents("div.cc-submit").show());x("html").hasClass("a-ie6")&&(x("#cup-mbdc").show(),x(".mbdc-link").attr("data-action","redirect-cup"));G=m.getElements(ha);G.bankNumberConfirm.show();G.newVDC.find(".payment-row").data("hasstatus")||
G.newVDC.find(".vdc-form-fields").hide();G.newCCFormContent.find(".cup-card-field").hide();G.newPayments.find("#cupInfoMessage").hide();G.newPayments.find("#use-ecard-link").show();G.newPayments.find(".mbdc-link").show();G.newPayments.find(".mbdc-button").hide();R=!1;G.newPayments.each(function(){var a=x(this),b=a.data();b&&0===b.hasstatus?(a.find("a.a-link-expander i.js-hide").remove(),a.find("a.a-link-section-expander i.js-hide").remove()):b&&1===b.hasstatus&&!R&&(m.scrollTopTo(a),R=!0)});var b=
G.newVCC.find("#requireCVVOrPincode");b&&b.length&&b.val("1");Y&&(a.declarative("new-cc",["submit"],v),a.declarative("new-brdc",["submit"],v),a.declarative("new-loc",["submit"],O),a.declarative("show-card-image",["change"],u),a.declarative("new-giftcard-promotion",["submit"],K),a.declarative("new-verified-card",["click"],d),a.declarative("new-cc-in-dashboard",["click"],y),a.declarative("new-gc-in-dashboard",["click"],A),a.declarative("add-bank-account",["submit"],S),a.declarative("add-direct-debit",
["submit"],E),a.declarative("add-invoice",["submit"],T),a.declarative("show-order-summary",["click"],U),a.declarative("redirect-cup",["click"],aa),a.declarative("cup-popover-close",["click"],da),a.declarative("add-new-debit-and-cc-popover-submit",["click"],B),a.declarative("add-bank-account-popover-submit",["click"],t),a.declarative("add-loc-account-popover-submit",["click"],L),a.declarative("new-gil-payment",["click"],Z),a.declarative("add-direct-debit-popover-submit",["click"],Q),a.declarative("add-invoice-account-popover-submit",
["click"],J),a.declarative("add-new-br-debit-card-popover-submit",["click"],P),Y=!1);G.cardTypeDropdown.unbind("change",C).bind("change",C);G.vdcBankDropdown.unbind("change",w).bind("change",w);x("div.pay-desktop a.a-link-expander").unbind("keypress");x("div.pay-desktop .a-declarative, div.pay-desktop .a-button").filter("[data-action\x3da-checkout-modal-popover]").unbind("keypress");a.on("a:popover:show:add-new-debit-cc-modal",function(a){ja=a.popover});a.on("a:popover:show:add-new-bank-account-modal",
function(a){X=a.popover});a.on("a:popover:show:add-new-direct-debit-modal",function(a){ia=a.popover});a.on("a:popover:show:add-new-loc-account-modal",function(a){oa=a.popover});a.on("a:popover:show:add-invoice-account-modal",function(a){la=a.popover});a.on("a:popover:show:add-br-debit-card-modal",function(a){ma=a.popover})}}function V(a,b){var c,d,e,l,g,h,k,p,m,q;"vcc"===b?(c="#vccCVVNum",d="#newVCCErrors",e="#vccMonth",l="#vccName",g="#newVerifiedCreditCardNumber",h="#vccType",k="#vccYear",p="#vccPincode",
q=m=void 0):"vdc"===b?(c="#vdcCVVNum",d="#newVDCErrors",e="#vdcMonth",l="#vdcName",g="#newVerifiedDebitCardNumber",h="#vdcType",k="#vdcYear",q=m=p=void 0):"brdc"===b?(d="#newBRDCErrors",e="#brdcMonth",l="#brdcName",g="#addCreditCardNumber_BRDC",k="#brdcYear",q=m=p=h=c=void 0):(m="#cupSecurityCode",q="#cupMobileNumber",c="#ccCVVNum",d="#newCCErrors",e="#ccMonth",l="#ccName",g="#addCreditCardNumber",h="#ccType",k="#ccYear",p=void 0);c=a.find(c);m&&0===c.length&&a.find(m).is(":visible")&&(c=a.find(m));
l=a.find(l);g=a.find(g);q=q?a.find(q):null;e=a.find(e);h=a.find(h);k=a.find(k);var n;p&&a.find(p).is(":visible")&&(n=a.find(p));p=h.val();m=f.create();m.validateCreditCardName(l,l);m.validateCreditCardNumber(g,g);l=e.parent();l=l.hasClass("a-button")?l:l.find(".a-button");g=k.parent();g=g.hasClass("a-button")?g:g.find(".a-button");"G21"!==p&&m.validateCreditCardDate(e,l,k,g);m.validateCreditCardType(h,h.closest(".card-type-field").find(".a-button"));e=p?p.substr(0,1):"";c.length&&"R"!==e&&c.is(":visible")&&
m.validateCreditCardCVV2(c,c,p);q&&q.length&&q.is(":visible")&&m.validateCreditCardMobile(q,q);n&&n.length&&m.validateCreditCardPincode(n,n);m.displayErrors(x(d),a);return m.hasErrors()}function ea(a,c){if(a){if("1"===a.hasErrors){var d=f.create();d.validateGetCreditCardTypeResult(a);if(d.hasErrors()){d.displayErrors(G.newCCErrors);return}}d="vcc"===c?G.newVCC:"vdc"===c?G.newVDC:"brdc"===c?G.newBRDCFormContent:G.newCCFormContent;var e=a.specificFields,l=d.find(".cup-card-field");0!==l.length&&(e&&
1===e.securityCode&&1===e.mobileNumber?(m.isTouchCX()&&d.find("#addCreditCardNumber").closest(".a-input-text-wrapper").removeClass("last-child"),l.show()):l.hide());e=a.specificFields;l=d.find(".amex-field");if(0!==l.length){var g=d.find(".cvv-field");0!==g.length&&(e&&1===e.pincode?(g.hide(),l.show()):(l.hide(),g.show()))}e=d.find(".card-images");e.find("img").hide();a.issuerdisplayimage?e.find("img[data-issuer\x3dATM]").attr("src",a.issuerdisplayimage).show():(l=a.issuer+a.brand,e.find("img[data-issuer\x3d"+
l+"]").show(),d.find(ha.cardTypeDropdown).val(l).trigger("change"));b.setDateSelectorStatus(a,d)}}var x=a.$,Y=!0,R=!1,G={},ha={bankNumberConfirm:"#wrapper-bank-account-number-confirm",btnAddCard:"#ccAddCard",btnAddLoc:"#button-new-loc",btnAddGC:"#button-add-gcpromo",btnAddBank:"#button-add-bank-account",btnAddDirectDebit:"#button-add-direct-debit",btnAddInvoice:"#button-add-invoice",cardImages:"#newCreditCardImages",cardTypeDropdown:".card-type-dropdown select",newCCFormContent:"#new-cc",newBRDCFormContent:"#new-brdc",
newGCErrors:"#gcpromoerrorblock",newGCFormContent:"#gc_entry",newPayments:"div.new-payment-line",newVCC:"#new-verified-credit-cards-table",newVDC:"#new-verified-debit-cards-table",paymentRows:"#existing-payment-methods .payment-row",vdcBankDropdown:"#vdcBanksSelect",cardList:"#existing-credit-cards-box",newCCErrors:"#newCCErrors"},ja,X,oa,ia,la,ma;a.on("checkout:reload:payselect",W);a.on("checkout:reload:spp-payment",W);return{actionShowOrderSummary:U,handleFormHandlerScrollToSelected:q}});r.when("A",
"page-detector","client-side-metrics","ready").execute(function(a,n,k){function m(a,g,p,c){a=f(g).is(":checked");t.P&&t.P.AUI_BUILD_DATE?a?f(p).val(f(p).parent().data("account-name")):f(p).val(""):(k.increaseCount("removeauijs8"),a?(f(c).removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active"),f(p).val(f(p).data("account-name"))):(f(c).removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive"),f(p).val("")));p="undefined"!==typeof t.ue&&"undefined"!==
typeof t.ue.count;c=n.isMobilePayment()?"mobile":"tablet";a=f("#showNameOnCardCheckbox").is(":checked")?"Checked":"Unchecked";p&&t.ue.count(c+"NameOnCardCheckBox"+a,1)}var f=a.$;a.declarative("show-card-name",["click"],function(a){m(a,"#showNameOnCardCheckbox","#ccName","#showNameOnCardIcon")});a.declarative("show-br-debit-card-name",["click"],function(a){m(a,"#showNameOnCardCheckbox_BRDC","#brdcName","#showNameOnCardIcon_BRDC")})});"use strict";r.when("A").register("pay-rewards-currency",function(a){var n=
function(a,f){var k=Math.pow(10,f),c=a.replace(/[^0-9]/g,"");return parseFloat(c)/k},k={CA:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2},DE:{groupingSeparator:".",decimalSeparator:",",decimalPlace:2},GB:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2},JP:{groupingSeparator:",",decimalSeparator:".",decimalPlace:0},US:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2}},m=function(a,f,k,c,b){this.groupingSeparator=a;this.decimalSeparator=f;this.currencyDecimalPlace=
k;this.pointsDecimalPlace=c;this.ratio=b;this.getCurrencyAmount=function(a){return n(a,this.currencyDecimalPlace)};this.getPointsAmount=function(a){return this.getCurrencyAmount(a)/this.ratio};this.format=function(a,b){var c=parseInt(a,10),f=parseFloat(a-c).toFixed(b),f=this.decimalSeparator+f.slice(2),c=c.toString(),g=3<c.length?c.length%3:0,c=(0<g?c.substr(0,g)+this.groupingSeparator:"")+c.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+this.groupingSeparator);return void 0===f||f===this.decimalSeparator?
c:c+f};this.formatCurrency=function(a){return this.format(a,k)};this.formatPoints=function(a){return this.format(a,c)}},f=function(f,g,k,c){this.maxAmount=c;this.rewardsFormatter=k;this.currencyElement=f;this.pointElement=g;var b=this;this.isControlKey=function(a){switch(a.which){case 8:case 46:return!0;case 86:case 88:return a.ctrlKey;default:return!1}};this.isNavigationKey=function(a){switch(a.which){case 9:case 16:case 17:case 35:case 36:case 37:case 39:return!0;case 65:case 67:return a.ctrlKey;
default:return!1}};this.isValidKey=function(a){var b=a.which;return 48<=b&&57>=b||96<=b&&105>=b||8===a.which||46===a.which};this.getCaret=function(){var a=b.currencyElement,c=a.get(0),f=0,g=0;if("number"===typeof c.selectionStart&&"number"===typeof c.selectionEnd)f=c.selectionStart,g=c.selectionEnd;else{var h=document.selection.createRange();if(void 0!==h&&h.parentElement()===c){var a=a.val(),g=a.length,k=c.createTextRange();k.moveToBookmark(h.getBookmark());c=c.createTextRange();c.collapse(!1);-1<
k.compareEndPoints("StartToEnd",c)?f=g:(f=-k.moveStart("character",-g),f+=a.slice(0,f).length-1,-1<k.compareEndPoints("EndToEnd",c)||(g=-k.moveEnd("character",-g),g+=a.slice(0,g).length-1))}}return{start:f,end:g}};this.setCaret=function(a){var c=b.currencyElement.get(0);c.setSelectionRange?c.setSelectionRange(a,a):c.createTextRange&&(c=c.createTextRange(),c.collapse(!0),c.moveStart("character",a),c.moveEnd("character",a),c.select())};this.bind=function(){b.currencyElement.unbind();b.currencyElement.bind("keydown",
function(a){b.isNavigationKey(a)||b.isControlKey(a)||b.isValidKey(a)||a.preventDefault()});b.currencyElement.bind("keyup",function(c){if(!b.isNavigationKey(c)){c=b.getCaret();var d=b.currencyElement.val().length;b.format();var f=b.currencyElement.val().length;c.start===c.end&&(c=Math.min(c.start+(f-d),f),b.setCaret(c));a.trigger("inlineFormatter:formattingCompleted",b)}})};this.unbind=function(){b.currencyElement.unbind("keydown keyup")};this.format=function(a){a=b.currencyElement.val();a=b.rewardsFormatter.getCurrencyAmount(a);
isNaN(a)&&(a=0);a>b.maxAmount&&(a=b.maxAmount);a=b.rewardsFormatter.formatCurrency(a);b.currencyElement.val(a)}};a.on("inlineFormatter:formattingCompleted",function(a){var f=a.pointElement,k=a.currencyElement.val(),k=a.rewardsFormatter.getPointsAmount(k);a=a.rewardsFormatter.formatPoints(Math.round(k));f.html(a)});return{getCurrencyFormatByCountryCode:function(a){(a=k[a])||(a=k["default"]);return a},getAmount:n,initializeInlineFormatting:function(h,g,k){var c=h.maxAmount;k=new m(k.groupingSeparator,
k.decimalSeparator,k.decimalPlace,g.decimalPlace,g.ratio);h=new f(h.$element,g.$element,k,c);h.bind();h.format(0);a.trigger("inlineFormatter:formattingCompleted",h)}}});"use strict";r.when("A","pay-common-util","pay-validator","page-conductor").register("jppoints",function(a,n,k,m){function f(){!n.isMobileCX()&&u("#jppoints").length&&(q=n.getElements(v),b())}function h(){var a=q.paymentRows.find('input[type\x3d"radio"][name\x3d"paymentMethod"]');a.closest("div.payment-selected").removeClass("payment-selected");
a.attr("checked",!1);n.isTouchCX()&&g(a,"radio")}function g(a,b){a.siblings("i").removeClass("a-icon-touch-"+b+"-active").addClass("a-icon-touch-"+b+"-inactive")}function p(a,b){a.is(":disabled")||a.siblings("i").removeClass("a-icon-touch-"+b+"-inactive").addClass("a-icon-touch-"+b+"-active")}function c(){return u('input[type\x3d"radio"][name\x3d"paymentMethod"][value\x3d"availablebalance"]').is(":checked")}function b(){if(q.jppoints&&q.jppoints.length){c()&&e();q.jppoints.show();var a=q.jppoints.find("#redeemPoints");
n.isTouchCX()?a.parents("label").bind("click",A):a.bind("click",A);q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').bind("click",function(){var a=q.jppoints.find("#jpPointsCustom");a.attr("checked",!0);var b=q.jppoints.find("#redeemPoints");b.attr("checked",!0);n.isTouchCX()&&(p(a,"radio"),g(q.jppoints.find("#jpPointsMax"),"radio"),p(b,"checkbox"))});q.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]').bind("click",d);q.jppoints.find("#jpPointsCustom").bind("click",function(){q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').focus()});
q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').bind("keyup",w)}}function e(){var a=q.jppoints.find("#redeemPoints"),b=q.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),c=q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),d=q.jppoints.find("#redeemableAmount"),e=q.jppoints.find("#redeemableValue");a.attr("checked",!1);a.attr("disabled",!0);b.attr("checked",!1);b.attr("disabled",!0);q.jppoints.find("#jpPointsError").hide();c.val("");
c.removeClass("a-form-error");c.attr("disabled",!0);e.text(q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]').val());d.text(q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]').val());m.isSPP()&&(q.jppoints.find("label").addClass("disabled-color"),q.jppoints.removeClass("payment-selected"));n.isTouchCX()&&(g(a,"checkbox"),g(b,"radio"),a.siblings("i").addClass("a-button-disabled"),b.siblings("i").addClass("a-button-disabled"))}function d(a){a=a.currentTarget;
var b=q.jppoints.find("#redeemPoints");b.attr("checked",!0);if(n.isTouchCX()){p(u("#"+a.id),"radio");var c;c="jpPointsMax"===a.id?q.jppoints.find("#jpPointsCustom"):q.jppoints.find("#jpPointsMax");g(c,"radio");p(b,"checkbox")}"true"===a.value&&(q.jppoints.find("#jpPointsError").hide(),a=q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),a.removeClass("a-form-error"),a.val(""),b=q.jppoints.find("#redeemableAmount"),c=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),
10),a=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),b=parseInt(b.text(),10)*c,u('input[name\x3d"useAvailableBalance"]').is(":checked")&&(c=q.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]'),a-=parseInt(c.val(),10)),b>=a&&h())}function y(a){var b=q.jppoints.find("#redeemableAmount"),c=q.jppoints.find("#redeemableValue"),d=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),e;a.is(":checked")?
(a=q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]').val(),e=q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]').val(),d-=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]').val(),10)):(a=q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val(),e=q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]').val());var f=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),
10)*a;b.text(a);c.text(e);0>=parseInt(a,10)?(b=q.jppoints.find("#redeemPoints"),b.attr("checked",!1),c=q.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),c.attr("checked",!1),n.isTouchCX()&&(g(b,"checkbox"),g(c,"radio"))):q.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"][value\x3d"true"]').is(":checked")?f>=d&&h():w()}function A(){var a=q.jppoints.find("#redeemPoints");a.is(":disabled")||(a=a.is(":checked"),n.isTouchCX()?a?(g(q.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]'),
"radio"),C()):(p(q.jppoints.find("#jpPointsMax"),"radio"),g(q.jppoints.find("#jpPointsCustom"),"radio"),z()):a?(z(),m.isSPP()&&q.jppoints.addClass("payment-selected")):(C(),m.isSPP()&&(q.jppoints.removeClass("payment-selected"),c()||n.selectDefaultPaymentMethodIfNotSelected())))}function z(){var a=q.jppoints.find("#jpPointsMax");a.attr("checked",!0);var b=parseInt(q.jppoints.find("#redeemableAmount").text(),10),c=q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val(),
d=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10);n.isTouchCX()&&(g(q.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]'),"radio"),p(a,"radio"));q.jppoints.find("#jpPointsMax").is(":checked")&&(b>=d?h():m.isSPP()&&q.paymentRows.find("#gcPromo, input[name\x3d'useAvailableBalance']").is(":checked")&&(a=q.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]'),d-=parseInt(a.val(),10),c>=d&&h()))}function C(){var a=q.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]');
a.attr("checked",!1);var b=q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]');b.val("");b.removeClass("a-form-error");q.jppoints.find("#jpPointsError").hide();n.isTouchCX()&&g(a,"radio")}function w(){var a=q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),b=parseInt(a.val(),10);!b||0>b?(a.val(""),q.jppoints.find("#jpPointsError").hide(),q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').removeClass("a-form-error")):(a.val(b),parseInt(q.jppoints.find("#redeemableAmount").text(),
10)<b?(q.jppoints.find("#jpPointsError").show(),q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').addClass("a-form-error")):(q.jppoints.find("#jpPointsError").hide(),q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').removeClass("a-form-error"),a=parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),parseInt(q.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),10),b>=a&&h()))}var u=a.$,q=
{},v={paymentRows:"#existing-payment-methods .payment-row",jppoints:"#jppoints"};a.on("checkout:reload:payselect",f);a.on("checkout:reload:spp-payment",f);return{handleJPPointsOnPaymentRows:function(a){a=u(a.currentTarget);if("jppoints"!==a.attr("id"))if("useAvailableBalance"===a.attr("name"))y(a);else if("availablebalance"===a.attr("value")||a.find("#pm_300")&&"availablebalance"===a.find("#pm_300").attr("value"))e();else{a=q.jppoints.find("#redeemPoints");var b=q.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),
c=q.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),d=q.jppoints.find("#redeemableAmount"),f=q.jppoints.find("#redeemableValue");m.isSPP()&&q.jppoints.find("label").removeClass("disabled-color");a.attr("disabled",!1);b.attr("disabled",!1);c.attr("disabled",!1);u('#existing-balance input[type\x3d"radio"][value\x3d"availablebalance"]').length&&(d.text(q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val()),f.text(q.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]').val()));
n.isTouchCX()&&(a.siblings("i").removeClass("a-button-disabled"),b.siblings("i").removeClass("a-button-disabled"))}},handleJPPointsWithGC:y}});"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator","page-transition-controller","page-conductor","a-popover-position","inline-points-register-controller","jppoints","pay-credit-card","checkout-general-utils","a-popover-base","a-dropdown","pay-rewards-currency","cache-page-data-controller","pay-credit-card-reregistration").register("existing-payments",
function(a,n,k,m,f,h,g,p,c,b,e,d,y,A,z,C){function w(){return D.paymentRows.filter(function(){return I(this).hasClass("payment-selected")||I(this).find("#redeemPoints").is(":checked")})}function u(a){f.show();a.$event.preventDefault();var b=w().find(".card-unreg-rewards").data();b.recommendedPaymentMethodId=b.paymentinstrumentid;k.makeAjaxCall(a.$target.attr("href"),b)}function q(a){a=I(a.currentTarget);var b=a.data();if(!(0>=b.ratio)){var c=a.val()/b.ratio;isNaN(c)||(a.val()<b.min&&(c=0),a=k.getNumberWithSeparators(c,
b.decimalplaces),w().find(".custom-reward-points").html(a))}}function v(a){1===a.data.refresh&&(f.show(),k.makeAjaxCall(a.data.url))}function l(a){Ba(a)?(a=D.continueBtns,a.find(".a-button-primary:not(.a-button-disabled)").addClass("aok-hidden"),a.find(".a-button-disabled").removeClass("aok-hidden")):I("#payPageContinueBtnStateFixEnabled").length&&L(a)}function O(a){k.isTouchCX()&&(Ba()?a.$event.preventDefault():(D.continueErrPopover.hide().find(".error-message").hide(),f.show()))}function K(a){k.isTouchCX()&&
(Ba()||D.continueErrPopover.hide().find(".error-message").hide())}function B(a){a=I(a.currentTarget);a.click();a=a.closest(".payment-container");a.find("#cc-errors").is(":visible")?a.find(".tv-update .a-button-primary").focus():a.click()}function F(a){a.$event.preventDefault();var c=w();if(!b.runConfirmCardValidator(c,c.find("#cc-errors"))){f.show();var d=(c=k.getInputValues(c))||{},e=k.getInputValues(D.hiddenFormFields),l;for(l in e)e.hasOwnProperty(l)&&(d[l]=e[l]);b.confirmCreditCard(c,oa,a.data.url)}}
function Q(){D.continueErrPopover.filter(":visible").length&&D.continueErrPopover.hide()}function L(){D.continueErrPopover.filter(":visible").length&&D.continueErrPopover.hide().find(".error-message").hide();var a=w();D.disableSubmitButtons.length?a.find(".no-address").length||(a.find(".continue-center").removeClass("aok-hidden"),a.find(".a-button-disabled").addClass("aok-hidden")):(D.continueBtns.find(".a-button-primary:not(.a-button-disabled)").removeClass("aok-hidden"),D.continueBtns.find(".a-button-disabled").addClass("aok-hidden"));
if(a){var b=a.find(".a-form-error");b&&b.length&&(b.removeClass("a-form-error"),(a=a.find(".pincode-err-block").filter(":visible"))&&a.length&&(D.continueErrPopover.hide().find(".error-message").hide(),D.continueBtns.find(".a-button-primary").removeClass("aok-hidden"),D.continueBtns.find(".a-button-disabled").addClass("aok-hidden"),a.hide()))}}function J(){D.continueErrPopover.filter(":visible").length||D.continueBtnTop.trigger("click")}function P(a){if(13===a.which){var b=I(document.activeElement),
c=b.closest("div.payment-row"),d=b.closest(".a-button"),b=b.get(0).tagName;if(c.length&&!d.length&&"A"!==b&&"a"!==b)return c=c.find('input[type\x3d"submit"]'),c.length?c.trigger("click"):(D.continueErrPopover.filter(":visible").length&&D.continueErrPopover.hide(),Ba(a)?(k.isTouchCX()||(D.continueBtns.find(".a-button-primary").addClass("aok-hidden"),D.continueBtns.find(".a-button-disabled").removeClass("aok-hidden")),a.preventDefault()):D.continueBtnTop.trigger("click")),!1}}function S(a){f.show();
var b=w(),c=b.find("input[type\x3dradio][name\x3dpaymentMethod]").val(),d=b.find(".card-unreg-rewards").data(),b=k.isTouchCX()?b.find(".flag-register-rewards"):D.rewardsRegister,b=k.getInputValues(b);b.programid=d.programid;b.paymentinstrumentid=d.paymentinstrumentid;b.CARD_EXPIRATION_DATE=d.expiredate;b.CARD_HOLDER_NAME=d.holdername;b.returnRefreshedPage=a.data.returnRefreshedPage;b.rewardsdateofbirthmonth&&b.rewardsdateofbirthday&&(b.DATE_OF_BIRTH=b.rewardsdateofbirthmonth+b.rewardsdateofbirthday);
-1===a.data.url.toLowerCase().indexOf("cachebuster")&&(a.data.url=e.addQueryStringParameter(a.data.url,"cacheBuster",(new Date).getTime()));k.makeAjaxCall(a.data.url,b,{successHandler:function(a,b,d){f.hide();if(a){a=n.jsonify(a);D.rewardsRegister.find(".register-content").hide();var e=k.isTouchCX()?w().find(".register-error"):D.rewardsRegister.find(".register-error");e.hide();a.error?e.show().find(".error-message").hide().filter("#"+a.error).show():(h.ajaxUpdatePage(a.refreshedPage,b,d),b=D.paymentRows.find('input[type\x3dradio][name\x3dpaymentMethod][value\x3d"'+
c+'"]').closest(".payment-row"),b.trigger("click"),k.scrollTopTo(b))}}})}function E(a){a=I(a.currentTarget).parents("div.currency-list");var b=a.find("label.a-touch-radio");b.length?b.trigger("click"):a.find("input[type\x3dradio][value\x3dOther]").trigger("click")}function T(a){a=a.$target.closest("div.payment-row");var b=a.find(".currency-list");if(h.isSPP()){var c=y.getSelect(b.find("select"));null!==c&&c.setValue("")}a.find(".change-currency").hide();b.show();k.isTouchCX()&&(a.find(".top-cell").removeClass("bottom-line").addClass("bottom-line"),
a.find(".bottom-cell").show());ia();ya()}function U(a){a=a.$target.closest("div.payment-row");a.find(".expire-info, .expire-date").hide();a.find(".enter-date, .expire-date-fields").show();ia();la()}function aa(a){var b=a.$target.closest("div.payment-row"),c="true"===k.getAttributeData(b,"isaddresschallenge")?1:0;b.find(".expire-date-fields").length?(U(a),b.find("#newExpDate").focus()):c&&b.find("#addCreditCardNumber").focus()}function da(a){setTimeout(function(a){var b=I(a.target);a=document.createEvent("UIEvents");
a.initUIEvent("DOMActivate",!0,!0,t,1);b.get(0).dispatchEvent(a)},0,a)}function Z(a){var b=I(a.target).closest("div.payment-row");""!==I(a.target).val()&&("true"===k.getAttributeData(b,"isaddresschallenge")?b.find("#addCreditCardNumber").focus():J())}function W(){var a=w();a.find("div.flag-register-rewards").is(":visible")?(a.find(".bottom-cell").hide(),a.find(".top-cell").removeClass("bottom-line"),a.find(".card-unreg-rewards").show()):(a.find(".card-unreg-rewards").hide(),a.find(".bottom-cell").show(),
a.find(".top-cell").removeClass("bottom-line").addClass("bottom-line"))}function V(){W()}function ea(a){a.$event.preventDefault();if("1"===w().find("div.flag-register-rewards").attr("cached"))W();else{var b=a.$target.attr("href");-1===b.toLowerCase().indexOf("cachebuster")&&(b=e.addQueryStringParameter(b,"cacheBuster",(new Date).getTime()));f.show();k.makeAjaxCall(b,a.data,{successHandler:function(a){f.hide();var b=n.jsonify(a);a=k.decodeJSONResponse(b.widgetHTML);var c=w();c.find("div.flag-register-rewards").html(a);
c.find("div.flag-register-rewards").attr("cached",1);c.find("div.flag-register-rewards .error-message").each(function(){var a=I(this),c=a.data("errorid");a.html(b.displaydata[c])});W()}})}}function x(a){var b=I(a.target);if(!b.is(":visible"))return a.preventDefault(),a.stopPropagation(),!1;h.isSPP()&&(h.isPrefetchFromAddressEnabled()?h.disablePageNoUpdateTransition():I("#payment").find(".panel-cancel-row").hide(),z.clearCache());var d=I(a.currentTarget);D.jppoints.length&&c.handleJPPointsOnPaymentRows(a);
var e=d.find("[name\x3duseAvailableBalance]");if("useAvailableBalance"!==a.target.name&&!e.length)if(R(d),Y(d),d.hasClass("payment-selected")||d.hasClass("payment-label"))D.disableSubmitButtons.length&&(ha(d,d,!1),!b.hasClass("continue-center")&&d.find(".continue-center").length||J());else if(a=d.find('input[type\x3d"radio"][name\x3d"paymentMethod"]'),a.length&&"disabled"!==a.attr("disabled")){Sa();a=w();h.isSPP()?a.filter(function(){var a=I(this).attr("id");return"gcPromo"===a?(a=I(this).find('input[type\x3d"radio"][name\x3d"paymentMethod"][value\x3d"availablebalance"]'))&&
a.length:"jppoints"!==a}).removeClass("payment-selected"):a.removeClass("payment-selected");a.find("[name\x3dpaymentMethod]").attr("checked",!1);a.find("i[data-a-input-name\x3dpaymentMethod]").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");a.find(".top-cell").removeClass("bottom-line");ma(a);k.isTouchCX()&&(a.find(".bottom-cell").hide(),a.find(".card-unreg-rewards").show());d.addClass("payment-selected");d.find("[name\x3dpaymentMethod]").attr("checked",!0);d.find("i[data-a-input-name\x3dpaymentMethod]").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active");
var b="true"===k.getAttributeData(d,"isaddresschallenge")?1:0,e=d.find('.rewards-list input[type\x3d"radio"]').length,f="1"===k.getAttributeData(d,"hasDerivedCurrency")?1:0,l=d.find(".vcc-form-fields").length,g=d.find(".card-ref-num").length;k.isTouchCX()&&(b||e||l||g||f)&&(d.find(".top-cell").removeClass("align-top bottom-line").addClass("bottom-line"),d.find(".bottom-cell").show());Ga(d);Ha(d);Ia(d);Ja(d);Ta(d);Ka(d);La(d);Ma(d);Ua(d);Na(d);Oa(d);qa();ja(d);Aa();ia();la();K();na();X(d,a);D.hideInputBoxes.length&&
(Pa(d,a),Qa(d));D.disableSubmitButtons.length&&ha(d,a,!0);xa();ya();D.disableSubmitButtons.length&&!d.find(".continue-center").length&&J()}}function Y(a){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=I("input[type\x3d'hidden'][name\x3d'paySelectLocale']");b.length&&"IN"===b.val()&&a.length&&r.when("client-side-metrics").execute(function(a){a.increaseCount("PayPage-COD-NonMobile",1)})}function R(a){var b=I("#isGlobalCODEligible").val();if(b&&"0"!==b){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');
var b=I("#button-add-gcpromo"),c=I("#button-add-gcpromo").parent().parent();a.length?(c.addClass("a-button-disabled"),b.attr("disabled","disabled")):(c.removeClass("a-button-disabled"),b.removeAttr("disabled"))}}function G(a){r.when("A","a-tv").execute(function(b,c){var d=b.$,e=d(a);e.length&&(d(".tv-lastSelected").removeClass("tv-lastSelected"),e.addClass("tv-lastSelected"),c.select(e))})}function ha(a,b,c){c&&b.find(".billing-address, .cc-continue-button").hide();if(a.find(".tv-update").length)Pa(a,
b),Qa(a);else{var d=a.find(".billing-address, .cc-continue-button");if(d.length&&!d.is(":visible")){var e=!1;a.find(".no-address").length&&(e=!0,a.find(".a-button-primary").addClass("aok-hidden"),a.find(".a-button-disabled").removeClass("aok-hidden"));r.when("a-tv").execute(function(f){c&&(b.find(".payment-container").hasClass(".a-tv-navigate")||f.add(b.find(".payment-container")));f.remove(a.find(".payment-container"));f=e?a.find(".billing-address-link"):d.find(".continue-center");G(f)});d.show()}}}
function ja(a){var b=I("#one-click-final-review-message");b.length&&(a.find("#canTryTFX").length?b.removeClass("aok-hidden"):b.addClass("aok-hidden"))}function X(a,b){if(k.isTouchCX()&&(b&&b.find(".top-cell .data-row").children(".a-column").height("auto"),a)){var c=a.find(".top-cell .data-row"),d=c.find(".addr-challenge-card-scan .a-box");if(d.length){var e=c.height(),d=d.height(),f=c.children(".a-column:first");c.children(".a-column").height(d);f.height(e);f.children(".vertical-center-grid:first").height(d)}else c.children(".a-column").height(c.height())}}
function oa(c){f.hide();c=n.jsonify(c);c.imbWidgetHTML&&I("#imb-wrapper").html(k.decodeJSONResponse(c.imbWidgetHTML));if(c.cardWidgetHTML){var d=w();d.replaceWith(k.decodeJSONResponse(c.cardWidgetHTML));a.trigger("checkout:reload");a.trigger("checkout:reload:payselect");d=w();if("true"!==k.getAttributeData(d,"isaddresschallenge")){b.setCardPasswordInputStatus(d,c.newpaymentmethodid,"cvv","#existingCvvNum");b.setCardPasswordInputStatus(d,c.newpaymentmethodid,"pincode","#existingPincodeNum");if(D.cvvColumnLabel.length){var e=
!1;D.paymentRows.each(function(){if("true"===k.getAttributeData(I(this),"isaddresschallenge"))return e=!0,!1});e||D.cvvColumnLabel.hide()}D.disableSubmitButtons.length&&J()}}}function ia(){D.paymentRows.each(function(){var a=I(this),b=a.find('.currency-list input[type\x3d"radio"]').length,c=a.find('.rewards-list input[type\x3d"radio"]').length,d=a.find(".card-reg-info").is(":visible"),e=a.find(".expire-date-fields").is(":visible"),f=a.find("a[data-action\x3dshow-expire-date-fields]").is(":visible"),
l=a.find(".bottom-cell .inner-grid-left"),g=a.find(".bottom-cell .inner-grid-right");e?b||c||d?(l.removeClass("hidden a-span10 a-span12").addClass("a-span8"),g.removeClass("a-span12 a-span2 hidden").addClass("a-span4")):(l.removeClass("a-span8 a-span10 a-span12").addClass("hidden"),g.removeClass("a-span4 a-span2 hidden").addClass("a-span12")):f?(l.removeClass("a-span12 a-span8 hidden").addClass("a-span10"),g.removeClass("hidden a-span4 a-span12").addClass("a-span2")):(l.removeClass("a-span10 a-span8 hidden").addClass("a-span12"),
g.removeClass("a-span2 a-span4 a-span12").addClass("hidden"));!k.isTouchCX()&&f&&(b||c||d)&&a.find(".bottom-cell").removeClass("align-top").addClass("align-top")});var a=w(),b=a.find("a[data-action\x3dshow-expire-date-fields]").filter(":visible").length,c=a.find(".top-cell.bottom-line").length;b&&!c||a.find(".bottom-cell").removeClass("align-top")}function la(){k.isTouchCX()&&D.paymentRows.each(function(){var a=I(this),b="true"===k.getAttributeData(a,"isaddresschallenge")?1:0,c=a.find("a[data-action\x3dshow-expire-date-fields]").is(":visible"),
d=a.find(".expire-date-fields").is(":visible"),e=a.find(".card-reg-info").is(":visible"),f=a.find(".rewards-info").is(":visible"),l=a.find(".change-currency").is(":visible");c?a.find(".top-cell .second-row").addClass("align-top"):a.find(".top-cell .second-row").removeClass("align-top");b=b||l||e||f;e=d||c;f=a.find(".top-cell .inner-grid-left");a=a.find(".top-cell .inner-grid-right");b||(f.removeClass("a-span6 a-span8 a-span12").addClass("hidden"),a.removeClass("a-span4 a-span6 hidden").addClass("a-span12"));
e||(f.removeClass("a-span6 a-span8 hidden").addClass("a-span12"),a.removeClass("a-span4 a-span6 a-span12").addClass("hidden"));b&&c&&(f.removeClass("a-span6 a-span12 hidden").addClass("a-span8"),a.removeClass("a-span6 a-span12 hidden").addClass("a-span4"));b&&d&&(f.removeClass("a-span6 a-span8 hidden").addClass("a-span6"),a.removeClass("a-span4 a-span12 hidden").addClass("a-span6"))})}function ma(a){var b=a.find(".currency-list");if(b.length){var c=b.find("[type\x3dradio]:checked").val(),b=b.find("#cardCurrencyDropDown option:selected").val();
"Other"!==c||"-1"!==b&&"-2"!==b||a.find(".currency-list input[type\x3dradio][value!\x3dOther]").attr("checked",!0)}}function ua(a){var b=I(a.currentTarget);a=b.find("option:selected");if(""===a.val())b.parents("div.selected-section").find(".selected-note-content").hide();else{var c=a.prop("disabled"),b=b.parents("div.selected-section"),d=b.find("#active-bank-content"),e=b.find("#disable-bank-content");c?(e.show(),d.hide()):(d.show(),e.hide());b.find("span.selected-note-bank").text(a.text()).show()}}
function za(a){var b=I(a.currentTarget);a=b.find("option:selected");""===a.val()?b.parents("div.selected-section-more-payment-method").find(".selected-more-payment-content").hide():(b=b.parents("div.selected-section-more-payment-method"),b.find("span.selected-payment-option").text(a.text()).show(),b.find("span.selected-more-payment-content").show())}function sa(a){(D.continueErrPopover.filter(":visible").length||Ba())&&a.$event.preventDefault()}function ba(b){b=I(b.currentTarget);var c=b.find("input[type\x3dcheckbox]");
c.attr("checked")?(c.attr("checked",!1),b.find(".checked-checkbox").addClass("aok-hidden"),b.find(".empty-checkbox").removeClass("aok-hidden"),b.find(".gc-balance-insufficient-msg").addClass("aok-hidden")):(c.attr("checked",!0),b.find(".checked-checkbox").removeClass("aok-hidden"),b.find(".empty-checkbox").addClass("aok-hidden"),b.find(".gc-balance-insufficient-msg").removeClass("aok-hidden"));r.when("a-tv").execute(function(b){setTimeout(function(){b.select(".tv-lastSelected")},500);a.trigger("a:tv:resize")})}
function H(a){a=I(a.currentTarget);"1"===a.attr("isclicked")?a.attr("isclicked",0):a.attr("isclicked",1);na()}function na(a){var b=I("#pm_promo");a=I("#pm_gc_radio");var c=I("#pm_gc_checkbox");if(a&&a.length||c&&c.length){var d=I("input[name\x3dgcBalanceRaw]").val();I("input[name\x3damBalanceRaw]").length&&(d=I("input[name\x3damBalanceRaw]").val());var e=I("input[name\x3dremainingBalanceRaw]").val(),f=I("input[name\x3dpurchaseTotalRaw]").val(),l,g,h=I(".purchase-total").length;h?(g=I(".purchase-total").html(),
l=I(".remaining-balance").html()):(g=I("input[name\x3dpurchaseTotal]").val(),l=I("input[name\x3dremainingBalance]").val());var p=I(".balance-applied");h?p.html(g):p.text(g);g=!1;(g=k.isTouchCX()&&"checkbox"===b.attr("type")?"1"===b.closest(".a-control-row").attr("isclicked"):b.is(":checked"))?(b=e,0<b&&(h?p.html(l):p.text(l))):b=f;l=a.closest(".radio-col");e=c.closest(".radio-col");h=I(".long");p=I(".short");0<=d-f?("disabled"===a.attr("disabled")&&a.removeAttr("disabled"),l.removeClass("hidden"),
a.is(":checked")&&l.trigger("click"),e.addClass("hidden"),c.attr("disabled","disabled"),h.show(),p.hide()):0<d-b?0>=b?(e.removeClass("hidden"),c.attr("disabled","disabled"),k.isTouchCX()&&e.find("i").addClass("a-button-disabled checkbox-disabled"),l.addClass("hidden"),a.attr("disabled","disabled"),p.show(),h.hide()):("disabled"===a.attr("disabled")&&a.removeAttr("disabled"),l.removeClass("hidden"),a.is(":checked")?l.trigger("click"):k.isTouchCX()&&l.find("i").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"),
e.addClass("hidden"),c.attr("disabled","disabled"),h.show(),p.hide()):("disabled"===c.attr("disabled")&&(c.removeAttr("disabled"),k.isTouchCX()&&e.find("i").removeClass("a-button-disabled checkbox-disabled")),e.removeClass("hidden"),(c=e.closest(".payment-row"))&&c.hasClass("payment-selected")&&c.removeClass("payment-selected"),l.addClass("hidden"),a.attr("disabled","disabled"),p.show(),h.hide())}}function ra(a){var b=w().find(".enter-custom-rewards");"rewardscustom"===I(a.currentTarget).children('input[type\x3d"radio"]').val()?
(b.show(),b=b.find("input.custom-rewards-input"),b.focus(),D.paymentRows.find(".rewards-list").hasClass("show-currency-input-widget-new")&&(a=b.val().length,b=b.get(0),b.setSelectionRange?b.setSelectionRange(a,a):b.createTextRange&&(b=b.createTextRange(),b.collapse(!0),b.moveStart("character",a),b.moveEnd("character",a),b.select()))):b.hide();ya()}function N(a){a=a.$target||I(a.currentTarget);ka(a)}function ka(a){if(a.length){var b=D.paymentRows.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]'),
c=D.paymentRows.find(".installments-select.a-row"),d=c.siblings(".installments-message"),e=D.paymentRows.find('input[type\x3d"radio"][value\x3d"morePaymentMethod"]');if(b.length){var f=b.closest(".payment-row"),l=e.closest(".payment-row");a.is(":checked")?(b.prop("disabled",!0),b.is(":checked")&&(b.prop("checked",!1),f.removeClass("payment-selected")),b.parent().siblings().addClass("a-color-secondary"),fa(e,l),(a=c.find("select"))&&a.each(function(){var a=this.id.replace(/\./g,"\\.");y.setValue(a,
"")}),c.find(".installments-enabled-text").hide(),d.find(".installments-enabled-text").hide(),c.find(".installments-disabled-text").show(),d.find(".installments-disabled-text").show()):(f.find(".payment-invalid").length||(b.prop("disabled",!1),b.parent().siblings().removeClass("a-color-secondary")),l.find(".payment-invalid").length||Ca(e,l),c.find(".installments-disabled-text").hide(),d.find(".installments-disabled-text").hide(),c.find(".installments-enabled-text").show(),d.find(".installments-enabled-text").show())}}}
function Ca(a,b){a.prop("disabled",!1);a.parent().siblings().removeClass("a-color-secondary");b.find(".selected-section-more-payment-method").show();b.find(".more-payment-gc-disabled-text").hide()}function fa(a,b){a.prop("disabled",!0);a.is(":checked")&&(a.prop("checked",!1),b.removeClass("payment-selected"));a.parent().siblings().addClass("a-color-secondary");b.find(".selected-section-more-payment-method").hide();b.find(".more-payment-gc-disabled-text").show()}function ta(a){var b=a.$target||I(a.currentTarget);
a=b.closest(".currency-list");b=b.val();!0===(k.isTouchCX()?"Other"===b:"Other"!==b)?(a.find("select").attr("disabled",!0),a.find(".a-button.a-button-dropdown").addClass("a-button-disabled"),a.find(".a-button.a-touch-select").addClass("a-button-disabled")):(a.find("select").attr("disabled",!1),a.find(".a-button.a-button-dropdown").removeClass("a-button-disabled"),a.find(".a-button.a-touch-select").removeClass("a-button-disabled"));ya()}function ca(a){C.actionReregisterCardInBox(a);k.scrollTopTo(w())}
function ga(a){ya()}function va(){D.paymentRows.each(function(){var a=I(this),b=".card-ref-num, .addr-challenge, .addr-challenge-msg, .cup-expired-msg, .enter-date, .expire-date-fields, .rewards-static-help-link, .verified-fail-msg, .tv-update, .billing-address, .cc-continue-button",c=".card-info, .card-name, .card-reg-info, .expire-info, .rewards-err-msg, .rewards-list label, .rewards-list div.a-radio, .rewards-dynamic-help-link, .financial-offer-err-detail";a.hasClass("payment-selected")&&("1"===
k.getAttributeData(a,"hasDerivedCurrency")||"1"===k.getAttributeData(a,"hasPreferredCurrency")&&"1"===k.getAttributeData(a,"isNewCard"))||(b+=", .currency-list");"1"===k.getAttributeData(a,"hasPreferredCurrency")&&"1"!==k.getAttributeData(a,"isNewCard")&&(c+=", .change-currency");a.find(b).hide();a.find(c).show()})}function Aa(){D.paymentRows.each(function(){var a=I(this),b="#cc-errors, .enter-date, .expire-date-fields",c=".expire-info";if(a.hasClass("payment-selected")&&"1"===k.getAttributeData(a,
"hasDerivedCurrency"))b+=", .change-currency",c+=", .currency-list";else{var d=a.find(".currency-list"),e=d.find("[type\x3dradio]:checked").val();if(e){var f;if("Other"!==e)f=d.find(".currencyNameLabel").html();else{var e=d.find("#cardCurrencyDropDown option:selected"),l=e.val();"-1"!==l&&"-2"!==l&&(f=e.text())}f&&(c+=", .change-currency",d.closest("div.payment-row").find(".change-currency .currencyNameLabel").html(f))}b+=", .currency-list"}a.find(b).hide();a.find(c).show()})}function pa(){var a=
I("#aan-ads-box");if(a.length){var b=a.data("adsendpoint"),c=a.data("adsclient"),d="https://"+b+"/2009-09-09/ad/",b="/jsc?pt\x3dstatic\x26slot\x3dlib\x26pt2\x3daanjs";a.data("useaannojq")&&(b+="-nojq");I.getScript(d+c+b,function(){t.d16g&&t.d16g.requestAanAd({elemId:"aan-ads-box",baseUrl:d,afterOnload:!0,client:c,pt:"checkout",slot:"display-ad-right",pt2:"payselect"})})}}function wa(){Ra&&(a.declarative("auto-rewards-reg",["click"],u),a.declarative("complete-rewards-register",["click"],v),a.declarative("confirm-card",
["click"],F),a.declarative("register-card-rewards",["click"],S),a.declarative("cancel-register-card-rewards",["click"],V),a.declarative("show-currencies",["click"],T),a.declarative("show-expire-date-fields",["click"],U),a.declarative("focus-cc-update-fields",["click"],aa),a.declarative("show-rewards-reg",["click"],ea),a.declarative("submit-payment-form",["submit"],sa),a.declarative("toggle-tfx-option",["click"],ta),a.declarative("reregister-cc-in-dashboard",["click"],ca),a.declarative("modify-expire-date-fields",
["change"],ga),k.isTouchCX()&&a.declarative("continue-button",["click"],O),Ra=!1);D.paymentRows.unbind("click").has("input[name\x3dpaymentMethod]:enabled").bind("click",x);D.paymentRows.find("input[name\x3dusePromoBalance]").unbind("change",na).bind("change",na);D.disableSubmitButtons.length&&D.paymentRows.has("input[type\x3dcheckbox]:enabled").unbind("click",ba).bind("click",ba);D.existingPincodeNum.unbind("click",M).bind("click",M);D.paymentRows.find("select#cardCurrencyDropDown").unbind("change",
E).bind("change",E);D.paymentRows.find(".rewards-list").hasClass("show-currency-input-widget-new")?D.paymentRows.find(".rewards-list").undelegate("label","click").delegate("label","click",ra).each(function(b,c){var d=a.$(c),e=d.find("input.custom-rewards-input"),d=d.find(".custom-reward-points"),f=a.$(e),e={$element:f,maxAmount:f.data("max")},d={$element:a.$(d),decimalPlaces:f.data("decimalplaces"),ratio:f.data("ratio")},f=f.data("country-code"),f=A.getCurrencyFormatByCountryCode(f);A.initializeInlineFormatting(e,
d,f)}):D.paymentRows.find(".rewards-list").undelegate("label","click").delegate("label","click",ra).undelegate("input.custom-rewards-input","keyup").delegate("input.custom-rewards-input","keyup",q);if(k.isTouchCX())D.pageContainer.find("#existing-payment-methods").find("select, input[type\x3dtext], input[type\x3dpassword]").unbind("change",K).bind("change",K),D.pageContainer.find("#existing-payment-methods").find("div.currency-list label.a-touch-radio").unbind("click").bind("click",ta),D.pageContainer.find("#existing-payment-methods").find("label.promoLabel").unbind("click").bind("click",
H);else if(!h.isSPP()){var b=D.continueBtns.find(".a-button-text");I("#payPageContinueBtnStateFixEnabled").length?b.filter('input[type\x3d"button"]').unbind("mouseenter",Da).bind("mouseenter",Da).unbind("focus",Da).bind("focus",Da).unbind("mouseleave",Q).bind("mouseleave",Q).unbind("blur",Q).bind("blur",Q):(b.filter('input[type\x3d"submit"]').unbind("mouseenter").bind("mouseenter",l).unbind("focus").bind("focus",l),b.filter('input[type\x3d"button"]').unbind("mouseleave").bind("mouseleave",L).unbind("blur").bind("blur",
L))}D.netBankingSelect.unbind("change",ua).bind("change",ua);D.morePaymentMethodsSelect.unbind("change",za).bind("change",za);D.continueBtnBottom.unbind("click").bind("click",J);0<I("input[name\x3d'needDisableCODandEMIforGC']").length&&(b=I("input#pm_300[type\x3d'checkbox'], #pm_gc_checkbox"),b.length&&(b.bind("change",N),b.is(":checked")&&ka(b)));D.jppoints.length&&D.paymentRows.find('input[name\x3d"useAvailableBalance"]').bind("click",c.handleJPPointsOnPaymentRows);D.hideInputBoxes.length&&(D.paymentRows.find("#confirm-card").unbind("focus").bind("focus",
B),D.paymentRows.find("#newExpDate").unbind("focus").bind("focus",da),D.paymentRows.find("#newExpDate").unbind("change").bind("change",Z))}function xa(){var a=m.create();a.validatePayment(w());a.hasErrors()||h.makePrefetch(D.existingPaymentForm)}function M(a){a=D.showAmexWarning;null!==a&&(a.removeClass("hidden"),a.removeClass("amex_display"))}function Ea(){if(!k.isMobileCX()){D=k.getElements(Va);D.paymentRows.filter(".payment-selected-marker").removeClass("payment-selected-marker").addClass("payment-selected");
var b=w();Ja(b);La(b);ja(b);va();Ga(b);Ha(b);Ia(b);Ma(b);Na(b);Oa(b);Ka(b);na();I(document).undelegate("div.pay-desktop .checkout-page-form","keypress").delegate("div.pay-desktop .checkout-page-form","keypress",P);I(document).undelegate("div.pay-desktop .checkout-page-form .enter-custom-rewards","keyup").delegate("div.pay-desktop .checkout-page-form .enter-custom-rewards","keyup",ya);D.addressChallengeCardList.length&&D.addressChallengeCardList.show();D.paymentRows.find('input[type\x3d"radio"][value\x3d"rewardsmax"]').each(function(){I(this).siblings('[type\x3d"checkbox"]').remove()}).removeClass("hidden");
la();ia();wa();D.existingPaymentForm.data("checkoutFormReady",!0);xa();pa();D.orderSummaryBottom.show();X(b);K();ya();R(b);I(".a-popover-preload").each(function(){var b=I(this).find(".rewards-registration").data("parentPaymentMethodId");b&&(a.off("a:popover:show:rewards-registration-"+b,p.displayRewardsRegister),a.off("a:popover:hide:rewards-registration-"+b,p.hideRewardsRegister),a.on("a:popover:show:rewards-registration-"+b,p.displayRewardsRegister),a.on("a:popover:hide:rewards-registration-"+b,
p.hideRewardsRegister))});r.when("a-tv").execute(function(c){a.trigger("a:tv:resize");b.find(".a-tv-navigate").length&&ha(b,b,!1)})}}function ya(b){h.isSPP()?(Ba()?D.disableSubmitButtons.length?(b=w(),b.find(".continue-center").addClass("aok-hidden"),b.find(".a-button-disabled").removeClass("aok-hidden")):(D.continueBtns.find(".a-button-primary:not(.a-button-disabled)").addClass("aok-hidden"),D.continueBtns.find(".a-button-disabled").removeClass("aok-hidden")):L(),a.trigger("orderSummary:primaryActionButton:mirrorPanelBtnState")):
I("#payPageContinueBtnStateFixEnabled").length&&l(b)}function Fa(a,b){var c=I(a.target).closest(".order-summary-box").find(".continue-button-errors");if(c.length&&b.length){var d=g.triggerLeft(c,b);c.show();c.offset(d)}}function Da(a){if((!D.continueErrPopover.filter(":visible").length||k.isTouchCX())&&D.continueErrPopover.find(".error-message:not(.hidden)").length&&a&&("mouseenter"===a.type||"focus"===a.type)){var b=I(a.target).closest(".continue-buttons").find(".a-button-disabled");Fa(a,b)}}function Ba(a){if(D.continueErrPopover.filter(":visible").length&&
!k.isTouchCX())return!0;var b=w(),c=m.create();c.validatePayment(b);c=c.getHighestErrorId();if(!c||!c.identifier)return!1;D.continueErrPopover.find(".error-message").hide();b=b.find(".pincode-err-block");b.hide();b&&b.length&&c.target&&c.target.length&&c.target.addClass("a-form-error");c.isPincodeError?(b.show(),b.addClass("a-form-error")):(D.continueErrPopover.find("#"+c.identifier).show(),D.continueErrPopover.find("#"+c.identifier).removeClass("hidden"),!a||"mouseenter"!==a.type&&"focus"!==a.type?
h.isSPP||D.continueBtns.find(".a-button input").filter(":visible").each(function(){var a=I(this).closest(".order-summary-box").find(".continue-button-errors"),b=g.triggerLeft(a,I(this));a.show();a.offset(b)}):(b=I(a.target).closest(".continue-buttons").find(".a-button-primary"),Fa(a,b)));return!0}function Ga(b){D.paymentRows.find(".addr-challenge, .addr-challenge-msg").hide();D.hideInputBoxes.length?D.paymentRows.find(".card-name").show():D.paymentRows.find(".card-info").show();"true"===k.getAttributeData(b,
"isaddresschallenge")&&(b.find(".addr-challenge, .addr-challenge-msg").show(),D.hideInputBoxes.length?b.find(".card-name").hide():b.find(".card-info").hide(),b=b.attr("paymentmethodid")?b.attr("paymentmethodid"):b.attr("data-paymentmethodid"),a.trigger("checkout:payment:challenge:log",b))}function Qa(a){D.paymentRows.find(".expire-date-fields").hide();a=a.find(".expire-date-fields");a.length&&a.show()}function Pa(a,b){r.when("a-tv").execute(function(c){c.add(b.find(".payment-container"));b.find(".tv-update").hide();
var d=a.find(".tv-update");d.length&&(c.remove(a.find(".payment-container")),d.show(),G(d.find(".a-button-primary")))})}function Ha(a){D.paymentRows.find(".verified-fail-msg").hide();"true"===k.getAttributeData(a,"isverifiedfail")&&a.find(".verified-fail-msg").show()}function Ia(a){D.paymentRows.find(".cup-expired-msg").hide();"true"!==k.getAttributeData(a,"iscupcardexpired")&&"true"!==k.getAttributeData(a,"iscupcardexpiringsoon")||a.find(".cup-expired-msg").show()}function Ja(a){D.paymentRows.find(".rewards-list").hide();
D.paymentRows.find(".top-cell .inner-grid-left").show().find(".rewards-info").show();var b=a.find('.rewards-list input[type\x3d"radio"]'),c=b.filter(":checked");D.paymentRows.find('.rewards-list input[type\x3d"radio"]').prop("checked",!1);0<c.length?c.prop("checked",!0):a.find(".rewards-list").hasClass("apply-by-default")?b.filter('[value\x3d"rewardsmax"]').prop("checked",!0):b.filter('[value\x3d"rewardsnone"]').prop("checked",!0);b=a.find(".rewards-list").show();b.find('input[type\x3d"radio"][value\x3d"rewardscustom"]').is(":checked")&&
b.children(".enter-custom-rewards").show();k.isTouchCX()&&b.length&&(a.find(".rewards-info").hide(),a.find(".top-cell").addClass("bottom-line"),a.find(".bottom-cell").show())}function La(a){D.paymentRows.find(".financial-offer-list").hide();D.paymentRows.find(".financial-offer-err-detail").hide();var b=a.find('.financial-offer-list input[type\x3d"radio"]'),c=b.filter(":checked");b.prop("checked",!1);0<c.length?c.prop("checked",!0):b.first().prop("checked",!0);b=a.find(".financial-offer-list").show();
a.find(".financial-offer-err-detail").show();k.isTouchCX()&&b.length&&(a.find(".top-cell").addClass("bottom-line"),a.find(".bottom-cell").show())}function Sa(){I(document.body).find(".a-dropdown").each(function(){d.hide(I(this))})}function Ta(a){D.paymentRows.find(".installments-select").hide();D.paymentRows.find(".installments-message").show();a.find(".installments-select").show();a.find(".installments-message").hide()}function Ka(a){D.paymentRows.find(".card-ref-num, .selected-note, .selected-more-payment-option").hide();
D.paymentRows.find(".card-benefit").show();a.find(".card-ref-num, .selected-note, .selected-more-payment-option").show();a.find(".card-benefit").hide()}function Ua(a){D.paymentRows.find(".otpBlock").hide();a.find(".otpBlock").show()}function Ma(a){D.paymentRows.find(".vcc-info-prompt,.vcc-form-fields").hide();a.find(".vcc-info-prompt,.vcc-form-fields").show()}function Na(a){var b=D.newVDC.find("#vdcBanksSelect"),c=D.newVDC.find(".vdc-selected-bank-prompt"),d=b.val(),e="1"===I("#save_citi_card").val()?
"CIT"!==d:!0,f="1"===I("#save_citi_card").val()&&"CIT"===d;a.find("#vdcBanksSelect").length?""!==d&&"OtherBanks"!==d&&e&&c.show():(("OtherBanks"===d||f)&&b.val(b.children("option").first().val()).trigger("change"),c.hide())}function Oa(a){var b=I("#cash-back-ineligible-for-cod-message");b&&b.length&&((a=a.find("#cashOnDeliveryCash"))&&a.length?b.removeClass("hidden"):b.addClass("hidden"))}function qa(){var a=I("#imb-wrapper");if(a.length&&a.is(":visible")){var b=a.find(".defaultPaymentMethodExpired"),
c=a.find(".codUnavailable"),d=a.find("p").length;0===b.length&&0===c.length||1!==d||a.hide()}}var I=a.$,Ra=!0,D={},Va={cardImages:"#newCreditCardImages",continueBtns:".continue-buttons:not(.place-order-button)",continueBtnTop:"#continue-top",continueBtnBottom:"#continue-bottom",continueErrPopover:".continue-button-errors",cvvColumnLabel:"#cvvColumnLabel",existingPaymentForm:"form.checkout-page-form",netBankingSelect:"#net-banking-select-list",morePaymentMethodsSelect:"#more-payment-methods-select-list",
newVDC:"#new-vdc",orderSummaryBottom:"#order-summary-bottom",pageContainer:"div.a-container",paymentRows:"#existing-payment-methods .payment-row",rewardsRegister:"#rewards-register",addressChallengeCardList:".address-challenge-card",hiddenFormFields:"#hiddenFormFields",jppoints:"#jppoints",gcpromo:"#gcPromo",disableSubmitButtons:"#disableSubmitButtons",hideInputBoxes:"#hideInputBoxes",showAmexWarning:"#showAmexWarning",existingPincodeNum:"#existingPincodeNum"};a.on("checkout:reload:payselect",Ea);
a.on("checkout:reload:spp-payment",Ea);return{getSelectedPayment:w}});"use strict";r.when("A","page-detector").register("wechat-detector",function(a,n){var k=a.$,m=function(a){a&&!1!==a.isWeChatInstalled&&(a=k("#wechat_payment"),a.length&&a.show())},f=function(a){},h="MShopWeChatPayment";a.on("checkout:reload:payselect",function(){k("#wechat_payment").length&&(k("#mShopWeChatApiName").length&&(h=k("#mShopWeChatApiName").val()),r.when("safe-mash").execute(function(a){t.cordova.require("cordova/exec")(m,
f,h,"isWeChatInstalled",[])}))})});"use strict";r.when("A","page-main","client-side-metrics","ready").register("otp-for-cod",function(a,n,k){function m(){z=A("#cashOnDeliveryCash");if(z.length&&(C=z.find(E.verifyOTP),w=z.find(E.sendOTP),B=C.length&&w.length,t=A(E.payMobile).length?1:0,B&&(u=z.find(E.submitSendOTP),q=z.find(E.submitVerifyOTP),v=z.find(E.submitResendOTP),l=z.find(E.changeOTPNumber),O=z.find(E.OTPPhoneNumber),K=z.find(E.otpCode),u.length&&q.length&&v.length&&l.length))){r=z.find(E.addURLHash).length;
k.increaseCount(U.metricPrefix+U.block,1,1);u.click(function(){y();k.increaseCount(U.metricPrefix+U.send,1,1)});q.click(function(){L=O.val();S=K.val();d();var a=h(L),b;b=/^\d{6}$/;b=S&&b.test(S);a&&b&&""!==J?e("VerifyOTP",J):b?a||z.find(E.otpServiceFailed).removeClass(E.aokHidden):z.find(E.invalidOTPError).removeClass(E.aokHidden);k.increaseCount(U.metricPrefix+U.verify,1,1)});if(r&&location.hash&&location.hash.length){for(var a=location.hash,a=a.replace("#",""),a=a.split(";"),b=0;b<a.length;b++)0<=
a[b].indexOf(T.codehandle)&&(J=a[b].replace(T.codehandle,"")),0<=a[b].indexOf(T.contactid)&&(P=a[b].replace(T.contactid,"")),0<=a[b].indexOf(T.phonenumber)&&(L=a[b].replace(T.phonenumber,""),O.val(L));""!==J&&""!==P&&""!==L&&p()}v.click(function(){k.increaseCount(U.metricPrefix+U.resend,1,1);y()});l.click(function(){C.addClass(E.aokHidden);w.removeClass(E.aokHidden);f(v,!1);f(q,!1);d();k.increaseCount(U.metricPrefix+U.changeNumber,1,1)})}}function f(a,b){b?a.addClass(E.aButtonDisabled):a.removeClass(E.aButtonDisabled);
t?a.find("button").prop("disabled",b):a.find("input").prop("disabled",b)}function h(a){var b=/^\d{10}$/;return a&&b.test(a)}function g(){z.find(E.otpServiceFailed).removeClass(E.aokHidden)}function p(){var a=z.find(E.verifyOTPPhoneNumber);z.find(E.invalidPhoneNumber).addClass(E.aokHidden);w.hasClass(E.aokHidden)?z.find(E.otpResentSuccess).removeClass(E.aokHidden):t&&z.find(E.otpSentSuccess).removeClass(E.aokHidden);w.addClass(E.aokHidden);C.removeClass(E.aokHidden);var b=L.substr(0,2)+"*****"+L.substr(7,
9);a.text(b);f(v,!1)}function c(a){if(void 0!==a&&"object"!==typeof a)try{a=A.parseJSON(a)}catch(c){a={}}a=a||{};var d="",e=r&&location.hash?location.hash:"#";r&&location.hash&&";"!==e.slice(-1)&&(e+=";");d=a.status;a.codeHandle&&null!==a.codeHandle&&(J=a.codeHandle,r&&"SEND-SUCCESS"===d&&(e=b(e,T.codehandle,J)));a.contactId&&null!==a.contactId&&(P=a.contactId,r&&"SEND-SUCCESS"===d&&(e=b(e,T.contactid,P),e=b(e,T.phonenumber,L)));r&&(location.hash=e);a=d;z.find(E.otpAlertClass).addClass(E.aokHidden);
if(aa[a])aa[a]();else aa.DEFAULT()}function b(a,b,c){var d=a.indexOf(b);if(0<=d){var e=a.indexOf(";",d),e=0<=e?e:a.length;a=a.substring(0,d)+a.substring(e+1,a.length+1)}return a+b+c+";"}function e(b,d){a.ajax("/gp/buy/payselect/handlers/otpAjaxHandler.html",{method:"get",params:{phoneNumber:L,method:b,codeHandle:d,contactId:P,otp:S},success:c,error:function(){c({status:"SERVICE-FAILED"})}})}function d(){K.val("");z.find(E.otpAlertClass).addClass(E.aokHidden)}function y(){d();L=O.val();h(L)?e("SendOTP",
J):z.find(E.invalidPhoneNumber).removeClass(E.aokHidden)}var A=a.$,z,C,w,u,q,v,l,O,K,B,t,r,L="",J="",P="",S="",E={aokHidden:"aok-hidden",aRadio:".a-radio",aButtonHidden:"a-button-hidden",aButtonDisabled:"a-button-disabled",payMobile:".pay-mobile",invalidOTPError:".invalidOTPError",verifyOTP:"#verifyOTP",sendOTP:"#sendOTP",submitSendOTP:"#submitSendOTP",submitVerifyOTP:"#submitVerifyOTP",submitResendOTP:"#submitResendOTP",changeOTPNumber:"#changeOTPNumber",OTPPhoneNumber:"#OTPPhoneNumber",otpCode:"#otpCode",
cashOnDeliveryCash:"#cashOnDeliveryCash",invalidPhoneNumber:".invalidPhoneNumber",otpServiceFailed:".otpServiceFailed",enterOTPLabel:"#enterOTPLabel",reEnterOTPLabel:"#reEnterOTPLabel",maxOTPError:".maxOTPError",numberAlreadyUsed:".numberAlreadyUsed",verifiedOTPSuccess:".verifiedOTPSuccess",verifyOTPPhoneNumber:"#verifyOTPPhoneNumber",otpResentSuccess:".otpResentSuccess",otpSentSuccess:".otpSentSuccess",otpAlertClass:".otpAlertClass",phonenumberNotVerified:"phonenumberNotVerified",addURLHash:".addURLHash"},
T={codehandle:"codehandle:",contactid:"contactid:",phonenumber:"phonenumber:"},U={metricPrefix:"PayPage-COD-OTP-",block:"Block",send:"Send",verify:"Verify",resend:"ReSend",changeNumber:"ChangeNumber"},aa={"SERVICE-FAILED":g,"SEND-SUCCESS":p,"VERIFY-SUCCESS":function(){w.addClass(E.aokHidden);C.addClass(E.aokHidden);z.find(E.verifiedOTPSuccess).removeClass(E.aokHidden);z.find("."+E.phonenumberNotVerified).removeClass(E.phonenumberNotVerified);t&&n.setContinueButtonStatus(!0)},"INVALID-NUMBER":function(){z.find(E.invalidPhoneNumber).removeClass(E.aokHidden)},
"NUMBER-ALREADY-USED":function(){f(v,!0);f(q,!0);z.find(E.numberAlreadyUsed).removeClass(E.aokHidden)},"MAX-OTP-REACHED":function(){z.find(E.maxOTPError).removeClass(E.aokHidden);f(v,!0)},"INVALID-OTP":function(){z.find(E.invalidOTPError).removeClass(E.aokHidden);K.val("");t?K.attr("placeholder","Re-enter OTP"):(z.find(E.enterOTPLabel).addClass(E.aokHidden),z.find(E.reEnterOTPLabel).removeClass(E.aokHidden))},DEFAULT:g};a.on("checkout:reload:payselect",m);a.on("checkout:reload:spp-payment",m)});"use strict";
r.when("A","pay-common-util","ready").execute(function(a,n){var k={productGls:"#productGls",gcTypes:"#gcDeliveryTypes",device:"#device"},m=n.getElements(k);a.on("checkout:payment:challenge:log",function(f){var h={},g;for(g in k)k.hasOwnProperty(g)&&m[g]&&m[g].val()&&(h[g]=m[g].val());f&&(h.paymentInstrumentId=f);Object.keys&&Object.keys(h).length&&a.ajax("/gp/buy/payselect/handlers/log-payment-challenge.html?ref_\x3dcheckout-payment-challenge",{method:"POST",params:h,timeout:1E3,cache:!1})})});"use strict";
r.when("A","page-main","page-transition-controller","page-conductor","client-side-metrics","button-blocker","ready").register("pay-auth",function(a,n,k,m,f,h){function g(){var a=p("#otp_id").val(),c=/^\d{6}$/;a&&c.test(a)?h.hide("pay-auth-otp-checks"):(a=p("#otp_invalid_msg").val(),h.show("pay-auth-otp-checks",a))}var p=a.$,c;a.on("checkout:reload:payauth",function(){c=p("#resend_form");c.submit(function(){f.increaseCount("Payauth-Resend",1,1);a.ajax("resend-otp.html?returnHtml\x3d0",{method:"get"});
return!1});g();p("#otp_id").unbind("keyup").bind("keyup",g)})});"use strict";r.when("A","pay-common-lib","ajax-utility","pay-common-util","loading-spinner-controller","page-conductor","page-transition-controller","quantity-service").register("pay-gil",function(a,n,k,m,f,h,g,p){function c(a){w("#gil-estimates-popover .gil-popover-content").html("");w("#gil-estimates-popover .gil-popover-error").hide();a.popover.updatePosition(!0)}function b(a){q=a.popover;a=w("#gil-estimates-popover");f.showSpinner(a,
!1,q);a="/gp/buy/payselect/handlers/get-gil-popover-content.html?cachebuster\x3d"+(new Date).getTime();w.ajax({type:"POST",url:a,data:"hasWorkingJavascript\x3d1",dataType:"text",async:!0,cache:!1,dataFilter:function(a){return k.jsonify(a)},success:function(a,b,c){b=w("#gil-estimates-popover");f.hideSpinner(b);a&&a.errors&&0<a.errors.length?b.find(".gil-popover-error").show():a&&a.widgetHTML?b.find(".gil-popover-content").html(decodeURIComponent(a.widgetHTML)):b.find(".gil-popover-error").show();q.updatePosition(!0)},
error:function(a){a=w("#gil-estimates-popover");f.hideSpinner(a);a.find(".gil-popover-error").show();q.updatePosition(!0)}})}function e(a){a.$event.preventDefault();a.$target.closest(".a-popover").find(".a-button-close").trigger("click")}function d(a){a.$event.preventDefault();var b=w("#gil-estimates-popover");f.showSpinner(b,!1,q);var c=y(a.$currentTarget.parents("#gil-estimates-popover")),d=b.find("input[name\x3dgil-subtype]").val();p.callBatch(c,{success:function(b,c,f){e(a);g.show();z(d)},error:function(a){a=
w("#gil-estimates-popover");f.hideSpinner(a);a.find(".gil-popover-error").show();q.updatePosition(!0)},isTrial:0})}function y(a){var b={};a.find(".gil-ineligible-items").children(".gil-ineligible-item").each(function(a,c){var d=w(c).find('input[name^\x3d"ineligible-item"]').val();b[d]=0});return b}function A(a){a.$event.preventDefault();var b=w("#gil-ineligible").find(".gil-ineligible-items"),c=b.data("index"),d=b.data("size"),c=(c+("next"===a.data.direction?1:-1)+d)%d,d=(c+1)%d;b.find(".gil-ineligible-item").addClass("aok-hidden").removeClass("a-span-last");
a=b.find("#gil-ineligible-item-"+c);d=b.find("#gil-ineligible-item-"+d);a.removeClass("aok-hidden");d.addClass("a-span-last").removeClass("aok-hidden");b.data("index",c)}function z(b){m.makeAjaxCall("/gp/buy/payselect/handlers/submit.html",{handler:"new-gil-payment",subtype:b},{successHandler:function(c,d,e){h.ajaxUpdatePage(c,d,e);m.scrollTopTo(w("#existing-payment-methods [value\x3d"+b+"]"));if(h.isSPP())a.on("checkout:afterReload",function F(){w("#existing-gil input[value\x3d"+b+"]").trigger("click");
a.off("checkout:afterReload",F)});else w("#existing-gil input[value\x3d"+b+"]").trigger("click")},errorHandler:function(a,b,c){h.ajaxUpdatePage(a,b,c)}})}function C(){n.isMobileCX()||(u&&(a.declarative("gil-close-popover",["click"],e),a.declarative("gil-submit-popover",["click"],d),a.declarative("gil-ineligible-pagination",["click"],A)),w("#gil-payment-type").length&&(a.off("a:popover:beforeShow:gil-estimates",c),a.off("a:popover:show:gil-estimates",b),a.on("a:popover:beforeShow:gil-estimates",c),
a.on("a:popover:show:gil-estimates",b)));u=!1}var w=a.$,u=!0,q;a.on("checkout:reload:payselect",C);a.on("checkout:reload:spp-payment",C);return{submitNewGilPayment:z}});"use strict";r.when("A","page-detector").register("alipay-detector",function(a,n){var k=a.$,m=function(){var a=k("input[name\x3d'isAlipayAppPayment']");0<a.length&&n.isMobileSpc&&a.val("1")},f=function(a){};a.on("checkout:reload:spc",function(){k("input[name\x3d'isAlipayAppPayment']").length&&r.when("safe-mash").execute(function(a){t.cordova.require("cordova/exec")(m,
f,"AlipayPlugin","isAlipayInstalled",[])})})});"use strict";r.when("A","page-transition-controller","page-detector").execute(function(a,n,k){function m(){var a=f("#backButtonProtection");a.length&&"1"===a.val()&&(n.showPageTransition(),document.location.reload())}var f=a.$;r.register("back-button-protection",function(){return{markAsDirty:function(){f("#backButtonProtection").val(1)}}});a.on("checkout:reload:spc",m);a.on("checkout:reload:spp-revieworder",m)});"use strict";r.when("A","page-transition-controller",
"loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics","delivery-preferences-csm-helper").register("delivery-preferences-controller",function(a,n,k,m,f,h,g,p,c){function b(){g.isTabletSpc()&&(q=u("#spc-orders .delivery-preferences-options"),C(),q.find("select").trigger("change"),A())}function e(){var a=q.find("input[name\x3dpreference]:checked").val(),b=q.find("select[name\x3dSafePlaceLocation]");"NeighborDelivery"===a?(q.find("input[name\x3dneighbor-name]").removeAttr("disabled").removeClass("a-form-disabled"),
q.find("input[name\x3dneighbor-house]").removeAttr("disabled").removeClass("a-form-disabled"),f.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"disabled"})}):b.attr("disabled","disabled").closest(".a-button").addClass("a-button-disabled"),q.find(".safe-place-error").hide()):"SafePlaceDelivery"===a?(f.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"enabled"})}):b.removeAttr("disabled").closest(".a-button").removeClass("a-button-disabled"),
q.find("input[name\x3dneighbor-name]").attr("disabled","disabled").addClass("a-form-disabled"),q.find("input[name\x3dneighbor-house]").attr("disabled","disabled").addClass("a-form-disabled"),q.find(".neighbor-name-error").hide(),q.find(".neighbor-house-error").hide()):(q.find("input[name\x3dneighbor-name]").attr("disabled","disabled").addClass("a-form-disabled"),q.find("input[name\x3dneighbor-house]").attr("disabled","disabled").addClass("a-form-disabled"),f.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"disabled"})}):
b.attr("disabled","disabled").closest(".a-button").addClass("a-button-disabled"),q.find(".neighbor-name-error").hide(),q.find(".neighbor-house-error").hide(),q.find(".safe-place-error").hide());d(!0)}function d(a){var b=q.find("input[name\x3dpreference]:checked").val();q.find(".safe-place-error").hide();q.find(".neighbor-name-error").hide();q.find(".neighbor-house-error").hide();q.find("input").removeClass("a-form-error");q.find("div.a-input-text-wrapper").removeClass("a-form-error");q.find("select").closest(".a-button").removeClass("a-button-error");
0<u("div.spc-tablet").length?q.find(".set-delivery-preferences-button").removeClass("a-button-disabled"):q.find(".set-delivery-preferences-button").show();q.find(".save-disabled").hide();q.find(".current-blocker-content").text("");var c=!1;"NeighborDelivery"===b?(b=q.find("input[name\x3dneighbor-name]"),b.data("defaultValueRemoved")&&b.val()||(q.find(".neighbor-name-error").show(),b.addClass("a-form-error"),b.closest(".a-input-text-wrapper").addClass("a-form-error"),q.find(".current-blocker-content").html(q.find(".neighbor-name-error-text").text()),
c=!0),b=q.find("input[name\x3dneighbor-house]"),b.data("defaultValueRemoved")&&b.val()||(q.find(".neighbor-house-error").show(),b.addClass("a-form-error"),b.closest(".a-input-text-wrapper").addClass("a-form-error"),q.find(".current-blocker-content").html(q.find(".neighbor-house-error-text").text()),c=!0)):"SafePlaceDelivery"===b&&(b=q.find("select[name\x3dSafePlaceLocation]"),b.val()||(q.find(".safe-place-error").show(),b.closest(".a-button").addClass("a-button-error"),q.find(".current-blocker-content").html(q.find(".safe-place-error-text").text()),
c=!0));a&&c&&(0<u("div.spc-tablet").length?q.find(".set-delivery-preferences-button").addClass("a-button-disabled"):q.find(".set-delivery-preferences-button").hide(),q.find(".save-disabled").show());return!c}function y(a){a&&a.$event&&a.$event.preventDefault();a="hasWorkingJavascript\x3d1\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26";var b="",e=q.find(".popover-deliv-prefs-content");e.data("obfuscatedEntityId")?b=e.data("obfuscatedEntityId"):q.data("obfuscatedEntityId")&&
(b=q.data("obfuscatedEntityId"));a+="obfuscatedEntityId\x3d"+b+"\x26";b=q.find("input[name\x3dpreference]:checked").val();""!==b&&(a+="prefDelLocation\x3d"+b+"\x26","NeighborDelivery"===b?(a+="neighborName\x3d"+encodeURIComponent(q.find("input[name\x3dneighbor-name]").val())+"\x26",a+="houseNo\x3d"+encodeURIComponent(q.find("input[name\x3dneighbor-house]").val())+"\x26"):"SafePlaceDelivery"===b&&(a+="safePlaceLocation\x3d"+q.find("select[name\x3dSafePlaceLocation]").val()+"\x26"),b=q.find("input[name\x3ddefaultPreference]:checked").val(),
void 0!==b&&""!==b&&(a+="isDefaultPreference\x3d1"));0<u("div.spc-tablet").length?n.show():k.showSpinner(q.find(".popover-deliv-prefs-content"),!1,v);c.recordCSMWithCurrentFieldValues("popover-submitted","preference","defaultPreference");u.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-delivery-preference.html",data:a,dataType:"text",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"},
success:function(a,b,c){l=!0;0<u("div.spc-tablet").length?n.hide():k.hideSpinner(q.find(".popover-deliv-prefs-content"));c.getResponseHeader("x-amz-checkout-page")?(q.find(".a-button-close").trigger("click"),f.ajaxUpdatePage(a,b,c)):(a=m.jsonify(a),f.redirect(a));p.increaseCount("checkoutSpcDeliveryPref-save",1)},error:function(a,b,c){0<u("div.spc-tablet").length?n.hide():k.hideSpinner(q.find(".popover-deliv-prefs-content"));d(!0)}})}function A(){q.find("input[name\x3d'neighbor-name'], input[name\x3d'neighbor-house']").unbind("focus").bind("focus",
function(){if(!u(this).data("defaultValueRemoved")){if(g.isMobileSpc()||g.isDesktopSpc())u(this).val(""),u(this).css("color","black");u(this).data("defaultValueRemoved",!0)}}).each(function(){(g.isMobileSpc()||g.isDesktopSpc())&&u(this).data("defaultValueRemoved")&&u(this).css("color","black")});q.find("input:radio[name\x3dpreference]").unbind("click").bind("click",e);q.find("input[name^\x3dneighbor]").unbind("keyup").bind("keyup",function(){d(!1)});0<u("div.spc-tablet").length?q.find("select[name\x3dSafePlaceLocation]").unbind("change").bind("change",
z):q.find("select[name\x3dSafePlaceLocation]").unbind("change").bind("change",function(){d(!1)})}function z(a){d(!0)&&y(a)}function C(a){var b=u("#spc-orders .delivery-preferences-options"),c,d="";a?(c=a.$currentTarget.find("input"),d=b.find("input[name\x3dpreference]:checked").val()):c=b.find("input[name\x3dpreference]:checked");b=c.val();if(d!==b){q.find(".expand-content").hide();var d=c,e=d.closest(".delivery-preferences-options");e.find("i.a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");
e.find("input").attr("checked",!1);d.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");d.attr("checked",!0);"NeighborDelivery"===b||"SafePlaceDelivery"===b?c.closest(".deliverypreference-option").siblings(".expand-content").show():a&&y(a)}}function w(a){(a=q.find("#delivery-preferences-set-default-checkbox"))&&1===a.length&&(a.prop("checked")?p.increaseCount("checkoutSpcDeliveryPref-setAsDefault",1):p.increaseCount("checkoutSpcDeliveryPref-setAsTemporary",
1))}var u=a.$;if(!u("html").hasClass("a-ie6")){var q,v,l;a.on("a:popover:beforeShow",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-delivprefs")&&(a.popover.$popover.find(".a-popover-inner").html(q.find(".current-blocker-content").text()),a.popover.updatePosition())});a.on("a:popover:show",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(p.increaseCount("checkoutSpcDeliveryPref-open",1),v=a.popover,q=v.$popover,l=!1,A(),c.recordCSMWithCurrentFieldValues("popover-displayed",
"preference","defaultPreference"),e(),q.find("select").trigger("change"))});a.on("a:popover:dismiss",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(l||p.increaseCount("checkoutSpcDeliveryPref-dismissed",1))});a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(l||c.recordCSM("popover-dismissed"))});a.declarative("delivery-preferences-switch-tablet",["click"],function(a){C(a)});a.declarative("delivery-preferences-expander-toggle",
["click"],function(a){h.toggleExpanderContent(a)});a.declarative("set-delivery-preferences",["click","touchend"],function(a){a.$event.preventDefault();h.protectAgainstDoubleAction("set-delivery-preferences")||d(!0)&&y()});a.declarative("delivery-preferences-set-default-checkbox-triggered","change",w);a.on("checkout:reload:spc",b)}});"use strict";r.when("A","page-detector","time-left-formatter").register("fast-track-controller",function(a,n,k){function m(){for(var b in y)y[b]&&clearInterval(y[b]);
a.defer(f)}function f(){e.DAY=b("#fasttrack-day").html();e.DAYS=b("#fasttrack-days").html();e.HOUR=b("#fasttrack-hour").html();e.HOURS=b("#fasttrack-hours").html();e.AND=b("#fasttrack-and").html();e.MINUTE=b("#fasttrack-minute").html();e.MINUTES=b("#fasttrack-minutes").html();e.SECOND=b("#fasttrack-second").html();e.SECONDS=b("#fasttrack-seconds").html();(b("#isfresh").length&&b(".checkout.spc-mobile").length||b("#lazy-fresh-promise-delivery-message").length?b("#spc-form"):b("#spc-orders")).find(".fasttrack-span").each(function(){var a=
b(this),c=a.find("input[name\x3d'countdownId']").val();d[c]=a.find("input[name\x3d'fasttrackExpiration']").val();h(a.find("input[name\x3d'countdownThreshold']").val(),a,a.find("input[name\x3d'showSimplifiedCountdown']").val(),c);a.show()})}function h(a,b,c,e){0>=d[e]?p(b,null):a&&0<a&&d[e]>a||(g(b,c),y[e]=setInterval(function(){g(b,c,e)},1E3))}function g(a,c,f){0<d[f]?(c=k.getTimeLeftFormatted(d[f],1===c||"1"===c?!0:!1,e),b("html").hasClass("a-tablet")?a.find("span[data-field\x3d'fasttrackcountdown']").html("\x26nbsp;"+
c):a.find("span[data-field\x3d'fasttrackcountdown']").html(c),a.find("span.fasttrackexpired").hide(),a.find("span.fasttrackcountdown").show(),a.find("span.fasttrackavailable").show(),d[f]--):p(a,f)}function p(a,b){b?(y[b]&&clearInterval(y[b]),a.find("span.fasttrackavailable").hide(),a.find("span.fasttrackexpired").show()):clearInterval(y[b])}function c(){m()}var b=a.$;if(!b("html").hasClass("a-ie6")){var e={},d={},y={};a.on("checkout:reload:spc",m);a.on("checkout:reload:spp-revieworder",m);return{spcLiteLazyLoadFastTrack:c}}});
"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","client-side-metrics").register("gc-redeem-controller",function(a,n,k,m,f){function h(a){if(!d){a.preventDefault();e(a.currentTarget);var b;0<e("#spc-gcpromoinput").length&&(b=encodeURIComponent(e("#spc-gcpromoinput").val()));0<e("#gc-promo-input").length&&(b=encodeURIComponent(e("#gc-promo-input").val()));var f=encodeURIComponent(e("#spc-usePromoOnly").val());if(b&&0!==b.length){e("#gc-error").hide();e("#gc-promo-success").hide();
e("#gc-success").hide();e("#gc-ineligible").hide();e("#promo-success").hide();m.isSPP()?(n.blockAllActions(),n.showTransitionInContainer(e("#payment"))):n.show();var h=(new Date).getTime();a="/gp/buy/spc/handlers/add-giftcard-promotion.html/ref\x3dox_pay_page_gc_add";e(".checkout.spc.aui-templatized").length&&(a="/gp/buy/spc/handlers/add-giftcard-promotion.html/ref\x3dox_spc_gc_add");b="claimcode\x3d"+b+"\x26disablegc\x3d"+f+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+
e("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+h;f=m.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});e.ajax({type:"POST",url:a,data:b,headers:f,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",complete:function(){d=!1},success:g,error:m.ajaxRedirect});d=!0}else c("addGiftCardOrPromo_NoCode")}}function g(a,d,f){var g=f.getResponseHeader("x-amz-checkout-page");if(g){if(m.ajaxUpdatePage(a,d,f),"spc"===
g||"spclite"===g||"spp-revieworder"===g)(a=parseInt(e("#checkoutDisplayPage").data("delaySetTitle"),10)||parseInt(e("#gc-promo-delay").data("egcDelayUpdateRedemptionMessage"),10)||0)?setTimeout(function(){p(f)},a):p(f)}else{a=k.jsonify(a);if(!a)return m.redirect();if(a.error)return c(a.error);if(a.errors)return c(a.errors);if(a.autohandlererror)return b(a.autohandlererror);m.redirect(a)}}function p(a){var b=a.getResponseHeader("x-updated-promo-type");a=a.getResponseHeader("x-updated-gc-applied-but-ineligible");
b&&(a||e("#gc-promo-success").show(),0<e("div.spc-desktop").length?(e("#spc-gcpromoinput").removeClass("a-form-error"),e("#gc-promo-input").removeClass("a-form-error")):(e("#spc-gcpromoinput").closest(".a-input-text-wrapper").removeClass("a-form-error"),e("#gc-promo-input").closest(".a-input-text-wrapper").removeClass("a-form-error")),"giftcard"===b?a?e("#gc-ineligible").show():e("#gc-success").show():e("#promo-success").show())}function c(a){n.hide();e("#gc-error p").hide();e("#gc-error").show();
0<e("div.spc-desktop").length?(e("#spc-gcpromoinput").addClass("a-form-error"),e("#gc-promo-input").addClass("a-form-error")):(e("#spc-gcpromoinput").closest(".a-input-text-wrapper").addClass("a-form-error"),e("#gc-promo-input").closest(".a-input-text-wrapper").addClass("a-form-error"));e(0<e("#gc-promo-input").length?"."+y[a]:"#"+a).show()}function b(a){if(a){var b=a.action,c="/gp/buy/payselect/handlers/error.html?errorType\x3d"+encodeURIComponent(a.type?a.type:b&&b.code?b.code:"string"===typeof a?
a:"Unknown:pipelineJSError");"fatal"===b?c+="\x26errorAction\x3dfatal":"redirect"===b&&(a.url?c=a.url:"cart"===a.page&&(c="/gp/cart/view.html"));t.location.href=c}else t.location.href="/gp/buy/payselect/handlers/error.html?errorType\x3dUnknown:pipelineJSError"}var e=a.$,d=!1;if(!e("html").hasClass("a-ie6")){var y={addGiftCardOrPromo_Unknown:"UNKNOWN",addGiftCardOrPromo_NoCode:"NO_CODE",addPromo_InvalidForPurchase:"PROMO_INVALID_FOR_PURCHASE",addPromo_BadCode:"PROMO_BAD_CODE",addPromo_ExpiredCode:"PROMO_EXPIRED_CODE",
addPromo_InvalidForOrgUnit:"PROMO_INVALID_FOR_ORG_UNIT",addPromo_OfferNotYetBegun:"USED_BEFORE_START_DATE",addPromo_AlreadyRedeemed:"PROMO_ALREADY_REDEEMED",addGiftCard_AlreadyRedeemedByAnotherAccount:"GC_ALREADY_REDEEMED_BY_ANOTHER_ACCOUNT",addGiftCard_AlreadyRedeemedByThisAccount:"GC_ALREADY_REDEEMED_BY_THIS_ACCOUNT",addGiftCard_BadCode:"GC_BAD_CODE",addGiftCard_ExpiredCode:"GC_EXPIRED_CODE",addGiftCard_Cancelled:"CANCELLED_CODE",addGiftCard_WrongOrgUnit:"GC_WRONG_ORG_UNIT",addGiftCard_ServiceDown:"GC_SERVICE_DOWN",
addGiftCard_InvalidForAGS:"GC_INVALID_FOR_AGS",addGiftCard_PassedClaimByDate:"PASSED_CLAIM_BY_DATE",addGiftCard_OfferNotYetBegun:"GC_NOT_YET_BEGUN",addGiftCard_ExceededMaxLimit:"GC_EXCEED_MAX_LIMIT",addGiftCard_Disabled:"GC_DISABLED"};a.declarative("gc-element",["click"],function(a){var b=a.data.click;b&&null!==b&&h(a.$event)});a.on("a:expander:redeem-gc-expander:toggle:expand",function(a){f.increaseCount("checkout:spp-payment:expand_addgc_coll",1)});e(document).delegate("#spc-gcpromoinput, #gc-promo-input",
"keypress",function(a){13===a.which&&h(a)});return{actionAddGiftPromotion:h,giftSystemErrorHandling:b}}});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics","gift-utility").register("gift-popover-controller",function(a,n,k,m,f,h,g,p,c){function b(){var a=N;a.find("#select-recipient").empty();for(var b=0;b<ga.length;b++){var c=H("\x3coption/\x3e").attr({value:ga[b].value}).text(ga[b].text);
a.find("#select-recipient").append(c)}pa&&(b=a.find('#select-recipient option[value\x3d"'+pa+'"]').attr("selected","selected"),a.find("#select-recipient").closest("#popover-gift-connection-recipient").find(".a-placeholder").text(b.text()),R())}function e(){a.defer(function(){H("#spc-orders").find(".gift-popover-link").each(function(){H(this).data("action")&&H(this).removeAttr("href").attr("tabindex",0)})});H(".larger-image-link").find("a").removeAttr("href")}function d(a){var d=N;d.find(".gift-error-box").hide();
d.find(".fake-label").each(function(){H(this).unbind("click").bind("click",function(){H(this).closest(".popover-checkbox").find("input").trigger("click")})});a&&a.item&&a.item.title&&d.find(".popover-gift-top .gift-item-title span").html(a.item.title);a&&a.item&&a.item.isAutoripEligible?d.find("#gift-autorip-unavailable-msg").show():d.find("#gift-autorip-unavailable-msg").hide();if(a&&a.obfuscatedEntityId){var e=d.find(".set-gift-options-button input");e.unbind("click").bind("click",{obfuscatedentityid:a.obfuscatedEntityId,
giftData:a},y);h.bindActionEnterKeyOnButton(e)}fa?(ca=a&&a.item&&a.item.isAmazonFulfilled,ta=!(a&&a.address&&0===a.address.shipToSelf),ca&&(a&&a.options&&a.options.canHaveMessage||a&&a.options&&a.options.canBeWrapped)?(C(!0),d.find(".mfn-hide-prices").hide(),d.find(".include-gift-receipt").show()):ca||(C(!0),d.find(".include-gift-receipt").hide(),d.find(".mfn-hide-prices").show(),d.find(".include-gift-message").show()),wa=d.find(".include-gift-message").is(":visible"),l()):a&&a.options&&a.options.canHidePrices?
d.find(".hide-prices-checkbox").closest("div").show():d.find(".hide-prices-checkbox").closest("div").hide();a&&a.selected&&(e=M(d.find(".hide-prices-checkbox")),a.selected.hidePrices?e.attr("checked",!0):e.removeAttr("checked"));if(a&&a.item&&a.item.purchaseIsKindle){if(e=d.find(".kindle-registration-box"),e.show(),e.find(".register-kindle-customer-name").html(d.find(".gift-customer-name").html()),!fa){var e=M(d.find(".kindle-reg-radio-another-account")),f=M(d.find(".kindle-reg-radio-your-account"));
a.selected.hidePrices||a.selected.isWrapped?(f.removeAttr("checked"),e.attr("checked",!0)):(e.removeAttr("checked"),f.attr("checked","checked"));M(d.find(".hide-prices-checkbox")).trigger("change")}}else d.find(".kindle-registration-box").hide();if(a&&a.options&&a.options.canHaveMessage){a&&a.selected&&(e=a.selected.message,f=M(d.find(".include-gift-message-checkbox")),e&&e.length?(d.find("textarea[name\x3d'gift-message-text']").val(e),u(!0)):null===e&&(a.selected.isWrapped||a.selected.hasReceipt)?
(f.removeAttr("checked"),d.find(".textarea[name\x3d'gift-message-text']").val("")):(d.find("textarea[name\x3d'gift-message-text']").val(""),e="",fa?(e+=d.find(".sample-gift-msg-greeting").html(),a&&a.address&&a.address.firstName&&!ta&&(e+=" "+a.address.firstName),e=e+",\n"+d.find(".sample-gift-msg").html(),e+="\n"):(e+=d.find(".sample-gift-msg").html(),e+="\n\n"),e+=d.find(".sample-gift-msg-from").text(),e=fa?e+c.getNameWithNoTitle(d.find(".gift-customer-name").html()):e+c.getFirstName(d.find(".gift-customer-name").html()),
d.find("textarea[name\x3d'gift-message-text']").val(e),!fa||ta&&wa||u(!0)));var g=H(".gift-message-warning").length,e=function(){fa&&u(!0);L(a.options.maxMessageChars,a.options.maxMessageLines,a.options.hasFixedGiftMsgLimit);if(g){var b=N.find("textarea[name\x3d'gift-message-text']");c.toggleGiftMessageWarning(b,N)}};if(a&&a.options){var p=d.find("textarea[name\x3d'gift-message-text']");p.bind("keyup",e);p.bind("mouseup",e);L(a.options.maxMessageChars,a.options.maxMessageLines,a.options.hasFixedGiftMsgLimit);
g&&c.toggleGiftMessageWarning(p,d);M(d.find(".include-gift-message-checkbox")).bind("change",function(){var b=H(this).is(":checked"),e=a.options.maxMessageChars,f=a.options.maxMessageLines,h=a.options.hasFixedGiftMsgLimit,k=N,m=k.find("textarea[name\x3d'gift-message-text']");b?fa&&v():(0<k.find(".validateInputCharactersOnBlur.a-form-error").size()&&(k.find(".validateInputCharactersOnBlur.a-form-error").removeClass("a-form-error"),0<k.find("#onblur-character-validation-error-gift-message-text").size()&&
k.find("#onblur-character-validation-error-gift-message-text").remove()),fa?l():(m.val(""),L(e,f,h)));g&&c.toggleGiftMessageWarning(p,d)})}}else d.find(".popover-gift-message-text").css("visibility","hidden"),d.find(".include-gift-message").css("visibility","hidden"),fa&&(d.find(".include-gift-message").hide(),d.find(".popover-gift-message").css("visibility","hidden")),d.find(".popover-gift-message-not-available").show();a&&a.options&&!a.options.canBeWrapped?(d.find(".wrap-option").hide(),d.find(".popover-gift-no-wrap-available").show(),
d.find(".hide-prices-amazon-msg").hide(),d.find(".hide-prices-note").hide(),d.find(".hide-prices-merchant-msg").show(),M(d.find(".hide-prices-checkbox")).attr("disabled",!1)):a&&a.item&&a.item.isAmazonFulfilled?(d.find(".wrap-option").hide(),d.find(".popover-gift-fba-wrap").show(),d.find(".hide-prices-amazon-msg").show(),d.find(".hide-prices-merchant-msg").hide(),a.useLargeWrapImage?(e=a.options.wraps[0].imageurl)&&0<e.length&&(d.find(".large-preview").find("img").attr("src",e),d.find(".large-preview").show(),
d.find(".fba-wrap-checkbox").show(),f=d.find(".larger-image-link"),f.unbind("click").bind("click",{imageURL:e},J),h.bindActionEnterKeyOnButton(f)):(e=a.options.wraps[0].imageurl)&&0<e.length&&(d.find(".fba-image").attr("src",e).show(),d.find(".amazon-gift-wrap-text").css("padding-top","10px")),a.options.wraps[0].description&&d.find(".gift-wrap-title").show().html(a.options.wraps[0].description),"1"===H("#multipleAFNGiftWrapOption").val()?a.options&&a.options.wraps&&1<=a.options.wraps.length&&(e=d.find(".popover-gift-amazon-wrap"),
A(d,e),Z(a,"afn",e)):a.options&&a.options.wraps&&1===a.options.wraps.length?(d.find(".popover-gift-amazon-wrap").hide(),d.find(".popover-gift-merchant-wrap").hide(),d.find(".fba-wrap-checkbox .gift-wrap-price").html(a.options.wraps[0].price),f=M(d.find(".amazon-gift-wrap")),f.val(a.options.wraps[0].id),e=M(d.find(".hide-prices-checkbox")),a.selected.isWrapped?(f.attr("checked",!0),a.item.purchaseIsKindle||(e.attr("checked",!0),e.attr("disabled",!0),d.find(".hide-prices-note").show())):(f.removeAttr("checked"),
e.attr("disabled",!1),d.find(".hide-prices-note").hide())):a.options&&a.options.wraps&&1<a.options.wraps.length&&(e=d.find(".popover-gift-amazon-wrap"),A(d,e),V(a,"afn",e))):(d.find(".wrap-option").hide(),M(d.find(".hide-prices-checkbox")).removeAttr("disabled"),d.find(".hide-prices-amazon-msg").hide(),d.find(".hide-prices-note").hide(),d.find(".hide-prices-merchant-msg").show(),d.find(".large-preview").hide(),e=d.find(".popover-gift-merchant-wrap").show(),e.find(".mfn-wrap-copy").remove(),V(a,"mfn",
e));fa&&(F(),Q(),r());if(0<H(".enable-gift-connections").length){d.find("#popover-gift-connection select.a-touch-select-input").each(function(){H(this).unbind("change").bind("change",function(){var a=H(this),b=a.siblings("a.a-placeholder"),a=a.find(":selected").text();b.text(a);return!1})});d.find("#select-recipient").bind("change",function(a){ha(a);return!1});d.find("#select-occasion").bind("change",function(a){ja(a);return!1});d.find("#input-recipient-first-name").keyup(function(){R()});d.find("#input-recipient-last-name").keyup(function(){R()});
d.find("#popover-gift-connection-recipient").unbind("click").bind("click",function(a){a=N;va||a.find("#select-recipient-spinner").show()});pa=void 0;if(a.giftConnection){void 0!==typeof a.giftConnection.giftlistTypeId&&"0"===a.giftConnection.giftlistTypeId&&void 0!==typeof a.giftConnection.occasionId&&"0"===a.giftConnection.occasionId&&d.find("#include-gift-connection-checkbox").attr("checked",!1);a.giftConnection.firstName&&d.find("#input-recipient-first-name").val(a.giftConnection.firstName);a.giftConnection.lastName&&
d.find("#input-recipient-last-name").val(a.giftConnection.lastName);if("1"===a.giftConnection.giftlistTypeId||"2"===a.giftConnection.giftlistTypeId)e=d.find('#select-recipient option[value\x3d"'+a.giftConnection.giftlistTypeId+'"]').attr("selected","selected"),d.find("#select-recipient").closest(".a-button-inner").find(".a-placeholder").text(e.text()),d.find(".gift-connection-recipient-extra").show();if(a.giftConnection.giftlistId&&"0"!==a.giftConnection.giftlistId)pa=a.giftConnection.giftlistId;
else if("0"===a.giftConnection.giftlistTypeId||"1"===a.giftConnection.giftlistTypeId||"2"===a.giftConnection.giftlistTypeId)pa=a.giftConnection.giftlistTypeId;a.giftConnection.occasionId&&(e=d.find('#select-occasion option[value\x3d"'+a.giftConnection.occasionId+'"]').attr("selected","selected"),d.find("#select-occasion").closest(".a-button-inner").find(".a-placeholder").text(e.text()));a.giftConnection.occasionMonth&&(e=d.find('#select-occasion-month option[value\x3d"'+a.giftConnection.occasionMonth+
'"]').attr("selected","selected"),d.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(e.text()));a.giftConnection.occasionDay&&(e=d.find('#select-occasion-day option[value\x3d"'+a.giftConnection.occasionDay+'"]').attr("selected","selected"),d.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(e.text()));a.giftConnection.age&&(e=d.find('#select-occasion-age option[value\x3d"'+a.giftConnection.age+'"]').attr("selected","selected"),
d.find("#select-occasion-age").closest(".a-button-inner").find(".a-placeholder").text(e.text()));if("1"===a.giftConnection.occasionId||"2"===a.giftConnection.occasionId)d.find(".gift-connection-occasion-extra").show(),"2"===a.giftConnection.giftlistTypeId&&d.find("#select-occasion-age-row").show();a.giftConnection.hasReminder&&"0"===a.giftConnection.hasReminder&&d.find("#occasion-has-reminder-checkbox").attr("checked",!1)}(!a.giftConnection||void 0===typeof a.giftConnection.occasionId||"1"!==a.giftConnection.occasionId&&
"2"!==a.giftConnection.occasionId&&"3"!==a.giftConnection.occasionId)&&R();ga&&(void 0!==typeof pa||a.registryId in Aa)?(void 0===typeof pa&&(pa=Aa[a.registryId]),b(),d.find("#select-recipient").show(),d.find("#select-recipient-spinner").hide(),va=!0):(va=!1,void 0!==typeof pa?X():X(a.registryId))}N.find(".content-container").css("visibility","visible");qa.updatePosition(!0);k.hideSpinner(d.find(".popover-content-main"))}function y(a){var b=N,c="";if(!(0<b.find(".validateInputCharactersOnBlur.a-form-error").size())){a&&
a.data&&a.data.obfuscatedentityid&&(c+="obfuscatedEntityId\x3d"+a.data.obfuscatedentityid+"\x26");ca&&(c+="isAFN\x3d1\x26");M(b.find(".include-gift-receipt-checkbox")).is(":checked")&&(c+="includeReceipt\x3d1\x26");M(b.find(".include-gift-message-checkbox")).is(":checked")?(c+="includeMessage\x3d1\x26message\x3d"+encodeURIComponent(b.find("textarea[name\x3d'gift-message-text']").val())+"\x26",c+="maxChars\x3d"+a.data.giftData.options.maxMessageChars+"\x26",c+="maxLines\x3d"+a.data.giftData.options.maxMessageLines+
"\x26"):c+="includeMessage\x3d0\x26";c=M(b.find(".hide-prices-checkbox")).is(":checked")?c+"hidePrices\x3d1\x26":c+"hidePrices\x3d0\x26";b.find(".kindle-registration-box").is(":visible")&&(c+="isKindlePurchase\x3d1\x26");var d;if(b.find(".popover-gift-fba-wrap").is(":visible"))if(b.find(".popover-gift-amazon-wrap").is(":visible")){if((d=b.find("input[name\x3d'afn-gift-wrap']:checked").eq(0).val())&&d.length)for(c+="giftWrap\x3d"+d+"\x26",d=0;d<a.data.giftData.options.wraps.length;d++)if(b.find(".popover-gift-amazon-wrap").find(".afn-wrap-"+
d).is(":checked")){c+="currencyAmount\x3d"+a.data.giftData.options.wraps[d].priceAmount+"\x26";c+="currencyUnit\x3d"+a.data.giftData.options.wraps[d].unit+"\x26";break}}else d=M(b.find(".amazon-gift-wrap")),d.is(":checked")&&(c+="giftWrap\x3d"+d.val()+"\x26",a.data.giftData.options&&(c+="currencyAmount\x3d"+a.data.giftData.options.wraps[0].priceAmount+"\x26",c+="currencyUnit\x3d"+a.data.giftData.options.wraps[0].unit+"\x26"));else if(b.find(".popover-gift-merchant-wrap").is(":visible")&&(d=b.find("input[name\x3d'mfn-gift-wrap']:checked").eq(0).val())&&
d.length)for(c+="giftWrap\x3d"+d+"\x26",d=0;d<a.data.giftData.options.wraps.length;d++)if(b.find(".popover-gift-merchant-wrap").find(".mfn-wrap-"+d).is(":checked")){c+="currencyAmount\x3d"+a.data.giftData.options.wraps[d].priceAmount+"\x26";c+="currencyUnit\x3d"+a.data.giftData.options.wraps[d].unit+"\x26";break}if(0<H(".enable-gift-connections").length)if(b.find("#include-gift-connection-checkbox").is(":checked")){c+="includeGiftConnection\x3d1\x26";a=b.find("#select-recipient").val();c+="gcGiftlistTypeId\x3d"+
a+"\x26";if("1"===a||"2"===a)c+="gcFirstName\x3d"+b.find("#input-recipient-first-name").val()+"\x26",c+="gcLastName\x3d"+b.find("#input-recipient-last-name").val()+"\x26";d=b.find("#select-occasion").val();c+="gcOccasionId\x3d"+d+"\x26";if("1"===d||"2"===d)c+="gcMonth\x3d"+b.find("#select-occasion-month").val()+"\x26",c+="gcDay\x3d"+b.find("#select-occasion-day").val()+"\x26","1"===d&&"2"===a&&(c+="gcAge\x3d"+b.find("#select-occasion-age").val()+"\x26"),c+="gcHasReminder\x3d"+(b.find("#occasion-has-reminder-checkbox").is(":checked")?
"1":"0")+"\x26"}else c+="includeGiftConnection\x3d0\x26";(a=H("input#executionId").val())&&(c+="executionId\x3d"+a+"\x26");a=(new Date).getTime();c+="isClientTimeBased\x3d"+H("input[name\x3d'useCtb']").val()+"\x26returnjson\x3d1\x26isDecoupleSPC\x3d1\x26hasWorkingJavascript\x3d1\x26returnFullHTML\x3d1\x26cachebuster\x3d"+a;f.isSPP()&&(qa.hide(),a=H("#setOrderingPrefsCheckbox"),a.length&&a.is(":checked")&&(c+="\x26saveAsDefaultsSelected\x3d1"));n.show();a=f.setAjaxTransitionHeader({"x-amz-checkout-page":"spc",
"x-amz-checkout-transition":"ajax"});H.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-gift.html",data:c,dataType:"text",async:!0,cache:!1,headers:a,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,c,d){d.getResponseHeader("x-amz-checkout-page")?(f.isSPP()||b.find(".a-button-close").trigger("click"),f.ajaxUpdatePage(a,c,d)):(a=m.jsonify(a),f.redirect(a))},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}}function A(a,b){a.find(".fba-wrap-checkbox").hide();
a.find(".large-preview").hide();b.show();b.find(".afn-wrap-copy").remove()}function z(){var a=N,b=a.find(".popover-gift-amazon-wrap").is(":visible"),c=M(a.find(".amazon-gift-wrap")),d=M(a.find(".afn-wrap-none")),e=M(a.find(".hide-prices-checkbox"));if(c.is(":checked")||!d.is(":checked")&&b)e.attr("checked",!0),e.attr("disabled",!0),a.find(".hide-prices-note").show();else if(c.not(":checked")||d.is(":checked")&&b)e.attr("checked",!0),e.attr("disabled",!1),a.find(".hide-prices-note").hide()}function C(a){var b=
N,c=M(b.find(".include-gift-receipt-checkbox")),b=M(b.find(".mfn-hide-prices-checkbox"));a?(ca&&!c.is(":checked")&&c.attr("checked",!0).trigger("change"),ca||b.is(":checked")||b.attr("checked",!0).trigger("change")):(ca&&c.is(":checked")&&c.removeAttr("checked").trigger("change"),!ca&&b.is(":checked")&&b.removeAttr("checked").trigger("change"))}function w(a){var b=N,c=M(b.find(".include-gift-receipt-checkbox")),b=M(b.find(".mfn-hide-prices-checkbox"));a?(C(!0),ca?c.attr("disabled","disabled"):b.attr("disabled",
"disabled")):ca?c.removeAttr("disabled"):b.removeAttr("disabled")}function u(a){var b=M(N.find(".include-gift-message-checkbox"));a?(b.is(":checked")||b.attr("checked",!0).trigger("change"),q(!1),v()):(b.is(":checked")&&b.removeAttr("checked").trigger("change"),l())}function q(a){var b=N,c=b.find(".no-message-warning"),d=b.find(".no-receipt-warning"),e=b.find("textarea[name\x3d'gift-message-text']"),b=b.find(".message-remaining-text");a&&!d.is(":visible")?(e.addClass("gift-message-warning"),b.hide(),
c.show()):(e.removeClass("gift-message-warning"),c.hide(),b.show())}function v(){var a=N,b=a.find("textarea[name\x3d'gift-message-text']"),a=a.find(".gift-message-label");b.removeClass("gift-message-inactive");a.removeClass("a-color-secondary")}function l(){var a=N,b=a.find("textarea[name\x3d'gift-message-text']"),a=a.find(".gift-message-label");b.addClass("gift-message-inactive");a.addClass("a-color-secondary")}function r(){var b=N,c=M(b.find(".include-gift-message-checkbox")),d=b.find(".gift-msg-on-card"),
e=b.find(".gift-msg-on-receipt"),f=a.trim(b.find(".gift-message-default-placeholder").text()),l=a.trim(b.find(".gift-message-with-wrap-placeholder").text()),g=b.find("textarea"),h=!1;b.find(".amazon-gift-wrap").each(function(){M(H(this)).is(":checked")&&(h=!0)});b.find(".afn-gift-wrap").each(function(){M(H(this)).is(":checked")&&(h=!0)});b.find(".mfn-gift-wrap").each(function(){M(H(this)).is(":checked")&&(h=!0)});h?(e.hide(),d.show(),g.attr("placeholder",l),ca&&(u(!0),wa&&c.attr("disabled","disabled"))):
(d.hide(),ca&&e.show(),g.attr("placeholder",f),c.removeAttr("disabled"))}function K(){var a=N,b=M(a.find(".include-gift-message-checkbox")),a=a.find("textarea[name\x3d'gift-message-text']");!ta&&ca&&(b.is(":checked")&&0<a.val().length?q(!1):q(!0))}function B(){var a=N,b=M(a.find(".include-gift-receipt-checkbox")),c=a.find(".no-receipt-warning"),a=a.find(".no-message-warning");b.is(":checked")?(c.hide(),wa||u(!0)):(a.hide(),c.show(),u(!1))}function F(a){a=N;var b=M(a.find(".include-gift-receipt-checkbox")),
b=ca&&b.is(":checked"),c=M(a.find(".mfn-hide-prices-checkbox")),c=!ca&&c.is(":checked");b||c?(E(),a.find(".kindle-reg-msg-your-account").hide(),a.find(".kindle-reg-msg-another-account").show()):(T(),w(!1),a.find(".kindle-reg-msg-another-account").hide(),a.find(".kindle-reg-msg-your-account").show())}function Q(a){a=N;var b=!1;M(a.find(".include-gift-message-checkbox")).is(":checked")&&(b=!0);var c=!1;a.find(".amazon-gift-wrap").each(function(){M(H(this)).is(":checked")&&(c=!0)});a.find(".afn-gift-wrap").each(function(){M(H(this)).is(":checked")&&
(c=!0)});a.find(".mfn-gift-wrap").each(function(){M(H(this)).is(":checked")&&(c=!0)});(b||c)&&C(!0);b&&wa||c?w(!0):w(!1)}function L(a,b,c){var d=N;na=a;ra=b;if(a=d.find("textarea[name\x3d'gift-message-text']")){b=c?a.val().length:t.unescape(encodeURIComponent(a.val())).length;fa&&!ta&&ca&&(0<b?q(!1):q(!0));var e=a.val().split("\n").length;c=na-b;e=ra-e;!fa&&0<b&&d.find(".include-gift-message-checkbox").not(":checked")&&d.find(".include-gift-message-checkbox").attr("checked",!0);a=a.val().split("\n");
for(var l in a)24<a[l].length&&(e=0===a[l].length%24?e-(Math.floor(a[l].length/24)-1):e-Math.floor(a[l].length/24));d.find(".popover-gift-center .remainder-count").hide();(-1>c?d.find(".popover-gift-center .remaining-char-over-multiple").show():0>c?d.find(".popover-gift-center .remaining-char-over-single").show():1===c?d.find(".popover-gift-center .remaining-char-single").show():d.find(".popover-gift-center .remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(c));(-1>e?d.find(".popover-gift-center .remaining-line-over-multiple").show():
0>e?d.find(".popover-gift-center .remaining-line-over-single").show():1===e?d.find(".popover-gift-center .remaining-line-single").show():d.find(".popover-gift-center .remaining-line-multiple").show()).find(".lines-remaining").html(Math.abs(e));if(0>c||0>e)f.isSPP()?(d.find(".set-gift-options-button").addClass("aok-hidden"),d.find(".set-gift-options-button-disabled").removeClass("aok-hidden")):(d.find(".set-gift-options-button").hide(),d.find(".set-gift-options-button-disabled").show()),0>c?(d.find(".gift-char-limit-error").find(".char-limit-error").html(na),
d.find(".current-blocker-content").html(d.find(".gift-char-limit-error").html())):0>e&&(d.find(".gift-line-limit-error").find(".line-limit-error").html(ra),d.find(".current-blocker-content").html(d.find(".gift-line-limit-error").html()));-1<c&&-1<e&&(f.isSPP()?(d.find(".set-gift-options-button").removeClass("aok-hidden"),d.find(".set-gift-options-button-disabled").addClass("aok-hidden")):(d.find(".set-gift-options-button").show(),d.find(".set-gift-options-button-disabled").hide()))}}function J(a){a.stopPropagation();
var b=N;b.find(".popover-content-main").fadeOut(100,function(){b.find(".popover-content-gift-wrap-preview .gift-wrap-preview-image").attr("src",a.data.imageURL);b.find(".popover-content-gift-wrap-preview").fadeIn(100)});var c=b.find(".popover-content-gift-wrap-preview .back-to-gift-options-button");c.unbind("click").bind("click",P);h.bindActionEnterKeyOnButton(c);Ca=!0}function P(a){Ca=!1;var b=N;a?b.find(".popover-content-gift-wrap-preview").fadeOut(100,function(){b.find(".popover-content-main").fadeIn(100)}):
setTimeout(function(){b.find(".popover-content-gift-wrap-preview").hide();b.find(".popover-content-main").show()},500)}function S(a){var b=N,c=!1;H(".amazon-gift-wrap").each(function(){M(H(this)).is(":checked")&&(c=!0)});H(".afn-gift-wrap").each(function(){M(H(this)).is(":checked")&&(c=!0)});H(".mfn-gift-wrap").each(function(){M(H(this)).is(":checked")&&(c=!0)});if(c)E(),U();else if(M(b.find(".hide-prices-checkbox")).is(":disabled"))aa();else if(a.is("input[type\x3dcheckbox]")&&(a.closest(".a-checkbox").hasClass("hide-prices-checkbox")||
a.hasClass("hide-prices-checkbox")))a.is(":checked")?E():T();else if(f.isSPP())(b=a.closest(".a-radio"))&&a.is(":checked")&&(b.hasClass("kindle-reg-radio-your-account")?T():b.hasClass("kindle-reg-radio-another-account")&&E());else if(a.hasClass("kindle-reg-radio-another-account")||a.hasClass("kindle-reg-radio-your-account"))b.find(".kindle-reg-radio-your-account").is(":checked")?T():E()}function E(){var a=N,b=M(a.find(".hide-prices-checkbox"));b.is(":checked")&&!f.isSPP()||b.attr("checked","checked");
M(a.find(".kindle-reg-radio-your-account")).is(":checked")&&M(a.find(".kindle-reg-radio-another-account")).attr("checked",!0)}function T(){var a=N,b=M(a.find(".hide-prices-checkbox"));b.is(":checked")&&b.removeAttr("checked");M(a.find(".kindle-reg-radio-another-account")).is(":checked")&&M(a.find(".kindle-reg-radio-your-account")).attr("checked",!0)}function U(){var a=N;M(a.find(".hide-prices-checkbox")).attr("disabled","true");M(a.find(".kindle-reg-radio-another-account")).attr("disabled",!0);M(a.find(".kindle-reg-radio-your-account")).attr("disabled",
!0);a.find(".hide-prices-merchant-cant").is(":visible")||a.find(".hide-prices-note").show()}function aa(){var a=N;M(a.find(".hide-prices-checkbox")).removeAttr("disabled");M(a.find(".kindle-reg-radio-another-account")).removeAttr("disabled");M(a.find(".kindle-reg-radio-your-account")).removeAttr("disabled");a.find(".hide-prices-note").hide()}function da(a){var b=h.getPosition(a,"#",2),c=h.getPosition(a,"#",3);return"60"===a.substring(b+1,c)}function Z(b,c,d){var e=W(),f,l;e?(f=d.find('li[class\x3d"a-carousel-card gift-wrap noshi-wrap none-wrap"]'),
l=d.find(".carousel-gift-wrap").find("ol")):(f=d.find("."+c+"-wrap-template"),l=d.find("ul.allGiftWrapList"));e&&a.trigger("checkout:gift:removeEmptyCarouselCards",l);var g=(d.data("lineitemid")||b.obfuscatedEntityId||"").replace(":","-");"afn"!==c||e||(l.find('li[class!\x3d"none-wrap gift-wrap noshi-wrap"]').remove(),H("#giftwrap-carousel-wrap-holder-"+g).css("width",90*(b.options.wraps.length+1)),H("#giftwrap-carousel-wrap-pane-"+g).css("width",360));for(var h=N,k=h.find(".larger-image-link-carousel-template"),
p=0;p<b.options.wraps.length;p++){var m=f.clone(!0).removeClass(c+"-wrap-template").addClass(c+"-wrap-copy"),q=k.clone(!0).removeClass("larger-image-link-carousel-template").addClass("larger-image-link-carousel-"+p),n=c,u=b,v=p,w=m,A=q,y=u.options.wraps[v].id;w.find("input").addClass(n+"-wrap-"+v).val(y);w.find("label").attr("for",n+"-wrap-"+v);y=u.options.wraps[v].description;w.find("."+n+"-wrap-description").html(y);y=u.options.wraps[v].price;w.find("."+n+"-wrap-price").html(y);(u=u.options.wraps[v].imageurl)&&
u.length?(w.find("."+n+"-image").attr("src",u).show(),n=w.find(".larger-image-link"),n.show(),n.unbind("click").bind("click",{imageURL:u},J),A.unbind("click").bind("click",{imageURL:u},J),A.find("a").unbind("click").bind("click",{imageURL:u},J)):"mfn"!==n||W()||(w.find(".a-span3").hide(),w.find(".a-span9").addClass("a-span12").removeClass("a-span9"),w.find(".a-color-price").removeClass("wrap-price"));if("afn"===c){v=b;A=p;w=g;n=l;u=h;y=v.options.wraps[A].id;m.data("giftwrap-id",y);m.data("wrap-no",
A);if(v.selected.wrap===y){n.find("li.none-wrap").find("img").removeClass("selected-giftwrap-image");m.find("img").addClass("selected-giftwrap-image");var v=m.find("img").attr("src"),U=H("#giftwrap-option-preview-imagearea-image-"+w);U.find("img").attr("src",v);U.removeClass("aok-hidden");H("#giftwrap-option-preview-imagearea-default-"+w).addClass("aok-hidden");S(m.find("input"));z();da(y)&&ba(w);q.removeClass("aok-hidden");q.addClass("selectedWrapLargeLink")}W()?(w=da(y)?"gift-wrap":"noshi-wrap",
m.removeClass(w).removeClass("none-wrap"),n.append(m.show())):(w=da(y)?"\x3cli class\x3dnoshi-wrap\x3e":"\x3cli class\x3dgift-wrap\x3e",n.append(H(w).append(m.show())));m=u.find("#carousel-larger-image-div");m.find(".larger-image-link-carousel-"+A).length||m.append(q.show())}}d.find("."+c+"-wrap-checkbox").removeAttr("checked");b.selected&&b.selected.isWrapped?d.find("input[value\x3d'"+b.selected.wrap+"']").attr("checked",!0):M(d.find("."+c+"-wrap-none")).attr("checked",!0);e&&a.trigger("checkout:gift:adjustCarouselInitial",
b,d)}function W(){return f.isSPP()&&H("input[name\x3dsppGiftPopoverWithCarousel]").length}function V(a,b,c){for(var d=c.find("."+b+"-wrap-template"),e=0;e<a.options.wraps.length;e++){var l=d.clone(!0).removeClass(b+"-wrap-template").addClass(b+"-wrap-copy"),g=a.options.wraps[e].id;l.find("input").addClass(b+"-wrap-"+e).val(g);l.find("label").attr("for",b+"-wrap-"+e);g=a.options.wraps[e].description;l.find("."+b+"-wrap-description").html(g);g=a.options.wraps[e].price;l.find("."+b+"-wrap-price").html(g);
if((g=a.options.wraps[e].imageurl)&&g.length){var h=l.find("."+b+"-image");f.isSPP()&&h.removeClass("hidden");h.attr("src",g).show();h=l.find(".larger-image-link");f.isSPP()&&h.removeClass("hidden");h.show();h.unbind("click").bind("click",{imageURL:g},J)}else l.find(".a-span3").hide(),l.find(".a-span9").addClass("a-span12").removeClass("a-span9"),l.find(".a-color-price").removeClass("wrap-price");f.isSPP()&&l.removeClass("hidden");l.insertAfter(d).show()}c.find("."+b+"-wrap-checkbox").removeAttr("checked");
a.selected&&a.selected.isWrapped?c.find("input[value\x3d'"+a.selected.wrap+"']").attr("checked",!0):M(c.find("."+b+"-wrap-none")).attr("checked",!0)}function ea(){N.find("#include-gift-connection-checkbox").attr("checked",!0)}function x(){if(N.find(".include-gift-connection-checkbox").not(":checked")){var a=N;a.find(".gift-connection-recipient-extra").hide();var b;b=a.find('#select-recipient option[value\x3d"0"]').attr("selected","selected");a.find("#select-recipient").closest(".a-button-inner").find(".a-placeholder").text(b.text());
a.find("#input-recipient-first-name").val("");a.find("#input-recipient-last-name").val("");R()}}function Y(a){for(var b=N,c=0;c<ga.length;c++)if(a&&a===ga[c].value&&ga[c].bMonth&&ga[c].bDay){var d;d=b.find('#select-occasion-month option[value\x3d"'+ga[c].bMonth+'"]').attr("selected","selected");b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(d.text());d=b.find('#select-occasion-day option[value\x3d"'+ga[c].bDay+'"]').attr("selected","selected");b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(d.text())}}
function R(){var a=N,b=a.find("#popover-gift-connection #select-recipient").find(":selected").val();if(""!==b&&"0"!==b&&("1"!==b&&"2"!==b||a.find("#input-recipient-first-name").val()||a.find("#input-recipient-last-name").val()))a.find("#select-occasion").prop("disabled",!1),a.find("#popover-gift-connection-occasion .a-touch-select").css({opacity:1});else{b=N;b.find(".gift-connection-occasion-extra").hide();var c;c=b.find('#select-occasion option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion").closest(".a-button-inner").find(".a-placeholder").text(c.text());
c=b.find('#select-occasion-month option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(c.text());c=b.find('#select-occasion-day option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(c.text());c=b.find('#select-occasion-age option[value\x3d"-1"]').attr("selected","selected");b.find("#select-occasion-age").closest(".a-button-inner").find(".a-placeholder").text(c.text());
b.find("#occasion-has-reminder-checkbox").attr("checked",!0);a.find("#select-occasion").prop("disabled",!0);a.find("#popover-gift-connection-occasion .a-touch-select").css({opacity:.5})}}function G(a,b){var c=N;"1"===a&&"2"===b?c.find("#select-occasion-age-row").show():c.find("#select-occasion-age-row").hide()}function ha(a){a=N;var b=a.find("#popover-gift-connection #select-recipient").find(":selected").val(),c=a.find("#popover-gift-connection #select-occasion").find(":selected").val();!b||"1"!==
b&&"2"!==b?(a.find(".gift-connection-recipient-extra").hide(),"1"===c&&b&&Y(b)):a.find(".gift-connection-recipient-extra").show();G(c,b);R()}function ja(a){a=N;var b=a.find("#popover-gift-connection #select-occasion").find(":selected").val(),c=a.find("#popover-gift-connection #select-recipient").find(":selected").val();!b||"1"!==b&&"2"!==b?a.find(".gift-connection-occasion-extra").hide():("1"===b&&c&&"1"!==c&&"2"!==c&&Y(c),a.find(".gift-connection-occasion-extra").show());G(b,c)}function X(a){var c=
N,d="/gp/buy/pipeline/handlers/list-of-giftlists.html?escape\x3d0";ga&&(d+="\x26mappingOnly\x3d1");a&&(d+="\x26fromRegistryIds\x3d"+a);H.ajax({type:"POST",url:d,dataType:"json",async:!0,cache:!1,timeout:5E3,success:function(d){c.find("#select-recipient").hide();!ga&&d.options&&0<d.options.length&&(ga=d.options);a&&d.registryIdMapping?(Aa[a]=d.registryIdMapping[a],pa=d.registryIdMapping[a]):a&&(Aa[a]=void 0);ga&&b();c.find("#select-recipient").show();c.find("#select-recipient-spinner").hide();va=!0},
error:function(){c.find("#select-recipient").show();c.find("#select-recipient-spinner").hide();va=!0}})}function oa(b,c){var d=W(),e=c.lineItemId,f=W()?c.currentTab:b.data("current-tab"),l=H("#popover-gift-options-wrapper-"+e).data("active-tab");if(f!==l){b.parent().find(".selected-giftwrap-tab").removeClass("selected-giftwrap-tab");b.addClass("selected-giftwrap-tab");l=H("#giftwrap-carousel-wrap-holder-"+e);d||l.css("left",0);var g=H("#giftwrap-carousel-wrap-holder-"+e+" li");d?(a.trigger("checkout:gift:changeCarouselWrapOptions",
l,f,e),a.trigger("checkout:gift:adaptCarouselSPCPanel",e,f)):"all"===f?g.show():(g.hide(),g.filter("."+{"gift-wrap":"gift-wrap",noshi:"noshi-wrap"}[f]).show());H("#popover-gift-options-wrapper-"+e).data("active-tab",f);g.find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");g.filter(".none-wrap").find("img").addClass("selected-giftwrap-image");H("#giftwrap-option-preview-imagearea-default-"+e).removeClass("aok-hidden");H("#giftwrap-option-preview-imagearea-image-"+e).addClass("aok-hidden");
d=H("#allGiftWrapList-"+e).find(".none-wrap").find("input");f=H(".selectedWrapLargeLink");d.prop("checked",!0);d.val("").change();sa(e);f.length&&(f.addClass("aok-hidden"),f.removeClass("selectedWrapLargeLink"))}}function ia(a,b,c){c.$event.preventDefault();a=b.lineItemId;b=parseInt(H("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);0>b&&(b=b+90+"px",H("#giftwrap-carousel-wrap-holder-"+a).css("left",b))}function la(a,b,c){c.$event.preventDefault();a=b.lineItemId;var d=H("#allGiftWrapList-"+a);
b=d.find("li").size();c=d.find("li.gift-wrap").size();var d=d.find("li.noshi-wrap").size(),e=H("#popover-gift-options-wrapper-"+a).data("active-tab"),f;"all"===e?f=b:"gift-wrap"===e?f=c:"noshi"===e&&(f=d);b=parseInt(H("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);b>-90*(f-4)&&(b=b-90+"px",H("#giftwrap-carousel-wrap-holder-"+a).css("left",b))}function ma(a,b){var c=b.lineItemId;H("#allGiftWrapList-"+c).find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");a.find(".afn-image").addClass("selected-giftwrap-image");
var d=a.parent();d.hasClass("noshi-wrap")&&!d.hasClass("none-wrap")?(ba(c),H("#afn-message-span-"+c).find("input").prop("checked",!1)):(sa(c),H("#afn-message-span-"+c).find("input").prop("checked",!0));var e=a.data("giftwrap-id"),f=a.find("input"),l=a.data("wrap-no");f.prop("checked",!0);f.val(e).change();e=H("#giftwrap-option-preview-imagearea-default-"+c);c=H("#giftwrap-option-preview-imagearea-image-"+c);f=H(".selectedWrapLargeLink");l=H(".larger-image-link-carousel-"+l);d.hasClass("none-wrap")?
(e.removeClass("aok-hidden"),c.addClass("aok-hidden"),f.length&&(f.addClass("aok-hidden"),f.removeClass("selectedWrapLargeLink"))):(d=a.find("img").attr("src"),c.find("img").attr("src",d),e.addClass("aok-hidden"),c.removeClass("aok-hidden"),f.length&&(f.addClass("aok-hidden"),f.removeClass("selectedWrapLargeLink")),l.length&&(l.addClass("selectedWrapLargeLink"),l.removeClass("aok-hidden")))}function ua(a,b){var c=b.lineItemId,d=H("#giftwrap-option-preview-imagearea-default-"+c),c=H("#giftwrap-option-preview-imagearea-image-"+
c);if(a.hasClass("none-wrap"))d.removeClass("aok-hidden"),c.addClass("aok-hidden");else{var e=a.find("img").attr("src");c.find("img").attr("src",e);d.addClass("aok-hidden");c.removeClass("aok-hidden")}}function ka(a,b){var c=b.lineItemId,d=H("#giftwrap-option-preview-imagearea-default-"+c),e=H("#giftwrap-option-preview-imagearea-image-"+c);H("#allGiftWrapList-"+c).find(".selected-giftwrap-image").parentsUntil("ul","li").hasClass("none-wrap")?(d.removeClass("aok-hidden"),e.addClass("aok-hidden")):
(c=H("#allGiftWrapList-"+c).find(".selected-giftwrap-image").attr("src"),e.find("img").attr("src",c),d.addClass("aok-hidden"),e.removeClass("aok-hidden"))}function sa(a){var b=H("#afn-message-span-"+a+", #gift-message-"+a);H("#gift-message-noshi-warning-"+a).addClass("aok-hidden");b.removeClass("disable-message-area").addClass("enable-message-area");b.find("input").removeAttr("disabled");b.find("textarea").removeAttr("disabled")}function ba(a){var b=H("#afn-message-span-"+a+", #gift-message-"+a);
H("#gift-message-noshi-warning-"+a).removeClass("aok-hidden");b.removeClass("enable-message-area").addClass("disable-message-area");b.find("input").attr("disabled","disabled");b.find("textarea").attr("disabled","disabled")}var H=a.$;if(!H("html").hasClass("a-ie6")){var na,ra,N,qa,Ca=!1,fa=!1,ta=!0,ca=!0,ga,va=!1,Aa={},pa,wa=!1;a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("gift-")&&(f.isSPP()&&p.increaseCount("checkout:spp-revieworder:gift_pop_cancel_sec",
1),Ca&&P(),fa&&(a=N,a.find(".gift-msg-on-card").hide(),a.find(".popover-gift-warning").hide(),a.find(".message-remaining-text").show(),M(a.find(".amazon-gift-wrap")).removeAttr("checked"),u(!1),a.find('input[type\x3d"checkbox"]').removeAttr("disabled")))});a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("gift-")){N=a.popover.$popover;qa=a.popover;0<N.find(".include-gift-receipt-checkbox").length&&(fa=!0);k.showSpinner(N.find(".popover-content-main"),!1,qa);
N.find(".content-container").css("visibility","hidden");a="returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isDecoupleSPC\x3d1\x26cachebuster\x3d"+(new Date).getTime();try{var b=qa.data;if(b)a+="\x26obfuscatedEntityId\x3d"+b;else throw{name:"MissingData",message:"lineItemId is undefined"};}catch(c){t.ueLogError&&t.ueLogError(c,{logLevel:"FATAL",attribution:"gift-popover",message:"[No lineItemId to open the gift-popover with]. "})}H.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/gift-select-content.html",
data:a,dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},dataFilter:function(a){return m.jsonify(a)},success:function(a,b,c){a&&a.conductoraction&&a.conductoraction.url&&f.redirect(a);null!==a?d(a,b,c):f.ajaxRedirect()},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}});a.on("a:popover:beforeShow",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-gift"))b=N,a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text()),
a.popover.updatePosition(!0);else if(a.popover&&a.popover.$popover){var b=a.popover.$popover;a=b.find(".validateInputCharactersOnBlur.a-form-error");0<a.size()&&a.removeClass("a-form-error");b=b.find("#onblur-character-validation-error-gift-message-text");0<b.size()&&b.remove()}});var xa={enforceSelectorParity:S,enforceGiftReceiptParity:Q,enforceHidePriceParity:F,disableHidePrice:z,toggleMessageBoxDisplay:r,toggleEmptyMsgWarning:K,toggleNoReceiptWarning:B,includeGiftConnection:ea,clearGiftConnection:x,
toggleGiftConnectionRecipientArea:ha,toggleGiftConnectionOccasionArea:ja,updateGiftOptionsTabSelection:oa,updateCarouselOnLeftClick:ia,updateCarouselOnRightClick:la,updateSelectedGiftWrap:ma,updatePreviewImageOnMouseEnter:ua,updatePreviewImageOnMouseLeave:ka},M=c.getInput;a.declarative("gift-popover-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(xa[b[c]])xa[b[c]](a.$target,a.data)});a.declarative("gift-popover-element","click mouseenter mouseleave",
function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(xa[b[c]])xa[b[c]](a.$currentTarget,a.data,a)});a.declarative("spc-update-gift-options-tab-selection","click",function(a){var b=a.$target.parents("li");b.attr("data",a.data);oa(b,a.data)});a.on("checkout:reload:spc",e);a.on("checkout:reload:spp-revieworder",e)}});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor",
"checkout-general-utils","page-detector","client-side-metrics").register("concealment-popover-controller",function(a,n,k,m,f,h,g,p){function c(){y("#spc-orders").find(".concealment-widgets-desktop").removeClass("no-js-hide");a.defer(function(){y("#spc-orders").find(".concealment-popover-link").each(function(){y(this).data("action")&&y(this).removeAttr("href").attr("tabindex",0)})})}function b(a){return a.is("input")?a:a.find("input")}function e(a){var c=A;c.find(".fake-label").each(function(){y(this).unbind("click").bind("click",
function(){y(this).closest(".popover-checkbox").find("input").trigger("click")})});a&&a.item&&a.item.title&&c.find(".concealment-item-title").html(a.item.title);if(a&&a.obfuscatedEntityId){var e=c.find(".set-concealment-options-button input");e.unbind("click").bind("click",{obfuscatedentityid:a.obfuscatedEntityId,concealmentData:a,quantity:a.quantity},d);h.bindActionEnterKeyOnButton(e)}C=a&&a.item&&a.item.isAmazonFulfilled;a&&a.selected&&(e=b(c.find(".conceal-item-checkbox")),a.selected.concealItem?
e.attr("checked",!0):e.removeAttr("checked"));A.find(".content-container").css("visibility","visible");z.updatePosition(!0);k.hideSpinner(c.find(".popover-content-main"))}function d(a){var c=A,d="";a&&a.data&&a.data.obfuscatedentityid&&(d+="obfuscatedEntityId.0\x3d"+a.data.obfuscatedentityid+"\x26");a&&a.data&&a.data.quantity&&(d+="quantity.0\x3d"+a.data.quantity+"\x26");var e="";a&&a.data&&a.data.concealmentData&&a.data.concealmentData.saveConcealmentRefTag&&(e=a.data.concealmentData.saveConcealmentRefTag);
var g="";a&&a.data&&a.data.concealmentData&&a.data.concealmentData.cancelConcealmentRefTag&&(g=a.data.concealmentData.cancelConcealmentRefTag);(a=b(c.find(".conceal-item-checkbox")).is(":checked"))?(C&&(d+="isAFN.0\x3d1\x26"),d+="includeReceipt.0\x3d1\x26includeMessage.0\x3d1\x26",d+="message.0\x3d"+encodeURIComponent(y("input[name\x3d'concealment-item-message']").val())+"\x26",d+="hidePrices.0\x3d0\x26",d+="saveOnly\x3d1",d+="ref\x3d"+e+"\x26"):d+="ref\x3d"+g+"\x26";var h=y("input#executionId").val();
h&&(d+="executionId\x3d"+h+"\x26");h="/gp/buy/gift/handlers/save-all.html/ref\x3d";h=a?h+e:h+g;f.isSPP()&&(c.find(".a-button-close").trigger("click"),e=y("#setOrderingPrefsCheckbox"),e.length&&e.is(":checked")&&(d+="\x26saveAsDefaultsSelected\x3d1"));n.show();y.ajax({type:"POST",url:h,data:d,dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"},contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,b,d){d.getResponseHeader("x-amz-checkout-page")?
(f.isSPP()||c.find(".a-button-close").trigger("click"),f.ajaxUpdatePage(a,b,d)):(a=m.jsonify(a),f.redirect(a))},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}var y=a.$;if(!y("html").hasClass("a-ie6")){var A,z,C=!0;a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("concealment-")&&(f.isSPP()&&p.increaseCount("checkout:spp-revieworder:concealment_pop_cancel_sec",1),b(A.find(".conceal-item-checkbox")).removeAttr("checked"))});a.on("a:popover:show",function(a){if(a.popover&&
a.popover.name&&0===a.popover.name.indexOf("concealment-")){A=a.popover.$popover;z=a.popover;k.showSpinner(A.find(".popover-content-main"),!1,z);A.find(".content-container").css("visibility","hidden");a="returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isDecoupleSPC\x3d1\x26cachebuster\x3d"+(new Date).getTime();try{var b=z.data.lineItemEntityId;if(b)a+="\x26obfuscatedEntityId\x3d"+b;else throw{name:"MissingData",message:"lineItemId is undefined"};var c=z.data.quantity;if(c)a+="\x26quantity\x3d"+c;
else throw{name:"MissingData",message:"quantity is undefined"};}catch(d){t.ueLogError&&t.ueLogError(d,{logLevel:"FATAL",attribution:"concealment-popover",message:"[Data missing to open the concealment-popover]. "})}b=z.data.ref;y.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/concealment-select-content.html/ref\x3d"+b,data:a+("\x26ref\x3d"+b),dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},dataFilter:function(a){return m.jsonify(a)},success:function(a,b,c){a&&a.conductoraction&&
a.conductoraction.url&&f.redirect(a);null!==a?e(a,b,c):f.ajaxRedirect()},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}});a.on("a:popover:beforeShow",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-concealment")){var b=A;a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text());a.popover.updatePosition(!0)}});var w={};a.declarative("concealment-popover-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:
a.data.onChange||[];for(var c=0;c<b.length;c++)if(w[b[c]])w[b[c]](a.$target,a.data)});a.declarative("concealment-popover-element","click mouseenter mouseleave",function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(w[b[c]])w[b[c]](a.$currentTarget,a.data,a)});a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c)}});"use strict";r.when("A","page-conductor","scroll-controller","page-detector","client-side-metrics",
"button-blocker").register("gold-box-controller",function(a,n,k,m,f,h){function g(){a.defer(c);a.defer(b)}var p=a.$;if(!p("html").hasClass("a-ie6")){var c=function(){var a=p("#goldbox-countdown"),b=p("#spc-orders");b&&0!==b.length||(b=p("#spclite-items-block"));b=b.find("input[name\x3dgoldboxexpirelefttime]");if(0!==b.length){if(1<b.size()){var c=parseInt(b.attr("data-timeleftms"),10),g=b;p.each(b,function(){var a=p(this),b=parseInt(a.attr("data-timeleftms"),10);b<c&&(g=a,c=b)});b=g}var h=parseFloat(b.attr("data-pagestarttime")),
m=parseFloat(b.attr("data-timeleftms")/1E3);if(!(isNaN(h)||isNaN(m)||0>=m)){var w=(new Date).getTime(),u=a.find("span[data-timefield\x3dminute]"),q=a.find("span[data-timefield\x3dsecond]"),v=t.setInterval(function(){var b=(new Date).getTime();m-=(b-w)/1E3;w=b;if(0>m&&v)q.html("00"),t.clearInterval(v),v=null,n.isSPP()&&f.increaseCount("checkout:spp-revieworder:deal_expired",1),p("#gold-box-modal-launcher").trigger("click"),k.scrollToTop(),k.toggleScrollOff();else{var b=Math.floor(m/60%60),c=Math.floor(m%
60),c=10>c?"0"+c:c;u.html(b);q.html(c);a.is(":visible")||a.show()}},1E3);n.isSPP()&&f.increaseCount("checkout:spp-revieworder:deal_countdown",1)}}},b=function(){var a=p("#gold-box-button-blocker");1===a.length&&h.show("place-order-gold-box-blocker",a.attr("data-blocker-message"))};a.on("checkout:reload:spc",g);a.on("checkout:reload:spclite",g);a.on("checkout:reload:spp-revieworder",g)}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","currency-formatter","page-detector",
"client-side-metrics","pay-rewards-currency").register("inline-points-controller",function(a,n,k,m,f,h,g,p){function c(){w("#spc-points-input")&&w("#spc-points-input").data("points-used")&&(w("#points-applied").show(),w("#inline-points-button").hide());w("#inline-points-register")&&w("#inline-points-register").removeAttr("href");w("#spc-loyalty-points-input")&&w("#spc-loyalty-points-input").val()&&(w("#loyalty-points-applied").show(),w("#loyalty-points-button").hide());w("#spc-points-input")&&w("#spc-points-input").hasClass("show-currency-input-widget-new")&&
w("#spc-points-input").each(function(b,c){var d=a.$(c),e={$element:d,maxAmount:d.data("max-dollar-amount")},f={$element:a.$("#inline-raw-points"),decimalPlaces:d.data("decimal-places"),ratio:d.data("conversion-ratio")},g=d.data("country-code"),g=p.getCurrencyFormatByCountryCode(g);p.initializeInlineFormatting(e,f,g);w(document).delegate("#spc-points-input","keydown",function(a){if(d.data("points-used")!==d.val){a=w("#inline-points-button");var b=!1;a.is("span")&&(b=!0);var c=a.find("span.apply"),
e=a.find("span.change");w("#points-applied").hide();d.data("points-used")?(c.hide(),e.show()):(c.show(),e.hide());b?a.addClass("display-inline-block"):a.show()}})})}function b(a,b){a.preventDefault();if(e(b)){m.isSPP()?(n.blockAllActions(),n.showTransitionInContainer(w("#payment"))):n.show();var c,d,f={"x-amz-checkout-page":"spc"};if(b)d=w("#loyalty-points-hidden-fields"),c="/gp/buy/spc/handlers/update-loyalty-points.html/ref\x3dox_spc_points_edit",d="\x26jpPointsPaymentInstrumentId\x3d"+encodeURIComponent(d.find("input[name\x3d'jpPointsPaymentInstrumentId']").val())+
"\x26jpPointsCustomerRequestedAmount\x3d"+w("#spc-loyalty-points-input").val()+"\x26jpPointsConversionRate\x3d"+d.find("input[name\x3d'jpPointsConversionRate']").val()+"\x26jpPointsBaseCurrencyCode\x3d"+d.find("input[name\x3d'jpPointsBaseCurrencyCode']").val()+"\x26jpPointsTargetCurrencyCode\x3d"+d.find("input[name\x3d'jpPointsTargetCurrencyCode']").val()+"\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+w("input[name\x3duseCtb]").val();else{f=m.setAjaxTransitionHeader(f);d=w("#inline-points-hidden-fields");
var g=d.find("input[name\x3d'useGCBalance']").val();c="/gp/buy/pipeline/handlers/update-reward-points.html/ref\x3d"+(m.isSPP()?"chk_pay_addswp_coll":"ox_pay_page_points_apply");d="paymentMethodId\x3d"+d.find("input[name\x3d'paymentMethodId']").val()+"\x26paymentMethodType\x3d"+d.find("input[name\x3d'paymentMethodType']").val()+"\x26rewardAccountId\x3d"+d.find("input[name\x3d'rewardAccountId']").val()+"\x26rewardAccountAmount\x3d"+w("#spc-points-input").val()+"\x26rewardAccountRate\x3d"+d.find("input[name\x3d'rewardAccountRate']").val()+
"\x26useGCBalance\x3d"+g+"\x26usePromoBalance\x3d"+g+"\x26returnFullHTML\x3d1\x26returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+w("input[name\x3duseCtb]").val()}w.ajax({type:"POST",url:c,data:d,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:f,success:function(a,b,c){c.getResponseHeader("x-amz-checkout-page")?m.ajaxUpdatePage(a,b,c):(a=k.jsonify(a),m.redirect(a))},error:function(a,b,c){m.ajaxRedirect(a,b,c)}})}}function e(a){var b=
!1,c=w("input[name\x3drewardAccountAmount]"),d=w("#inline-points-error-block");a||w("#spc-points-input")&&!w("#spc-points-input").hasClass("show-currency-input-widget-new")?(a&&(c=w("input[name\x3dloyaltyPointsValue]"),d=w("#loyalty-points-error")),d.hide(),d.find("p").hide(),y(c))?A(c,a)?z(c,a)||(d.find("p").filter(function(){return"badMax"===w(this).data("error")}).show().css("display","inline"),b=!0):(d.find("p").filter(function(){return"badMin"===w(this).data("error")}).show().css("display","inline"),
b=!0):(d.find("p").filter(function(){return"badValue"===w(this).data("error")}).show().css("display","inline"),b=!0):a||A(c,a)||(d.find("p").filter(function(){return"badMin"===w(this).data("error")}).show().css("display","inline"),b=!0);if(b)return d.show(),c.addClass("a-form-error"),!1;c.removeClass("a-form-error");return!0}function d(a,b){var c=w(a.currentTarget),d=c.val(),e=w("#inline-raw-points");b&&(e=w("#loyalty-points-applied-value"));var g=e.html();if(b)!/^\s*$/.test(d)&&!isNaN(d)&&0<d?e.html(d):
e.html(0);else if(!w("#spc-points-input").hasClass("show-currency-input-widget-new")){var h=c.data("min-dollar-amount");!/^\s*$/.test(d)&&!isNaN(d)&&0<d&&!isNaN(h)&&d>=h?(h=c.data("conversion-ratio"),c=c.data("decimal-places"),d=f.getNumberWithSeparators(d/h,c),e.html(d)):e.html(0)}(b||w("#points-applied").is(":visible"))&&g!==e.html()&&(e=w("#spc-loyalty-points-display"),g=w("#loyalty-points-applied"),d=w("#loyalty-points-button"),c=!1,b||(e=w("#inline-points-button"),e.is("span")&&(c=!0),g=e.find("span.apply"),
d=e.find("span.change"),w("#points-applied").hide()),g.hide(),d.show(),c?e.css("display","inline-block"):e.show())}function y(a){a=a.val();return/^\s*$/.test(a)||!isNaN(a)}function A(a,b){if(b)return!0;var c=a.val();if(/^\s*$/.test(c))return!0;c=parseFloat(c);return isNaN(c)||!a.data("min-dollar-amount")?!0:0===c||c>=a.data("min-dollar-amount")}function z(a,b){var c=a.val();if(/^\s*$/.test(c))return!0;var c=parseFloat(c),d=a.data("max-dollar-amount");b&&(d=a.data("available-points"));return isNaN(c)||
!d?!0:c<=d}function C(a){switch(a.keyCode?a.keyCode:a.which){case 13:case 10:var c=w("#loyalty-points-button"),d=w("#spc-points-input");0<c.length&&c.is(":visible")?b(a,1):0<d.length&&b(a,0)}}var w=a.$;w("html").hasClass("a-ie6")||(w(document).delegate("#spc-loyalty-points-input","keypress",function(a){C(a)}),w("#spc-points-input")&&!w("#spc-points-input").hasClass("show-currency-input-widget-new")&&(w(document).delegate("#spc-points-input","keypress",function(a){C(a)}),w(document).delegate("#spc-points-input",
"keyup",function(a){d(a,0)})),w(document).delegate("#spc-loyalty-points-input","keyup",function(a){d(a,1)}),w(document).delegate("#inline-points-button","click",function(a){b(a,0)}),w(document).delegate("#loyalty-points-button","click",function(a){b(a,1)}),a.on("a:expander:apply-point-expander:toggle:expand",function(a){g.increaseCount("checkout:spp-payment:expand_addswp_coll",1)}),a.on("checkout:reload:spc",c),a.on("checkout:reload:spp-revieworder",c))});"use strict";r.when("A","client-side-metrics",
"ready").execute(function(a,n){var k=a.$;a.on("checkout:reload:spc",function(){var a=k("input[name\x3d'rewardsProgramId']").val(),f=k("input[name\x3d'swpWidgetCase']").val();a&&f&&n.increaseCount("Checkout::SPC::SWPWidgetCSM::"+a+"::"+f,1)})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor").register("inline-fps-balance-controller",function(a,n,k,m){function f(a){a.preventDefault();h("#inline-fps-balance-checkbox").prop("disabled","disabled");m.isSPP()?(n.blockAllActions(),
n.showTransitionInContainer(h("#payment"))):n.show();var f=h("#inline-fps-balance-hidden-fields"),c=0;h("#inline-fps-balance-checkbox").prop("checked")&&(c=1);a=m.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});var b="/gp/buy/pipeline/handlers/update-fps-balance.html/ref\x3d"+(m.isSPP()?"chk_pay_"+(c?"apply":"remmove")+"_fps_balance_coll":"ox_spc_page_fps_balance_apply"),f="fpsPaymentMethodId\x3d"+f.find("input[name\x3d'fpsPaymentMethodId']").val()+"\x26useFlexiblePayments\x3d"+c+"\x26returnFullHTML\x3d1\x26returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+
h("input[name\x3duseCtb]").val();h.ajax({type:"POST",url:b,data:f,dataType:"text",async:!0,cache:!1,headers:a,success:function(a,b,c){c.getResponseHeader("x-amz-checkout-page")?m.ajaxUpdatePage(a,b,c):(a=k.jsonify(a),m.redirect(a))},error:function(a,b,c){m.ajaxRedirect(a,b,c)}})}var h=a.$;h("html").hasClass("a-ie6")||h(document).delegate("#inline-fps-balance-checkbox","click",function(a){f(a)})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","checkout-general-utils",
"error-feature-detection","page-detector","client-side-metrics").register("shipping-speed-selection-controller",function(a,n,k,m,f,h,g,p){function c(){P?B("fieldset div.a-radio").addClass("a-touch-radio").removeClass("a-radio"):a.defer(function(){var a=B("#spc-orders").find("div.ship-option");a.filter(".no-scheduled-delivery");a.each(function(){B(this).find("input.radio-image").remove()});a.each(function(){var a=B(this).find("input.radio-standard");a.attr("checked")&&a.attr("checked",!0)})});b();
a.defer(z);h.markFeatureAvailable("shipping-speed-selection-controller");e()}function b(){if(m.isSPP()&&0<B("#trigger-case-call-to-resolve-cv").length){var a=function(){var a=t.setInterval(function(){m.isAnimating()||(n.show(),t.clearInterval(a))},50)},b=B("div.ship-option").filter(".call-set-to-resolve-cv").first().find("input[type\x3d'radio']");if(b&&b.length){var c=b.parents(".shipping-speeds").find("input.lineitemidinput[type\x3dhidden]").val();w(b,null,null,{transitionAction:a,refTag:"chk_revieworder_set_ship_option_no_default",
extraData:{callingCASEResolveCV:1,lineItemIds:c}})}}}function e(){if(0<B("#buy-button-disabled-state").length)var a=t.setInterval(function(){var b=B("div.sd_widget_root.sd_widget_initialized"),c=b.attr("id"),d={},e=!1;b.find("input[type\x3d'hidden']").each(function(){var a=B(this).attr("key"),b=B(this).val();"ScheduledDeliveryEntity.startDeliveryDate"===a&&b&&""!==b&&(e=!0);d[a]=b||""});c&&e&&(w(null,c,d),t.clearInterval(a))},1E3)}function d(){Q||(Q=B("input[type\x3d'hidden'][name\x3d'scopeId']").val());
return Q}function y(a,b,c){var d=c.getResponseHeader("x-amz-checkout-page");if(d)return"spc"===d&&F||(L=!1),(d=k.jsonify(a))&&d.success&&d.trialkey&&J[d.trialkey]?(a=J[d.trialkey],m.isSPP()&&"object"===typeof a&&(a=JSON.stringify(J[d.trialkey])),m.ajaxUpdatePage(a,b,c),S&&(clearTimeout(S),S=null),J={},!0):m.ajaxUpdatePage(a,b,c);L=!1;return m.redirect(a)}function A(a,b){if(a){var c=a.data(b);if(void 0!==c)return c;var d=a.closest(".radio-standard");d&&(c=d.data(b));return c}}function z(){J={};Q=null;
S&&(clearTimeout(S),S=null);var a=B("#spc-orders").find("input[type\x3d'hidden'][name\x3d'shiptrialprefix']").val(),b=B("#spc-orders").find("div.shipment"),c=B("#setDeliveryPrefetchMultiGroups").val(),e=B("#setDeliveryPrefetchGroupLimit").val(),f=1;c&&(f=b.length,e&&e<b.length&&(f=e));for(var l=e?18E4:6E4,g=0;g<f;g++){var h="returnpipedata\x3d0\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1",p=0,n=[],q=B("#shipTrialToCacheCount").val();b.each(function(a,
b){var c=B(b),e="",f=c.find(".shipping-speed").find("input[type\x3d'radio']"),f=a===g?f.filter(function(){return 1===A(B(this),"istrial")}):f.filter(function(){return B(this).is(":checked")}),l=c.find(".ship-split-preferences").find("input[type\x3d'radio']:checked");1!==l.length&&(l=c.find(".ship-split-preferences").find("input[type\x3d'hidden'][name^\x3d'shippriority']"));e+="\x26lineitemids"+p+"\x3d"+c.find("input[name\x3d'lineitemids"+p+"']").attr("value");e+=K(c,p);f.length&&f.each(function(){var a=
B(this),b=u(a,l,p),c="ox_spc_set_trial_ship_option_no_data";m.isSPP()&&(c="chk_revieworder_set_trial_ship_option_no_data");if(1===A(a,"istrial")){var e=!1;A(a,"trialIndex")<q&&(e=!0,c="ox_spc_set_trial_ship_option",m.isSPP()&&(c="chk_revieworder_set_trial_ship_option"));a=d()+":"+a.attr("name")+":"+a.attr("value");n.push({trialkey:a,speedparams:b,cacheResult:e,ref:c})}else h+=b});h+=e;p++});0<p&&(h+="\x26groupcount\x3d"+p);h+="\x26istrial\x3d1";0===h.indexOf("\x26")&&(h=h.substr(1));var w=m.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});
B.each(n,function(b,c){var e=h+c.speedparams+"\x26trialkey\x3d"+c.trialkey;c.cacheResult&&(e+="\x26returnFullHTML\x3d1");if(c.cacheResult||!a){var f=c.trialkey,e=B.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+c.ref,data:e,dataType:"text",async:!0,cache:!1,headers:w,dataFilter:function(a){return k.jsonify(a)},success:function(a){delete E[f];if(a&&a.trialkey){var b=a.trialkey.split(":")[0];!L&&b===d()&&a.fullhtml&&(J[a.trialkey]=a.fullhtml,S||(S=setTimeout(function(){J=
{}},l)))}},error:function(){delete E[f]}});E[f]=e}})}}function C(a){a.closest("fieldset").find("i.a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");a.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive")}function w(a,b,c,e){P&&C(a);e&&e.transitionAction?e.transitionAction():n.show();F=!1;L=!0;for(var f in E)E.hasOwnProperty(f)&&(E[f].abort(),delete E[f]);f=B("#spc-orders").find("input[type\x3d'hidden'][name\x3d'shiptrialprefix']").val();
var l;a||(a=B("#"+b).closest(".shipping-speed").find("input[type\x3d'radio']"));l=a.closest(".shipment").data("orderid");a&&a.length&&a.hasClass("valid-btn")&&a.closest(".prime-calendar").hasClass("long-calendar")&&(l=a.closest(".prime-calendar").data("orderid"));var g="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1";if(e&&e.extraData)for(var h in e.extraData)e.extraData.hasOwnProperty(h)&&(g+="\x26"+h+"\x3d"+e.extraData[h]);var k=
B(".shipment"),p=0;k.each(function(d,e){var f=B(e),h="",m=f.has(".prime-calendar-container"),n=f.find("input[name\x3d'currentshippingspeed']").attr("value"),q=f.find("input[name\x3d'currentshipsplitpreference']").attr("value");1===k.length&&(g+="\x26oldoption\x3d"+n+"."+q);n=f.find("input[name\x3d'defaultshipsplitpreference."+p+"']").attr("value");q=f.find("input[name\x3d'usingprimeshipping."+p+"']").attr("value");n&&q&&(g+="\x26defaultshipsplitpreference."+p+"\x3d"+n,g+="\x26usingprimeshipping."+
p+"\x3d"+q);n=f.find(".shipping-speed");n=a?n.find('input[type\x3d"radio"]:checked'):n.find("input[src*\x3dradio-on]");m&&!n.length&&(n=f.find("input[name\x3d'hiddenSelection"+p+"']"));q=f.find(".ship-split-preferences").find("input[type\x3d'radio']:checked");1!==q.length&&(q=f.find(".ship-split-preferences").find("input[type\x3d'hidden'][name^\x3d'shippriority']"));l===f.data("orderid")&&(A(a,"shippingofferingid")?n=a:q=a,1===k.length&&(h=m?h+("\x26option\x3d"+n.data("key")+"."+(q?q.attr("value"):
"")):h+("\x26option\x3d"+n.attr("value")+"."+(q?q.attr("value"):""))));h+="\x26lineitemids"+p+"\x3d"+f.find("input[name\x3d'lineitemids"+p+"']").attr("value");h+=K(f,p);if(n.length)if(h+=u(n,q,p,m),1===A(n,"isscheduleddelivery")){f=n.closest(".shipping-speed").find('[id^\x3d"sd_widgets_"]');if(b&&c&&(b===f.attr("id")||void 0===b))for(var w in c)c.hasOwnProperty(w)&&(h+="\x26"+w+"."+p+"\x3d"+c[w]);else h+="\x26"+f.children(":input").serialize();F=!0}else 1===A(n,"isscheduleddeliveryslot")&&A(n,"sddatastring")&&
(h+="\x26ScheduledDeliveryEntity.data."+p+"\x3d"+encodeURIComponent(n.data("sddatastring")));else h+="\x26isdigital"+p+"\x3d1";p++;g+=h});0<p&&(g+="\x26groupcount\x3d"+p);h="ox_spc_set_ship_option";if(m.isSPP()){h="chk_revieworder_set_ship_option";var q=B("#setOrderingPrefsCheckbox");q.length&&q.is(":checked")&&(g+="\x26saveAsDefaultsSelected\x3d1")}q=B("input[name\x3duseCtb]").val();g+="\x26isClientTimeBased\x3d"+q;1===A(a,"istrial")?(f=d()+":"+a.attr("name")+":"+a.attr("value"),g+="\x26trialkey\x3d"+
f,J[f]&&(S&&clearTimeout(S),h="ox_spc_set_cached_ship_option",m.isSPP()&&(h="chk_revieworder_set_cached_ship_option"),g=g.replace("returnFullHTML\x3d1","returnFullHTML\x3d0"),g+="\x26trialSuccess\x3d1")):"undefined"!==typeof f&&(f=f+":"+a.attr("name")+":"+a.attr("value"),g+="\x26trialkey\x3d"+f);e&&e.refTag&&(h=e.refTag);0===g.indexOf("\x26")&&(g=g.substr(1));e="/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+h;f=m.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});B.ajax({type:"POST",
url:e,data:g,dataType:"text",async:!0,cache:!1,headers:f,success:function(a,b,c){y(a,b,c)},error:function(a,b,c){L=!1;m.ajaxRedirect(a,b,c)}})}function u(a,b,c,d,e){var f="";"undefined"!==typeof e&&(c+="-"+e);f=d?f+("\x26shippingspeed"+c+"\x3d"+a.data("key")):f+("\x26shippingspeed"+c+"\x3d"+a.attr("value"));f+="\x26shippingofferingid"+c+"\x3d"+A(a,"shippingofferingid");f+="\x26guaranteetype"+c+"\x3d"+A(a,"guaranteetype");f+="\x26issss"+c+"\x3d"+A(a,"issss");f+="\x26forceshipsplitpreference"+c+"\x3d"+
A(a,"forceshipsplitpreference");d="shipWhenComplete";b&&(d=b.attr("value"));1===A(a,"isscheduleddelivery")&&(f+="\x26isscheduleddelivery"+c+"\x3d1",d="shipWhenComplete");return f+("\x26shippriority"+c+"\x3d"+d)}function q(a){var b=[a.closest(".shipment").data("orderid")];l(a,b)}function v(a){var b=[];B("#spc-orders").find(".shipment").each(function(a,c){b.push(a)});l(a,b)}function l(a,b){n.show();var c="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1",
e="/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+a.data("reftag");B("#spc-orders").find(".shipment").each(function(d,e){c+="\x26lineitemids"+d+"\x3d"+B(e).find("input[type\x3d'hidden'][name\x3d'lineitemids"+d+"']").attr("value");c+=K(B(e),d);B(e).find("input[type\x3d'hidden'][name^\x3d'shippriority']");var f;if(f=-1===b.indexOf(d)?B(e).find("#selected-ship-option-"+d):a)c+="\x26shippingofferingid"+d+"\x3d"+f.data("shippingofferingid"),c+="\x26guaranteetype"+d+"\x3d"+f.data("guaranteetype"),
c+="\x26issss"+d+"\x3d"+f.data("issss"),c+="\x26forceshipsplitpreference"+d+"\x3d"+f.data("forceshipsplitpreference"),c+="\x26shippriority"+d+"\x3d"+f.data("targetshipoptionkey")});var f=B("#spc-orders").find("input[type\x3d'hidden'][name\x3d'groupcount']").val(),c=c+("\x26groupcount\x3d"+f),c=c+("\x26isClientTimeBased\x3d"+B("input[type\x3d'hidden'][name\x3d'useCtb']").attr("value")),c=c+("\x26trialkey\x3d"+d()+":"+a.data("orderindex")+":"+a.data("targetshipoptionkey")),f=m.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});
B.ajax({type:"POST",url:e,data:c,dataType:"text",async:!0,cache:!1,headers:f,success:function(a,b,c){y(a,b,c)},error:function(a,b,c){L=!1;m.ajaxRedirect(a,b,c)}})}function r(b,c,d,e){f.protectAgainstDoubleAction(c)||T||(a.trigger(d,b),b=b.$currentTarget.find("a"),e&&e(b))}function K(a,b){var c=a.find("input[name\x3d'onOrAfterAppointment"+b+"']").val(),d=a.find("input[name\x3d'onOrAfterLineItemId"+b+"']").val(),e="";c&&d&&(e=e+("\x26onOrAfterAppointment"+b+"\x3d"+c)+("\x26onOrAfterLineItemId"+b+"\x3d"+
d));return e}var B=a.$;if(!B("html").hasClass("a-ie6")){var F=!1,Q,L=!1,J={},P=B("html").hasClass("a-touch"),S,E={};t.spcpage.scheduledDeliverySetSOCallback=function(b,c){m.isSPP()&&a.objectIsEmpty(b)||(t.spcpage&&B("#spcpagecontent").is(":visible")?t.spcpage.actionSetShipOptions(null,c,b):w(null,c,b))};t.spcpage.scheduledDeliveryEnableSOCallback=function(){};B(document).delegate(".ship-option","click",function(a){var b=B(a.target);a=B(a.currentTarget);p.resetMetrics();b.is('a[target\x3d"AmazonHelp"]')||
b.is('a[target\x3d"PromoDetails"]')||a.is("input")||b.hasClass("a-button")||b.closest("a-button").length||b.is("img")&&(b.closest("div").is(".prime-ship-speed")||b.closest(".prime-fake-radio").parent().is(".prime-ship-speed"))||(b=a.find("div.prime-ship-speed"),0<b.length?b.find("a:first img").trigger("click"):((b=a.find("input[type\x3d'image']").attr("src"))&&b.match(/radio-off/)&&B(".ap_popover_sprited").hide(),a=a.find("input[type\x3d'radio']"),(b=a.closest("div.shipping-speeds").data("sospargs"))&&
1===a.data("isscheduleddelivery")&&!a.is(":checked")?(n.show(),a.attr("checked",!0),C(a),f.redirectWithJavascript("/gp/buy/shipoptionselect/handlers/display.html?"+b)):(a.hasClass("js-no-serverside-callback")&&(a.attr("checked",!0),C(a),a.closest(".a-section-expander-container").find(".a-link-section-expander").click()),!B("#disableSubmitButtons").length&&a.is(":checked")||1===a.data("isscheduleddelivery")||(a.attr("checked",!0),w(a)))))});B(document).delegate(".ship-option input[type\x3d'radio']",
"change",function(a){a=B(a.currentTarget);var b=a.closest("div.prime-ship-speed");0<b.length?b.find('input[type\x3d"radio"]').attr("checked",!1):1!==a.data("isscheduleddelivery")&&w(a)});a.declarative("shipping-speed-expander-toggle",["click"],function(a){var b=a.$target.closest(".a-box"),c,d;b.hasClass("a-single")?(c=b.find(".expanded-header-content"),d=b.find(".collapsed-header-content"),d.hide(),c.hasClass("prime-title")&&c.find("div").attr("style",""),c.show()):(d=b.find(".collapsed-header-content"),
c=b.find(".expanded-header-content"),b=b.siblings(".a-expander-content").find(".a-icon-touch-radio-active").siblings(".a-radio-label").html(),d.html(b),c.hide(),d.show());f.toggleExpanderContent(a)});a.declarative("select-prime-slot",["click"],function(a){a=a.$currentTarget;B(".a-button-close").trigger("click");a.closest(".valid-slot").hasClass("selected-slot")||w(a)});var T=!1;B(document).delegate(".mobile-upsell","touchmove",function(a){T=!0});B(document).delegate(".mobile-upsell","touchstart",
function(a){T=!1});a.declarative("select-upsell-shipping-speed",["click","touchend"],function(a){r(a,"select-upsell-shipping-speed","a:checkout:mobile-upsell-shipping-speed:select",q)});a.declarative("select-all-upsell-shipping-speed",["click","touchend"],function(a){r(a,"select-all-upsell-shipping-speed","a:checkout:mobile-upsell-shipping-speed:select-all",v)});a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c)}});"use strict";r.when("A","page-detector","spc-page-state","client-side-metrics",
"page-conductor").register("order-summary-controller",function(a,n,k,m,f){function h(){y=b("#transactionalRadio");A=b("#marketplaceRadio");b("#tfx-see-exchange-rates");d=b("#tfx-switch-currency-options");e||(m.increaseCount("removeauijs15"),b("#transactionalRadioImage").remove(),b("#marketplaceRadioImage").remove(),b("#acceptAccImage").remove());var a=b("#exchange-rate-link"),c=b("#switch-currency-link");if(0!==A.length){var f=d.find('input[name\x3d"switchCurrency"]'),h=f.not(":checked"),f=k.prop("currencyType")||
f.filter(":checked").val();h.val()===f?h.parent().trigger("click"):g(f);e||(m.increaseCount("removeauijs16"),a.find("i.a-icon-collapse").remove(),c.find("i.a-icon-collapse").remove())}}function g(c){k.prop("currencyType",c);var d=b("#subtotals-marketplace-table"),g=b("#subtotals-transactional-table"),h=b("#subtotals-marketplace-spp-bottom"),p=b("#subtotals-transactional-spp-bottom"),v=b("#vatRetailSubtotals-transactional-table"),l=b("#vatGlobalSubtotals-transactional-table"),t=b("#vatMerchantSubtotals-transactional-table"),
r=b("#vatRetailSubtotals-marketplace-table"),B=b("#vatGlobalSubtotals-marketplace-table"),F=b("#vatMerchantSubtotals-marketplace-table"),Q=b(".place-your-order-button"),L=f.isSPP()?b(".place-order-button-text"):b(".place-your-order-button + span");f.isSPP()||setTimeout(function(){var a=Math.max(d.outerHeight(),g.outerHeight());0<a&&(d.height(a),g.height(a))},500);if(!e){m.increaseCount("removeauijs17");var J=A.siblings("i"),P=y.siblings("i");if(J.hasClass("a-icon-touch-radio-inactive")||J.hasClass("a-icon-touch-radio-active"))"marketplace"===
c?(J.removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"),P.removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive")):(P.removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"),J.removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"))}"marketplace"===c?(b("#fxGoodNews-transactional").hide(),b("#fxGoodNews-marketplace").show(),g.hide(),d.show(),p.hide(),h.show(),v.hide(),l.hide(),t.hide(),r.show(),
B.show(),F.show(),Q.val(b("#placeYourOrderTextMarketplace").val()),e&&L.text(b("#placeYourOrderTextMarketplace").val()),b("#currencyChanged").attr("value","true"),b("#fxCurrencyChoice").attr("value","marketplace"),b("#tfx-total-header").addClass("aok-hidden"),b("#mkt-total-header").removeClass("aok-hidden")):(b("#fxGoodNews-transactional").show(),b("#fxGoodNews-marketplace").hide(),d.hide(),g.show(),h.hide(),p.show(),r.hide(),B.hide(),F.hide(),v.show(),l.show(),t.show(),Q.val(b("#placeYourOrderTextTransactional").val()),
e&&L.text(b("#placeYourOrderTextTransactional").val()),b("#currencyChanged").attr("value","false"),b("#fxCurrencyChoice").attr("value","transactional"),b("#mkt-total-header").addClass("aok-hidden"),b("#tfx-total-header").removeClass("aok-hidden"));a.trigger("checkout:spc:ordersummary:sizeChanged");n.isMobileSpc()&&(h=b("#vatBreakdownNote"),0<h.size()&&(p=h.attr("href"),p=0<p.lastIndexOf(".html?")?p+("\x26currencyType\x3d"+c):p+("?currencyType\x3d"+c),h.attr("href",p)))}function p(a){var d=b("#tfx-footer"),
f=b("#tfx-header");if(!e){m.increaseCount("removeauijs18");var h=b("#fxApplicabilityDecision").siblings("i"),k=b("#fxApplicabilityAdoption").siblings("i");if(k.hasClass("a-icon-touch-checkbox-inactive")||k.hasClass("a-icon-touch-checkbox-active"))k.removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive"),h.removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active")}"accept"===a?(c()?(b("#fx-terms-and-conditions").show(),b("#fxCardCurrencySubcondition").hide()):
(b("#fx-enable").show(),b("#fx-disable").hide()),b("#fxApplicabilityDecision").prop("checked",!0),f.show(),g("transactional"),d.show(),b("#marketplaceRadio").prop("checked",!1),b("#transactionalRadio").prop("checked",!0),b("#fxApplicabilityChoice").attr("value","accept")):(c()?(b("#fx-terms-and-conditions").hide(),b("#fxCardCurrencySubcondition").show()):(b("#fx-enable").hide(),b("#fx-disable").show()),b("#fxApplicabilityAdoption").prop("checked",!1),f.hide(),g("marketplace"),d.hide(),b("#transactionalRadio").prop("checked",
!1),b("#marketplaceRadio").prop("checked",!0),b("#fxApplicabilityChoice").attr("value","decline"))}function c(){return f.isSPP()&&b("input[name\x3disNewTFXExperienceEnabled]").length}var b=a.$;if(!b("html").hasClass("a-ie6")){var e=t.P&&t.P.AUI_BUILD_DATE,d,y,A;b(document).delegate("#checkoutCurrencyTransactional","click",function(){g("transactional")});b(document).delegate("#checkoutCurrencyMarketplace","click",function(){g("marketplace")});b(document).delegate("#fxApplicabilityDecisionCheckbox",
"click",function(){p("decline")});b(document).delegate("#fxApplicabilityAdoptionCheckbox","click",function(){var a=c()&&!b("#fxApplicabilityAdoption").is(":checked");p(a?"decline":"accept")});a.on("a:expander:tfx-options-expander:toggle:expand",function(a){m.increaseCount("checkout:spp-ordersummary:expand_tfx_options",1)});a.on("a:expander:tfx-see-rate-expander:toggle:expand",function(a){m.increaseCount("checkout:spp-ordersummary:expand_tfx_see_rate",1)});return{changeCurrency:g,initOrderSummary:h}}});
"use strict";r.when("A","ready").register("spc-page-state",function(a){var n={};return{prop:function(a,m){if(a&&"string"===typeof a)return 1<arguments.length&&(n[a]=m),n[a]}}});"use strict";r.when("A","ready").execute(function(a){function n(){0<k("#spcCachedPromiseData").length&&(m=(new Date).getTime(),k(".place-your-order-button").click(function(){var a=(new Date).getTime()-m;k("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'spcWaitingTime' value\x3d'"+a+"' /\x3e")}))}var k=a.$,m=0;a.on("checkout:reload:spc",
n);a.on("checkout:reload:spclite",n);a.on("checkout:reload:spp-revieworder",n)});"use strict";r.when("A","page-transition-controller","scroll-controller","loading-spinner-controller","page-conductor","checkout-general-utils","ready").register("changeCustomerDetailsPopover",function(a,n,k,m,f,h){function g(){b&&b.find("button[data-action\x3da-popover-close]").trigger("click")}function p(){var a=c("#saveButton");if(a.length){var b=c("#changeNameInput"),f=c("#changePostNumberInput"),g=c("#changePhoneInput"),
h=1,k=1,p=1;b.length&&!b.val()&&(h=0);f.length&&!f.val()&&(k=0);g.length&&!g.val()&&(p=0);h&&k&&p?(a.removeClass("a-button-disabled"),a.removeAttr("disabled")):(a.addClass("a-button-disabled"),a.attr("disabled","true"))}}var c=a.$,b;a.declarative("clickedsave","click submit",function(a){var b=c("#changeNameInput").val(),h=c("#changePhoneInput").val(),k=c("#changePostNumberInput").val(),p=c("#changeAccountNameCheckBox").is(":checked")?1:0,m=c("#changePostNumberCheckBox").is(":checked")?1:0,b="custName\x3d"+
encodeURIComponent(b)+"\x26changeAccountName\x3d"+encodeURIComponent(p);h&&(b=b+"\x26custPhoneNumber\x3d"+encodeURIComponent(h));k&&(b=b+"\x26dhlPostNumber\x3d"+encodeURIComponent(k),m&&(b=b+"\x26changeDhlPostNumberInEmbu\x3d"+encodeURIComponent(m)));h=a.data.changeDetailUrl;f.isSPP()&&(h=a.$target.data("changedetailurl"),c("#cancelReminderPopover").click());f.isSPP()||(b+="\x26usePipelineDispatch\x3d1");n.show();h&&c.ajax({type:"POST",data:b,url:h,dataType:"html",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
async:!0,cache:!1,headers:f.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"}),success:function(a,b,c){g();n.hide();f.ajaxUpdatePage(a,b,c)},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})});a.declarative("clickedsave","mouseenter mousemove touchstart",function(a){p()});a.declarative("changeNameKeyIn changePostNumberKeyIn changePhoneNumberKeyIn","keydown keyup change keypress mouseenter mouseleave mousemove",function(a){p()});a.declarative("clickedcancel","click submit",function(a){g()});a.on("a:popover:show:changeDetailPopover",
function(a){if(!f.isSPP()){var d=c(t).width(),g=c(t).height(),d=parseInt(.6*d,10),g=parseInt(.7*g,10);b=a.popover.$popover;var h=a.popover;b.css("position","absolute");b.css("top","50px");b.css("height",g+"px");b.css("width",d+"px");h.updatePosition()}d=f.isSPP()?a.popover.originalnamevalue:a.popover.$trigger.data("original-name-value");g=f.isSPP()?a.popover.originalcellphonevalue:a.popover.$trigger.data("original-cellphone-value");a=f.isSPP()?a.popover.originalpostnumbervalue:a.popover.$trigger.data("original-postnumber-value");
var h=c("#changeNameInput"),k=c("#changePhoneInput"),m=c("#changePostNumberInput");h.val(d);k.val(g);m.val(a);p()})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","page-detector","checkout-general-utils").register("prime-decline-controller",function(a,n,k,m,f,h){function g(){c("input[name\x3d'changeCardNoEndDatePrime']").attr("data-action","prime-decline-element")}function p(a,c,d){if(d.getResponseHeader("x-amz-checkout-page"))m.ajaxUpdatePage(a,c,d);else{a=
k.jsonify(a);if(!a)return m.redirect();a.error?n.hide():a.errors?n.hide():a.autohandlererror?(c=(a=a.autohandlererror)?a.action:null,d=a&&a.type?a.type:c&&c.code?c.code:"string"===typeof a?a:"Unknown:pipelineJSError",t.location.href="fatal"===c?"/gp/buy/payselect/handlers/error.html?errorAction\x3dfatal\x26errorType\x3d"+encodeURIComponent(d):"redirect"===c?a.url:"/gp/buy/payselect/handlers/error.html?errorType\x3d"+encodeURIComponent(d)):m.redirect(a)}}var c=a.$;c("html").hasClass("a-ie6")||(a.declarative("prime-decline-element",
["click","touchend"],function(a){h.protectAgainstDoubleAction("prime-decline-element")||(a.$event.preventDefault(),n.show(),a=(new Date).getTime(),a="changeCardNoEndDatePrime\x3d1\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26fromAnywhere\x3d"+c("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+a,c.ajax({type:"POST",url:"/gp/buy/spc/handlers/stuff-handler.html/ref\x3dox_spc_prime_renew_nodate",data:a,headers:{"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"},
contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",success:p,error:m.ajaxRedirect}))}),a.on("checkout:reload:spc",g),a.on("checkout:reload:spp-revieworder",g))});"use strict";r.when("A","loading-spinner-controller","page-conductor").register("prime-popover-controller",function(a,n,k){function m(){h={};a.defer(function(){0!==f("#spc-orders").find(".prime-popover-link").length&&(f("#spc-orders").find(".prime-popover-link").each(function(){var a=f(this);if(a.data("action")){a.removeAttr("href").attr("tabindex",
0);var k=a.data("aCheckoutModalPopover");var c=k.name,b="";k.width&&k.height&&(b="width:"+k.width+"px;height:"+k.height+"px;");0<f("#spc-orders").find("#"+c+"-popover").length||(k=f(['\x3cdiv id\x3d"a-popover-'+c+'" class\x3d"a-popover-preload" style\x3d"display:none;"\x3e','\x3cdiv id\x3d"'+c+'-popover" class\x3d"checkout" style\x3d"'+b+'"\x3e\x3c/div\x3e',"\x3c/div\x3e"].join("")),f("#spc-orders").append(k));a=a.data("aCheckoutModalPopover").name;h[a]||(k=f(".prime-popover-content").html())&&0<
k.length&&(h[a]=k,f("#"+a+"-popover").html(k))}}),f("#spc-orders").find(".a-box").each(function(){var a=f(this),h=a.find(".prime-ad-banner-content .prime-popover-link");1<h.length&&(h=h.first());a.find("a.primeAdLauncher").each(function(){var a=f(this);a.wrap('\x3cspan class\x3d"a-declarative" data-action\x3d"prime-event" data-prime-event\x3d\'{"metric":"lm3"}\'\x3e\x3c/span\x3e');a.replaceWith(h.clone().text(a.text()).addClass("a-size-mini"))})}))})}var f=a.$;if(!f("html").hasClass("a-ie6")){var h=
{};a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("prime")&&(a=a.popover.name,!h[a])){var k=f("input#primePopopverFallbackContent").val()||"";h[a]=k;f("#"+a+"-popover").html(k)}});a.on("checkout:reload:spc",m);a.on("checkout:reload:spp-revieworder",m)}});"use strict";r.when("A","page-transition-controller","back-button-protection","page-conductor").register("place-order-controller",function(a,n,k,m){function f(){if(!m.isAnimating()){var f=g("#spc-form");
if("0"===g("#showPageTransition").attr("content")){if(0<g("#enableAlternatePYOBlocker").length){var c=f.find(".a-button.continue-button");if("disabled"===c.find("input").attr("disabled"))return;c.find("input").attr("disabled","disabled");c.addClass("a-button-disabled");setTimeout(function(){c.removeClass("a-button-disabled");c.find("input").removeAttr("disabled")},4E4)}}else n.showPageTransition();var b=g("#currencyChanged");0<b.length&&"true"===b.val()&&(b='\x3cinput type\x3d"hidden" name\x3d"checkoutCurrencySelection.'+
g("#tfx-switch-currency-options").find("input:radio:checked").val()+'" /\x3e',g("#spc-form-inputs").append(b));f.append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");if((b=a.state("firetv-aws-attributes"))&&b.queryParams){var e=f.attr("action"),e=e+(0<=e.indexOf("?")?"\x26":"?"),e=e+g.param(b.queryParams);f.attr("action",e)}m.isSPP()&&f.append(g("#subtotalsSection").find("input").hide());k.markAsDirty();f.submit()}}function h(a){a.preventDefault();f(a.target)}var g=a.$;
if(!g("html").hasClass("a-ie6"))return a.declarative("a-checkout-place-order",["click"],function(a){f(a.target)}),g(document).delegate("span.place-order-button-link","click",h),{placeOrderClick:f,placeOrderClickDelegate:h,PLACE_ORDER_BUTTON_LINK_SELECTOR:"span.place-order-button-link"}});"use strict";r.when("A","page-conductor","a-tooltip","button-blocker","client-side-metrics").register("verification-checkbox-controller",function(a,n,k,m,f){function h(){if(!n.isSPP()&&t.P&&t.P.AUI_BUILD_DATE){var a=
c(".continue-button"),b=c(".continue-button-blocker"),e=c("#spc-imb").find(".verification-checkbox input:not(:checked)"),h=c(".place-order-blocker-message.custom-blocker-message"),p=c("#spc-imb").find(".verification-checkbox");if(!g()||0!==p.length&&0!==e.length)0<e.length?(h.text(e.first().closest(".verification-checkbox").attr("data-blocker-message")),a.addClass("aok-hidden"),b.removeClass("aok-hidden")):(h.empty(),a.removeClass("aok-hidden"),b.addClass("aok-hidden"),(a=k.get(b))&&a.isActive()&&
a.hide())}else f.increaseCount("removeauijs23"),c("#spc-imb").find(".verification-checkbox").length&&(e=n.isSPP()?c("#spc-imb").find(".verification-checkbox input:not(:checked)"):c("#spc-imb").find(".verification-checkbox:not(:checked)"),0<e.length?(a=n.isSPP()?e.first().closest(".spp-panel").hasClass("aok-hidden")?e.first().closest(".verification-checkbox").data("non-review-panel-blocker-msg"):e.first().closest(".verification-checkbox").data("blocker-message"):e.first().attr("data-blocker-message"),
m.show("place-order-imb-checks",a)):(m.hide("place-order-imb-checks"),c("#hasTVNavigation").length&&r.when("a-tv").execute(function(a){a.select(".continue-button")})))}function g(){var a=c("input[name\x3disINExpressCheckoutCC]");return a&&a.length?1===parseInt(a.val(),10):!1}function p(){var a=c("#wineNoticeCheckbox");a&&a.length&&(b?(a.attr("checked",""),e&&(a=a.siblings(".a-icon-touch-checkbox-inactive"))&&a.length&&(a.removeClass("a-icon-touch-checkbox-inactive"),a.addClass("a-icon-touch-checkbox-active"))):
(a.removeAttr("checked",""),e&&(a=a.siblings(".a-icon-touch-checkbox-active"))&&a.length&&(a.removeClass("a-icon-touch-checkbox-active"),a.addClass("a-icon-touch-checkbox-inactive"))));h();a=t.P&&t.P.AUI_BUILD_DATE?'.verification-checkbox input[type\x3d"checkbox"]':"input.verification-checkbox";c("#spc-imb").find(a).unbind("change.verification-checkbox").bind("change.verification-checkbox",h)}var c=a.$,b,e=c("html").hasClass("a-touch");if(!c("html").hasClass("a-ie6"))return a.declarative("change-wine-notice-checkbox",
["change"],function(a){b=a.$target.is(":checked")?1:0}),a.on("checkout:reload:spc",p),a.on("checkout:reload:spclite",p),a.on("checkout:reload:spp-revieworder",p),a.on("checkout:reload:spp-collapsed",p),{verifyCheckboxes:h}});"use strict";r.when("A","page-transition-controller","scroll-controller","ajax-utility","page-conductor","quantity-service","checkout-modal-popover","page-detector","checkout-general-utils","a-popover","client-side-metrics").register("quantity-update-controller",function(a,n,
k,m,f,h,g,p,c,b,e){function d(){S=!1;a.defer(function(){var a=B("#spc-orders");a.find("a.quantity-change-button-static").remove();"1"!==B("#spc-form-inputs").find("input[name\x3d'isQuantityInvariant']").val()&&a.find("div.quantity-value-static").remove()});B(".lineitem").each(function(a,b){var c=B(b);c.find(".no-js-quantity").remove();var d=c.find(".quantity-dropdown");d.is(":visible")?(c.find(".js-select").prop("disabled",!1),d.removeClass("a-button-disabled")):(c=c.find(".quantity-input"),c.prop("disabled",
!1),c.removeClass("a-form-disabled"))})}function y(a,b){var c=B('.update-quantity-error[data-itemid\x3d"'+a+'"]');c.find(".error-message").hide();c.find('.error-message[data-error-type\x3d"'+b+'"]').show();c.find("i").show();c.find(".a-span12").show();c.show();var d=c.closest(".item-details-right-column");d.find(".spc-quantity-dropdown-button").addClass("a-button-error");d.find(".spc-quantity-input").addClass("a-form-error");c=c.parents("div.update-quantity-error");d=c.siblings(".item-details");0<
d.length&&(d.find(".a-input-text-wrapper").addClass("a-form-error"),d.removeClass("a-spacing-large"),d.find(".a-touch-select").addClass("a-input-text a-form-error"));c.show()}function A(a,d,g){var l=g.getResponseHeader("x-amz-checkout-new-cart-quantity");c.updateCartByMash(l);if(g.getResponseHeader("x-amz-checkout-page"))f.ajaxUpdatePage(a,d,g,{pushNewFrame:"false"}),a=g.getResponseHeader("x-amz-checkout-updated-itemid"),g=g.getResponseHeader("x-amz-checkout-quantity-error"),a&&g&&y(a,g);else{if(a=
m.jsonify(a)){if(a&&a.errors&&a.errors.addon&&(f.isSPP()&&e.increaseCount("checkout:spp-revieworder:addon_warn_pri",1),g=a.errors.addon.type,0<F?(B("#a-popover-addon-warning-normal .reduce-title").show(),B("#a-popover-addon-warning-normal .delete-title").hide()):(B("#a-popover-addon-warning-normal .delete-title").show(),B("#a-popover-addon-warning-normal .reduce-title").hide()),g=B("#addon-warning-"+g+"-launcher"),g.length)){B("input[name\x3duseLiveAUI]").length?b.get(g).attrs({$trigger:E}).show():
T&&B("div.checkout.spc-mobile.aui-templatized").length?g.click():(e.increaseCount("removeauijs19"),a=B.Event("keyup",{triggerPositioningElement:E,manualTrigger:!0}),g.trigger(a),0<B("div.spc-mobile").length&&(k.scrollToTop(),k.toggleScrollOff()));n.hide();return}return f.redirect(a)}f.redirect()}}function z(a,b){n.show();var c={isClientTimeBased:B('input[name\x3d"useCtb"]').val(),fromAnywhere:B("input[name\x3dfromAnywhere]").val(),success:A};if(b)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);f.isSPP()?
(c.ref="chk_ship_chg_qty_pri",d=B("#setOrderingPrefsCheckbox"),d.length&&d.is(":checked")&&(c.saveAsDefaultsSelected=1)):B(".spc-mobile.aui-templatized").length&&(c.ref="ox_spc_change_quantity");!a&&B("#addon-indicator")&&"true"===B("#addon-indicator").attr("data-has-addon-items")&&(c.istrial=1);h.call(L,F,c);J?J.data("currentQuantity",F):P&&P.data("currentQuantity",F)}function C(){n.hide();t.location="/gp/aw/c/ref\x3dox_spc_deal_expired?app-action\x3dcart"}function w(){var a=Q;F=Q;J&&r.when("a-dropdown").execute(function(b){J&&
(b.getSelect(J).setValue(a.toString()),J.data("currentQuantity",F))});k.toggleScrollOn();if(P){P.val(a);P.data("currentQuantity",F);var b=P.closest(".quantity-block");b.find(".change-quantity-button").closest(".a-declarative").removeClass("hidden");b.find(".quantity-display").removeClass("hidden");b.find(".quantity-display-block-tablet").removeClass("hidden");b.find(".dynamic-quantity-update").hasClass("stay-visible")||b.find(".dynamic-quantity-update").addClass("hidden").children().addClass("hidden")}}
function u(a,b){var c=a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a");L=c.data("entityId");F=0;J=null;Q=c.data("currentQuantity");E=B("a.quantity-delete-button[data-entity-id\x3d'"+L+"']");E.length||(E=a.$currentTarget);P=c.closest(".dynamic-quantity-update").find(".quantity-input");P.length||(P=null);c.data("isBundleDelete")?setTimeout(function(){B("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click")},100):(z(!1,b),g.hideById(c.closest(".a-popover").data("aPopoverId")))}
function q(a){if(!c.protectAgainstDoubleAction("order-summary-update-quantity",200)){e.resetMetrics();var b=a.$currentTarget,d=b.closest(".lineitem"),f=b.find("select"),f=f.length?f:b;L=d.data("entityId");var g=B('.update-quantity-error[data-itemid\x3d"'+L+'"]');P=J=null;f.is("select")?(J=b.find("select"),F=f.val()):(P=d.find(".quantity-input"),F=P.val());Q!==F&&(E=f.is("select")?J.parent():P,""===F?O(d):"Delete"===F||0===parseInt(F,10)?(a.$event.preventDefault(),c.protectAgainstDoubleAction("delete-item")||
v(a)):c.validateNumber(F,0,999)?(g.hide(),d.blur(),d.data("isBundleDelete")?setTimeout(function(){B("#pb-delete-trigger-"+d.data("bundleGroupId")).trigger("click")},100):z(!1)):y(L,"changeQuantity_quantityNotInRange"))}}function v(a,b){var c=a.$currentTarget.closest(".lineitem");L=c.data("entityId");F=0;c.data("isBundleDelete")?setTimeout(function(){B("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click")},100):(z(!1,b),g.hideById(c.closest(".a-popover").data("aPopoverId")))}function l(a){var b=
a.$currentTarget.closest(".quantity-text-field").find(".update-quantity-link"),c=a.$currentTarget.is("input")?a.$currentTarget.val():a.$currentTarget.find("input").val(),d=a.$currentTarget.find("input").data("currentQuantity");Q=d;-1===parseInt(c,10)||""===c?("change"===a.type&&O(a.$currentTarget.closest(".lineitem")),b.hide()):parseInt(c,10)!==d?b.show():b.hide()}function O(a){a.find(".quantity-input").val(Q)}function K(){return f.isSPP()?B("#revieworder").hasClass("expanded")?!0:!1:0<B("div.spc").length?
!0:!1}var B=a.$;if(!B("html").hasClass("a-ie6")){var F,Q,L,J,P,S=!1,E,T=t.P&&t.P.AUI_BUILD_DATE;a.declarative("change-quantity",["click","touchend"],function(a){if(!c.protectAgainstDoubleAction("lock-update-quantity",200)){a=a.$currentTarget;var b=!0;a.addClass("hidden");a=a.closest(".quantity-block");a.find(".change-quantity").addClass("hidden");a.find(".quantity-display").addClass("hidden");a.find(".quantity-display-block-tablet").addClass("hidden");a.find(".dynamic-quantity-update").removeClass("hidden").find(".hidden").each(function(){var a=
B(this);a.removeClass("hidden");a.is("input")&&(a.focus(),a.select(),a.unbind("keydown.update-quantity-spc").bind("keydown.update-quantity-spc",function(a){13===a.which&&a.preventDefault()}),a.unbind("keyup.update-quantity-spc").bind("keyup.update-quantity-spc",function(a){13!==a.which||b||B(a.target).closest(".dynamic-quantity-update").find(".update-quantity-button").trigger("click")}))});setTimeout(function(){b=!1},500)}});a.declarative("order-summary-get-quantity",["click","touchend"],function(a){c.protectAgainstDoubleAction("order-summary-get-quantity",
200)||a.$currentTarget.find("select").length&&(Q=a.$currentTarget.find("select").val())});a.declarative("order-summary-update-quantity",["change"],q);a.declarative("order-summary-update-quantity-text-field",["click","touchend"],q);a.declarative("order-summary-handle-text-input",["keydown"],function(a){13===a.$event.which?(a.$event.preventDefault(),q(a)):c.limitInputToNumbers(a)});a.declarative("order-summary-show-update-button",["change","keyup"],l);a.declarative("trigger-update-quantity-button",
["keydown"],function(a){13===a.$event.which&&(a.$event.preventDefault(),a.$currentTarget.closest(".quantity-block").find(".update-quantity-button").trigger("click"))});a.declarative("toggle-update-quantity-button",["change","keyup"],function(a){var b=a.$currentTarget.closest(".quantity-block").find(".update-quantity-button"),c=a.$currentTarget.find("input"),d=c.val(),e=c.data("currentQuantity");""===d?("change"===a.type&&c.val(e),b.hide()):parseInt(d,10)!==e?b.show():b.hide()});a.declarative("update-quantity",
["click","touchend"],function(a){e.resetMetrics();var b=a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a");a=b.closest(".quantity-block");var d=b.closest(".dynamic-quantity-update"),f=d.find(".quantity-input");d.length||(f=a.find(".quantity-input"));if(c.protectAgainstDoubleAction("lock-update-quantity",200))f.focus();else{var g=f.val();L=b.data("entityId");var l=B('.update-quantity-error[data-itemid\x3d"'+L+'"]');c.validateNumber(g,0,999)?(l.hide(),d.find(".a-form-error").removeClass("a-form-error"),
f.removeClass("a-form-error"),g=parseInt(g,10),P=f,Q=P.data("currentQuantity"),Q=parseInt(Q,10),g===Q?(a.find(".change-quantity-button").closest(".a-declarative").removeClass("hidden"),a.find(".quantity-display").removeClass("hidden"),a.find(".quantity-display-block-tablet").removeClass("hidden"),d.addClass("hidden").children().addClass("hidden")):(F=g,E=b,b.blur(),b.data("isBundleDelete")?setTimeout(function(){B("#pb-delete-trigger-"+b.data("bundleGroupId")).trigger("click")},100):z(!1))):y(L,"changeQuantity_quantityNotInRange")}});
B(document).delegate(".spc-quantity-dropdown","change",function(a){J=B(a.currentTarget);e.resetMetrics();T?(a=J.next(),L=a.data("entityId"),Q=a.data("currentQuantity")):(e.increaseCount("removeauijs21"),L=J.data("entityId"),Q=J.data("currentQuantity"));var b=J.find(":selected");F=parseInt(b.val(),10);Q!==F&&(a=B("#toggleDropdownQuantityTrigger"),a.length&&F===parseInt(a.val(),10)?(a=J.closest(".quantity-block"),a.find(".spc-quantity-dropdown-button").hide(),a.find(".quantity-input").show()):(E=J.parent(),
J.blur(),b&&b.data("isBundleDelete")?setTimeout(function(){B("#pb-delete-trigger-"+b.data("bundleGroupId")).trigger("click")},100):z(!1)))});a.declarative("dont-delete-item",["click","touchend"],function(a){a.$event.preventDefault();c.protectAgainstDoubleAction("dont-delete-item")||g.hideById(a.$currentTarget.closest(".a-popover").data("aPopoverId"))});a.declarative("delete-item",["click","touchend"],function(a){a.$event.preventDefault();c.protectAgainstDoubleAction("delete-item")||u(a)});a.declarative("delete-prime-membership-item-confirm",
["click","touchend"],function(a){a.$event.preventDefault();if(!c.protectAgainstDoubleAction("delete-prime-membership-item-confirm")){var b={additionalData:{deletePrimeMembership:1,primeMembershipASIN:(a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a")).data("asin")}};u(a,b)}});a.declarative("bundle-delete",["click","touchend"],function(){c.protectAgainstDoubleAction("bundle-delete")||z(!1)});a.declarative("bundle-delete-action",["click","touchend"],function(a){c.protectAgainstDoubleAction("bundle-delete-action")||
(r.when("a-popover-base").execute(function(b){b.get(a.data.popoverName).hide()}),z(!1))});a.declarative("egc-delete",function(a){L=a.entityId;F=0;z(!0)});a.declarative("bundle-dont-delete",["click","touchend"],function(){c.protectAgainstDoubleAction("bundle-dont-delete")||(F=Q,J&&r.when("a-dropdown").execute(function(a){a.setValue(J.attr("id"),Q.toString());J.data("currentQuantity",F)}))});a.declarative("addon-return-to-cart",["click","touchend"],function(){c.protectAgainstDoubleAction("addon-return-to-cart")||
K()&&C()});a.declarative("addon-delete-items",["click","touchend"],function(){c.protectAgainstDoubleAction("addon-delete-items")||(K()&&(S=!0,B(".a-button-close").trigger("click"),z(!0)),f.isSPP()&&e.increaseCount("checkout:spp-revieworder:addon_delete_pri",1))});a.declarative("addon-dont-delete",["click","touchend"],function(){c.protectAgainstDoubleAction("addon-dont-delete")||(K()&&w(),f.isSPP()&&e.increaseCount("checkout:spp-revieworder:addon_keep_pri",1))});a.on("a:popover:hide:addon-warning-normal",
function(){0<B("div.spc-mobile").length?C():K()&&(S||w())});a.on("a:popover:hide:addon-warning-special",function(){K()&&(S||w())});a.on("checkout:reload:spc",d);a.on("checkout:reload:spp-revieworder",d)}});r.when("A","ready").execute(function(a){a.on("a:popover:beforeShow",function(a){if(a.popover.$trigger.hasClass("quantity-dropdown-button")){var k=a.popover.$popover,m=k.closest("div.a-dropdown");m.length&&(a.popover.$iframe.css("max-height","260px"),k.css("max-height","260px"),k=m.find("div.a-popover-inner"),
k.css({"max-height":"260px"}),a.popover.updatePosition(),k.css({"overflow-y":"scroll"}))}})});"use strict";r.when("A","page-transition-controller","page-conductor","ajax-utility").register("tax-exemption-controller",function(a,n,k,m){function f(a,c,b){return b.getResponseHeader("x-amz-checkout-page")?k.ajaxUpdatePage(a,c,b,{pushNewFrame:"false"}):(a=m.jsonify(a))?k.redirect(a):k.redirect()}function h(a,c){var b=c.$target.data("entityId");if(b){n.show();var e={isClientTimeBased:g('input[name\x3d"useCtb"]').val(),
fromAnywhere:g("input[name\x3dfromAnywhere]").val()},e=e||{},d={returnFullHTML:1,cachebuster:(new Date).getTime(),isClientTimeBased:0,hasWorkingJavascript:1};g.extend(d,e);d.entityId=b;d.optOut=a;b=k.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});g.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/tax-exemption-optout.html",data:g.param(d),dataType:"text",async:!0,cache:!1,headers:b,success:f,error:k.ajaxRedirect})}else t.ueLogError&&t.ueLogError({name:"MissingData",message:"lineItemId is undefined, when trying to opt out from tax exemption",
logLevel:"FATAL"})}var g=a.$;g("html").hasClass("a-ie6")||(a.declarative("tax-exemption-opt-out",["click","touchend"],function(a){h(!0,a)}),a.declarative("tax-exemption-opt-in",["click","touchend"],function(a){h(!1,a)}))});"use strict";r.when("A","page-transition-controller","page-conductor").register("sns-subscription-controller",function(a,n,k){function m(){var k=g(document);k.delegate(".sns-option","click",function(a){a=g(this);h(a.closest(".sns-upsell"),a)});k.delegate(".sns-option-mobile","click",
function(a){var b=g(this);a.target.name&&"snsSetCreateSubscription"===a.target.name&&h(b.closest(".sns-upsell-mobile"),b)});k.delegate(".sns-option-tablet","click",function(a){a=g(this);h(a.closest(".sns-upsell-tablet"),a)});k.delegate(".sns-upsell-nextdelivery","change",function(){f(g(this))});a.declarative("sns-upsell-nextdelivery-dropdown","change",function(a){f(g(a.$target))});k.delegate(".sns-upsell-learn-more","click",function(a){var b=g(this);a=b.width();var e=b.height(),d=b.position(),b=b.find(".sns-upsell-popover-learn-more");
b.removeClass("aok-hidden");var f=b.width();b.height();b.css({top:d.top+e,left:d.left-(f-a)/2,position:"absolute"})});k.delegate(".sns-upsell-learn-more-close","click",function(a){(a=g(this))&&a.closest(".sns-upsell-popover-learn-more")&&a.closest(".sns-upsell-popover-learn-more").addClass("aok-hidden");return!1})}function f(a){var c=a.closest(".sns-upsell,.sns-upsell-mobile,.sns-upsell-tablet");if(a.length&&c.length){var b=c.data("index"),e=c.find("span.sns-change-delivery-txt");e&&e.text(a.find("option:selected").data("date"));
e=a.find("option:selected").data("epoch");a=a.find("option:selected").val();c.find("input[type\x3d'hidden'][name\x3d'sns_nextDelivery"+b+"']").val(e);c.find("input[type\x3d'hidden'][name\x3d'sns_frequency"+b+"']").val(a)}}function h(a,c){n.show();var b=a.data("index"),e=(new Date).getTime(),d=a.find("input[type\x3d'hidden'][name\x3d'sns_lineItemIdentifier"+b+"']").attr("value"),f=a.find("input[type\x3d'hidden'][name\x3d'sns_merchantId"+b+"']").attr("value"),h=a.find("input[type\x3d'hidden'][name\x3d'sns_asin"+
b+"']").attr("value"),b=a.find("input[type\x3d'hidden'][name\x3d'sns_frequency"+b+"']").attr("value"),m=c.prop("checked")||c.find("[type\x3dcheckbox]").is(":checked"),e={returnpipedata:0,returnFullHTML:1,cachebuster:e,hasWorkingJavascript:1};e.lineItemIdentifier=d;e.isONMLSelected=m?1:0;e.merchantId=f;e.asin=h;e.frequency=b;d=k.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});g.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-sns-options.html",data:g.param(e),dataType:"text",async:!0,cache:!1,
headers:d,success:function(a,b,c){return k.ajaxUpdatePage(a,b,c)},error:function(a,b,c){k.ajaxRedirect(a,b,c)}})}var g=a.$;g("html").hasClass("a-ie6")||m()});"use strict";r.when("A","page-detector","page-detector-current-page","page-conductor","page-transition-controller","ajax-utility","place-order-controller","client-side-metrics").execute(function(a,n,k,m,f,h,g,p){function c(a){"function"===typeof t.ues&&(t.ues("t0",a,new Date),t.ues("ctb",a,"1"));"function"===typeof t.uet&&t.uet("tc",a,{wb:1})}
function b(a,b){"function"===typeof t.ues&&t.ues("id",a,b)}function e(a,b){"function"===typeof t.uet&&t.uet(a,b,{wb:1})}function d(a){"function"===typeof t.uex&&t.uex("ld",a,{wb:1})}function y(a){t.ueLogError&&t.ueLogError({message:a},{logLevel:"WARN",attribution:"ajax-typ"})}function A(){var a=F("span#typ-load").attr("data-typ-args");t.location.href="https://"+t.location.hostname+"/gp/buy/thankyou/handlers/display.html?"+a}function z(){if(aa){var a=F("#typ-desktop-frame").contents(),b=aa;if(b.deliveryestimates)for(var c in b.deliveryestimates)if(b.deliveryestimates.hasOwnProperty(c)){var d=
a.find("span#"+c);d&&d.replaceWith(b.deliveryestimates[c])}b.autorip&&(a=a.find("#thank-you-rogue"))&&a.replaceWith(b.autorip)}}function r(){e("cf","ajax-typ:place-your-order");z();var a=F("#typ-desktop-frame").contents(),c="ThankYouCart",g=a.find("span#typ-rewrite-url");history&&history.pushState&&g&&0<g.length&&(history.pushState({},"",g.attr("data-url")),c=g.attr("data-view"));a=a.find("title").text();F("#checkoutDisplayPage").hide();F("#typ-desktop").show();document.title=a;f.hide();c=F("span#typ-load").attr("data-typ-args")+
"\x26viewId\x3d"+c;e("be","ajax-typ:place-your-order");p.setmarker&&(a=p.getscope(),Z&&(c+="\x26requestID\x3d"+W,p.setscope("ajax-typ")),p.setmarker("cf"),Z&&p.setscope(a));F.ajax({type:"POST",url:"/gp/buy/thankyou/handlers/log-data.html",data:c,dataType:"text",async:!0,cache:!1,complete:function(a,c){var e=F("#typ-desktop-frame")[0].contentWindow;"function"===typeof e.updateCart&&e.updateCart();if(a.getResponseHeader("x-amz-checkout-requestid")){e=a.getResponseHeader("x-amz-checkout-requestid");
if(p.sendue){var f=p.getscope();p.setscope("ajax-typ");p.setrid(e);p.sendue("ld");p.setscope(f)}b("ajax-typ:place-your-order",e);d("ajax-typ:place-your-order")}}});Z||(p.sendUEPageLoadStats(),d("ajax-typ:place-your-order"))}function w(a,b,c){a&&a.conductoraction&&a.conductoraction.url?m.redirect(a):(e("af","ajax-typ:place-your-order"),aa=a,P?r():L?S=1:(y("No TYP data available after place-order, redirecting to static TYP"),A()))}function u(){if(!x)if(ea&&clearTimeout(ea),3===V.readyState){var a;try{a=
h.jsonify(V.responseText)}catch(b){a=null}null!==a?(x=1,w(a)):ea=setTimeout(u,50)}else 4===V.readyState&&(x=1,200===V.status?(a=h.jsonify(V.responseText),null!==a?w(a):(y("No results from place-order, calling ajaxRedirect"),m.ajaxRedirect())):(y("Error calling place-order, calling ajaxRedirect"),m.ajaxRedirect()))}function q(){J=1;T&&clearTimeout(T);U&&clearTimeout(U);var a=F("#currencyChanged");0<a.length&&"true"===a.val()&&(a='\x3cinput type\x3d"hidden" name\x3d"checkoutCurrencySelection.'+F("#tfx-switch-currency-options").find("input:radio:checked").val()+
'" /\x3e',F("#spc-form-inputs").append(a));F("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");a=(new Date).getTime()-Y;F("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'waitingTime' value\x3d'"+a+"' /\x3e");F("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'returnjson' value\x3d'1' /\x3e");R&&F("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'isAsyncTYPEnabled' value\x3d'1' /\x3e");var a=F("#spc-form").serialize(),b=F("#typ-desktop-frame").contents().find("input#cached-promise-data");
0<b.length&&(a+="\x26cachedPromiseData\x3d"+b.val());if(da){if(t.XMLHttpRequest)V=new XMLHttpRequest;else if(t.ActiveXObject)try{V=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(c){V=null}if(!V){y("Can't get XMLHttpRequest for data stream, calling standard placeOrderController");J=1;g.placeOrderClick();return}V.open("POST","/gp/buy/spc/handlers/place-your-decoupled-order.html",!0);V.setRequestHeader("Content-type","application/x-www-form-urlencoded");V.setRequestHeader("Content-length",a.length);V.setRequestHeader("Connection",
"close");V.onreadystatechange=u;V.overrideMimeType("text/plain");V.send(a)}else F.ajax({type:"POST",url:"/gp/buy/spc/handlers/place-your-decoupled-order.html",data:a,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return h.jsonify(a)},success:function(a,b,c){null!==a?w(a,b,c):(y("No results from place-order, calling ajaxRedirect"),m.ajaxRedirect())},error:function(a,b,c){y("Error calling place-order, calling ajaxRedirect");m.ajaxRedirect(a,b,c)}});"function"===typeof t.uet&&t.uet("bb","ajax-typ:place-your-order",
{wb:1})}function v(){P=L=E=0;F("div#typ-desktop").empty()}function l(a,d,e){E||(E=1,clearTimeout(U),L=0,P=1,Q++,(a=F("#typ-desktop-frame").contents().find("span#typ-rewrite-url"))&&0<a.length&&(a=a.attr("data-requestid"),c("ajax-typ:place-your-order"),Z?W=a:(p.setAsyncRequestId(a),b("ajax-typ:place-your-order",a))),S?r():!J&&5>Q&&(T=setTimeout(function(){v();O()},12E4)))}function O(){if(!(J||L||5<=Q)){L=1;var a=F("span#typ-load").attr("data-typ-args");U=setTimeout(function(){v();S&&(y("Timed out waiting for TYP fetch after place-order, redirecting to static TYP"),
A())},45E3);F("\x3ciframe /\x3e",{name:"typ-desktop-frame",id:"typ-desktop-frame",width:"100%",height:"100%",frameborder:"0",src:"/gp/buy/thankyou/handlers/display.html?"+a}).appendTo("div#typ-desktop").load(l)}}function K(){l()}function B(){n.isSpc()&&0<F("span#typ-load").length&&(Y=(new Date).getTime(),Q=0,F("div#typ-desktop").length?v():F("body").append('\x3cdiv id\x3d"typ-desktop" style\x3d"position:absolute;left:0;right:0;bottom:0;top:0;display:none;"\x3e\x3c/div\x3e'),da=F("span#typ-load").attr("data-early-json-flush")&&
!F("html").hasClass("a-lt-ie10"),R=0<F("span#async-typ-enabled").length,Z=F("span#typ-load").attr("data-use-cds-stub"),F(document).undelegate("span.place-order-button-link","click"),F(document).delegate("span.place-order-button-link","click",function(a){a.preventDefault();Z?(a=p.getscope(),p.setscope("ajax-typ"),p.setctb(),p.resetue(),p.setmarker("tc"),p.setscope(a)):(p.resetMetrics(),p.setmarker("tc"));L||P?(f.show(),q()):(J=1,g.placeOrderClick())}),O())}var F=a.$;if(!F("html").hasClass("a-ie6")){var Q=
0,L=0,J=0,P=0,S=0,E=0,T,U,aa,da=0,Z=0,W,V,ea,x=0,Y=0,R=0;a.on("ajax-typ-cf",K);a.on("checkout:reload:spc",B);a.on("checkout:reload:spp-revieworder",B);a.on("checkout:reload:spclite",B)}});"use strict";r.when("A","client-side-metrics","ajax-utility","button-blocker","button-blocker-popover","spclite-items-viewer","fast-track-controller").register("get-final-results-update",function(a,n,k,m,f,h,g){function p(){for(var b=function(){a.trigger("checkout:spc:ordersummary:sizeChanged")},c=0;20>c;++c)setTimeout(b,
100*c)}function c(a,b){setTimeout(function(){var c=h.prepare(a);c&&y("#spclite-items-operation").show();y("#spclite-items-header-dynamic").fadeIn(b?0:300,function(){c&&y("#spclite-items-operation").find(".spclite-items-view-switch").each(function(){var a=y(this).attr("view-name");a&&y(this).find("a").click(function(){n.increaseCount("SPCLite:ClientSide:SwitchViewClick:"+a,1);h.switchToView(a);y("#spclite-items-operation").fadeOut(b?0:300);p()})})})},b?0:800)}function b(b,c,d){if(b&&y.isArray(b))for(var e=
!1,f=0;f<b.length;f++){var g=b[f];if(g.identifier&&g.content){var h=y("#"+c+"-"+g.identifier);h&&0!==h.length?a.slideDown(h.html(g.content),d?0:500,"ease-out",function(){}):(n.increaseCount("SPCLite:LazyContentPlaceHolderMissing:Item:"+c,1),e||(n.increaseCount("SPCLite:LazyContentPlaceHolderMissing:Page:"+c,1),e=!0))}}}function e(e,f){if(e.presentCVs&&0<e.presentCVs.countOfCVs)d();else{e.orderSummaryHTML&&(a.fadeOut(y("#order-summary-footer"),f?0:250,"ease-out"),a.fadeOut(y("#spc-order-summary"),
f?0:250,"ease-out",function(){y("#spc-order-summary").replaceWith(e.orderSummaryHTML).hide();e.additionalOrderSummaryHTML&&y("#order-summary-footer").html(e.additionalOrderSummaryHTML);a.fadeIn(y("#spc-order-summary"),f?0:400,"ease-out");a.fadeIn(y("#order-summary-footer"),f?0:400,"ease-out")}));e.freshDeliveryMessageHTML&&(y("#lazy-fresh-promise-delivery-message").html(e.freshDeliveryMessageHTML),a.slideDown(y("#lazy-fresh-promise-delivery-message"),f?0:500,"ease-out"),g.spcLiteLazyLoadFastTrack());
b(e.itemToPrimeMembershipDelivery,"lazy-membership-delivery",f);b(e.itemToGiftContentMapping,"lazy-gift-options",f);b(e.itemToShipOfferingMapping,"lazy-ship-method",f);b(e.itemToPromise,"lazy-promise",f);e.freshDeliverySlotInformationHTML&&(y("#lazy-fresh-delivery-slot-information").html(e.freshDeliverySlotInformationHTML),a.slideDown(y("#lazy-fresh-delivery-slot-information"),f?0:250,"ease-out"));e.freshDeliveryInstructionsHTML&&(y("#lazy-fresh-delivery-instructions").html(e.freshDeliveryInstructionsHTML),
a.slideDown(y("#lazy-fresh-delivery-instructions"),f?0:250,"ease-out"));if(e.itemToPromoMapping&&y.isArray(e.itemToPromoMapping))for(var h=y("#items-block"),k=0;k<e.itemToPromoMapping.length;k++){var m=e.itemToPromoMapping[k];"lightningdeal"===m.type?h.find(".lazy-lightning-promo-details-"+m.identifier).removeClass("aok-hidden"):"promotion"===m.type&&h.find(".lazy-promo-details-"+m.identifier).removeClass("aok-hidden")}e.freeShippingId&&y("#"+e.freeShippingId).removeClass("aok-hidden");y("input#isOrderSummaryReady").val(1);
c(e.itemGroupData,f);p()}}function d(){var b=y("#spclite-block-order-place-message").html()||"";m.show("disabled-order-place",b);m.lock();f.create({name:"disabled-order-place",content:b});f.lock();var c=m.getButtonBlocker().data("a-popover-id");a.on("checkout:beforeReload",function(){f.unlock();m.unlock();f.destroy();y("#a-popover-"+c).remove()})}var y=a.$,A,z=function(a,b){function c(){if(f&&0!==f.length){for(var a="",b=0;b<d%3+1;b++)a+=".";f.html(a);d++}}var d=0,e,f;this.start=function(){b&&b.useTextAnimate&&
(d=0,f=a.find(".spclite-loading-text .spclite-processing-indicator"),e=setInterval(c,800))};this.stop=function(){e&&(clearInterval(e),f&&0<f.length&&f.html(""),d=0);a.find(".spclite-loading-spinner").hide();b&&b.showTextAlways||a.find(".spclite-loading-text").hide()}};a.on("checkout:reload:spclite",function(){if(t.__spcliteFinalResultsData)e(t.__spcliteFinalResultsData,!0);else{var a="",b=y("input#executionId").val();b&&(a+="executionId\x3d"+b);return y.ajax({type:"GET",url:"/gp/buy/spclite/handlers/get-final-results.html/ref\x3dox_spclite_get_final_results",
data:a,dataType:"text",async:!0,beforeSend:function(a){A=new z(y("#spclite-order-summary-loading-indicator"),{showTextAlways:!0});A.start();t.uet&&t.uet("bb","SPCLite:ClientSide:Perf:FinalAjax",{wb:1})},success:function(a,b,c){(a=k.jsonify(a))&&!y.isEmptyObject(a)?e(a,!1):d()},error:function(a,b,c){d()},complete:function(a){A.stop();t.uex&&t.uex("ld","SPCLite:ClientSide:Perf:FinalAjax",{wb:1})},cache:!1})}});a.on("checkout:beforeLoadPage",function(){t.__spcliteFinalResultsData=void 0})});"use strict";
r.when("A","client-side-metrics").register("spclite-items-viewer",function(a,n){function k(){var a=f("#spclite-items-block").find(".spclite-item-detail");a&&0<a.length&&(g={},a.each(function(a){a=f(this).attr("entity-id");g[a]=f("\x3cp\x3e\x3c/p\x3e").append(f(this).clone().removeClass("a-span-last")).html()}))}function m(a,c){if(!c||0===c.length)return null;for(var b=f('\x3cdiv class\x3d"a-row spclite-item-view" view-type\x3d"order-by-delivery"\x3e\x3c/div\x3e'),e=c,d=[],h=[],k=0;k<e.length;k++){var m=
e[k];if("normal"!==m.type)h.push(m);else{for(var n=0;n<d.length;)if(m.data.destinationAddressId!==d[n].data.destinationAddressId)n++;else break;for(;n<d.length;)if(m.data.destinationAddressId===d[n].data.destinationAddressId&&m.data.promise.starttime.dayepoch>d[n].data.promise.starttime.dayepoch)n++;else break;d.splice(n,0,m)}}for(e=0;e<h.length;e++)switch(m=h[e],m.type){case "primemembership":d.unshift(m);break;case "vas":case "digital":case "no-promise":case "exception":d.push(m);break;default:d.push(m)}c=
d;for(d=0;d<c.length;d++){h=c[d];if(m=h.content)e='\x3cdiv class\x3d"row spclite-item-group-title"\x3e',m.destination&&(e+='\x3cdiv class\x3d"row destination"\x3e'+m.destination+"\x3c/div\x3e"),m.promise&&(e+='\x3cdiv class\x3d"row promise"\x3e'+m.promise+"\x3c/div\x3e"),e+="\x3c/div\x3e",b.append(e);a:if(m=h.items,g&&m&&0!==m.length){e="";for(k=0;k<m.length;k++){0===k%2&&(e+='\x3cdiv class\x3d"a-row"\x3e');n=m[k].identifier;if(!g[n]){m=null;break a}n=f(g[n]);1===k%2&&n.addClass("a-span-last");e+=
f("\x3cp\x3e\x3c/p\x3e").append(n).html();1===k%2&&(e+="\x3c/div\x3e")}1===m.length%2&&(e+='\x3cdiv class\x3d"a-column a-span6 a-span-last"\x3e\x3c/div\x3e\x3c/div\x3e');m=e}else m=null;if(m)m=f(m),("no-promise"===h.type||"normal"===h.type&&h.data&&h.data.promise&&"scheduled"!==h.data.promise.type)&&m.find(".spclite-promise").hide(),b.append(m);else return null;d<c.length-1&&b.append("\x3chr\x3e")}return b}var f=a.$,h,g;return{prepare:function(a){try{var c;a:{k();if(g){var b=m("order-by-delivery",
a);if(b){h={"order-by-delivery":b};c=!0;break a}}c=!1}return c}catch(e){n.increaseCount("SPCLite:ClientSide:Exception:SwitchViewPrepare",1)}return!1},switchToView:function(a,c){var b;h&&h[a]?b=h[a]:(n.increaseCount("SPCLite:ClientSide:SwitchViewNoPrepared:"+a,1),"order-by-delivery"===a&&(b=m(a,c)));if(b){var e=f("#spclite-items-block");e.find(".spclite-item-view").fadeOut(300,function(){e.empty();e.append(b.clone().hide());e.find(".spclite-item-view").fadeIn(500)})}}}});"use strict";r.when("A","loading-spinner-controller").register("cpf-controller",
function(a,n){function k(a){var h,g,k;if(/^\d{11}$/.test(a)||/^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(a)){a=a.replace(/[^\w\s]|_/g,"");if(/(\d)\1{10}/.test(a))return!1;h=a.substring(0,9);g=a.substring(9);k=0;for(var c=10;1<c;c--)k+=h.charAt(10-c)*c;if((2>k%11?0:11-k%11)!==g.charAt(0))return!1;h=a.substring(0,10);k=0;for(a=11;1<a;a--)k+=h.charAt(11-a)*a;return(2>k%11?0:11-k%11)!==g.charAt(1)?!1:!0}return!1}var m=a.$;a.on("checkout:reload:spp-taxid",function(){m("#useThresholdTaxIdService").length||m("#taxidForm").submit(function(){var a=
m("#taxidregistration-imb");if(!k(m("#taxid-field").val()))return n.hideSpinner(m("#spinner-anchor"),!0),a.show(),!1;a.hide();return!0})})});"use strict";r.when("A","page-conductor","ready").register("taxid-threshold-controller",function(a,n){function k(){var a=m();n.isSPP()?a?(f("#taxid-continue-disabled").hide(),f("#taxid-continue-enabled").show()):(f("#taxid-continue-enabled").hide(),f("#taxid-continue-disabled").show()):a?f("span.#continue").removeClass("a-button-disabled").find('input[type\x3d"submit"]').removeAttr("disabled"):
f("span.#continue").addClass("a-button-disabled").find('input[type\x3d"submit"]').attr("disabled","disabled")}function m(){var a=!0,g=f("#taxIdForm");g.length&&g.find('input[type\x3d"text"]').each(function(){var g=f(this);if(!g.val()||7>g.val().length)g.parents(".taxid-form").find('input[type\x3d"checkbox"]').attr("checked")||(a=!1)});return a}var f=a.$;a.on("checkout:reload:spp-taxid",function(){if(f("#useThresholdTaxIdService").length){var a=f("#taxIdForm");a.length&&(a.find('input[type\x3d"text"]').keyup(k),
a.find('input[type\x3d"checkbox"]').change(k));k()}})});"use strict";r.when("A","page-spinner-controller","ajax-utility","page-conductor","client-side-metrics").execute(function(a,n,k,m,f){function h(){function c(a){if(!d)if(a.preventDefault(),a=encodeURIComponent(g("#spc-deliverytipinput").val()),g("#tip-error").addClass("aok-hidden"),g("#tip-promo-success").addClass("aok-hidden"),g("#tip-success").addClass("aok-hidden"),g("#tip-ineligible").addClass("aok-hidden"),g("#tip-success").addClass("aok-hidden"),
a&&0!==a.length)if(0>a)e("invalidDeliveryTip_NoAmount");else if(/^[0-9]*(\.[0-9]{1,2})?$/.test(a)){n.show();f=g("#spc-deliverytipnoticecheckbox").attr("checked")?1:0;var c=(new Date).getTime();a="tipamount\x3d"+a+"\x26isDefaultTip\x3d"+f+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+g("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+c;c=m.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});g.ajax({type:"POST",
url:"/gp/buy/spc/handlers/add-delivery-tip.html/ref\x3dox_tip_page_delivery_tip_add",data:a,headers:c,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",complete:function(){d=!1;n.hide()},success:b,error:m.ajaxRedirect});d=!1}else e("invalidDeliveryTip_NoAmount");else e("addDeliveryTip_NoAmount")}function b(a,b,c){n.hide()}function e(a){n.hide();g("#tip-error").removeClass("aok-hidden");0<g("div.spc-desktop").length?g("#spc-deliverytipinput").addClass("a-form-error"):
g("#spc-deliverytipinput").closest(".a-input-text-wrapper").addClass("a-form-error");g("#"+a).removeClass("aok-hidden")}var d=!1,f=0;p&&(a.declarative("tip-element",["click"],function(a){var b=a.data.click;b&&null!==b&&c(a.$event)}),p=!1)}var g=a.$;if(!g("html").hasClass("a-ie6")){var p=!0;a.on("checkout:reload:spc",h);a.on("checkout:reload:spclite",h)}});"use strict";r.when("A","checkout-general-utils","page-conductor","loading-spinner-controller").register("checkout-feedback-controller",function(a,
n,k,m){function f(){if(!g||"function"!==typeof g)return"";var a=g(),c="";if(a)for(var b in a)if("number"===typeof a[b]||"string"===typeof a[b]||"boolean"===typeof a[b])c+="\x26__pagedata_"+b+"\x3d"+a[b];return c}var h=a.$,g;a.declarative("checkout-submit-feedback",["click","touchend"],function(a){if(!n.protectAgainstDoubleAction("checkout-submit-feedback",200)&&(a=h("#checkout-feedback-form"),a.length)){m.showSpinner(a,!1);var c=a.serialize(),c=c+f();h.ajax({type:"POST",url:a.attr("action"),data:c,
dataType:"text",error:k.ajaxRedirect,success:function(a,c,d){c=d.getResponseHeader("checkout-feedback-submitted");h(".a-button-close").trigger("click");null!==c&&void 0!==c&&h("#checkout-feedback-banner").append(a)}})}});return{registerPageDataCollecter:function(a){a&&"function"===typeof a&&(g=a)}}});"use strict";r.when("A","page-spinner-controller","scroll-controller","ajax-utility","page-conductor","checkout-modal-popover","page-detector","checkout-general-utils","a-popover","client-side-metrics").execute(function(a,
n,k,m,f,h,g,p,c,b){function e(){function b(a){a=a.$currentTarget.closest(".delivery-instructions-block");a.find(".edit-delivery-instructions-link").addClass("aok-hidden");a.find(".delivery-instructions-display").addClass("aok-hidden");var c=a.find(".dynamic-delivery-instructions-update").find(".delivery-instructions-input").attr("maxlength");a.find(".dynamic-delivery-instructions-update").removeClass("aok-hidden");d("#deliveryInstructions").focus();d("#deliveryInstructions").select();d("#deliveryInstructions").keydown(function(a){10===
a.which&&a.preventDefault()});d("#deliveryInstructions").keyup(function(){d("#delivery-instructions-left-text").hasClass("aok-hidden")&&d("#delivery-instructions-left-text").removeClass("aok-hidden");var a=c-d(this).val().length;0>a&&(a=0);d("#delivery-instructions-left").text(a)});setTimeout(function(){},500)}function c(a){n.show();a=a.$currentTarget;var b=d("#deliveryInstructions").val(),g=a.closest(".delivery-instructions-block"),h=a.closest(".dynamic-delivery-instructions-update");g.find(".edit-delivery-instructions-link").removeClass("aok-hidden");
g.find(".delivery-instructions-display").removeClass("aok-hidden");h.addClass("aok-hidden");g=(new Date).getTime();b="deliveryInstructions\x3d"+encodeURIComponent(b)+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+d("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+g;g=f.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});d.ajax({type:"POST",url:"/gp/buy/spc/handlers/add-delivery-instructions.html/ref\x3dox_instructions_page_delivery_instructions_update",
data:b,headers:g,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",complete:function(){n.hide()},success:e,error:f.ajaxRedirect});a.blur()}function e(a,b,c){(a=m.jsonify(a))&&!d.isEmptyObject(a)&&d("#deliveryInstructionsDisplay").html(a.deliveryInstructions);n.hide()}y&&(a.declarative("edit-delivery-instructions",["click"],b),a.declarative("update-delivery-instructions",["click"],c),y=!1)}var d=a.$;if(!d("html").hasClass("a-ie6")){var y=!0;a.on("checkout:reload:spc",
e);a.on("checkout:reload:spclite",e)}});"use strict";r.when("A","page-conductor").register("installments-service",function(a,n){var k=a.$;return{call:function(a,f,h){k.ajax({type:"POST",url:"/gp/buy/installments/handlers/set-item-installments.html/ref\x3dox_spc_inst_toggle",data:{itemId:a,programId:f},dataType:"text",async:!0,cache:!1,headers:n.setAjaxTransitionHeader(),success:h.success||null,error:h.error||null})}}});"use strict";r.when("A","page-transition-controller","page-conductor","page-detector",
"button-blocker","installments-service").register("installments-controller",function(a,n,k,m,f,h){function g(){a.defer(c)}function p(a,b,c){n.hide();k.ajaxUpdatePage(a,b,c,{pushNewFrame:"false"})}function c(){var a=b("#installments-button-blocker");1===a.length&&(a=a.data("blocker-message"),f.show("place-order-installments-blocker",a))}var b=a.$;a.declarative("installments-sync-state",["change"],function(a){var b=a.data.itemId;a=a.$target.is(":checked")?a.data.programId:"";var c={success:p,error:k.ajaxRedirect};
n.show();h.call(b,a,c)});a.on("checkout:reload:spp-revieworder",g);a.on("checkout:reload:spc",g)});"use strict";r.when("A","page-conductor","checkout-modal-popover","page-transition-controller","ajax-utility","page-detector","payments-portal-common","ready").register("spc-payments-portal",function(a,n,k,m,f,h,g){function p(b,c){var f={refTag:c,callbackBeforePageUpdate:function(){a.$("div.a-popover button.a-button-close").trigger("click")}};n.isSPP()&&(f.keepCachedPagesData=1);n.loadPage("spc",b,null,
f)}function c(a,c,f){n.isSPP()?(m.blockAllActions(),m.showTransitionInContainer(b("#payment"))):m.show();a="/gp/buy/spc/handlers/pmts-continue-widget.html/ref\x3d"+a;var g=n.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});b.ajax({type:"POST",url:a,data:c,headers:g,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",success:function(a,b,c){c.getResponseHeader("x-amz-checkout-page")?n.ajaxUpdatePage(a,b,c):f(a)},error:n.ajaxRedirect})}
var b=a.$;return{prepareDelegatedPopovers:function(c){function d(a,c){var d=b(a);d.data("aCheckoutModalPopover",c);k.createModal({$declarativeParent:d},c)}a.on("pmts:retail:billing-address-popover",function(a){d(".pmts-change-address-link",{header:c.billingAddressPopoverHeader,footer:"",name:"billing-address",allowScrollOnPage:!0})});a.on("pmts:retail:rewards-registration",function(a){d(".pmts-shop-with-points-learn-more-link",{header:c.rewardsRegistrationPopoverHeader,footer:"",name:"rewards-registration",
allowScrollOnPage:!0})})},handleClaimCodeSubmittedEvent:function(a,d){var f={returnjson:"1",returnFullHTML:"1",hasWorkingJavascript:"1",fromAnywhere:b("input[name\x3dfromAnywhere]").val(),cachebuster:(new Date).getTime(),nextAction:"pipeline-dispatch",embedOnlyData:"1"},f=b.param(a)+"\x26"+b.param(f);c("ox_pay_page_gc_add",f,function(a){g.claimCodePageUpdater(d,a)})},handleChangeBillingAddressRequestedEvent:function(){h.isDesktopSpc()?n.isSPP()?b("#pmts-change-billing-address-popover").trigger("click"):
a.trigger("pmts:retail:billing-address-popover"):(m.show(),n.isPipeliningOn()&&p("billingaddressselect","ox_spc_change_ship_addr"))},handleChangePaymentInstrumentRequestedEvent:function(){m.show();n.isPipeliningOn()&&p("payselect","ox_spc_change_payment")},handleRewardsAccountLearnMoreRequestedEvent:function(){a.trigger("pmts:retail:rewards-registration")},handlePointsAccountSubmittedEvent:function(a){var d={hasWorkingJavascript:"1",isClientTimeBased:b("input[name\x3duseCtb]").val(),nextAction:"dispatch"};
a=b.param(a)+"\x26"+b.param(d);c("ox_spc_points_edit",a,function(a){a=f.jsonify(a);n.redirect(a)})}}});"use strict";r.when("ajax-utility","gc-redeem-controller","page-transition-controller","ready").register("payments-portal-common",function(a,n,k){return{claimCodePageUpdater:function(m,f){var h=a.jsonify(f);null!==h?h.widgetJsonData?(m.update(h.widgetJsonData),k.hide()):h.autohandlererror&&n.giftSystemErrorHandling(h.autohandlererror):k.hide()}}});"use strict";r.when("A","page-detector-current-page",
"a-button","a-meter").register("checkout-throttle-error",function(a,n,k,m){var f=a.$;a.on("checkout:reload:throttle",function(){if(f("#checkout-throttle-meter").length){var a=1E3*f('input[name\x3d"waiting-time"]').val()/100;k("#checkout-throttle-return-to-cart").disable();var g=m("#checkout-throttle-meter"),n=0,c=setInterval(function(){g.percent(n);if(100>n)n+=1;else{clearInterval(c);var a=k("#checkout-throttle-return-to-cart");a.text(f("#checkout-throttle-primary-button-active-text").text());a.enable()}},
a)}})});"use strict";r.when("A","weblab-helper").register("nav-bar-helper",function(a,n){function k(){try{r.register("navCF")}catch(a){if(-1===a.message.toLowerCase().indexOf("component already registered"))throw a;}}if(n.isNavCFWeblabOn())a.on("checkout:reload",k)});"use strict";r.when("A","a-dropdown","a-button","a-alert","page-spinner-controller","page-conductor","checkout-general-utils").register("pets-rx-handler",function(a,n,k,m,f,h,g){function p(a){u(a).find(v.buttons.edit).show();u(a).find(v.petInfo.summary).prop("hasSummary")?
u(a).find(v.rx.summary).show():u(a).find(v.rx.summary).hide();u(a).find(v.petInfo.section).hide();u(a).find(v.vetInfo.section).hide();u(a).find(v.buttons.section).hide()}function c(a){u(a).find(v.petInfo.form).show();var b=Number(u(a).find(v.petInfo.savedPetsCount).val()),c=u(a).find(v.petInfo.savedPetsDiv);0<b?c.show():c.hide();u(a).find(v.petInfo.section).show()}function b(a){u(a).find(v.vetInfo.form).show();var b=Number(u(a).find(v.vetInfo.savedVetsCount).val()),c=u(a).find(v.vetInfo.savedVetsDiv),
d=u(a).find(v.vetInfo.searchClinicButton);0<b?(c.show(),d.hide()):(c.hide(),d.show());var b=u(a).find(v.vetInfo.savedVets),b=n.getSelect(b)?n.getSelect(b).val():"",c=u(a).find(v.vetInfo.name),d=u(a).find(v.vetInfo.phone),e=u(a).find(v.vetInfo.address);0<b.length||0!==q(c.val()).length||0!==q(e.val()).length||0!==q(d.val()).length?u(a).find(v.vetInfo.newVet).show():u(a).find(v.vetInfo.newVet).hide();u(a).find(v.vetInfo.section).show()}function e(e){u(e).hide();u(e).find(v.buttons.edit).hide();u(e).find(v.rx.summary).hide();
c(e);b(e);d(e,!1);u(e).find(v.buttons.section).show();a.slideDown(u(e),500,"ease",function(){})}function d(a,b,c){var d=[],e=u(a).find(v.petInfo.name);0===q(e.val()).length&&d.push(e);var e=u(a).find(v.petInfo.weight),f=u(a).find(v.petInfo.weightLimit),g=e.val(),f=f.val(),g=q(g);0!==g.length&&/^\d+$/.test(g)&&!(Number(g)>Number(f)||0>=Number(g))||d.push(e);e=u(a).find(v.petInfo.typeListSelect);0===n.getSelect(e).val().length&&d.push(u(a).find(v.petInfo.typeList+" .a-button"));e=u(a).find(v.vetInfo.name);
0===q(e.val()).length&&(d.push(e),e.is(":visible")||(d.push(u(a).find(v.vetInfo.savedVetsList+" .a-button")),d.push(u(a).find(v.vetInfo.searchButton))));e=u(a).find(v.vetInfo.phone);0===q(e.val()).length&&(d.push(e),e.is(":visible")||(d.push(u(a).find(v.vetInfo.savedVetsList+" .a-button")),d.push(u(a).find(v.vetInfo.searchButton))));if(e=c){a:{for(e=0;e<d.length;e++)if(c&&d[e]&&c[0]===d[e][0]){e=!0;break a}e=!1}e=!e}e&&(c.removeClass("a-form-error").removeClass("a-button-error"),c.is("select")&&c.siblings(".a-button").removeClass("a-button-error"));
if(b)for(b=0;b<d.length;b++)c=d[b],c.is("input")?c.addClass("a-form-error"):c.addClass("a-button-error");a=k(u(a).find(v.buttons.save));0<d.length?a.disable():a.enable();return 0===d.length}function t(a){var b=u(a).find(v.petInfo.typeListSelect),c=q(u(a).find(v.vetInfo.clinicId).val()),d=q(u(a).find(v.vetInfo.name).val()),e=q(u(a).find(v.vetInfo.phone).val()),f=q(u(a).find(v.vetInfo.address).val());if(0<c.length){var g=u(a).find(v.vetInfo.savedVets),g=n.getSelect(g).val();0<g.length&&(g=JSON.parse(g),
g.clinicName!==d||g.phone!==e)&&(c="")}return{petInfo:{id:u(a).find(v.petInfo.id).val(),name:q(u(a).find(v.petInfo.name).val()),type:n.getSelect(b).val(),weight:q(u(a).find(v.petInfo.weight).val()),weightUnit:u(a).find(v.petInfo.weightUnit).val()},vetInfo:{id:u(a).find(v.vetInfo.id).val(),clinicName:d,phone:e,address:f,clinicId:c},lineItemId:u(a).find(v.rx.lineItemId).val(),rxId:u(a).find(v.rx.rxId).val()}}function A(a){var b=u(a).parents(v.rx.box).find(v.rx.errorMsg);b.parent().hide();d(a,!0)&&(f.show(),
r(t(a),function(a,c,d){try{var e=JSON.parse(a);if(e.error){m(b).text(e.error);b.parent().show();f.hide();return}e.redirect&&h.ajaxRedirect()}catch(g){h.ajaxRedirect()}h.reloadPage()},h.ajaxRedirect))}function r(a,b,c){u.ajax({type:"POST",url:"/gp/buy/prescription/handlers/pets-save-rx.html",async:!0,cache:!1,dataType:"text",headers:{"x-amz-checkout-page":"spc"},data:{petId:a.petInfo.id,petName:a.petInfo.name,petType:a.petInfo.type,petWeight:a.petInfo.weight,petWeightUnit:a.petInfo.weightUnit,vetId:a.vetInfo.id,
clinicName:a.vetInfo.clinicName,clinicPhone:a.vetInfo.phone,clinicAddress:a.vetInfo.address,clinicId:a.vetInfo.clinicId,lineItemId:a.lineItemId,rxId:a.rxId,returnJson:1,hasWorkingJavascript:1},success:b,error:c})}function C(a){return u(a).closest(v.rx.section)}function w(){if(0<u(v.rx.section).length)for(var a=u(v.rx.section),b=!1,c=0;c<a.length;c++){if(b||d(a[c],!1)){if(d(a[c],!1)){var f=a[c],g=q(u(f).find(v.petInfo.name).val()),h=q(u(f).find(v.petInfo.weight).val()),k=u(f).find(v.petInfo.typeListSelect),
k=q(n.getSelect(k).val()),m=q(u(f).find(v.vetInfo.name).val()),w=q(u(f).find(v.vetInfo.phone).val()),t=u(f).find(v.petInfo.weightUnit).val();u(f).find(v.petInfo.summary).html(g+" - "+k+" - "+h+"("+t+")");u(f).find(v.petInfo.summary).prop("hasSummary",!0);u(f).find(v.vetInfo.summary).html(m+" - "+w);u(f).find(v.vetInfo.summary).prop("hasSummary",!0)}p(a[c])}else e(a[c]),b=!0;f=a[c];g=u(f).find(v.petInfo.typeListSelect);n.setValue(g,n.getSelect(g).val());g=u(f).find(v.petInfo.savedPets);n.setValue(g,
n.getSelect(g).val());f=u(f).find(v.vetInfo.savedVets);n.setValue(f,n.getSelect(f).val())}}var u=a.$,q=u.trim,v={rx:{box:".pets-rx-box",section:".pets-rx-info",lineItemId:".pets-rx-lineitem-id",rxId:".pets-rx-id",errorMsg:".pets-rx-error-msg",summary:".pets-rx-summary"},petInfo:{section:".pets-rx-pet-info",summary:".pets-rx-pet-summary",form:".pets-rx-pet-form",newPet:".pets-rx-new-pet-info",savedPetsDiv:".pets-rx-saved-pets",savedPets:".pets-rx-saved-pets select",savedPetsCount:".pets-rx-saved-pets-count",
id:".pets-rx-pet-id",name:"input[name\x3dpets-rx-pet-name]",typeList:".pets-rx-type-list",typeListSelect:".pets-rx-type-list select",weight:"input[name\x3dpets-rx-pet-weight]",weightUnit:".pets-rx-pet-weight-unit",weightLimit:".pets-rx-pet-weight-limit"},vetInfo:{section:".pets-rx-vet-info",summary:".pets-rx-vet-summary",form:".pets-rx-vet-form",newVet:".pets-rx-new-vet-info",savedVetsDiv:".pets-rx-saved-vets",savedVetsList:".pets-rx-saved-vets-list",savedVets:".pets-rx-saved-vets select",savedVetsCount:".pets-rx-saved-vets-count",
id:".pets-rx-vet-id",name:"input[name\x3dpets-rx-clinic-name]",phone:"input[name\x3dpets-rx-clinic-phone]",address:"input[name\x3dpets-rx-clinic-address]",clinicId:".pets-rx-clinic-id",searchButton:".pets-rx-search-button",currentSelect:".pets-rx-vet-current-select",searchClinicButton:".pets-rx-search-vet"},buttons:{section:".pets-rx-actions",cancel:".pets-rx-cancel",save:".pets-rx-save",edit:".pets-rx-edit"},popover:{lineItemId:"#pets-rx-search-lineItemId",searchInput:"#pets-rx-search-input"}};a.declarative("pets-rx-save",
["click","touchend"],function(a){a.$event.preventDefault();a=C(a.$target);A(a)});a.declarative("pets-rx-edit",["click","touchend"],function(a){a.$event.preventDefault();a=C(a.$target);for(var b=u(v.rx.section),c=0;c<b.length;c++)a[0]===b[c]?e(b[c]):p(b[c])});a.declarative("pets-rx-saved-pets",["change"],function(a){var b=a.$target;if(a=JSON.parse(n.getSelect(u(b)).val()))b=C(b),u(b).find(v.petInfo.id).val(a.petId?a.petId:""),u(b).find(v.petInfo.name).val(a.petName?a.petName:""),u(b).find(v.petInfo.weight).val(a.petWeight&&
0<a.petWeight?a.petWeight:""),n.getSelect(u(b).find(v.petInfo.typeListSelect)).setValue(a.petType),u(b).find(v.petInfo.name).change(),u(b).find(v.petInfo.weight).change()});a.declarative("pets-rx-saved-vets",["change"],function(a){var b=a.$target;a=C(b);u(a).find(v.vetInfo.savedVetsList+" .a-button").removeClass("a-button-error");var c=n.getSelect(u(b)).val();if(c=c&&0<c.length?JSON.parse(c):void 0)c.vetId&&"Search"===c.vetId?(b=u(a).find(v.vetInfo.savedVets),n.getSelect(b)&&n.getSelect(b).setValue(u(a).find(v.vetInfo.currentSelect).val()),
a.find(v.vetInfo.searchButton).click()):(u(v.vetInfo.currentSelect).val(n.getSelect(u(b)).val()),u(a).find(v.vetInfo.id).val(c.vetId?c.vetId:""),u(a).find(v.vetInfo.name).val(c.clinicName?c.clinicName:""),u(a).find(v.vetInfo.clinicId).val(c.clinicId?c.clinicId:""),u(a).find(v.vetInfo.phone).val(c.phone?c.phone:""),u(a).find(v.vetInfo.address).val(c.address?c.address:""),u(a).find(v.vetInfo.newVet).show(),u(a).find(v.vetInfo.name).change(),u(a).find(v.vetInfo.phone).change())});a.declarative("pets-rx-input",
["change"],function(a){var b=C(a.$target);d(b,!1,a.$target)});a.declarative("pets-rx-weight",["keydown"],g.limitInputToNumbers);a.declarative("pets-rx-search",["click","touchend"],function(a){a=C(a.$target);var b=u(a).find(v.rx.lineItemId).val();u(v.popover.lineItemId).val(b);u(a).find(v.vetInfo.searchClinicButton).removeClass("a-button-error")});a.on("checkout:reload:spc",w);a.on("checkout:reload:spclite",w);a.on("checkout:reload:spp-revieworder",w)});r.when("A","a-dropdown","page-detector").register("pets-rx-search",
function(a,n,k){function m(a,b,c){d(r.spinner).hide();h();d(r.searchResult).html(a).show()}function f(){d(r.spinner).hide();h()}function h(){var a=t(d(r.searchInput).val());d(r.searchResultKeyword).html(a);d(r.searchResultTitle).show()}function g(a){d(r.searchInput).val("");d(r.searchResultTitle).hide();d(r.searchResult).hide();a.closest(r.popoverWrapper).find(r.closeButton).click()}function p(a,b,c,e){var f=d(r.lineItemId).val();d(r.lineItemInput).each(function(){if(d(this).val()===f){var g=d(this).closest(r.rxInfo),
h=g.find(r.vetInfo.savedVets),k;a:{k=n.getSelect(h).getOptions();for(var m=0;m<k.size();m++){var p=JSON.parse(k.options.elements[m].val());if(0<p.clinicId.length&&p.clinicId===a){k=k.options.elements[m].val();break a}}k=""}h=n.getSelect(h);0===k.length&&(k=JSON.stringify({vetId:"",clinicId:a,clinicName:b,phone:c,address:e}),h.addOption({text:b,value:k}),m=Number(g.find(r.vetInfo.savedVetsCount).val()),g.find(r.vetInfo.savedVetsCount).val(m+1));h.setValue(k);g.find(r.savedVetList).is(":visible")||
(g.find(r.savedVetList).show(),g.find(r.searchClinicButton).hide());g.find(r.vetInfo.newVet).show();g.find(r.vetInfo.name).focus()}})}function c(){var a=d(r.lineItemId).val();d(r.lineItemInput).each(function(){if(d(this).val()===a){var b=d(this).closest(r.rxInfo),c=b.find(r.vetInfo.savedVets);n.getSelect(c).setValue("");b.find(r.vetInfo.clinicId).val("");b.find(r.vetInfo.id).val("");b.find(r.vetInfo.name).val("").change().focus();b.find(r.vetInfo.phone).val("").change();b.find(r.vetInfo.address).val("");
b.find(r.vetInfo.newVet).show()}})}function b(){var a="desktop";k.isMobile()?a="mobile":k.isTablet()&&(a="tablet");return a}function e(){var a=t(d(r.searchInput).val());0!==t(a).length&&(d(r.searchResult).hide().empty(),d(r.searchResultTitle).hide(),d(r.spinner).show(),d.ajax({type:"GET",url:"/gp/buy/prescription/handlers/pets-search-clinic.html",async:!0,cache:!1,dataType:"text",data:{searchKeyword:a,device:b()},success:m,error:f}))}var d=a.$,t=d.trim,r={searchInput:"#pets-rx-search-input",searchResultTitle:".pets-rx-search-result-title-section",
searchResult:".pets-rx-search-result",searchResultKeyword:".pets-rx-search-result-keyword",spinner:".pets-rx-spinner",resultPage:".pets-rx-search-result-page",resultPrefix:"#pets-rx-search-page-",popoverWrapper:".a-popover-wrapper",closeButton:".a-button-close",clinicBox:".pets-rx-clinic-box",clinicId:".pets-rx-search-clinic-id",clinicName:".pets-rx-search-clinic-name",clinicPhone:".pets-rx-search-clinic-phone",clinicAddress:".pets-rx-search-clinic-address",lineItemId:"#pets-rx-search-lineItemId",
lineItemInput:".pets-rx-lineitem-id",rxInfo:".pets-rx-info",newClinic:"#pets-rx-search-new-clinic",savedVetList:".pets-rx-saved-vets",searchClinicButton:".pets-rx-search-vet",vetInfo:{newVet:".pets-rx-new-vet-info",savedVets:".pets-rx-saved-vets select",savedVetsCount:".pets-rx-saved-vets-count",id:".pets-rx-vet-id",name:"input[name\x3dpets-rx-clinic-name]",phone:"input[name\x3dpets-rx-clinic-phone]",address:"input[name\x3dpets-rx-clinic-address]",clinicId:".pets-rx-clinic-id"}};a.declarative("pets-rx-search-button",
["click","touchend"],function(a){e()});a.declarative("pets-rx-search-enter",["click","touchend"],function(a){c();g(a.$target)});a.declarative("pets-rx-my-vet",["click","touchend"],function(a){var b=d(a.$target).closest(r.clinicBox),c=b.find(r.clinicId).val(),e=b.find(r.clinicName).html(),f=b.find(r.clinicAddress).html(),b=b.find(r.clinicPhone).html();p(c,e,b,f);g(a.$target)});a.declarative("pets-rx-search-input",["keypress"],function(a){13===a.$event.keyCode&&e()});a.on("a:popover:afterShow:pets-rx-search",
function(){setTimeout(function(){d(r.searchInput).focus()},500)})});r.when("A").register("pets-rx-search-pagination",function(a){function n(a,c){if(0<a.find("a").length)a.find("a").prop("href",c);else{a.removeClass("a-disabled");var d=g('\x3ca href\x3d"'+c+'"\x3e\x3c/a\x3e').html(a.html());a.empty().append(d)}}function k(a){if(0!==a.find("a").length){var c=a.find("a");a.addClass("a-disabled").empty().html(c.html())}}function m(a){a=g('\x3ca href\x3d"'+c.resultPrefix+a+'"\x3e'+a+"\x3c/a\x3e");return g("\x3cli\x3e\x3c/li\x3e").addClass("a-normal").append(a)}
function f(){return g("\x3cli\x3e...\x3c/li\x3e").addClass("a-disabled")}function h(a){g(c.resultPage+":visible").fadeOut(400,function(){g(c.resultPrefix+a).show();p=!1})}var g=a.$,p=!1,c={resultPage:".pets-rx-search-result-page",resultPrefix:"#pets-rx-search-page-"};a.declarative("pets-rx-search-pagination",["click","touchend"],function(a){a.$event.preventDefault();if(!p){var e=g(c.resultPage).length,d=g(c.resultPage+":visible").prevAll().length+1,r=a.$target.closest("li");if(!(1>r.find("a").length||
(a=r.find("a").attr("href"),a=Number(a.substring(a.lastIndexOf("-")+1)),isNaN(a)||a===d))){p=!0;d=r.closest("ul");r=d.children().first();1===a?k(r):n(r,c.resultPrefix+(a-1));r=d.children().last();a===e?k(r):n(r,c.resultPrefix+(a+1));var t=e-3;if(5<e){var z=d.children().first(),r=d.children().last();d.empty().append(z);4>a?(z=1,t=4):a>t?(z=t,t=e):(z=a-1,t=a+1);1!==z&&(d.append(m(1)),d.append(f()));for(;z<=t;z++)d.append(m(z));t!==e&&(d.append(f()),d.append(m(e)));d.append(r)}e=d.children();for(d=1;d<
e.length-1;d++)1>e.eq(d).find("a").length||(r=e.eq(d).find("a").attr("href"),Number(r.substring(r.lastIndexOf("-")+1))===a?e.eq(d).removeClass("a-normal").addClass("a-selected"):e.eq(d).hasClass("a-selected")&&e.eq(d).removeClass("a-selected").addClass("a-normal"));h(a)}}})})});
/* ******** */
(function(m){var k=window.AmazonUIPageJS||window.P,aa=k._namespace||k.attributeErrors,a=aa?aa("CheckoutMultiPagePipeline"):k;a.guardFatal?a.guardFatal(m)(a,window):a.execute(function(){m(a,window)})})(function(m,k,aa){m.when("A","a-tooltip").register("button-blocker-mpp",function(a,c){var d=a.$;a.declarative("a-tooltip-button-blocker",["mouseenter","click","touchstart"],function(a){a=a.$target;if(0<a.length){var b=c.get(a),g=d(".place-order-blocker-message.custom-blocker-message");if(g.is(":empty")){var h=
d("#gold-box-button-blocker");1===h.length&&g.text(h.attr("data-blocker-message"))}g.is(":empty")&&d("div.locale-cn").length&&(g=d(".place-order-blocker-message.china-invoice-message"));b?b.updateContent(g.text()):b=c.create(a,{content:g.text()});b.isActive()||b.show()}})});m.when("A","a-popover-base","a-popover-util","button-blocker").register("button-blocker-popover",function(a,c,d,f){function b(a,e){if(e.name)c.show({$trigger:a?a.$target:f.getButtonBlocker(),skin:p,alone:!1,update:n,hide:k,content:e.content,
name:e.name,position:e.position||"triggerVertical"});else{var b=c.show({$trigger:a.$target,skin:p,alone:!1,update:n,hide:k,content:a.$currentTarget.data("blockerText"),position:e.position||"triggerVertical"});b&&(b.update(a.$currentTarget.data("blockerText")),b.updatePosition())}}function g(e){var b=e?e.$target:f.getButtonBlocker();b&&a.delay(function(){e&&d.eventOccursWithin(e,b)||c.hide(b)},250)}var h=a.$,p=function(a){return['\x3cdiv class\x3d"a-popover"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',
'\x3cdiv class\x3d"a-popover-inner"\x3e'+a+"\x3c/div\x3e",'\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")},B=!1,n=function(a){B||h(".a-popover-inner",this.$popover).html(a)},k=function(){B||a.fadeOut(this.$popover,250)},v={mouseenter:b,mouseleave:g},e={click:b};a.declarative("a-button-blocker",["mouseenter","mouseleave","click"],function(b){try{b.$event.preventDefault()}catch(c){if(!h("html").hasClass("a-lt-ie9"))throw c;
}if(!B){var d=(a.capabilities.touch?e:v)[b.type];d&&d(b,b.data)}});return{create:function(a){a&&a.name&&a.content&&b(null,a)},destroy:function(a){g(null)},lock:function(){B=!0},unlock:function(){B=!1}}});"use strict";m.when("jQuery").register("form-icon-controller",function(a){function c(a){a.is(":checked")?a.closest("label").find("i").removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active"):a.closest("label").find("i").removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive");
a.is(":disabled")?a.closest("label").addClass("a-touch-selector-disabled"):a.closest("label").removeClass("a-touch-selector-disabled")}function d(a){a.is(":checked")?a.closest("label").find("i").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"):a.closest("label").find("i").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");a.is(":disabled")?a.closest("label").addClass("a-touch-selector-disabled"):a.closest("label").removeClass("a-touch-selector-disabled")}
function f(){a("label.a-touch-checkbox-control input").each(function(b){c(a(this))});a("label.a-touch-radio-control input").each(function(b){d(a(this))})}function b(){a("label.a-touch-checkbox-control input").unbind("change.form-icon-controller").bind("change.form-icon-controller",function(b){c(a(this))});a("label.a-touch-radio-control input").unbind("change.form-icon-controller").bind("change.form-icon-controller",function(b){d(a(this))});a("label.a-touch-radio-control").unbind("click.form-icon-controller").bind("click.form-icon-controller",
function(b){b=a("input",this);if(!b.is(":disabled")){var c=a("i.a-icon",this),d=a('i[data-a-input-name\x3d"'+b.attr("name")+'"]'),g=a('input[name\x3d"'+b.attr("name")+'"]');g.removeAttr("checked");b.attr("checked","checked");d.addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active");c.addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");g.trigger("change");b.trigger("change")}});a("label.a-touch-checkbox-control").unbind("click.form-icon-controller").bind("click.form-icon-controller",
function(b){b=a("input",this);if(!b.is(":disabled")){var c=a("i.a-icon",this);b.is(":checked")?b.removeAttr("checked"):b.attr("checked","checked");c.toggleClass("a-icon-touch-checkbox-active").toggleClass("a-icon-touch-checkbox-inactive");b.trigger("change")}})}function g(){a("html").hasClass("a-touch")&&(f(),b(),a("label.a-touch-radio-control input").trigger("change"))}m.when("A").execute(function(a){a.on("checkout:reload",g)});return{initializeIconControllers:f,bindIconControllers:b}});"use strict";
m.when("A","checkout-general-utils").register("inline-expander",function(a,c){function d(a){var c=a.parent().find(".a-expander-inner");c.length||(c=f("#"+a.data("expanderContent")));a.data("isShown")&&"false"!==a.data("isShown")?(c.slideUp("fast"),a.data("isShown","false")):(c.slideDown("fast"),a.data("isShown","true"),c=f("#"+a.data("expanderAnchor")),c.length&&f("html, body").animate({scrollTop:c.offset().top},"fast"));a=a.find("i");(a.hasClass("a-icon-collapse")||a.hasClass("a-icon-expand"))&&
a.toggleClass("a-icon-collapse").toggleClass("a-icon-expand")}var f=a.$;a.declarative("a-inline-expander",["click","touchend"],{allowLinkDefault:!0},function(a){a.$event.preventDefault();c.protectAgainstDoubleAction("a-inline-expander",400)||d(f(a.$event.currentTarget))});return{toggleExpander:d}});"use strict";m.when("jQuery").register("checkout-pagination",function(a){function c(a,b,c,g,f){var v=b.find("li.checkout-page-selector.a-selected").removeClass("a-selected");a.find("js-hide").hide().removeClass("js-hide");
d(v,a,b,c,f,g);g.height(g.height())}function d(a,c,d,n,k,v){if(!a.hasClass("a-selected")){var e=parseInt(a.text(),0)-1,w=parseInt(a.siblings(".a-selected").text(),0)-1,l=d.find(".checkout-page-previous"),q=d.find(".checkout-page-next");c.stop(!0,!0).clearQueue();0===e?b(l):f(l);e===k-1?b(q):f(q);d.find(".checkout-page-selector").removeClass("a-selected");a.addClass("a-selected");a=function(){return c.slice(e*n,e*n+n).fadeIn("fast")};isNaN(w)?a().stop(!0,!0):c.slice(w*n,w*n+n).fadeOut("fast",a);0<
e&&g(v)}}function f(a){a.hasClass("a-disabled")&&(a.removeClass("a-disabled"),a.wrapInner('\x3ca href\x3d"javascript:void(false)"/\x3e'))}function b(a){a.hasClass("a-disabled")||(a.addClass("a-disabled"),a.html(a.children("a").html()))}function g(b){var c=0;b.children().filter(":visible").each(function(){c+=a(this).outerHeight(1)});c>b.height()&&b.height(c)}return{initializePagination:function(b){b.unbind("checkoutpagination.initializePagination").bind("checkoutpagination.initializePagination",function(){var b=
a(this),g=b.find(".checkout-pagination-content"),f=g.children().addClass("checkout-pagination-item"),h=b.find("div.a-pagination"),v=parseInt(h.data("checkoutPaginationItemsperpage"),0)||5;if(0!==v&&0!==h.length){var e=Math.ceil(f.length/v);1===e?h.hide():(c(f,h,v,g,e),b.delegate("li.checkout-page-selector","click",function(b){b.preventDefault();d(a(this),f,h,v,e,g)}),b.delegate("li.checkout-page-previous","click",function(b){b.preventDefault();if(a(this).hasClass("a-disabled"))return!1;d(h.find(".a-selected").prev(),
f,h,v,e,g)}),b.delegate("li.checkout-page-next","click",function(b){b.preventDefault();if(a(this).hasClass("a-disabled"))return!1;d(h.find(".a-selected").next(),f,h,v,e,g)}),g.delegate(".checkout-pagination-item","activate.checkout-pagination",function(){var b=a(this),b=f.index(b);h.find("li:contains("+(Math.floor(b/v)+1)+")").click()}))}}).trigger("checkoutpagination.initializePagination")}}});"use strict";m.register("latency-logger",function(){var a=[],c=[];return{start:function(d){var f=(new Date).getTime();
a.push(f);c.push(d)},stop:function(){var d=(new Date).getTime(),f=a.pop();if(k.log_latency&&k.console&&k.console.log){var b=c.pop();console.log(b+": "+(d-f)+" ms")}}}});"use strict";m.when("page-conductor","ajax-utility","jQuery","page-detector").register("page-conductor-mpp",function(a,c,d,f){a.initFunc(function(a){d("body").html(a)},function(a){var c=d("#checkoutDisplayPage");c.length&&(c.html(a),f.isMobile()&&(d(document).scrollTop(c.offset().top),a=d("h1"),a.attr("tabindex","0").css("outline",
"none"),a.focus()))})});"use strict";m.when("A","loading-spinner-controller","page-conductor").register("long-calendar-popover-controller",function(a,c,d){var f=a.$,b={},g,h,p=0;a.on("a:popover:show:prime-long-calendar",function(a){g=a=a.popover.$trigger.data("orderid");f(".prime-long-calendar-popover").each(function(a){f(this).parent().hasClass("a-popover-inner")&&(h=f(this))});c.showSpinner(h,!1);var n;if(f("#spc-another-day-link").length)n="spc",p=0;else if(n="sosp",p=1,b[g]){f(".prime-long-calendar-popover").html(b[g]);
return}var k;"spc"===n?k=f("input[name\x3dlineitemids"+a+"]").attr("value"):"sosp"===n&&(k=f("input[name\x3dlineItemEntityIds_"+a+"]").attr("value"));f.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/long-calendar-content.html",data:"lineitemids\x3d"+k+"\x26orderid\x3d"+a+"\x26fromPage\x3d"+n,dataType:"html",async:!0,cache:!1,headers:{"x-amz-checkout-page":n},success:function(a){f(a).find("#recs-server-error").length?f(".a-button-close").trigger("click"):f(".prime-long-calendar-popover").html(a)},
error:d.ajaxRedirect})});a.on("a:popover:hide:prime-long-calendar",function(a){p&&(b[g]=h.html())})});"use strict";m.when("A","a-popover-base").execute(function(a,c){function d(a){var g=$(".ags-popover-content").closest(".a-popover-wrapper");g.find(".a-popover-inner").unbind();var f=a.$declarativeParent;if(c.get(f)){var p=setTimeout(function(){c.hide(f)},250);g.find(".a-popover-inner").bind("mouseenter",function(a){clearTimeout(p);a.stopPropagation()});g.find(".a-popover-inner").bind("mouseleave",
function(c){d(a);c.stopPropagation()})}}var f;a.on("a:popover:beforeShow:ags-badge-popover",function(){var a=$(".ags-popover-content").closest(".a-popover-wrapper"),c=a.find(".a-popover-header");1===c.length&&(f=c.find(".a-button-close").clone(),c.remove());a.find(".a-popover-inner").prepend(f)});a.declarative("a-popover","mouseenter",function(a){"ags-badge-popover"===a.data.name&&a.$currentTarget.trigger("click")});a.declarative("a-popover","mouseleave",function(a){"ags-badge-popover"===a.data.name&&
d(a)})});m.when("A","a-dropdown","page-detector","a-button").register("pets-rx-search-mobile",function(a,c,d,f){var b,g;function h(){w(q.searchInput).val("");w(q.resultArea).hide();w(q.buttons.pagination).hide();w(q.searchInput).closest(q.popoverWrapper).find(q.backButton).click()}function p(a,b,e,d){var l=w(q.lineItemId).val();w(q.lineItemInput).each(function(){if(w(this).val()===l){var g=w(this).closest(q.rxInfo),f=g.find(q.vetInfo.savedVets),h;a:{h=c.getSelect(f).getOptions();for(var p=0;p<h.size();p++){var n=
JSON.parse(h.options.elements[p].val());if(0<n.clinicId.length&&n.clinicId===a){h=h.options.elements[p].val();break a}}h=""}f=c.getSelect(f);0===h.length&&(h=JSON.stringify({vetId:"",clinicId:a,clinicName:b,phone:e,address:d}),f.addOption({text:b,value:h}),p=Number(g.find(q.vetInfo.savedVetsCount).val()),g.find(q.vetInfo.savedVetsCount).val(p+1));f.setValue(h);g.find(q.savedVetList).is(":visible")||(g.find(q.savedVetList).show(),g.find(q.searchClinicButton).hide());g.find(q.vetInfo.newVet).show();
g.find(q.vetInfo.name).focus()}})}function B(){var a=w(q.lineItemId).val();w(q.lineItemInput).each(function(){if(w(this).val()===a){var b=w(this).closest(q.rxInfo),e=b.find(q.vetInfo.savedVets);c.getSelect(e).setValue("");b.find(q.vetInfo.clinicId).val("");b.find(q.vetInfo.id).val("");b.find(q.vetInfo.name).val("").change().focus();b.find(q.vetInfo.phone).val("").change();b.find(q.vetInfo.address).val("");b.find(q.vetInfo.newVet).show()}})}function n(){var a="desktop";d.isMobile()?a="mobile":d.isTablet()&&
(a="tablet");return a}function k(a,c,d){w(q.spinner).hide();b=JSON.parse(a);g=1;e()}function v(){w(q.spinner).hide();b=[];g=1;e()}function e(){for(var a=g>b.length?[]:b[g-1].clinics,e=0;3>e;e++){var c=w(q.radioPrefix+e);if(e<a.length){var d=a[e],l=c.closest("label");l.find(q.result.clinicNameText).html(d.name);l.find(q.result.clinicPhoneText).html(d.phoneText);l.find(q.result.clinicAddressText).html(d.address);l.find(q.result.clinicLocationText).html(d.locationText);l.find(q.result.clinicId).val(d.id);
l.find(q.result.clinicName).val(d.name);l.find(q.result.clinicAddress).val(d.address);l.find(q.result.clinicPhone).val(d.phone);c.closest(q.result.section).show()}else c.closest(q.result.section).hide()}w(q.buttons.selectOption).hide();w(q.radios).prop("checked",!1);w(q.resultArea).show();1>=b.length?w(q.buttons.pagination).hide():(1===g?(w(q.buttons.previous).removeClass("a-button-focus"),f(w(q.buttons.previous)).disable()):f(w(q.buttons.previous)).enable(),g===b.length?(w(q.buttons.previous).removeClass("a-button-focus"),
f(w(q.buttons.next)).disable()):f(w(q.buttons.next)).enable(),w(q.buttons.pagination).show())}var w=a.$,l=w.trim,q={searchInput:"#pets-rx-search-input",spinner:".pets-rx-spinner",popoverWrapper:".a-popover-wrapper",backButton:".a-icon-page-back",lineItemId:"#pets-rx-search-lineItemId",lineItemInput:".pets-rx-lineitem-id",rxInfo:".pets-rx-info",newClinic:"#pets-rx-search-new-clinic",savedVetList:".pets-rx-saved-vets",searchClinicButton:".pets-rx-search-vet",radioPrefix:"#pets-rx-radio",radios:"input[name\x3dpets-rx-search-radio]",
resultArea:".pets-rx-search-result-mobile",result:{section:".clinic-search-result-section",clinicId:"input[name\x3dpets-rx-search-clinic-id]",clinicName:"input[name\x3dpets-rx-search-clinic-name]",clinicAddress:"input[name\x3dpets-rx-search-clinic-address]",clinicPhone:"input[name\x3dpets-rx-search-clinic-phone]",clinicPhoneText:".pets-rx-search-clinic-phone",clinicAddressText:".pets-rx-search-clinic-address",clinicLocationText:".pets-rx-search-clinic-location",clinicNameText:".pets-rx-search-clinic-name"},
vetInfo:{newVet:".pets-rx-new-vet-info",savedVets:".pets-rx-saved-vets select",savedVetsCount:".pets-rx-saved-vets-count",id:".pets-rx-vet-id",name:"input[name\x3dpets-rx-clinic-name]",phone:"input[name\x3dpets-rx-clinic-phone]",address:"input[name\x3dpets-rx-clinic-address]",clinicId:".pets-rx-clinic-id"},buttons:{pagination:"#pets-rx-search-pagination",previous:"#pets-rx-search-prev",next:"#pets-rx-search-next",selectOption:".clinic-select-action-mobile"}};b=[];g=0;a.declarative("pets-enter-my-own-mobile",
["click","touchend"],function(a){B();h()});a.declarative("pets-rx-my-vet-mobile",["click","touchend"],function(a){var b=w(a.$target).closest(q.result.section);a=b.find(q.result.clinicId).val();var e=b.find(q.result.clinicName).val(),c=b.find(q.result.clinicAddress).val(),b=b.find(q.result.clinicPhone).val();p(a,e,b,c);h()});a.declarative("pets-rx-search-input-mobile",["keypress"],function(a){13===a.$event.keyCode&&(a=l(w(q.searchInput).val()),0!==l(a).length&&(w(q.resultArea).hide(),w(q.buttons.pagination).hide(),
w(q.spinner).show(),w.ajax({type:"GET",url:"/gp/buy/prescription/handlers/pets-search-clinic.html",async:!0,cache:!1,dataType:"text",data:{searchKeyword:a,device:n()},success:k,error:v})))});a.declarative("pets-rx-clinic-next",["click","touchend"],function(a){g<b.length&&(g++,e())});a.declarative("pets-rx-clinic-prev",["click","touchend"],function(a){1<g&&(g--,e())});a.declarative("pets-rx-clinic-search-radio",["change"],function(a){a=w(a.$target).closest(q.result.section);w(q.buttons.selectOption).hide();
a.find(q.buttons.selectOption).show()});a.on("a:popover:afterShow:pets-rx-search-mobile",function(){setTimeout(function(){w(q.searchInput).focus()},500)})});"use strict";m.when("A","page-detector").execute(function(a,c){function d(){c.isSpc()&&f("iframe#typ-assets-spc-iframe").attr("src","/gp/checkoutprefetch/typ-assets.html")}var f=a.$;a.on("checkout:reload:spc",function(){setTimeout(d,1E3)})});"use strict";m.when("A","page-detector","page-detector").execute(function(a,c,d){function f(){0<g(".prime-calendar-container").length&&
g(".prime-calendar-container").contents().each(function(a,b){8===b.nodeType&&g(b).replaceWith(b.nodeValue)});B=p=-1;var a=g("html");a.hasClass("a-ie6")&&(a.removeClass("a-js").addClass("a-no-js"),g(".a-declarative").removeClass("a-declarative"));setTimeout(b,1E3)}function b(){if(d.isSpc())if(d.isSpcLite()){n=g("#left-grid");m=g("#right-grid");B=g("#second-buy-button").height();m.css("min-height",0);n.css("min-height",0);var a=n.height(),b=g("#order-summary-box").height(),c=b+B;if(c<a){m.css("min-height",
a);n.css("min-height",a);var b=g(document).height(),l=g(k).height()+200;b>l&&c<a?g("#second-buy-button").show():g("#second-buy-button").hide()}else a<c&&n.css("min-height",b),g("#second-buy-button").hide()}else-1===p&&(n=g("#left-grid"),m=g("#right-grid"),p=n.height(),B=g("#second-buy-button").height()),b=g("#order-summary-box").height(),c=b+B,c<p?(m.css("min-height",p),n.css("min-height",p),b=g(document).height(),l=g(k).height()+200,b>l&&c<p?g("#second-buy-button").show():g("#second-buy-button").hide()):
(p<c&&n.css("min-height",b),g("#second-buy-button").hide())}var g=a.$,h,p,B,n,m;a.on("resize",function(){h&&k.clearTimeout&&k.clearTimeout(h);h=setTimeout(function(){b();h=null},100)});a.on("checkout:spc:ordersummary:sizeChanged",b);a.on("checkout:reload:spc",f);a.on("checkout:reload:spclite",f)});m.when("error-feature-detection").execute(function(a){a.registerFeature("shipping-speed-selection-controller",1)});"use strict";m.when("A","checkout-general-utils","page-transition-controller","page-detector",
"page-conductor","cache-page-data-controller").execute(function(a,c,d,f,b,g){function h(c,e,d,l,g){a.trigger("checkout:beforeLoadPage");b.ajaxUpdatePage(n[c+":"+e+":"+d+":"+l+":"+g].data,n[c+":"+e+":"+d+":"+l+":"+g].status,n[c+":"+e+":"+d+":"+l+":"+g].response,{refTag:l,anchor:d})}function p(a){if(k)k=!1;else if(c.protectAgainstDoubleAction("pipeline-link"))a.preventDefault(),a.stopImmediatePropagation();else{var e=B(a.currentTarget),f=e.data("pipelineLinkFromPage"),l=e.data("pipelineLinkToPage"),
q=e.data("pipelineLinkAnchor"),p=e.data("pipelineLinkRef"),e=e.data("pipelineLinkArgs");l&&(a.preventDefault(),a.stopImmediatePropagation(),b.isSPP()&&g.setCachedPageData(f,l),"object"!==typeof n[f+":"+l+":"+q+":"+p+":"+e]||!n[f+":"+l+":"+q+":"+p+":"+e].pending&&"undefined"===typeof n[f+":"+l+":"+q+":"+p+":"+e].data?(d.show(),a={refTag:p,anchor:q},b.isSPP()&&(a.keepCachedPagesData=1),b.loadPage(f,l,e,a)):n[f+":"+l+":"+q+":"+p+":"+e].pending?(d.show(),n[f+":"+l+":"+q+":"+p+":"+e].dispatch=1):h(f,l,
q,p,e))}}var B=a.$,n={},k=!1;a.on("checkout:reload:spc",function(){B("a.pipeline-link.static-link-prefetch").each(function(a,c){var d=B(c);d.bind("touchmove",function(){k=!0});d.bind("click keypress touchend",p);var l=d.data("pipelineLinkFromPage"),g=d.data("pipelineLinkToPage"),f=d.data("pipelineLinkAnchor"),t=d.data("pipelineLinkRef"),A=d.data("pipelineLinkArgs");if(g){n[l+":"+g+":"+f+":"+t+":"+A]={};n[l+":"+g+":"+f+":"+t+":"+A].pending=1;n[l+":"+g+":"+f+":"+t+":"+A].dispatch=0;var m={refTag:t,
anchor:f,resultscallback:function(a,c,e){n[l+":"+g+":"+f+":"+t+":"+A].pending=0;a?(n[l+":"+g+":"+f+":"+t+":"+A].data=a,n[l+":"+g+":"+f+":"+t+":"+A].response=e,n[l+":"+g+":"+f+":"+t+":"+A].status=c,n[l+":"+g+":"+f+":"+t+":"+A].dispatch&&h(l,g,f,t,A)):n[l+":"+g+":"+f+":"+t+":"+A].dispatch&&(m.resultscallback=void 0,b.loadPage(l,g,A,m))}},d="isAsync\x3d1\x26isClientTimeBased\x3d1";A&&(d+="\x26"+A);b.loadPage(l,g,d,m)}})})});"use strict";m.when("A","ready").execute(function(a){var c=a.$,d,f,b;a.on("checkout:beforeReload",
function(){void 0!==b&&(f.css("margin-bottom",b+"px"),b=void 0)});a.on("checkout:reload:spc",function(){d=c("#pyo-button-pinned");f=c("body");if(1===d.length&&"fixed"===d.css("position")&&void 0===b){var a=f.css("margin-bottom");b=parseInt(a,10);f.css("margin-bottom",b+d.height()+"px")}})});"use strict";m.when("A","loading-spinner-controller","page-transition-controller","page-conductor","ajax-utility","checkout-general-utils","page-detector","client-side-metrics").register("inline-address-popover-controller",
function(a,c,d,f,b,g,h,p){function B(){n();a.defer(function(){u("#spc-top").find(".change-address-popover-link").each(function(){var a=u(this);a.data("action")&&-1<a.data("action").indexOf("a-checkout-modal-popover")&&a.attr("tabindex",0)})});var b=u(".a-popover-modal");b.find("#shipping-address-popover").remove();b.find("#billing-address-popover").remove();a.defer(function(){m();v()})}function n(){var a=u("#logErrorsInPopupModal").val();E="T1"===a||"T2"===a;W="T2"===a;R="T1"===u("#fixPopupModalInfiniteSpinner").val()}
function m(){u("#desktop-shipping-address-div .screenreader-address-span").text(" "+u("#desktop-shipping-address-div .displayAddressAddressLine1").text())}function v(){u("#billing-address .duplicate-address").is(":visible")?u("#billing-address .screenreader-address-span").text(" "+u("#desktop-shipping-address-div .displayAddressAddressLine1").text()):u("#billing-address .screenreader-address-span").text(" "+u("#billing-address .displayAddressAddressLine1").text())}function e(a,c,e){function g(a){a.isSameAsShipping?
(u("#billing-address .single-address").hide(),u("#billing-address .duplicate-address").show()):a.addressHTML&&(u("#billing-address .duplicate-address").hide(),u("#billing-address .single-address").html(a.addressHTML).show());v()}function l(a){var b=u("#left-grid");a.isSameAsShipping?b.find(".pmts-billing-address-details").html(b.find(".billing-duplicate-address").html()):a.addressHTML&&b.find(".pmts-billing-address-details").html(a.addressHTML)}if(e.getResponseHeader("x-amz-checkout-page"))return u(".a-button-close").trigger("click"),
f.ajaxUpdatePage(a,c,e);(a=b.jsonify(a))&&(a.isSameAddress||a.isSameAsShipping||a.addressHTML)?(0===u("#billing-address").size()?l(a):g(a),d.hide(),u(".a-button-close").trigger("click"),a.requestid&&(p.setAsyncRequestId(a.requestid),p.sendUEPageLoadStats())):(f.redirect(a),d.hide(),u(".a-button-close").trigger("click"))}function w(a,b){b=b.toLowerCase();if(R){if("none"===u("#"+b+"-address-popover").closest(".a-popover").css("display")){E&&O.push(b+"-Address: Not populating popup modal is hidden");
return}}else{if(!D){E&&O.push(b+"-Address: Not populating content already loaded");return}D=!1}var e=u("#"+b+"-address-popover .select-address-main"),d="/gp/buy/pipeline/handlers/update-"+b+"-address.html",g=!1;"true"===a.isCampus&&(g=e.closest(".select-address-main"),g.find(".popover-pagination").remove(),g="true"===a.hideAddAddress||!1);L(a.addresses,e,2,3,d,b,"pageConductor.ajaxRedirect",g);d=e.find(".select-address-page").filter(function(){return"template"!==u(this).data("addresspage")}).length;
1<d&&(d=A(0,d,t),g=e.closest(".select-address-main"),g.find(".popover-pagination").remove(),d.appendTo(g).show());!1===H.modifiedForCampus&&e.closest(".address-popover").find(".address-popover-sidebar").css("visibility","visible").hide().fadeIn(300);c.hideSpinner(e);E&&O.push(b+"-Address: Hiding spinner");E&&S(u("#"+b+"-address-popover"));e.find(".select-address-page").filter(function(){return 0===u(this).data("addresspage")}).fadeIn(300)}function l(a){E&&O.push("Billing-Address: AJAX Call returned with data: "+
b.jsonify(a));w(a,"Billing")}function q(a){E&&O.push("Shipping-Address: AJAX Call returned with data: "+b.jsonify(a));w(a,"Shipping");var c=u("#shipping-address-popover .select-address-main"),e=u("#popover-store-pickup-search-spc");a.showPickupSearch?(e.show(),a.useTwoZipStoreSearch?(e.find(".secondary-pickup-input").show(),e.find("input[name\x3d'searchCriterion']").val("storeTwoZips"),e.find(".popover-pickup-input input").removeClass("single-input").addClass("two-inputs")):e.find(".secondary-pickup-input input").val("")):
e.hide();a.canShipToMultiple?u("#spc-popover-ship-to-multiple-link").show():u("#spc-popover-ship-to-multiple-link").hide();e.find(".popover-pickup-input input").focus(function(){u(this).hasClass("pickup-search-field")&&u(this).removeClass("a-color-secondary").val("")});a=c.find(".add-address-button");a.hasClass("pipeline-link")||(a.bind("click",{usecase:"addaddress",reftag:"ox_spc_shipaddr_addnewbox_popover"},F),c=u("#spc-popover-add-new-address-link a"),c.bind("click",{usecase:"addaddress",reftag:"ox_spc_shipaddr_addnewlink_popover"},
F),e=u("#spc-popover-edit-address-link a"),e.bind("click",{usecase:"editaddress",reftag:"ox_spc_shipaddr_editlink_popover"},F),g.bindActionEnterKeyOnButton(a),g.bindActionEnterKeyOnButton(c),g.bindActionEnterKeyOnButton(e));a=u("#spc-popover-ship-to-multiple-link a");a.hasClass("pipeline-link")||(a.bind("click",{usecase:"shiptomultiple",reftag:"ox_spc_shipaddr_multilink_popover"},F),g.bindActionEnterKeyOnButton(a))}function F(a){var b=null;if(a&&a.data&&a.data.usecase){b=a.data.usecase;a=a.data.reftag?
a.data.reftag:"shipaddr_popover_link";var c=null,e="";"addaddress"===b?(c="/gp/buy/addressselect/handlers/display.html",e="#new-address"):"editaddress"===b?c="/gp/buy/addressselect/handlers/display.html":"shiptomultiple"===b&&(c=g.addQueryStringParameter("/gp/ordering/checkout/item/select.html","useCase","multiAddress"));c&&(d.show(),c=g.addQueryStringParameter(c,"ref",a),c=g.addQueryStringParameter(c,"hasWorkingJavascript","1"),k.location.href=c+e)}}function t(a){if(a&&a.target){var b=u(a.target),
c=parseInt(b.closest("li").data("goto"),10),e=u(a.target).closest(".select-address-main"),d=e.find(".select-address-page").filter(function(){return"template"!==u(this).data("addresspage")}).length;e.find(".select-address-page:visible").fadeOut(300,function(){var a=A(c,d,t);e.find(".popover-pagination").remove();a.appendTo(e).show();e.find("div").filter(function(){return u(this).data("addresspage")===c}).fadeIn(300)})}}function A(a,b,c){var e=u("div[data-pagination\x3d'template']").clone().attr("data-pagination",
"copy"),d=e.find(".pagination-next-disabled"),f=a-1;0>f&&(f=0);var l=f+2;l>=b&&(l=b-1,f=l-2,0>f&&(f=0));3>f&&(f=1);4>b-l&&(l=b-2);d.before(u("\x3cli\x3e").addClass("pagination-link").data("goto",0).html("\x3ca\x3e1\x3c/a\x3e").attr("tabindex",0));for(2<f&&d.before(u("\x3cli\x3e").addClass("a-disabled").html("..."));f<=l;f++)d.before(u("\x3cli\x3e").addClass("pagination-link").data("goto",f).html("\x3ca\x3e"+(f+1)+"\x3c/a\x3e").attr("tabindex",0));3<b-l&&d.before(u("\x3cli\x3e").addClass("a-disabled").html("..."));
d.before(u("\x3cli\x3e").addClass("pagination-link").data("goto",b-1).html("\x3ca\x3e"+b+"\x3c/a\x3e").attr("tabindex",0));0<a&&(e.find(".pagination-previous-disabled").hide(),e.find(".pagination-previous-enabled").addClass("pagination-link").data("goto",a-1).attr("tabindex",0).show());a<b-1&&(d.hide(),e.find(".pagination-next-enabled").addClass("pagination-link").data("goto",a+1).attr("tabindex",0).show());e.find("li.pagination-link").filter(function(){return u(this).data("goto")===a}).removeClass("pagination-link").addClass("a-selected");
b=e.find(".pagination-link");b.bind("click",c);g.bindActionEnterKeyOnButton(b);return e}function K(){return"template"===u(this).data("addresspage")}function V(){return"template"===u(this).data("addressrow")}function J(){return"template"===u(this).data("newaddressslot")}function y(){return"template"===u(this).data("addressslot")}function M(){return"template"===u(this).data("addressgroup")}function z(a,b,e){var c=u("#shipping-address-popover .address-book").filter(M).clone().data("addressgroup","copy").show();
c.find("h4").html(b);c.find(".popover-address-book-container").html(a.contents());e&&c.find(".popover-address-book-container").removeClass("a-padding-base");return a.empty().prepend(c)}function L(a,b,c,e,f,l,h,q){b.find(".select-address-page").filter(function(){return"template"!==u(this).data("addresspage")}).remove();for(var p=0,r=0,w=0,W=0,n,t=!1,B=function(){u(this).height()>W&&(W=u(this).height())},R=0;p<=a.length;R++){for(var k=b.find(".select-address-page").filter(K).clone().data("addresspage",
R),v=0;v<c&&p<=a.length;v++){var D=k.find(".select-address-row").filter(V).clone().data("addressrow","copy").show();p<a.length&&a[p].addressBook&&(n=a[p].addressBook);for(var A=0;A<e&&p<=a.length;A++){var m;if(p===a.length)m=D.find(".select-address-slot").filter(J).clone().data("newaddressslot","copy").show(),n&&m.find(".add-address-button").width(170),!0===q&&m.hide();else{if(n&&a[p].addressBook!==n)continue;m=D.find(".select-address-slot").filter(y).clone().data("addressslot","copy").show();m.find(".select-address-slot-content").append(a[p].html);
a[p].isInvoiceAddress&&m.append(m.find(".invoice-address-note").clone().show());var F={seturl:f,setargs:a[p].setArgs+"\x26index\x3d"+p,callerType:l,errorhandler:h,popoverdiv:b.closest(".address-popover")},G;G=a[p].isSelected?m.find(".use-current-address-button"):m.find(".use-different-address-button");a[p].isSuggestedPUP?function(a){G.unbind("click").bind("click",function(){d.show()}).show().find("a").attr("href",a)}(a[p].insertUrl):G.unbind("click").bind("click",F,Q).show();g.bindActionEnterKeyOnButton(G)}A===
e-1&&m.addClass("a-span-last");D.append(m);p++}v===c-1&&D.addClass("a-spacing-base");n&&(p<a.length&&a[p].addressBook!==n||v===c-1&&!t?D=z(D,n,!1):t=!0);k.find("div:first").append(D)}r++;t&&(k=z(k,n,!0),t=!1);b.append(k);k.show();b.height()>parseInt(b.css("min-height"),10)&&b.css("min-height",b.height());k.height()>w&&b.find(".select-address-page").css("min-height",k.height());k.find(".select-address-slot-content").each(B);w=k.height();k.hide()}b.find(".select-address-slot-content").height(W);u(".screenreader-address-span").each(function(){var a=
u(this);a.text(" "+a.closest(".select-address-slot").find("li.displayAddressAddressLine1").text())})}function Q(a){var c,g,l;a&&a.data&&a.data.seturl&&a.data.setargs&&a.data.callerType&&a.data.errorhandler&&(c=a.data.seturl,g=a.data.setargs,l=a.data.callerType);d.show();a=u("input[name\x3duseCtb]").val();g=g+"\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+a+"\x26responsive\x3d1";a=u("input#deliver-to-input");a.length&&(g+="\x26deliverTo\x3d"+a.val());a={"x-amz-checkout-page":"spc"};
u("#passAjaxRequestHeader").length&&(a["x-amz-checkout-transition"]="ajax");T({type:"POST",url:c,data:g,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded;charset\x3dutf-8",headers:a,success:function(a,c,g){"shipping"===l?g.getResponseHeader("x-amz-checkout-page")?(u(".a-button-close").trigger("click"),f.ajaxUpdatePage(a,c,g)):(a=b.jsonify(a))&&a.isSameAddress?(d.hide(),u(".a-button-close").trigger("click"),a.requestid&&(p.setAsyncRequestId(a.requestid),p.sendUEPageLoadStats())):
(m(),f.redirect(a)):"billing"===l&&e(a,c,g)},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}function N(){H.initialized&&setTimeout(function(){var a=u("#shipping-address-popover .select-address-main");a.css("minHeight",H.shippingAddressPopoverMinHeight).find(".select-address-page").css("minHeight",H.selectAddressPageMinHeight);a.closest(".address-popover").find(".address-popover-sidebar").show()},300);H.modifiedForCampus=!1}function T(a){if(R){X&&X.abort();var b=a.success;a.success=function(a,c,e){X=
null;b&&"function"===typeof b&&(console.log("Success"),b(a,c,e))};var c=a.error;a.error=function(a,b,e){X=null;console.log("Error");"abort"!==b&&c&&"function"===typeof c&&c(a,b,e)}}X=u.ajax(a)}function G(a,b){if(a){b=b||0;O=["Starting spinner monitor"];var c=a.attr("id");P(c);r(c,function(){P(c);var e="none"!==u(".a-popover-modal").css("display"),d=0<a.children(".loading-spinner").length;e&&d&&(e=1E4+b,d="Popover Modal ("+a.attr("id")+") is still waiting after "+e/1E3+" secs. Current status is: "+
O,g.logError(d),W&&1E4>e&&G(a,e))},1E4)}}function S(a){a&&(a=a.attr("id"),P(a))}function P(a){Z[a]&&(clearTimeout(Z[a]),delete Z[a])}function r(a,b,c){b=setTimeout(b,c);Z[a]=b}var u=a.$;if(!u("html").hasClass("a-ie6")){var D=!1;if(!u("html").hasClass("a-touch")){var H={initialized:!1,modifiedForCampus:!1,shippingAddressPopoverMinHeight:0,selectAddressPageMinHeight:0},E=!1,W=!1,R=!1;a.declarative("search-locker",["click","touchend"],function(){if(!g.protectAgainstDoubleAction("search-locker")){var a=
u("input[name\x3d'searchLockerFormAction']").val();if(a){d.show();var b='\x3cform name\x3d"searchLockerForm" action\x3d"'+a+'" method\x3d"POST"\x3e';u("#popover-store-pickup-search-spc input").each(function(){b+='\x3cinput name\x3d"'+u(this).attr("name")+'" value\x3d"'+u(this).val()+'" type\x3d"hidden" /\x3e'});b+='\x3cinput name\x3d"hasWorkingJavascript" value\x3d"1" type\x3d"hidden" /\x3e';b+="\x3c/form\x3e";a=u(b);u("body").append(a);a.submit()}}});a.on("a:popover:hide:billing-address",function(){D=
!1});a.on("a:popover:hide:shipping-address",function(){D=!1;H.modifiedForCampus&&N()});a.on("a:popover:beforeShow:shipping-address",function(a){if((a=a&&a.popover?a.popover.data:void 0)&&!0===a.returnCampusAddressesOnly){a=u("#shipping-address-popover .select-address-main");var b=a.closest(".select-address-main");a.closest(".address-popover").css("minWidth",b.width()).find(".address-popover-sidebar").hide();H.modifiedForCampus=!0;!1===H.initialized&&(H.shippingAddressPopoverMinHeight=a.css("minHeight"),
H.selectAddressPageMinHeight=a.closest(".address-popover").find(".select-address-page").css("minHeight"),H.initialized=!0);a.css("minHeight","").find(".select-address-page").css("minHeight","")}else H.modifiedForCampus=!1});a.on("a:popover:show:shipping-address",function(a){D=!0;c.showSpinner(u("#shipping-address-popover"),!1);E&&G(u("#shipping-address-popover"));E&&O.push("Shipping-Address: Executing AJAX request");T({type:"POST",url:"/gp/buy/pipeline/handlers/shipping-address-select-content.html",
dataType:"text",dataFilter:function(a){return b.jsonify(a)},data:a&&a.popover?a.popover.data:void 0,async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},success:q,error:f.ajaxRedirect})});a.on("a:popover:show:billing-address",function(a){D=!0;c.showSpinner(u("#billing-address-popover"),!1);E&&G(u("#billing-address-popover"));E&&O.push("Billing-Address: Executing AJAX request");T({type:"POST",url:"/gp/buy/pipeline/handlers/billing-address-select-content.html",dataType:"text",dataFilter:function(a){return b.jsonify(a)},
async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},success:l,error:f.ajaxRedirect})});a.on("checkout:reload:spc",B);var X,O=[],Z={}}}});"use strict";m.when("A").register("thirdparty-redirect-popover-controller",function(a){function c(){k.history&&k.history.pushState?g(document).delegate("span.place-your-order-button-span","click",function(a){a.preventDefault()}):(g("span.place-your-order-button-span").removeClass("a-declarative"),g("input.place-your-order-button").parents("span.a-button-primary").addClass("place-order-button-link"))}
function d(a){var b=g(a);0<b.filter("#thirdpartyform-headless").length?(g("#spc-desktop").append('\x3cdiv id\x3d"thirdparty-redirecting-hidden-form" style\x3d"display:none"\x3e\x3c/div\x3e'),g("#thirdparty-redirecting-hidden-form").append(b),g("#thirdpartyform-headless").submit()):(k.history.pushState({state:"pushed-thirdparty-submit"},null,g("#spc-form").attr("action")),b=document.open(),b.write(a),b.close(),k.onpopstate=function(a){null===a.state&&k.location.reload()})}function f(a){g("#spc-form").submit()}
function b(a){h&&h.abort();var b=a.success;a.success=function(a,c,e){h=null;b&&"function"===typeof b&&b(a,c,e)};var c=a.error;a.error=function(a,b,e){h=null;"abort"!==b&&c&&"function"===typeof c&&c(a,b,e)};h=g.ajax(a)}var g=a.$;a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c);a.on("a:popover:show:thirdparty-redirecting",function(a){a=g("#spc-form");a.append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");a.append("\x3cinput type\x3d'hidden' name\x3d'headlessForm' value\x3d'1' /\x3e");
b({type:"POST",url:a.attr("action"),data:a.serialize(),async:!0,cache:!1,success:d,error:f})});var h});"use strict";m.when("A","order-summary-controller","inline-expander","client-side-metrics").register("order-summary-controller-mpp",function(a,c,d,f){var b=a.$,g=k.P&&k.P.AUI_BUILD_DATE;a.on("checkout:reload:spc",function(){c.initOrderSummary();var a=b("#exchange-rate-link"),p=b("#switch-currency-link");if(!g){f.increaseCount("removeauijs67");if(b("html").hasClass("a-touch"))p.unbind("click").bind("click",
function(a){d.toggleExpander(b(a.currentTarget))}),a.unbind("click").bind("click",function(a){d.toggleExpander(b(a.currentTarget))});else{var B=b("#spc-order-summary");B.find(".regulatory-fee-link").removeAttr("href").attr("tabindex",0);B.find(".vat-breakdown-link").removeAttr("href").attr("tabindex",0)}d.toggleExpander(p);d.toggleExpander(a)}})});"use strict";m.when("A","page-transition-controller","page-conductor").register("pallet-delivery-controller",function(a,c,d){function f(a,b,f){if(f.getResponseHeader("x-amz-checkout-pallet-warning"))c.hide(),
g(".pallet-delivery-update").hide(),g(".pallet-delivery-display").show(),g(".pallet-delivery-warning-display").show();else{if(f.getResponseHeader("x-amz-checkout-page"))return d.ajaxUpdatePage(a,b,f);d.redirect(a)}}function b(a,b,f){f.getResponseHeader("x-amz-checkout-pallet-warning")?(c.hide(),g(".pallet-delivery-disclaimer-mobile").hide(),g(".pallet-delivery-warning-mobile").show()):d.redirect(a)}var g=a.$;g("html").hasClass("a-ie6")||(a.declarative("pallet-delivery-update","click",function(a){a=
a.$currentTarget.closest(".pallet-delivery-block");var b=a.find("input[type\x3d'radio']:checked").val();a.data("selection",b);a.find(".pallet-delivery-display").hide();a.find(".pallet-delivery-update").show()}),a.declarative("pallet-delivery-select","click",function(a){var b=a.$currentTarget;a=a.$target;var c=b.find("input[type\x3d'radio']"),b=b.closest(".pallet-delivery-block"),d=b.data("selection")!==c.val();d||(b.find(".pallet-delivery-update").hide(),b.find(".pallet-delivery-display").show());
a.is(c)||(c.attr("checked",!0),d&&c.change())}),a.declarative("pallet-delivery-select","change",function(a){var b=a.$currentTarget.find("input[type\x3d'radio']");a=a.data.addressId;b=b.attr("value");c.show();b="cachebuster\x3d"+(new Date).getTime()+"hasWorkingJavascript\x3d1\x26addressId\x3d"+a+"\x26palletDelivery\x3d"+b;a=d.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});g.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-pallet-delivery.html/ref\x3dox_spc_set_pallet_delivery",data:b,dataType:"text",
async:!0,cache:!1,headers:a,success:f,error:d.ajaxRedirect})}),a.declarative("show-pallet-delivery-disclaimer-mobile","click",function(a){g(".pallet-delivery-disclaimer-mobile").show();g(".pallet-delivery-warning-mobile").hide()}),a.declarative("hide-pallet-delivery-disclaimer-mobile","click",function(a){g(".pallet-delivery-disclaimer-mobile").hide();g(".pallet-delivery-warning-mobile").hide()}),a.declarative("set-pallet-delivery-preference-mobile","click",function(a){a=a.data.addressId;var f=g('input[name\x3d"pallet-delivery-option"]:checked').val();
c.show();a="cachebuster\x3d"+(new Date).getTime()+"hasWorkingJavascript\x3d1\x26addressId\x3d"+a+"\x26palletDelivery\x3d"+f;f=d.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});g.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-pallet-delivery.html/ref\x3dox_spc_m_set_pallet_delivery",data:a,dataType:"text",async:!0,cache:!1,headers:f,success:b,error:d.ajaxRedirect})}))});"use strict";m.when("A","page-detector").register("time-preferences-controller",function(a,c){function d(a){a=g(a.target).closest("a");
var b=a.next(".time-preferences-options-list");b.is(":hidden")?(a.find(".time-pref-title").hide(),a.find(".time-pref-title-expanded").show(),b.slideDown("fast")):(a.find(".time-pref-title-expanded").hide(),a.find(".time-pref-title").show(),b.slideUp("fast"))}function f(a){var b=g(a.target);a=b.closest(".time-preferences-options-list").prev(".time-preferences-link").find(".time-pref-title-details");h&&(a=b.closest(".a-expander-container").find(".time-pref-title-details"));b=b.closest(".time-preferences-option").find(".time-preference-label").text();
a.text(b)}function b(){if(0!==g("div.locale-cn").length&&g("html").hasClass("a-touch")){var a=g("#spc-orders");a.find(".time-preferences-option").unbind("click").bind("click",f);a.find(".time-preferences-link").unbind("click").bind("click",d)}}var g=a.$;if(!g("html").hasClass("a-ie6")){var h=k.P&&k.P.AUI_BUILD_DATE;a.on("checkout:reload",b)}});"use strict";m.when("A","page-detector").register("imb-controller",function(a,c){function d(){a.defer(function(){var a=f("#spc-imb").find(".imb-message-link");
0<a.length&&a.find("i.js-hide").remove()})}var f=a.$;if(!f("html").hasClass("a-ie6"))a.on("checkout:reload:spc",d)});"use strict";m.when("A","page-transition-controller","page-conductor","ajax-utility","page-detector").register("business-order-popover-controller",function(a,c,d,f,b){function g(){b.isDesktopSpc()&&a.defer(function(){v("#spc-biz-order").find(".business-order-popover-link").each(function(){v(this).data("action")&&v(this).removeAttr("href").attr("tabindex",0)})})}function h(a){var b=
e,c=b.find("textarea[name\x3d'comments']");if(c){c=k.unescape(encodeURIComponent(c.val())).length;c=a-c;b.find(".popover-business-order-comments .remainder-count").hide();var d=b.find(".popover-business-order-comments");(-1>c?d.find(".remaining-char-over-multiple").show():0>c?d.find(".remaining-char-over-single").show():1===c?d.find(".remaining-char-single").show():d.find(".remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(c));0>c&&(b.find(".set-business-order-button").hide(),
b.find(".set-business-order-button-disabled").show(),0>c&&(b.find(".business-order-char-limit-error").find(".char-limit-error").html(a),b.find(".current-blocker-content").html(b.find(".business-order-char-limit-error").html())));-1<c&&(b.find(".set-business-order-button").show(),b.find(".set-business-order-button-disabled").hide())}}function p(){var a=e,b="";0<a.find("input[name\x3d'approval-required']").length&&(b+="approvalrequired\x3d1\x26");0<a.find("input[name\x3d'ponumberRequired']").length&&
(b+="ponumberRequired\x3d1\x26");0<a.find("input[name\x3d'ponumberEnabled']").length&&(b+="ponumberEnabled\x3d1\x26");if(0<a.find("input[name\x3d'approver']").length)var f=a.find("input[name\x3d'approver']").val(),b=b+("approver\x3d"+encodeURIComponent(f)+"\x26");0<a.find("textarea[name\x3d'comments']").length&&(f=a.find("textarea[name\x3d'comments']").val(),b+="comments\x3d"+encodeURIComponent(f)+"\x26");var b=b+("ponumber\x3d"+a.find("input[name\x3d'purchase-order-number']").val()+"\x26"),g=0;a.find("label.additional-fields-key").each(function(a){b+=
"key"+a+"\x3d"+encodeURIComponent(v(this).html())+"\x26";g=a+1});b+="count\x3d"+g+"\x26";a.find("input[name\x3d'additional-fields-value']").each(function(a){b+="value"+a+"\x3d"+encodeURIComponent(v(this).val())+"\x26"});b+=B(a);f=(new Date).getTime();b+="isDecoupleSPC\x3d1\x26hasWorkingJavascript\x3d1\x26cachebuster\x3d"+f;c.show();v.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-business-order.html",data:b,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded;charset\x3dutf-8",
headers:{"x-amz-checkout-page":"spc"},success:function(b,c,e){n(b,c,e,a)},error:function(a,b,c){d.ajaxRedirect(a,b,c)}})}function B(a){var b="",c=0;a.find("input[name\x3d'customfieldsvalue']").each(function(a){b+="customfieldsvalue"+a+"\x3d"+encodeURIComponent(v(this).val())+"\x26";c++});b+="noOfCustomFields\x3d"+c+"\x26";a.find("input[name\x3d'customfieldslabel']").each(function(a){b+="customfieldslabel"+a+"\x3d"+encodeURIComponent(v(this).val())+"\x26"});a.find("input[name\x3d'customfieldsid']").each(function(a){b+=
"customfieldsid"+a+"\x3d"+encodeURIComponent(v(this).val())+"\x26"});a.find("input[name\x3d'customfieldstype']").each(function(a){b+="customfieldstype"+a+"\x3d"+encodeURIComponent(v(this).val())+"\x26"});a.find("input[name\x3d'customfieldsrequired']").each(function(a){b+="customfieldsrequired"+a+"\x3d"+encodeURIComponent(v(this).val())+"\x26"});return b}function n(a,b,e,g){if(e.getResponseHeader("x-amz-checkout-page"))return g.find(".a-button-close").trigger("click"),d.ajaxUpdatePage(a,b,e);if(a=
f.jsonify(a)){if(a.invalidEmail){g.find("#invalid-approver-email").show();c.hide();return}if(a.caseSetError){g.find("#set-business-order-error").show();c.hide();return}if(a.commentsLimitError){g.find("#comments-limit-error").show();c.hide();return}if(a.ponumberRequiredError){g.find("#ponumber-required-error").show();g.find("input[name\x3d'purchase-order-number']").val(g.find("input[name\x3d'ponumberHidden']").val());c.hide();return}if(a.ponumberLimitError){g.find("#ponumber-limit-error").show();c.hide();
return}if(a.customFieldLimitError){g.find("#customfield-limit-error-text").text(a.customFieldErrorText);g.find("#customfield-limit-error").show();c.hide();return}if(a.customFieldRequiredError){g.find("#customfield-required-error-text").text(a.customFieldErrorText);g.find("#customfield-required-error").show();c.hide();return}}d.redirect(a)}function m(a,b){var c=document.createElement("textarea");a.hasOwnProperty("comments")&&(c.innerHTML=a.comments,b.find("textarea[name\x3d'comments']").val(c.value));
a.hasOwnProperty("customOrderFields")&&b.find("input[name\x3d'customfieldsvalue']").each(function(b){c.innerHTML=a.customOrderFields[b].value;v(this).val(c.value)});a.hasOwnProperty("approverEmail")&&(c.innerHTML=a.approverEmail,b.find("input[name\x3d'approver']").val(c.value))}var v=a.$;if(!v("html").hasClass("a-ie6")){var e;a.on("a:popover:show:business-order",function(b){b=e=b.popover.$popover;var c=a.state("bo_popover_state");c&&m(c,b);b.find(".set-business-order-button input").unbind("click").bind("click",
p);b.find("#invalid-approver-email").hide();b.find("#set-business-order-error").hide();b.find("#comments-limit-error").hide();b=b.find("textarea[name\x3d'comments']");var d=b.attr("maxlength");b.unbind("keyup.business-order").bind("keyup.business-order",function(){h(d)});b.unbind("mouseup.business-order").bind("mouseup.business-order",function(){h(d)});h(d)});a.on("a:popover:beforeShow:button-blocker-business-order",function(a){if(a.popover&&a.popover.name){var b=e;a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text());
a.popover.updatePosition()}});a.on("checkout:reload:spc",g)}});"use strict";m.when("A","page-detector","button-blocker","a-tooltip","a-dropdown","client-side-metrics").register("china-invoice-controller-v2",function(a,c,d,f,b,g){function h(){u.is(":checked")?(r.show(),m()):(r.hide(),v())}function p(){var a=D.val();return/^\s*$/.test(a)}function B(){var a=!1;"1"===na&&H.each(function(){if(a=/^\s*$/.test(y(this).val()))return!1});return a}function n(){ga.is(":checked")?(D.prop("value",oa),D.prop("disabled",
"disabled"),D.addClass("a-form-disabled")):(D.removeAttr("disabled"),D.removeClass("a-form-disabled"),m())}function m(){u.is(":checked")&&(p()||B()?(W.addClass("hidden"),E.prop("disabled",!0),E.prop("checked",!1)):(W.removeClass("hidden"),E.prop("disabled",!1),v()))}function v(){ba.hide();x.hide();C.hide();ca.hide();da.hide();D.removeClass("a-form-error");Y.hide()}function e(){U.is(":checked")?(L&&y("input[name\x3dchinaInvoiceTypeInner][value\x3d"+U.val()+"]").prop("checked",!0),u.prop("checked",
!0),r.show()):(u.prop("checked",!1),r.hide());fa.is(":checked")?E.prop("checked",!0):E.prop("checked",!1);D.val(ea.val());M?H.each(function(){var a=y(this).siblings("[data-cci_type]").attr("data-cci_type"),a=y("input.china-invoice-category[data-cci_type\x3d"+a+"]").val();b.getSelect(this).val(a)}):(g.increaseCount("removeauijs63"),H.each(function(){var a=y(this).attr("data-cci_type"),a=y("input.china-invoice-category[data-cci_type\x3d"+a+"]").val();y(this).val(a)}));Z.prop("checked",!0);ga.prop("checked",
!1);D.removeAttr("disabled");D.removeClass("a-form-disabled");m()}function w(){u.is(":checked")?(U.prop("checked",!0),E.is(":checked")?fa.prop("checked",!0):fa.prop("checked",!1),ea.val(D.val()),M?H.each(function(){var a=y(this).siblings("[data-cci_type]").attr("data-cci_type");y("input.china-invoice-category[data-cci_type\x3d"+a+"]").val(b.getSelect(this).val())}):(g.increaseCount("removeauijs64"),H.each(function(){var a=y(this).attr("data-cci_type");y("input.china-invoice-category[data-cci_type\x3d"+
a+"]").val(y(this).val())})),ma.addClass("hidden"),ja.html(aa),ka.html(D.val()),la.removeClass("hidden")):(U.prop("checked",!1),fa.prop("checked",!1),ea.val(""),ma.removeClass("hidden"),ja.html(pa),ka.html(""),la.addClass("hidden"))}function l(){var a=y("\x3cform\x3e");U.clone().appendTo(a);ea.clone().appendTo(a);ha.clone().appendTo(a);fa.clone().appendTo(a);Y.show();y.ajax({type:"POST",url:"/gp/buy/invoiceselect/handlers/submit.html",data:a.serialize(),async:!0,cache:!1,success:function(a,b,c){0===
a.statusCode?X.click():ca.show();Y.hide()},error:function(a,b,c){ca.show();Y.hide()}})}function q(){v();X.click()}function F(){v();u.is(":checked")&&(p()||B())?(v(),p()?(D.addClass("a-form-error"),B()?(ba.show(),da.show()):x.show()):(C.show(),da.show())):(w(),z?(L&&U.val(y("input[name\x3dchinaInvoiceTypeInner]:checked").val()),l()):X.click())}function t(){var a=N?y("#china-invoice-inner"):Q;0!==y("div.locale-cn").length&&(r=a.find("#china-invoice-edit-div"),u=a.find("#china-invoice-required-i"),D=
a.find("#china-invoice-title-i"),H=a.find("select.china-invoice-category-i"),E=a.find("#china-invoice-as-default-i"),W=a.find("#china-invoice-save-as-default-div"),O=a.find("#china-invoice-cancelbutton"),R=a.find("#china-invoice-savebutton"),a.find("#china-invoice-savebutton-span"),X=a.find("#china-invoice-dismiss-popover-button"),Z=a.find("#china-invoice-title-company"),ga=a.find("#china-invoice-title-personal"),ba=a.find("#china-invoice-error11-i"),x=a.find("#china-invoice-error12-i"),C=a.find("#china-invoice-error13-i"),
ca=a.find("#china-invoice-error14-i"),da=a.find("#china-invoice-error2-i"),Y=a.find("#china-invoice-saving-span"),oa=a.find("#china-invoice-type-personal-string").text(),u.unbind("change").bind("change",h),D.unbind("keyup").bind("keyup",m),H.unbind("change").bind("change",m),Z.unbind("click").bind("click",n),ga.unbind("click").bind("click",n),O.unbind("click").bind("click",q),R.unbind("click").bind("click",F),e())}function A(){var a=U.is(":checked"),b=ea.val(),b=/^\s*$/.test(b),c=!1,e;ha.each(function(){e=
y(this).val();if(c=/^\s*$/.test(e))return!1});a&&(b||c)?(ia.show(),d.show("china-invoice",y(".place-order-blocker-message.china-invoice-message").text())):(ia.hide(),d.hide("china-invoice"),M&&(a=f.get(y(".continue-button-blocker")))&&a.isActive()&&a.hide())}function K(){S.hide();P.show();t()}function V(){S.show();P.hide();A()}function J(){if(0!==y("#china-invoice-required").length){if(N=0!==y("#ChinaInvoice2015SeptNonAuiMobileEnabled").length)S=y("#spc-mobile-container-div"),P=y("#spc-mobile-chinainvoice-popover-div"),
T=y("#china-invoice-show-popover-link"),G=y("#china-invoice-dismiss-popover-button"),T.unbind("click").bind("click",K),G.unbind("click").bind("click",V);U=y("#china-invoice-required");ea=y("#china-invoice-title");ha=y("input.china-invoice-category");fa=y("#china-invoice-as-default");ja=y("#china-invoice-action-title");ka=y("#china-invoice-display-title");la=y("#china-invoice-display-title-div");ma=y("#china-invoice-display-noinvoice-div");ia=y("#china-invoice-error");pa=y("#china-invoice-addinvoice-string").text();
aa=y("#china-invoice-editinvoice-string").text();y("#china-invoice-nochoose-categoryid-string").text();na=y("#china-invoice-hasUserChoose-string").text();z=0!==y("#isChinaElectronicInvoiceEnabled").length;L=0!==y("input[name\x3dchinaInvoiceTypeInner]").length;setTimeout(A,100)}}var y=a.$;if(!y("html").hasClass("a-ie6")){y("html").hasClass("a-touch");var M=k.P&&k.P.AUI_BUILD_DATE,z,L,Q,N,T,G,S,P,r,u,D,H,E,W,R,X,O,Z,ga,ba,x,C,ca,da,Y,U,ea,ha,fa,ia,ja,ka,la,ma,na,oa,pa,aa;a.on("a:popover:hide:chinainvoice-popover",
function(a){A()});a.on("a:popover:show:chinainvoice-popover",function(a){Q=a.popover.$popover;t();v()});a.on("checkout:reload:spc",J)}});"use strict";m.when("A","fast-track-controller","page-detector").register("carrier-details-controller",function(a,c,d){function f(){a.defer(function(){g("#spc-reservation-countdown").length&&b()})}function b(){var a=g("#spc-reservation-countdown");if(a.length){var b=a.data("secondsLeft"),d=function(b,g){b--;if(0>=b)g.find(".cn-wireless-notice-js").hide(),g.find(".cn-wireless-expired-message").show();
else{var f=c.getFastTrackCountdown(b,a);g.find("span[data-field\x3d'countdown']").html(f);g.find(".cn-wireless-notice-js").show();g.find(".cn-wireless-expired-message").hide();setTimeout(function(){d(b,g)},1E3)}};d(b,a)}}var g=a.$;g("html").hasClass("a-ie6")||(a.on("a:popover:beforeShow:simcard",function(a){a.popover.$popover.find(".popover-content").html(g("#carrier-sim-card-details").html());a.popover.updatePosition()}),a.on("checkout:reload:spc",f))});"use strict";m.when("A","page-transition-controller",
"checkout-general-utils","address-utilities","client-side-metrics").register("as-controller",function(a,c,d,f,b){function g(a){a=a.find("input[type\x3d'checkbox']");0<r(".checkout-as-mobile").length?h(a):0<r(".checkout-as-tablet").length&&p(a)}function h(a){var c=k.P&&k.P.AUI_BUILD_DATE,e=a.closest(".address-book-entry").find(".ship-to-this-link-area"),d=e.find(".a-button"),g=e.find("a");0>=a.length||a.is(":checked")?(d.removeClass("a-button-disabled"),c?(a=e.find(".ship-to-this-link-value"),g.attr("href",
a.text())):(b.increaseCount("removeauijs24"),g.attr("href",g.data("select-locker-url")))):(d.addClass("a-button-disabled"),g.removeAttr("href"))}function p(a){var b=r("#ship-to-this-link-area"),c=b.find(".a-button"),b=b.find("input[type\x3d'submit']");0>=a.length||a.is(":checked")?(c.removeClass("a-button-disabled"),b.prop("disabled",!1)):(c.addClass("a-button-disabled"),b.attr("disabled",!0))}function B(a){a.find("div.enter-address-form form").find("input.a-form-error, select.a-form-error").filter(function(){return 0===
r(this).parents().filter(".enhanced-input").length}).closest(".a-input-text-wrapper").addClass("a-form-error")}function n(a){a=a.find("div.enter-address-form form");a.find(".enhanced-input .enterAddressFormInputError").addClass("a-form-error");a.find(".enhanced-input input.a-form-error, .enhanced-input select.a-form-error, .enhanced-input label.a-form-error").each(function(){r(this).parents(".a-input-text-wrapper").last().addClass("a-form-error")})}function I(a){var b=a.siblings("div.a-input-text-wrapper").andSelf();
b.siblings().unwrap();a.removeClass("a-input-text-wrapper");for(var c=r(),b=b.first();b.length;b=b.parent().nextAll("div.a-input-text-wrapper:first"))if(b.hasClass("a-input-text-wrapper")){var e=b.nextUntil(":not(.a-input-text-wrapper)").andSelf();e.wrapAll("\x3cdiv class\x3d'a-input-text-group'\x3e\x3c/div\x3e");1===e.length&&(c=c.add(b))}c.unwrap();a=a.closest("form");a.find(".a-input-text-group").siblings("div").andSelf().addClass("a-spacing-base");a.find(".a-touch-select").addClass("a-spacing-mini")}
function v(a){a.find("#identity-add-new-address select.#enterAddressCountryCode").closest(".a-input-text-wrapper").each(function(){var a=r(this),b=r(this).closest("form").find("#address-country-container");a.appendTo(b).removeClass("a-input-text-wrapper").addClass("a-spacing-medium")});a=a.find("#identity-add-new-address .a-input-text-wrapper:has(.a-touch-select), #identity-add-new-address .a-input-text-wrapper:has(.javascript-unwrap-row)").not(":has(.enhanced-input)");I(a)}function e(a){var b=a.find(".store-results-list"),
c=b.siblings(":not(script)");r(k).unbind("resize.store-results").bind("resize.store-results",function(){w(b,c)});w(b,c)}function w(a,b){var c=r(k).height();b.each(function(){c-=r(this).outerHeight()});a.height(c)}function l(a){a.undelegate("div.address-book-entry","click.resultToMapBinding").delegate("div.address-book-entry","click.resultToMapBinding",function(){var a=r(this);a.hasClass("address-book-entry")||(a=a.closest("div.address-book-entry"));0!==a.length&&(a=a.index("div.address-book-entry"),
k.Map&&k.Map.selectPin&&k.Map.selectPin(a))});a.find("label.a-touch-radio a.a-button").unbind("click.checkout-as").bind("click.checkout-as",function(a){c.show();a.stopPropagation()})}function q(a){k.Map&&k.Map.registerPinClickCallback&&k.Map.registerPinClickCallback(function(b){var c=a.find("div.store-results-list");b=c.find("div.address-book-entry:eq("+b+")");b.find(".a-control-row").trigger("activate.checkout-pagination").trigger("click",["preventAddressSelectionChangedTrigger"]);b=b.position().top;
var e=c.scrollTop();c.animate({scrollTop:e+b+"px"})})}function F(a){k.mapBubbleButtonClicked=function(b){b=r(b).data("storeid");b=a.find("div.store-results-list").find("div.address-book-entry:eq("+b+")").find(".a-button").attr("href");c.show();d.redirectWithJavascript(b)}}function t(a){a.find("form.controlEnterKeyFormSubmission").find("input[type\x3d'text']").unbind("keypress.controlEnterKeyFormSubmission").bind("keypress.controlEnterKeyFormSubmission",function(a){if(a.which&&13===a.which||a.keyCode&&
13===a.keyCode){if(a=r(this).closest("form").find("button[type\x3d'submit'], input[type\x3d'submit']"),a.length)return a.click(),!1}else return!0})}function A(a){a.find("form.controlEnterAddressForm").find("input[type\x3d'text']").unbind("keypress.controlEnterAddressForm").bind("keypress.controlEnterAddressForm",function(a){return(a.which&&13===a.which||a.keyCode&&13===a.keyCode)&&0<r(this).closest("div").next().length?(d.moveToNextInput(r(this).closest("div")),!1):!0})}function K(a){m.when("checkout-pagination").execute(function(b){b.initializePagination(a.find("div.checkout-pagination-container"));
a.find(".a-icon-touch-radio-active").closest(".checkout-pagination-item").trigger("activate.checkout-pagination")})}function V(){var a=r("div.checkout-as-tablet");a.length&&(a.hasClass("checkout-as-store-search-results")&&(M(a),e(a),l(a),q(a),F(a),a.find("div.store-opening-hours br").replaceWith(",\x26nbsp;")),K(a),v(a),a.find("div.address-options div.address-feature div.a-expander-content[aria-expanded\x3dfalse]").css({display:"none"}),B(a),n(a),z(a),t(a),f.countrySpecificLabelOptimizationCheck(a),
m.when("tablet-address-select-controller").execute(function(){a.find("div.address-book-entry").find(".a-icon-touch-radio-active").closest("label.a-declarative").trigger("click")}))}function J(a){d.migrateHelpLinksToMobile(a.find("div.a-alert-error"))}function y(a){a.find("input[type\x3d'hidden']").each(function(){r(this).appendTo(r(this).closest("form"))})}function M(a){a.undelegate("click.as").delegate(".addr-display","click.as",function(b,c){var e=r(this).closest(".a-box");0===e.length&&(e=r(this).closest(".address-book-entry"));
if(!e.hasClass("active-box")){var d=a.find(".active-box");d.removeClass("active-box").addClass("inactive-box");d.find("i").removeClass("a-icon-touch-radio-active");d.find("i").not(".locker-restriction-reminder, .most-recently-used-alert").addClass("a-icon-touch-radio-inactive");e.removeClass("inactive-box").addClass("active-box");"preventAddressSelectionChangedTrigger"!==c&&e.trigger("address-selection-changed");a.hasClass("checkout-as-store-search-results")&&g(e)}});var b=a.find(".address-book-entry:has(input[type\x3dradio]:checked)");
b.trigger("click");a.hasClass("checkout-as-store-search-results")&&g(b)}function z(a){m.when("a-form-controls").execute(function(){a.find("select.a-touch-select-input").each(function(){var a=r(this);""!==a.val()&&"--"!==a.val()&&a.change()})})}function L(a){var b=r("input#deliver-to-input").val();if(0<b.length){var c=r(a.currentTarget).attr("href");r(a.currentTarget).attr("href",c+"\x26deliverTo\x3d"+encodeURIComponent(b))}}function Q(){var a=r("div.checkout-as-mobile");a.length&&(k.P&&k.P.AUI_BUILD_DATE?
(J(a),y(a),v(a),f.countrySpecificLabelOptimizationCheck(a),n(a),G(a),a.hasClass("checkout-as-store-search-results")&&(a=r(".address-book-entry:has(input[type\x3dradio]:checked)"),0<a.length&&g(a))):(b.increaseCount("removeauijs25"),J(a),y(a),B(a),n(a),M(a),v(a),z(a),f.countrySpecificLabelOptimizationCheck(a),A(a),G(a),t(a)))}function N(){var a=r("div.checkout-as-desktop");a.length&&f.countrySpecificPopoverOptimizationCheck(a)}function T(a){b.increaseCount("checkout:access-point:"+a,1)}function G(b){u=
b.find("div[id$\x3d'-country']");H=b.find("div[id$\x3d'-pickup-type']");u.length&&H.length&&S(u,H);a.declarative("country-filter-pickup-point","change",function(a){u.length&&H.length&&S(u,H)})}function S(a,b){D=a.find("select[name\x3dcountry]");E=b.find("select[name\x3dpickupType]");if(D.length&&E.length){var c=D.find("option:selected"),e=E.find("option[value!\x3d'All']"),c=E.find("option."+c.attr("data-pickuptypeclass"));c.length?(e.hide(),c.show(),E.prop("disabled",!1),E.val("All").change(),b.show()):
b.length&&E.length&&(E.prop("disabled","disabled"),b.hide())}}function P(){V();Q();N();r("div.checkout-as input[placeholder]").each(function(){var a=r(this).attr("placeholder"),a=r("\x3cdiv /\x3e").html(a).text().replace(":","");r(this).attr("placeholder",a)});r("div.checkout-as #newShippingAddressFormFromIdentity span.field-description, #locker-find span.field-description").each(function(){var a=r(this),b=a.closest("div.one-new-address-form-field, label").find("input, select, textarea");!(0<a.find("a[href]").length||
0===b.length)&&"placeholder"in b[0]&&(b.attr("placeholder",a.text()),a.remove())});r("html.checkout-as-mobile div.displayAddressDiv ul.displayAddressUL, div.checkout-as-tablet div.displayAddressDiv ul.displayAddressUL").bind("touchend",function(a){});(function(){var a=r("div.checkout-as #searchLockerByLocationButton");a.unbind("enable").bind("enable",function(){r(this).removeClass("a-button-disabled").removeAttr("disabled")}).unbind("disable").bind("disable",function(){r(this).addClass("a-button-disabled").attr("disabled",
!0)});if(navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition){a.text();a.data("labelActive");a.data("labelSuccess");a.find(".a-button-text");var b=a.data("submit-url");a.click(function(e){e.preventDefault();var d=r("\x3cdiv id\x3d'turbo-checkout-bottom-sheet' class\x3d'aok-hidden'\x3e\x3c/div\x3e");a.append(d);var g=r("div.checkout-as #clientSideLockerFindErrorIMB").hide().removeClass("hidden").find(".hidden").removeClass("hidden").hide().end();navigator.geolocation.getCurrentPosition(function(e){d.remove();
var g=a.closest("form"),f=b?b:g.attr("action");g.attr("action",f);g.append(r("\x3cinput type\x3d'hidden' /\x3e").attr("name","latitude").attr("value",e.coords.latitude));g.append(r("\x3cinput type\x3d'hidden' /\x3e").attr("name","longitude").attr("value",e.coords.longitude));g.append(r("\x3cinput type\x3d'hidden' /\x3e").attr("name","isGeolocalisationButtonClicked").attr("value",1));c.showPageTransition();g.submit()},function(b){d.remove();a.closest("div.checkout-as-mobile, div.checkout-as-tablet").length?
alert(g.find("p.e"+b.code).text()):g.show().find("p.e"+b.code).show()},{maximumAge:12E4,timeout:1E4})})}else a.hide()})();(function(){r("div.checkout-as-mobile form#locker-find").submit(function(a){a=r(this).find("#locker-find-search-field");var b=r(this).find("#locker-find-inline-alert"),e=r("div.checkout-as-mobile #locker-find-error-imb");a.closest("form");var d=r(this).find("input[name\x3d'latitude']").attr("value"),g=r(this).find("input[name\x3d'longitude']").attr("value"),f=0<a.val().trim().length;
b.removeClass("aok-hidden").addClass("aok-hidden");a.parent().removeClass("a-form-error");if(d&&g)return!0;if(f)return c.showPageTransition(),!0;e&&e.remove();a.parent().removeClass("a-form-error").addClass("a-form-error");b.removeClass("aok-hidden");return!1})})();(function(){r.support.ajax&&r("div.checkout-as a.a-button-text[href], div.checkout-as a.a-button[href], div.checkout-as a.js-add-working-javascript[href]").each(function(){0<r(this).attr("href").indexOf("?")&&r(this).attr("href",r(this).attr("href")+
"\x26hasWorkingJavascript\x3d1")})})();(function(){r("div.checkout-as .enter-address-form").not(".hidden").find("div.a-alert-error").addClass("js-originally-shown-imb");r("div.checkout-as a.js-switch-form").click(function(a){a.preventDefault();a=r(this).closest(".enter-address-form");f.toggleAddressForm(a,a.siblings(".enter-address-form"))})})();(function(){m.when("A").execute(function(a){a.declarative("switch-store-results-display",["click"],function(a){if(a.data&&a.data.showDiv){var b=r(a.data.showDiv);
0!==b.length&&(a.$declarativeParent.addClass("a-button-selected").siblings(".a-button-selected").removeClass("a-button-selected"),b.show(),b.siblings("div").hide())}})})})();(function(){m.when("jQuery").execute(function(a){0!==a(".js-scroll-lock").length&&a(k).unbind("scroll.as").bind("scroll.as",function(){a(".js-scroll-lock").each(function(){var b=a(this),c=b.position().top,c=a(k).scrollTop()-c+10;0>=c||b.outerHeight()>a(k).height()?b.css({marginTop:"auto"}):b.css({marginTop:c})})})})})();(function(){if(r("div.checkout-as-desktop").length){var a=
r("div#deliver-to");a.length&&(a.show(),r("div.ship-to-this-address").each(function(){r(this).find("a.a-button-text").unbind("click.deliver-to").bind("click.deliver-to",L)}))}})();r("li[data-a-tab-name\x3dpickupTab]").length&&T("pickupTab:visible");if(0<r(".imb-autoscroll").length){var b=r(".imb-autoscroll:first").closest(".on-imb-scroll-here");b.length&&r("html, body").animate({scrollTop:b.offset().top},1E3)}r("#legacy-non-converged-locker-find").delegate("input[type\x3dtext], select","click change",
function(a){r(this).closest("tr").find("input[type\x3dradio]").attr("checked",!0)});r("html").hasClass("a-lt-ie8")&&r("div.checkout-as-desktop input[type\x3d'text']").addClass("a-input-text");a.defer(function(){r(".screenreader-address-span").each(function(){var a=r(this);a.text(" "+a.closest(".address-book-entry").find("li.displayAddressAddressLine1").text())})})}var r=a.$,u,D,H,E;a.declarative("select-address",["click"],function(a){a=r(".address-content input[type\x3dradio]:checked");a.length&&
(a=a.data("addressSelect"))&&(c.showPageTransition(),d.redirectWithJavascript(a))});a.declarative("tap-to-field",["click"],function(a){r(k).scrollTop(a.$declarativeParent.offset().top)});m.register("tablet-address-select-controller",function(){a.declarative("tablet-store-select-button",["click"],function(a){if(a=a.$currentTarget.closest("div.store-results-list").find("input[name\x3d'selectedStore']:checked").closest("label").data("selectThisStoreUrl"))c.show(),d.redirectWithJavascript(a)});a.declarative("tablet-checkout-cancel-address",
["click"],function(a){a.$currentTarget.closest(".a-expander-container").find("a.a-expander-header").click();r(document).scrollTop(0)});a.declarative("tablet-address-select",["click"],function(a){function b(a){a.addClass("a-button-disabled");a.find("input").attr("disabled",!0)}function c(a){a.removeClass("a-button-disabled");a.find("input").removeAttr("disabled")}var e=r("div.checkout-as-tablet"),d=e.find(".address-select-button"),e=e.find(".address-edit-button");a.data&&a.data.disableSelect?b(d):
c(d);a.data&&a.data.disableEdit?b(e):c(e)})});a.declarative("edit-address",["click"],function(a){a=r(".address-content input[type\x3dradio]:checked");a.length&&(a=a.data("addressEdit"))&&(c.showPageTransition(),d.redirectWithJavascript(a))});a.declarative("suggestion-edit-address",["click"],function(a){a=r("div.checkout-as-tablet #address-suggestion-form");if(a.length){var b=a.find("input[type\x3dradio]:checked");if(b.length){var b=b.val(),e=a.find("input#operationField");e.length&&(e.val(b),e.attr("name",
"edit_"+b),c.show(),a.submit())}}});a.declarative("refine-locker-search-results",["click"],function(a){var b=a.$currentTarget.closest("form");b.find("#latitude").val(a.data.latitude);b.find("#longitude").val(a.data.longitude)});a.declarative("mobile-refine-locker-search-results",["click"],function(a){var b=a.$currentTarget,e=b.closest("form");e.find("#latitude").val(a.data.latitude);e.find("#longitude").val(a.data.longitude);b.find("input[type\x3dradio]").prop("checked",!0);c.show();e.submit()});
a.declarative("mobile-store-results-back-button",["click"],function(a){c.show();k.history&&k.history.length&&0<k.history.length?(k.history.go(-1),a.$event.preventDefault()):d.redirectWithJavascript(a.data.url)});a.declarative("suggestion-select-address",["click"],function(a){a=r("div.checkout-as-tablet #address-suggestion-form");if(a.length){var b=a.find("input[type\x3dradio]:checked");if(b.length){var b=b.val().replace(/^addr_/,""),e=a.find("input#operationField");e.length&&(e.val(b),e.attr("name",
"useSelectedAddress"),c.show(),a.submit())}}});a.declarative("tablet-checkout-delete-address",["click"],function(a){k.confirm(r("#addressConfirmDeletion").text())&&(a=a.$currentTarget,c.showPageTransition(),d.redirectWithJavascript(a.attr("href")))});a.declarative("mobile-confirm-locker-restriction",["click"],function(a){h(a.$currentTarget.find("input[type\x3d'checkbox']"))});a.declarative("tablet-confirm-locker-restriction",["click"],function(a){p(a.$currentTarget.find("input[type\x3d'checkbox']"))});
a.declarative("mobile-select-address",["change"],function(a){a=a.$currentTarget.closest("div.address-book-entry");if(!a.hasClass("active-box")){if(r("li[data-a-tab-name\x3ddeliverTab]").length&&r("li[data-a-tab-name\x3dpickupTab]").length){var b=a.closest(".address-book");b&&b.find("div.address-book-entry.active-box").removeClass("active-box").addClass("inactive-box")}else r("div.address-book-entry.active-box").removeClass("active-box").addClass("inactive-box");a.removeClass("inactive-box").addClass("active-box");
0<r("div.checkout-as-mobile").length&&g(a)}});a.declarative("pickup-tab-selected",["click"],function(a){T("pickupTab:clicked")});a.on("checkout:reload:shipaddressselect",P);a.on("checkout:reload:billingaddressselect",P);a.on("checkout:reload:editaddress",P);a.on("checkout:reload:newaddress",P)});m.when("A").register("as-faf-controller",function(a){function c(){d("#faf-error-message").hide();d("#faf-content").hide();d("#faf-loading-image").show();d.ajax({type:"GET",url:"/gp/gifting/add-friends-and-family.html?filter\x3d1",
dataType:"html",cache:!1,timeout:1E4,success:function(a){d("#faf-loading-image").hide();d("#faf-content").show();d("#faf-content").html(a)},error:function(a){d("#faf-loading-image").hide();d("#faf-error-message").show()}})}var d=a.$;a.on("a:popover:show:add-friends-and-family",function(a){c()});a.on("checkout:reload:shipaddressselect",function(){d("div.checkout-as-desktop").delegate("#faf_retry","click",function(){c()})})});m.when("A","page-transition-controller","page-conductor","checkout-general-utils").execute(function(a,
c,d,f){var b=a.$;a.declarative("checkout-delete-address",["click"],function(a){a.$event.preventDefault();var h=0,p;a.data&&void 0!==a.data.targetAddress&&(h=1,p=a.data.targetAddress);var B=a.$declarativeParent.find("a[href]:first").attr("href");!B&&h&&(B=a.$declarativeParent.attr("href"));if(b("div.checkout-as-mobile").length&&!k.confirm(b("#addressConfirmDeletion").text()))return!1;c.show();b.ajax({dataType:"json",url:B,success:function(n,k,v){var e;e=h?b("#"+p):a.$declarativeParent.closest(".address-book-entry");
var w=e.parent();if(w.closest("div.checkout-as-mobile").length){if(e.removeClass("address-book-entry").addClass("deleted-address-book-entry"),n=e.find(".displayAddressDiv").text(),e.find(".a-box-inner").empty(),n=b("\x3cdiv class\x3d'a-box a-alert-inline a-alert-inline-success'\x3e\x3c/div\x3e").append("\x3cdiv class\x3d'a-box-inner'\x3e\x3ci class\x3d'a-icon a-icon-alert' /\x3e\x3cp class\x3d'deleted-address-alert-content'\x3e"+n+"\x3cbr/\x3e"+b("#addressWasDeletedSuccess").text()+"\x3c/p\x3e\x3c/div\x3e"),
e.find(".a-box-inner").append(n),n=e.prev(".address-book-entry.a-box"),0===n.length&&(n=e.next(".address-book-entry.a-box")),0===n.length&&!(0<b(".checkout.checkout-as .address-book-entry").length)){c.hidePageTransition();f.redirectWithJavascript(B);return}}else if(b("div.checkout-as-desktop").length){e.detach();var l=w.find("div.address-book-entry");l.length||d.ajaxUpdatePage(n,k,v);l.removeClass("address-book-new-row").filter(":nth-child(3n+1)").addClass("address-book-new-row");b("div.checkout-as-desktop").trigger("checkout-as-recalculate-address-height")}e.is(".a-box.active-box")&&
w.find(".address-book-entry.a-box.inactive-box:first").addClass("active-box").removeClass("inactive-box").find("input[type\x3d'radio']").attr("checked",!0).change().siblings("i.a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");h&&b(".a-button-close").trigger("click");c.hide()},error:function(){c.hidePageTransition();f.redirectWithJavascript(B)}})})});m.when("A","a-expander","ready").register("as-tablet-controller",function(a){var c=a.$;
a.on("checkout:reload:shipaddressselect",function(){if(c("div.checkout-as-tablet").length&&k.location.hash){var a=c(k.location.hash+".a-expander-header");"none"===a.siblings("div.a-expander-content").css("display")&&setTimeout(function(){a.trigger("click")},500)}})});m.when("A","safe-mash","page-detector").register("as-locker-mobile-controller",function(a,c,d){var f=a.$;a.on("checkout:reload:shipaddressselect",function(){d.isMobileAddressSelect()&&a.defer(function(){if(!c||!c.showDeliveryDestinationPicker){var a=
f("div.checkout-as-mobile").find("a.checkout-add-locker"),d=a.attr("href");d&&"#"!==d||a.hide()}})})});m.when("A","page-transition-controller","safe-mash","page-detector","checkout-general-utils","mash").register("as-mash-controller",function(a,c,d,f,b){var g=a.$;d.showDeliveryDestinationPicker&&g("div.checkout-as-mobile").find("a.checkout-add-locker").show();a.declarative("invoke-mash-store-picker",["click"],function(a){if(d.showDeliveryDestinationPicker){var p;k.app&&k.app.willReappear&&(p=k.app.willReappear,
delete k.app.willReappear);f.isTabletAddressSelect()&&a.$currentTarget.closest("div.a-expander-container").find("div.a-expander-content").remove();d.showDeliveryDestinationPicker({successCallback:function(a){var d="/gp/buy/storeaddress/handlers/select.html",d=b.addQueryStringParameter(d,"addressID",a.addressId),d=b.addQueryStringParameter(d,"requestToken",g("div.checkout-as").data("requestToken")),d=b.addQueryStringParameter(d,"purchaseId",g("div.checkout-as").data("purchaseId"));c.show();k.setTimeout(function(){k.app&&
p&&(k.app.willReappear=p);b.redirectWithJavascript(d)},650)},failCallback:function(a){k.app&&p&&(k.app.willReappear=p)}})}else 1<(a.$currentTarget.attr("href")||"").length&&b.redirectWithJavascript(a.$currentTarget.attr("href"))})});m.when("A","a-checkbox").execute(function(a,c){a.declarative("filter-available-locations",["click"],function(c){var f=a.$;c.$target.is(":checked")?f(".ineligible-store").hide():f(".ineligible-store").show()})});m.when("A","a-checkbox","ready").execute(function(a,c){var d=
a.$,f=c("[id\x3d'filterLocationsMpp']");d('[id\x3d"filterLocationsMpp"]').change(function(){f.isChecked()?d(".ineligible-store").hide():d(".ineligible-store").show();var a=f.isChecked()?!1:!0;"undefined"!==typeof k.Map&&d(".ineligible-store").each(function(){var c=d(this).attr("data-store-display-number");c&&(c=parseInt(c,10)-1,k.Map.togglePinVisibility(c,a))})})});m.when("A").execute("searchLevelAlert",function(a){var c=a.$;c(k);var d=c("#searchLevelMessage"),f=function(){0>d.height()-c(k).scrollTop()?
d.removeClass("search-level-message-back-to-top").addClass("search-level-message"):d.removeClass("search-level-message").addClass("search-level-message-back-to-top")};c("#searchLevelMessage").length&&a.on.scroll(f)});"use strict";m.when("A","client-side-metrics","ready").register("address-autopopulate-fields-clear",function(a,c){var d=a.$,f,b;k.P&&k.P.AUI_BUILD_DATE&&(f=d(".auto-populated-fields-clear-icon"),b=d(".auto-populated-fields-clear-icon-on input"));d.fn.exists=function(){return 0!==this.length};
"undefined"!==typeof b&&b.exists()&&b.each(function(){var a=d(this),b=a.attr("id")+"-icon",b=d("#"+b);a.val()&&a.is(":visible")?(a.after(b),b.show()):a.val()||b.hide()});"undefined"!==typeof f&&f.click(function(){var a=d(this).prev("input");a.exists()&&(a.val(""),a.focus(),c.increaseCount("checkout:newaddress:autopopulatedfieldcleared:"+a.prop("name"),1));d(this).hide()})});"use strict";m.when("A","page-transition-controller").register("accesspoint-search-controller",function(a,c){var d=a.$;a.declarative("search-accesspoint-for-location",
["click"],function(a){navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition&&navigator.geolocation.getCurrentPosition(function(b){var c=a.data.url,h=d("#accesspoint-search-form");h.attr("action",c);h.append(d("\x3cinput type\x3d'hidden'/\x3e").attr("name","latitude").attr("value",b.coords.latitude));h.append(d("\x3cinput type\x3d'hidden'/\x3e").attr("name","longitude").attr("value",b.coords.longitude));h.submit()},function(a){a=d("#geolocation-error-strings").find(".e"+a.code).text();
alert(a)})});a.on("checkout:reload:accesspoint",function(){d("#legacy-non-converged-locker-find").delegate(".storesearchinput input,.storesearchinput select","click",function(a){d(this).closest(".storesearchinput").siblings().find("input[type\x3dradio]").click()})})});"use strict";m.when("A","checkout-general-utils","ready").register("delivery-preference-controller",function(a,c){function d(){return g("form.checkout-page-form").serialize()}function f(){var a=d();a!==n&&5>=k&&(a&&(a+="\x26"),g.ajax({type:"POST",
url:"/gp/buy/deliverypreference/handlers/save.html",data:a+"returnjson\x3d1\x26isTrial\x3d1",dataType:"json",async:!0,cache:!1,headers:{"x-amz-checkout-page":"deliverypreference"},complete:function(){}}),k++)}function b(){k=0;n=d();g("form.checkout-page-form").find("input[type\x3d'checkbox'],input[type\x3d'radio'],input[type\x3d'text'],select").unbind("change").change(f);p&&g("form.checkout-page-form").data("checkoutFormReady",!0).change()}var g=a.$,h=g("input#isPipelinedPage"),p=0<h.length&&"1"===
h.val(),k,n;a.declarative("select-delivery-preference-radio-button",["click","touchend"],function(a){c.protectAgainstDoubleAction("select-delivery-preference-radio-button")||a.$currentTarget.closest(".delivery-preference-option").find("input[type\x3d'radio']").trigger("click")});if(p)a.on("checkout:reload:deliverypreference",b)});"use strict";m.when("A","weekend-availability-expander-helper").register("weekend-availability-expander-desktop",function(a,c){function d(a,b){return{isSaturdayChecked:f("#"+
a).prop("checked"),isSundayChecked:f("#"+b).prop("checked")}}var f=a.$,b=!0,g=!0,h={"sat-sun-expander-header":{saturdayId:"sat-sun-availability-checkbox-sat",sundayId:"sat-sun-availability-checkbox-sun"},"sat-sun-expander-header-domestic":{saturdayId:"sat-sun-availability-checkbox-sat-domestic",sundayId:"sat-sun-availability-checkbox-sun-domestic"}};return{init:function(){a.declarative("sat-sun-availability-checkbox-change","change",function(a){a=d(a.data.satCheckboxId,a.data.sunCheckboxId);c.updateAllWeekendAvailabilityStates(a);
var b=f("input[name\x3d'BusinessHours']").attr("value"),b=c.stateToCheckboxes(b);f(".weekend-checkbox-sat").prop("checked",b.isSaturdayChecked);f(".weekend-checkbox-sun").prop("checked",b.isSundayChecked);c.updateAllTitles(a);c.updateAllOptOutMessages(a)});var p="expander"===f("input[name\x3d'weekendDeliveryDisplayType']").attr("value"),k=f("input[name\x3dshipToThisAddress]");k.length&&p&&k.closest("form").submit(function(a){c.logExpanderState("mpp","create",g,b)});k=f("input[name\x3dfromAddressEditToContinue]");
k.length&&p&&k.closest("form").submit(function(a){c.logExpanderState("mpp","edit",g,b)});a.declarative("a-expander-toggle","click",function(a){a=a.$currentTarget;var f=a.attr("id");a.hasClass("sat-sun-expander-class")&&void 0!==h[f]&&(a=d(h[f].saturdayId,h[f].sundayId),c.updateAllWeekendAvailabilityStates(a),c.updateAllTitles(a),b=!b,g=!1)})}}});"use strict";m.when("A","delivery-preferences-csm-helper","checkout-general-utils","page-detector-current-page").register("mpp-delivery-preferences-controller",
function(a,c,d,f){a.declarative("delivery-preferences-submit-button",["click","touchend"],function(a){"deliverypreference"===f.getCurrentPage()&&(d.protectAgainstDoubleAction("delivery-preferences-submit-button",400)||c.recordCSMWithCurrentFieldValues("page-submitted","prefDelLocation","isDefaultPreference"))});a.on("checkout:reload:spc",function(){c.recordCSMForEligiblePages()});a.on("checkout:reload:deliverypreference",function(){c.recordCSMWithCurrentFieldValues("page-displayed","prefDelLocation",
"isDefaultPreference")})});"use strict";m.when("A","delivery-preferences-csm-helper","page-detector","page-detector-current-page","client-side-metrics").register("what-if-im-not-in-delivery-preferences",function(a,c,d,f,b){function g(){if(F)a.capabilities.history?k.history.back():m.when(q?"a-secondary-view":"a-popover-base").execute(function(a){a.get("what-if-im-not-in-form-popover").hide()});else{var b=l("#what-if-im-not-in-form-container").closest(".a-popover-wrapper");b.length&&b.find(".a-button-close").click()}}
function h(){l('select[name\x3d"enterAddressCountryCode"]').val()!==l("input[name\x3dcountryOrg]").val()?(l(".what-if-im-not-in-delivery-preferences-summary").hide(),v()):(l(".what-if-im-not-in-delivery-preferences-summary").show(),I())}function p(a,c){q?m.when("a-dropdown").execute(function(b){b.setValue(a.attr("id"),c)}):(b.increaseCount("removeauijs26"),a.find("option").removeAttr("selected"),a.find('option[value\x3d"'+c+'"]').attr("selected","selected"),a.siblings(".a-placeholder").text(a.find("option:selected").text()))}
function B(a,c){q?m.when("a-checkbox").execute(function(b){b=b("#"+a.attr("id"));c?b.check():b.uncheck()}):(b.increaseCount("removeauijs27"),c?a.attr("checked","checked"):a.removeAttr("checked"),a.siblings("i").removeClass("a-icon-touch-checkbox-"+(c?"inactive":"active")).addClass("a-icon-touch-checkbox-"+(c?"active":"inactive")))}function n(){var a=F&&"newaddress"===f.getCurrentPage(),b=!F&&!d.isTablet()&&"shipaddressselect"===f.getCurrentPage();(a||b)&&c.recordCSMForEligiblePages("address-form:")}
function I(){var a=l("#what-if-im-not-in-form-container"),b=l(".what-if-im-not-in-delivery-preferences-summary").closest("form"),c=a.find("input[name\x3dprefDelLocation]:checked").val();b.find('input[name\x3d"prefDelLocation"]').val(c);"NeighborDelivery"===c?(b.find('input[name\x3d"neighborName"]').val(a.find("input[name\x3dneighborName]").val()),b.find('input[name\x3d"houseNo"]').val(a.find("input[name\x3dhouseNo]").val())):"SafePlaceDelivery"===c&&b.find('input[name\x3d"safePlaceLocation"]').val(a.find("select[name\x3dsafePlaceLocation]").val());
b.find('input[name\x3d"isDefaultPreference"]').val(a.find("input[name\x3disDefaultPreference]").is(":checked")?"1":"0")}function v(){var a=l(".what-if-im-not-in-delivery-preferences-summary").closest("form");a.find('input[name\x3d"prefDelLocation"]').removeAttr("value");a.find('input[name\x3d"neighborName"]').removeAttr("value");a.find('input[name\x3d"houseNo"]').removeAttr("value");a.find('input[name\x3d"safePlaceLocation"]').removeAttr("value");a.find('input[name\x3d"isDefaultPreference"]').removeAttr("value")}
function e(){n();l(".what-if-im-not-in-delivery-preferences-summary").length&&(h(),l('select[name\x3d"enterAddressCountryCode"]').change(function(){h()}))}function w(a){a.$event.preventDefault();c.recordCSMWithCurrentFieldValues("embedded-in-address-form-submitted","prefDelLocation","isDefaultPreference");var e=l("#what-if-im-not-in-form-container"),d=e.find("input[name\x3dprefDelLocation]:checked").val();a=l("#what-if-im-not-in-form-container");a.find("input").removeClass("a-form-error");a.find("div.a-input-text-wrapper").removeClass("a-form-error");
q?a.find("select").siblings(".a-button").removeClass("a-button-error"):(b.increaseCount("removeauijs28"),a.find("select").closest(".a-button").removeClass("a-button-error"));a=!1;"NeighborDelivery"===d?(d=e.find("input[name\x3dneighborName]"),d.val()||(d.addClass("a-form-error"),d.closest(".a-input-text-wrapper").addClass("a-form-error"),a=!0),e=e.find("input[name\x3dhouseNo]"),e.val()||(e.addClass("a-form-error"),e.closest(".a-input-text-wrapper").addClass("a-form-error"),a=!0)):"SafePlaceDelivery"===
d&&(e=e.find("select[name\x3dsafePlaceLocation]"),e.val()||(q?e.siblings(".a-button").addClass("a-button-error"):(b.increaseCount("removeauijs29"),e.closest(".a-button").addClass("a-button-error")),a=!0));if(!a){v();I();e=l("#what-if-im-not-in-form-container");a=l(".what-if-im-not-in-delivery-preferences-summary").closest("form");var d=e.find("input[name\x3dprefDelLocation]:checked").val(),f,h;"NeighborDelivery"===d?(f=a.find("input[name\x3dneighborDeliveryLabel]").val(),h=e.find("input[name\x3dneighborName]").val(),
e=e.find("input[name\x3dhouseNo]").val(),h=h+", "+e):"SafePlaceDelivery"===d?(f=a.find("input[name\x3dsafePlaceDeliveryLabel]").val(),h=e.find("select[name\x3dsafePlaceLocation] option:selected").text()):"NoSpecialDelivery"===d&&(f=a.find("input[name\x3dnoSpecialDeliveryLabel]").val());f+=h?": "+h:"";l("#delivery-preference-label").text(f);f=l("#delivery-preference-link");f.length&&f.text(a.find("input[name\x3dchangeYourPreferenceLabel]").val());g()}}var l=a.$,q=k.P&&k.P.AUI_BUILD_DATE,F=d.isMobile();
a.declarative("embedded-what-if-im-not-in-form","submit",w);a.declarative("what-if-im-not-in-mpp-popover","click",w);a.on("a:popover:show:what-if-im-not-in-form-popover",function(){var a=l("#what-if-im-not-in-form-container"),b=l(".what-if-im-not-in-delivery-preferences-summary").closest("form"),e=b.find('input[name\x3d"prefDelLocation"]').val()||"";a.find("input[name\x3dprefDelLocation][value\x3d"+e+"]").click();a.find('input[name\x3d"neighborName"]').val(b.find("input[name\x3dneighborName]").val());
a.find('input[name\x3d"houseNo"]').val(b.find("input[name\x3dhouseNo]").val());var e=a.find('select[name\x3d"safePlaceLocation"]'),d=b.find("input[name\x3dsafePlaceLocation]").val();p(e,d);a=a.find('input[name\x3d"isDefaultPreference"]');B(a,"0"!==b.find("input[name\x3disDefaultPreference]").val());c.recordCSMWithCurrentFieldValues("embedded-in-address-form-displayed","prefDelLocation","isDefaultPreference")});a.on("checkout:reload:shipaddressselect",e);a.on("checkout:reload:newaddress",e)});"use strict";
m.when("A","weekend-availability-expander-helper","a-secondary-view","client-side-metrics","a-checkbox").register("weekend-availability-secondary-view-mobile",function(a,c,d,f,b){function g(){m=!0;var a=n("input[name\x3d'BusinessHours']").attr("value"),a=c.stateToCheckboxes(a);b("#weekend-availability-sat-checkbox").check(a.isSaturdayChecked);b("#weekend-availability-sun-checkbox").check(a.isSundayChecked);b("#weekend-availability-sat-checkbox-domestic").check(a.isSaturdayChecked);b("#weekend-availability-sun-checkbox-domestic").check(a.isSundayChecked);
n(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!0)}function h(a,c){return{isSaturdayChecked:b("#"+a).isChecked(),isSundayChecked:b("#"+c).isChecked()}}function p(){return m&&v?"save":m?"back":"noView"}function k(a,b,c){var d=n("#hasUserDefinedValue").length?"userDefined":"notUserDefined";f.increaseCount("checkout:delivery-preferences:"+a+":secondaryView:"+b+":"+c+":"+d)}var n=a.$,m=!1,v=!1;return{init:function(){a.declarative("sat-sun-availability-checkbox-change","change",function(a){c.updateAllOptOutMessages(h(a.data.saturdayCheckboxId,
a.data.sundayCheckboxId))});var b="secondaryView"===n("input[name\x3d'weekendDeliveryDisplayType']").attr("value"),f=n("input[name\x3dshipToThisAddress]");f.length&&b&&f.closest("form").submit(function(a){k("mpp","create",p())});f=n("input[name\x3dfromAddressEditToContinue]");f.length&&b&&f.closest("form").submit(function(a){k("mpp","edit",p())});a.declarative("weekend-availability-secondary-view-save","click",function(a){var b=a.data;a=d.get(b.popoverName);null!==a&&void 0!==a&&(b=h(b.saturdayCheckboxId,
b.sundayCheckboxId),c.updateAllWeekendAvailabilityStates(b),c.updateAllTitles(b),a.hide(),v=!0)});a.on("a:popover:beforeShow:weekend-availability-secondary-view",g);a.on("a:popover:beforeShow:weekend-availability-secondary-view-domestic",g)}}});"use strict";m.when("A","page-detector").register("weekend-availability-loader",function(a,c){function d(){c.isMobile()?m.when("weekend-availability-secondary-view-mobile").execute(function(a){a.init()}):m.when("weekend-availability-expander-desktop").execute(function(a){a.init()})}
a.on("checkout:reload:shipaddressselect",d);a.on("checkout:reload:editaddress",d);a.on("checkout:reload:newaddress",d)});"use strict";m.when("A","jQuery","gift-form-base-controller").register("gift-form-controller",function(a,c,d){a.on("checkout:gift:adaptCarousel",function(a){a=c("#giftwrap-carousel-wrap-holder-"+a);parseInt(a.css("left"),10);a.css("left",0)});a.on("checkout:gift:changeCarouselWrapOptions",function(a,b,d){"all"===b?c("#giftwrap-carousel-wrap-holder-"+d+" li").show():"GW"===b?(c("#giftwrap-carousel-wrap-holder-"+
d+" li",c(a)).hide(),c(".gift-wrap",c(a)).show()):"noshi"===b&&(c("#giftwrap-carousel-wrap-holder-"+d+" li",c(a)).hide(),c(".noshi-wrap",c(a)).show())});d.extendFunctions({updateCarouselOnLeftClick:function(a,b,d){a="";d.$event.preventDefault();a=b.itemId;b=parseInt(c("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);0>b&&(b=b+90+"px",c("#giftwrap-carousel-wrap-holder-"+a).css("left",b))},updateCarouselOnRightClick:function(a,b,d){a="";var h;d.$event.preventDefault();a=b.itemId;h=c("#giftwrap-carousel-wrap-pane-"+
a);b=parseInt(c("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);d=h.find("ul li").size();var p=h.find("ul li.gift-wrap").size();h=h.find("ul li.noshi-wrap").size();var k=c("#afn-gift-options-wrapper-"+a).data("active-tab"),n;"all"===k?n=d:"GW"===k?n=p:"noshi"===k&&(n=h);b>-90*(n-4)&&(b=b-90+"px",c("#giftwrap-carousel-wrap-holder-"+a).css("left",b))}})});m.when("A","jQuery","client-side-metrics","ready").execute(function(a,c,d){function f(a,b,d){a=0;var f="",g=!1;c("#includeReceiptCheckbox-"+
d)&&c("#includeReceiptCheckbox-"+d).is(":checked")&&(g=!0);c('input[name\x3d"wrap.'+d+'"]:checked')&&(a=c('input[name\x3d"wrap.'+d+'"]:checked').val());c("#includeMessageCheckbox-"+d)&&c("#includeMessageCheckbox-"+d).is(":checked")&&(f=c("#message-area-"+d).val(),10<f.length&&(f=f.substring(0,10)+"..."));(!a||1>a.length)&&c("#wrapRadio-"+d+"-noWrap").attr("checked","checked").trigger("change");a&&!(1>a.length)||f&&!(1>f.length)||g?(b.find(".no-gift-options-button-text").hide(),b.find(".selected-gift-options-button-text").show(),
b.find(".gift-wrap-button-text").hide(),a&&0<a.length&&b.find(".gift-wrap-button-text-"+a.replace(/#/g,"\\#")).show(),f&&0<f.length?(b.find(".gift-message-button-text").show(),b.find(".gift-message-preview").html(f)):b.find(".gift-message-button-text").hide(),g?b.find(".gift-receipt-button-text").show():b.find(".gift-receipt-button-text").hide()):(b.find(".selected-gift-options-button-text").hide(),b.find(".no-gift-options-button-text").show())}function b(a){a.find(".selected-gift-options-button-text").hide();
a.find(".no-gift-options-button-text").show()}function g(a){a.is(":checked")||(v?a.closest("label").click():(d.increaseCount("removeauijs32"),a.attr("checked",!0).trigger("change")))}function h(a){var b=a.find("div.expando-content"),c=1===a.data("select-gift-receipt");a=1===a.data("select-gift-message");(c||a)&&B(b,c,a)}function p(a){return a.is("input")?a:a.find("input")}function B(a,b,c){var d;d=0<a.find(".includeReceiptCheckbox").length?p(a.find(".includeReceiptCheckbox")):p(a.find(".mfnHidePriceCheckbox"));
a=p(a.find(".includeMessageCheckbox"));(b||c)&&g(d);c&&g(a)}function n(){v?m.when("A").execute(function(a){a.off("a:expander:gift-options-expander:toggle:collapse");a.on("a:expander:gift-options-expander:toggle:collapse",function(a){a=a.expander.$expander;var b=a.closest("div.expando-box"),c=b.find("div.expando-content"),b=b.data("itemNumber");f(c,a,b)});a.off("a:expander:gift-options-expander:toggle:expand");a.on("a:expander:gift-options-expander:toggle:expand",function(a){b(a.expander.$expander);
var c=a.expander.$expander.closest("div.expando-box");a=c.find("div.expando-content");var d=1===c.data("select-gift-receipt"),c=1===c.data("select-gift-message");(d||c)&&B(a,d,c)})}):(d.increaseCount("removeauijs33"),c("a.expando-link").unbind("click").bind("click",function(a){var d=c(this),e=d.closest("div.expando-box"),g=e.attr("data-item-number"),h=e.find("div.expando-content");h.is(":visible")?h.slideUp("fast",function(){f(h,d,g);d.find("i").removeClass("a-icon-section-expand").addClass("a-icon-section-collapse")}):
(b(d),h.slideDown("fast",function(){d.find("i").removeClass("a-icon-section-collapse").addClass("a-icon-section-expand");var a=1===e.data("select-gift-receipt"),b=1===e.data("select-gift-message");(a||b)&&B(h,a,b)}))}));var e=c("a.expando-link");if(0<e.length){if(e=e.eq(0),e.click(),v){var g=c("div.expando-box").eq(0);b(e);a.delay(function(){h(g)},100)}}else a.delay(function(){c("div.expando-box").each(function(){h(c(this))})},100)}var I=c("input#isPipelinedPage"),I=0<I.length&&"1"===I.val(),v=k.P&&
k.P.AUI_BUILD_DATE;if(I)a.on("checkout:reload:giftselect",n);else n()});"use strict";m.when("A","pay-common-util").register("page-slide",function(a,c){function d(a,d,h){if(!d)return a;0<a.length&&a.remove();a=f(d).hide();d=c.getCurrentPage();0===d.length?c.elements.pageContainer.append(a):h?a.insertBefore(d):a.insertAfter(d);return a}var f=a.$;return{slideHide:function(a,f){var h=c.getCurrentPage(),p=d(a,f,!1);h.hide();p.show()},slideShow:function(a,f){var h=c.getCurrentPage(),p=d(a,f,!0);h.hide();
p.show()}}});m.when("A","ajax-utility","pay-common-util","page-conductor","page-slide","page-transition-controller","pay-validator","pay-credit-card","a-dropdown").register("page-main",function(a,c,d,f,b,g,h,p,k){function n(a,b){if(null!==a)return String(a.data(b))}function I(a){var b=x(a.currentTarget).val(),c=C.newVDC.find(".vdc-other-fields").hide(),d=C.newVDC.find("#cardErrors_VDC").hide(),e=C.newVDC.find(".bank-name").hide(),f=!1;"OtherBanks"===b?(c.show(),d.find("li.error-message").not(".hidden").length&&
d.show()):""!==b&&(a=x(a.currentTarget).find("option:selected").text(),e.show().find(".bank-name-text").html(a),f=!0);E(f)}function v(b){b=x(b.currentTarget);var c=b.find("i");if(b.find("#addCreditCardNumber").is(":visible")){var d=x("#auiTemplatingPaypageSelectionFix");0<d.length&&"T1"===d.val()&&b.find("#addCreditCardNumber").focus()}if("1"!==b.attr("ischecked")&&!c.eq(0).hasClass("a-icon-touch-radio-active")){O(!0);C.continueErrors.hide();C.paymentRows.attr("ischecked",0);C.paymentRows.attr("isclicked",
0);b.attr("ischecked",1);c=N(b);E(c);D(b);c=C.paymentRows.parent();c.find("#card-expiration,.payment-info").show();c.find("#addr-challenge,#addr-challenge-msg,.addr-challenge-card-scan,.addr-challenge-confirm,#expire-date-fields").hide();C.continueBtn.closest(".a-row").show();"true"===n(b,"isaddresschallenge")&&(c=b.parent(),c.find("#card-expiration,.payment-info").hide(),c.find("#addr-challenge,#addr-challenge-msg,.addr-challenge-card-scan,.addr-challenge-confirm,#expire-date-fields").show(),C.continueBtn.closest(".a-row").hide(),
c=b.attr("paymentmethodid")?b.attr("paymentmethodid"):b.attr("data-paymentmethodid"),a.trigger("checkout:payment:challenge:log",c));C.paymentRows.parent().find(".verified-fail-msg").hide();"true"===n(b,"isverifiedfail")&&b.parent().find(".verified-fail-msg").show();C.paymentRows.parent().find(".cup-expired-msg").hide();"true"!==n(b,"iscupcardexpired")&&"true"!==n(b,"iscupcardexpiringsoon")||b.parent().find(".cup-expired-msg").show();c=C.paymentRows.parent();c.find(".installments-select").hide();c.find(".installments-message").show();
c=b.parent();c.find(".installments-select").show();c.find(".installments-message").hide();c=x("#imb-wrapper");if(c.length&&c.is(":visible")){var d=c.find(".defaultPaymentMethodExpired"),g=c.find(".codUnavailable"),r=c.find("p").length;0===d.length&&0===g.length||1!==r||c.hide()}(c=x("#form-add-credit-card"))&&0!==c.length&&(d=0,0<b.find('input[value\x3d"addingNewCCInBox"]').length&&(d=1),d&&!c.is(":visible")?c.slideDown():c.is(":visible")&&c.slideUp());c=C.paymentRows.parent();g=["#reward-err-link",
".financial-offer-err-link"];for(d=0;d<g.length;d++)x(g[d],c).show();g=["#reward-err-detail",".financial-offer-err-detail"];for(r=0;r<g.length;r++)x(g[d],c).hide();J();c=h.create();c.validatePayment(S());c.hasErrors()||f.makePrefetch(C.paymentsForm);w(b);e(b)}}function e(a){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=x("input[type\x3d'hidden'][name\x3d'paySelectLocale']");b.length&&"IN"===b.val()&&a.length&&m.when("client-side-metrics").execute(function(a){a.increaseCount("PayPage-COD-Mobile",
1)})}function w(a){if(x("#isGlobalCODEligible").val()){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=x("#new-gc-promo");a.length?b.hide():b.show()}}function l(a){a.$event.preventDefault();var b=a.$target;b.closest("#card-expiration").hide();b.parents("div.a-box-inner").find("#"+a.data.targetId).show();b.parents(".a-touch-radio").find("label").trigger("click")}function q(a){a.$target.parent().parent().hide();x("#reward-err-detail").show()}function F(a){a.$target.parent().hide();
x(".financial-offer-err-detail").show()}function t(a){a.$event.preventDefault();d.makeAjaxCall(a.data.href,{},{successHandler:function(a,c,e){a&&(c=d.getPageId(e))&&b.slideShow(x(c),a)}})}function A(a){a.$event.preventDefault();d.makeAjaxCall(a.data.href,{},{successHandler:function(a,c,e){a&&(c=d.getPageId(e))&&b.slideShow(x(c),a)}})}function K(a){var b=x("input#isPipelinedPage"),b=0<b.length&&"1"===b.val(),c=d.prop("activeGoElement");if(c)for(var e=["gcPromo","newVCC","newVDC"],f=0;f<e.length;f++){var r=
C[e[f]];if(r&&r.length&&r.find(c).length)return r.find('input[type\x3d"button"]').trigger("click"),a.$event.preventDefault(),!1}c=G();e=[z,L];for(f=0;f<e.length;f++)if((0,e[f])(a.data.url,c))return a.$event.preventDefault(),b&&a.$event.stopImmediatePropagation(),!1;c=h.create();c.validatePayment(S());if((c=c.getHighestErrorId())&&c.identifier)return C.continueErrors.show().find("#"+c.identifier).show(),a.$event.preventDefault(),b&&a.$event.stopImmediatePropagation(),!1;C.continueErrors.hide().find(".error-message").hide();
g.showPageTransition()}function V(a){a=x(a.currentTarget);1===a.data("isclicked")?a.data("isclicked",0):a.data("isclicked",1);J()}function J(){var a=x("#pm_promo"),b=x("#pm_gc_radio"),c=x("#pm_gc_checkbox");if(!b.length&&!c.length)return!1;var d=x("input[name\x3dgcBalanceRaw]").val();x("input[name\x3damBalanceRaw]").length&&(d=x("input[name\x3damBalanceRaw]").val());var e=x("input[name\x3dremainingBalanceRaw]").val(),f=x("input[name\x3dpurchaseTotalRaw]").val(),g,r,l=x(".purchase-total").length;l?
(r=x(".purchase-total").html(),g=x(".remaining-balance").html()):(r=x("input[name\x3dpurchaseTotal]").val(),g=x("input[name\x3dremainingBalance]").val());var h=x(".balance-applied");l?h.html(r):h.text(r);a=a.closest(".a-control-row");"1"===a.attr("isclicked")||1===a.data("isclicked")?0<e&&(l?h.html(g):h.text(g)):e=f;g=b.closest(".a-control-row");l=c.closest(".a-control-row");h=x(".long");a=x(".short");0<=d-f?("disabled"===b.attr("disabled")&&b.removeAttr("disabled"),g.removeClass("hidden"),l.addClass("hidden"),
c.attr("disabled","disabled"),h.show(),a.hide()):0<d-e?0>=e?(l.removeClass("hidden"),l.find("i").addClass("a-button-disabled checkbox-disabled"),c.attr("disabled","disabled"),g.addClass("hidden"),b.attr("disabled","disabled"),a.show(),h.hide()):("disabled"===b.attr("disabled")&&b.removeAttr("disabled"),g.removeClass("hidden"),l.addClass("hidden"),c.attr("disabled","disabled"),h.show(),a.hide()):("disabled"===c.attr("disabled")&&c.removeAttr("disabled"),l.removeClass("hidden"),l.find("i").removeClass("a-button-disabled checkbox-disabled"),
g.addClass("hidden"),b.attr("disabled","disabled"),a.show(),h.hide())}function y(a){a=a.$target||x(a.currentTarget);M(a)}function M(a,b){var c=a.find("input[type\x3d'checkbox']")||a.find("input[type\x3d'radio']"),d;d=c.is("input[type\x3d'checkbox']")?"checkbox":"radio";if(c.length){var e=c.siblings("i"),f=C.paymentRows.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]'),g=C.paymentRows.filter(".a-touch-radio[data-paymentmethodtype\x3d'creditCard']"),r=g.siblings(".installments-select.a-row"),
g=g.siblings(".installments-message"),l=C.paymentRows.find('input[type\x3d"radio"][value\x3d"morePaymentMethod"]'),h=l.parents(".a-control-row");b||e.hasClass("a-icon-touch-"+d+"-inactive")?(f.attr("disabled",!0).prop("disabled",!0),f.is(":checked")&&(f.attr("checked",!1),f.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active"),f.siblings("i").addClass("a-icon-radio-inactive").removeClass("a-icon-radio-active"),D(f)),d=f.parents(".a-control-row"),d.addClass("a-color-secondary js-gc-disabled"),
l.attr("disabled",!0).prop("disabled",!0),l.is(":checked")&&(l.attr("checked",!1),l.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active"),l.siblings("i").addClass("a-icon-radio-inactive").removeClass("a-icon-radio-active"),D(l)),h.addClass("a-color-secondary js-gc-disabled"),h.siblings(".selected-section-more-payment-method").hide(),(c=r.find("select"))&&c.each(function(){var a=this.id.replace(/\./g,"\\.");k.setValue(a,"");a=x(this).find("option").eq(0).text();
x(this).siblings(".a-input-dropdown").text(a)}),r.find(".installments-enabled-text").hide(),g.find(".installments-enabled-text").hide(),r.find(".installments-disabled-text").show(),g.find(".installments-disabled-text").show()):(f.attr("disabled",!1).prop("disabled",!1),e.removeClass("a-icon-touch-"+d+"-inactive").addClass("a-icon-touch-"+d+"-active"),d=f.parents(".a-control-row"),d.removeClass("a-color-secondary js-gc-disabled"),r.find(".installments-disabled-text").hide(),g.find(".installments-disabled-text").hide(),
r.find(".installments-enabled-text").show(),g.find(".installments-enabled-text").show(),h.find(".payment-invalid").length||(l.attr("disabled",!1).prop("disabled",!1),h.removeClass("a-color-secondary js-gc-disabled"),h.siblings(".selected-section-more-payment-method").show()),c.is(":checked")&&(l.attr("disabled",!0).prop("disabled",!0),l.attr("checked",!1),l.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active"),l.siblings("i").addClass("a-icon-radio-inactive").removeClass("a-icon-radio-active"),
h.siblings(".selected-section-more-payment-method").hide()))}}function z(a,b){if("true"!==n(b,"isaddresschallenge"))return!1;var c=b.parent();if(p.runConfirmCardValidator(c,c.find("#confirmCardErrors")))return d.scrollTopTo(c.find("#addCreditCardNumber")),!0;c=d.getInputValues(c);p.confirmCreditCard(c,T,c.confirmCardUrl);return!0}function L(a,b){var c=d.getInputValues(b.parent());if("undefined"===typeof c.newMonth||!c.newMonth||!c.newYear||"undefined"===typeof c.newYear||parseInt(c.expmonth,10)===
parseInt(c.newMonth,10)&&parseInt(c.expyear,10)===parseInt(c.newYear,10))return!1;c.handler="update-credit-card";c.ccId0=c.paymentmethodid;c.issueNumber0=c.issuer;c.month0=c.newMonth;c.year0=c.newYear;d.makeAjaxCall(a,c,{},{useSif:!0});return!0}function Q(){var a=x("#new-cc-inbox label");if(a&&0!==a.length){var b;if(b=!(0<C.paymentRows.filter(".a-touch-radio[data-paymentmethodtype\x3d'creditCard']").length))b=C.continueBtn.parents(".a-button").hasClass("a-button-disabled")?!0:!1;b&&(d.scrollTopTo(a),
a.trigger("click"))}}function N(a){if(!a||!a.length)return!1;var b=a.find('input[name\x3d"paymentMethod"]').val();if("cashOnDeliveryCash"===b&&a.parent().find(".phonenumberNotVerified").length||"addingNewCCInBox"===b||"addingNewCUPDCInBox"===b)return!1;if("verifiedDebitCard"!==b&&"verifiedCreditCard"!==b)return!0;if("verifiedCreditCard"===b)return!1;a=C.newVDC.find("#vdcBanksSelect").val();return""!==a&&"OtherBanks"!==a}function T(a){a=c.jsonify(a);a.imbWidgetHTML&&x("#imb-wrapper").html(d.decodeJSonResponse(a.imbWidgetHTML));
var b=G(),e=n(b,"paymentmethodid");!a.cardWidgetHTML||a.newpaymentmethodid!==e&&a.optionalnewpaymentmethodid!==e||(b.closest(".a-box").replaceWith(d.decodeJSonResponse(a.cardWidgetHTML)),ba(),b=G(),"true"!==n(b,"isaddresschallenge")&&(p.setCardPasswordInputStatus(b,a.newpaymentmethodid,"cvv","#existingCvvNum"),p.setCardPasswordInputStatus(b,a.newpaymentmethodid,"pincode","#existingPincodeNum"),C.continueBtn.closest(".a-row").show()))}function G(){var a=C.paymentRows.filter("[ischecked\x3d1]");return a.length?
a:C.paymentRows.filter("[data-ischecked\x3d1]")}function S(){var a=[];a.push(G());C.jppoints&&C.jppoints.length&&C.jppoints.find("#redeemPoints").is(":checked")&&a.push(C.jppoints);return a}function P(){for(var a=[".financial-offer-err-detail"],b=0;b<a.length;b++){var c=x(a[b]);c.data("isHidden")||c.show()}}function r(a){a.stopPropagation();a.preventDefault()}function u(a,b){U[b]&&(U[b](),U[b]=null);var c=a.find(b);c.length&&(c=c[0],c.addEventListener("click",r),U[b]=function(){c.removeEventListener("click",
r)})}function D(a){var b=".card-cvv-field .card-pcard-field #invoice-address .loc-order-number #net-banking-list #selected-section-more-payment-method .new-card-fields #rewards-balance-link .financial-offer-link .financial-offer-err-detail .review-continue-text #form-add-cupdc-inbox .otpBlock".split(" ");Y||b.push("#domestic-card-list","#third-party-list","#installment-payment-warning");var c=x("#cash-back-ineligible-for-cod-message");c&&c.length&&b.push("#cash-back-ineligible-for-cod-message");c=
C.paymentRows.parent();a=a.parent();for(var d=0;d<b.length;d++){var e=b[d];x(e,c).hide();var f=a.find(e);f.data("isHidden")||(f.show(),".card-cvv-field"===e&&(u(a,"#existingCvvNum"),u(a,"#existingPincodeNum")))}b=["#reward-points",".financial-offer"];for(d=0;d<b.length;d++)e=b[d],x(e,c).show(),x(e,a).hide()}function H(){var a;a=x("#select-payments-view input[type\x3d'radio'][name\x3d'paymentMethod']:checked").closest(".a-touch-radio");a=N(a);E(a)}function E(a){var b=C.continueBtn.parents(".a-button");
a?(C.continueBtn.removeAttr("disabled"),b.removeClass("a-button-disabled")):(C.continueBtn.attr("disabled",!0),b.addClass("a-button-disabled"))}function W(b){var c=b.$target.closest("a");b=c.closest("div.extender-section");c=c.find("i");c.hasClass("a-icon-extender-expand")?(b.find(".collapsed").hide(),a.slideDown(b.find(".expanded"),200),c.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse")):(b.find(".collapsed").show(),a.slideUp(b.find(".expanded"),200),c.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"));
d.scrollTopTo(R().find(".reg-expander-anchor"))}function R(){return G().closest(".payment-box")}function X(){O()}function O(a){var b=R();b.find("div.flag-register-rewards").is(":visible")?(b.find(".flag-register-rewards").addClass("aok-hidden"),b.find(".card-unreg-rewards").removeClass("aok-hidden"),b.find(".a-box-inner:first").removeClass("no-padding-bottom")):a||(b.find(".card-unreg-rewards").addClass("aok-hidden"),b.find(".flag-register-rewards").removeClass("aok-hidden"),b.find(".a-box-inner:first").addClass("no-padding-bottom"));
a||d.scrollTopTo(b)}function Z(a){a.$event.preventDefault();var b=a.$currentTarget.closest(".payment-box"),e=b.find(".a-touch-radio");0!==e.length&&(e.find('input[type\x3d"radio"]').click(),"1"===b.find("div.flag-register-rewards").data("cached")?O():(b=a.$target.attr("href"),g.show(),d.makeAjaxCall(b,a.data,{successHandler:function(a){g.hide();var b=c.jsonify(a);a=d.decodeJSonResponse(b.widgetHTML);R().find("div.flag-register-rewards").html(a).data("cached","1").find(".error-message").each(function(){var a=
x(this),c=a.data("errorid");a.html(b.displaydata[c])});O()}})))}function aa(a){g.show();var b=R(),e=b.find("input[type\x3dradio][name\x3dpaymentMethod]").val(),f=b.find(".card-unreg-rewards").data(),l=b.find(".flag-register-rewards"),l=d.getInputValues(l);l.programid=f.programid;l.paymentinstrumentid=f.paymentinstrumentid;l.CARD_EXPIRATION_DATE=f.expiredate;l.CARD_HOLDER_NAME=f.holdername;l.returnRefreshedPage=a.data.returnRefreshedPage;l.rewardsdateofbirthmonth&&l.rewardsdateofbirthday&&(l.DATE_OF_BIRTH=
l.rewardsdateofbirthmonth+l.rewardsdateofbirthday);d.makeAjaxCall(a.data.url,l,{successHandler:function(a,f,l){g.hide();a&&(a=c.jsonify(a),f=R().find(".register-error"),a.error?f.show().find(".error-message").hide().filter("#"+a.error).show():(f.hide(),C.pageContainer.html(a.refreshedPage),ba(),b=C.paymentRows.find('input[type\x3dradio][name\x3dpaymentMethod][value\x3d"'+e+'"]').closest(".a-touch-radio"),b.trigger("click")),d.scrollTopTo(b))}})}function ba(b){if(d.isMobileCX()){d.refreshElements(C,
da);Y=parseInt(x("input[type\x3d'hidden'][name\x3d'showWidgetInSeparateGroup']").val(),10);Y=isNaN(Y)?0:Y;ca&&(a.declarative("show-expire-date-fields",["click"],l),a.declarative("show-reward-err-detail",["click"],q),a.declarative("show-financial-offer-err-detail",["click"],F),a.declarative("submit-payment-form",["submit"],K),a.declarative("show-reward-points",["click"],t),a.declarative("show-financial-offer",["click"],A),a.declarative("show-rewards-reg-mobile",["click"],Z),a.declarative("register-card-rewards-mobile",
["click"],aa),a.declarative("cancel-register-card-rewards-mobile",["click"],X),a.declarative("extender-toggle-mobile",["click"],W),ca=!1);C.paymentsForm.undelegate(".a-touch-radio","click").delegate(".a-touch-radio:has(input[name\x3dpaymentMethod]:enabled)","click",v);C.paymentsForm.undelegate(".promoLabel","click").delegate(".promoLabel:has(input[name\x3dusePromoBalance]:enabled)","click",V);b=function(a){a.target.focus()};x("input#existingPincodeNum").bind("click",b);x("input#existingCvvNum").bind("click",
b);x("input#existingCvvNum").bind("click",b);x("input#addCreditCardNumber").bind("click",b);x("input#addCreditCardPincode").bind("click",b);x("input#addCreditCardVerificationNumber").bind("click",b);x(".payment-select").bind("touchstart",function(a){x(this).find("i").removeClass("a-icon-touch-radio-inactive")});x("#domestic-card-dropdown").unbind("change").bind("change",function(){x("#label-domestic-card").trigger("click")});x("#third-party-dropdown").unbind("change").bind("change",function(){x("#label-third-party").trigger("click")});
x("#vdcBanksSelect").unbind("change",I).bind("change",I);if(0<x("input[name\x3d'needDisableCODandEMIforGC']").length){b=x("#existing-gift-card-promo");if(b.length){b.bind("click",y);C.paymentsForm.delegate(".js-gc-disabled","click",function(){return!1});var c=b.find("#pm_300");c.is("input[type\x3d'checkbox']:checked")&&M(b,!0);b.data("gc-initially-checked")&&M(b,!0)}var e=x(".existing-gift-card-balance");e.length&&(e.bind("click",y),C.paymentsForm.delegate(".js-gc-disabled","click",function(){return!1}),
c=e.find("#pm_gc_checkbox"),c.is(":checked")&&M(e,!0),e.data("gc-initially-checked")&&M(b,!0))}H();Q();D(G());P();J();b=G();w(b);x("form.checkout-page-form").data("checkoutFormReady",!0).change()}}var x=a.$,C={},ca=!0,da={jppoints:"#jppoints",continueBtn:"#select-payments-view #continueButton",continueErrors:"#continue-errors",gcPromo:"#new-gc-promo",newVCC:"#new-verified-credit-card",newVDC:"#new-verified-debit-card",paymentsForm:"#select-payments-view form",pageContainer:"#page-container",existingBalance:"#pm_300",
paymentRows:"#select-payments-view .a-touch-radio"},Y,U={};return{init:ba,setContinueButtonStatus:E,getSelectedPaymentRow:G}});m.when("A","pay-common-util","pay-rewards-currency").register("page-rewards",function(a,c,d){function f(a){a=p(a.currentTarget);var b=a.closest("div").data(),c=a.val()/b.ratio;isNaN(c)||(c=0>c||a.val()<b.min?0:h(c,b.decimalplaces),n.customRewardPoints.html(c))}function b(a){a=p(a.currentTarget);var b=a.data(),c=a.val(),d=parseFloat(n.rewardForm.find("#rewardsmax").val());
isNaN(c)||0>c?(n.customRewardPoints.html(0),a.val(0)):c>d&&(b=h(d/b.ratio,b.decimalplaces),n.customRewardPoints.html(b),a.val(d))}function g(a){a=p(a.currentTarget);"1"!==a.attr("ischecked")&&(n.rewardRows.attr("ischecked",0),a.attr("ischecked",1),"rewardscustom"===a.find("[type\x3dradio]").val()?(n.customReward.show(),n.customRewardText.addClass("a-text-bold")):(n.customReward.hide(),n.customRewardText.removeClass("a-text-bold")))}function h(a,b){isNaN(b)||(a=Number(a).toFixed(b));a=a.toString();
var c=0<=a.lastIndexOf(".")?a.lastIndexOf("."):a.length;return 3>=c?a:h(a.substring(0,c-3),0)+","+a.substring(c-3)}var p=a.$,k=!0,n={},m={customReward:"#select-payment-rewards-view #custom-reward",customRewardPoints:"#select-payment-rewards-view #custom-reward-points",customRewardText:"#select-payment-rewards-view #custom-reward-text",rewardForm:"#select-payment-rewards-view form",rewardRows:"#select-payment-rewards-view .a-touch-radio"};return{init:function(){if(c.isMobileCX()){c.refreshElements(n,
m);k&&(k=!1);var a=n.rewardForm.find("input[name\x3drewardsCustom]"),e=!1,h;a.hasClass("show-currency-input-widget-new")?(e=!0,h=p(a)):a.parent().hasClass("show-currency-input-widget-new")&&(e=!0,h=p(a.parent()));if(e){var l=parseFloat(h.data("max")),q=h.data("decimalplaces"),F=h.data("ratio"),t=h.data("country-code");a.each(function(b,c){var e=n.rewardForm.find("#custom-reward-points");p(a);var f={$element:p(a),maxAmount:l},e={$element:p(e),decimalPlaces:q,ratio:F},g=d.getCurrencyFormatByCountryCode(t);
d.initializeInlineFormatting(f,e,g)})}else a.unbind("keyup").bind("keyup",f).unbind("blur").bind("blur",b);n.rewardForm.undelegate(".a-touch-radio","click").delegate(".a-touch-radio","click",g)}}}});m.when("A","pay-common-util").register("page-financial-offer",function(a,c){function d(a){a.$event.preventDefault();a=a.$target;var b=c.getInputValues(a),d=a.find(":checked").val();b.selectedFinancialOfferId=d;b.recommendedPaymentMethodId=b.paymentMethodId;c.makeAjaxCall(a.attr("action"),b)}var f=!0,b=
{},g={financialOfferForm:"#select-payment-financial-offer-view form",financialOfferRows:"#select-payment-financial-offer-view .a-touch-radio"};return{init:function(){c.isMobileCX()&&(c.refreshElements(b,g),f&&(a.declarative("apply-financial-offer",["submit"],d),f=!1))}}});m.when("A","pay-common-util","ready").execute(function(a,c){function d(){c.isMobileCX()&&(c.init(),c.elements.pageContainer.undelegate(".expando-link","click").delegate(".expando-link","click",function(a){var b=f(this);a=b.closest("div.expando-section").find("div.expando-content");
a.is(":visible")?a.slideUp("fast",function(){b.find("i").removeClass("a-icon-collapse").addClass("a-icon-expand");b.find("div.expando-toggle-text-show").show();b.find("div.expando-toggle-text-hide").hide()}):a.slideDown("fast",function(){b.find("i").removeClass("a-icon-expand").addClass("a-icon-collapse");b.find("div.expando-toggle-text-show").hide();b.find("div.expando-toggle-text-hide").show()})}))}var f=a.$,b=f("input#isPipelinedPage");if(0<b.length&&"1"===b.val())a.on("checkout:reload:payselect",
d);else d()});m.when("A","pay-common-util","page-slide","pay-validator","ajax-utility","page-transition-controller","pay-credit-card","page-main","pay-common-lib","safe-mash","ready").register("mobile-new-payments",function(a,c,d,f,b,g,h,p,m,n){function I(a){"undefined"!==typeof k.ue&&"undefined"!==typeof k.ue.count&&k.ue.count("PayPage-ClientSide-AddCupClick-Mobile",1);var b=a.data.url,d={},e;for(e in a.data)"url"!==e&&(d[e]=a.data[e]);"object"===typeof n?"function"===typeof n.showEmbeddedBrowser&&
n.showEmbeddedBrowser({targetURL:b,method:"POST",postParameters:d,successCallback:function(){}}):c.submitFormRequest(b,d,{target:"_blank"})}function v(a){"undefined"!==typeof k.ue&&"undefined"!==typeof k.ue.count&&k.ue.count("PayPage-ClientSide-AddCupAckClick-Mobile",1);g.show();k.location.reload()}function e(a,b){var d=a.data.type;h.isWaitingForType(d)?(a.$event.preventDefault(),g.show(),setTimeout(function(){e(a)},50)):(z("#card-scanner-success-messages").addClass("aok-hidden"),J(d)?a.$event.preventDefault():
z("#cupSecurityCode").is(":visible")&&z("#cupMobileNumber").is(":visible")?l(a,b):b?c.makeAjaxCall(a.data.url,b,{successHandler:A},{useSif:!0}):K(a,{useSif:!0}))}function w(a){a.$event.preventDefault();var b=c.getInputValues(z("#new-cc-inbox #form-add-credit-card"));b.handler=b.handler_addNewCC;e(a,b)}function l(a,d){if(!d){d={};for(var e=a.$declarativeParent.find("form").serializeArray(),f=0;f<e.length;f++)d[e[f].name]=e[f].value}a.$event.preventDefault();c.makeAjaxCall("/gp/buy/payselect/handlers/add-credit-card.html",
d,null,{useSif:!0,success:function(a,c,d){a=b.jsonify(a);q(a,c,d)}})}function q(a){var d={},e={success:function(a,d,e){a=b.jsonify(a);a.checkStatusCount?(a.checkStatusCount=parseInt(a.checkStatusCount,10),isNaN(a.checkStatusCount)&&(a.checkStatusCount=1)):a.checkStatusCount=3;"PENDING"===a.cardStatus&&1<a.checkStatusCount?(--a.checkStatusCount,q(a)):c.submitFormRequest("/gp/buy/payselect/handlers/submit.html",{newPaymentMethodId:a.paymentInstrumentId})}};d.paymentInstrumentId=a.paymentInstrumentId;
a.checkStatusCount&&(d.checkStatusCount=a.checkStatusCount);setTimeout(function(){c.makeAjaxCall("/gp/buy/payselect/handlers/check-credit-card-status.html",d,null,e)},2500)}function F(a){h.handleCreditCardType(a,V)}function t(a){a.$event.preventDefault();var b=a.data.type;if(!J(b)){var e=L[b],f=z(e.fieldId),e=e.suffix,g=c.getInputValues(f),f=g["addCreditCardVerificationNumber"+e],l=g["addCreditCardPincode"+e],b={addCreditCardNumber:g["addCreditCardNumber"+e],addCreditCardVerificationNumber:f,addCreditCardPincode:l,
handler:g["handler"+e],month:g["month"+e],name:g["name"+e],newPaymentType:b,recommendedPaymentMethodId:g.paymentMethod,year:g["year"+e],cctype:g["cctype"+e]};c.prop("cvv-newcard",f);c.prop("pincode-newcard",l);c.makeAjaxCall(a.data.url,b,{successHandler:function(a){if(a){var b=z(c.pages.main.pageId);d.slideShow(b,a);a=z("#select-payments-view .a-touch-radio");h.setNewCardCVVInputStatus(a)}}},{useSif:!0})}}function A(b,e,f){b&&(e=c.getPageId(f))&&(d.slideShow(z(e),b),a.trigger("checkout:reload:payselect"),
(b=0<z(".activateScrollToError").length)&&0<z("#check-errors").length?z(k).scrollTop(z("#check-errors").offset().top):b&&0<z("#direct-debit-errors").length?z(k).scrollTop(z("#direct-debit-errors").offset().top):b&&0<z("#new-invoice-errors").length?z(k).scrollTop(z("#new-invoice-errors").offset().top):"#select-payments-view"===e&&m.scrollTopTo(p.getSelectedPaymentRow()))}function K(a,b){c.handleForm(a,A,b)}function V(a,b){if(a){var c=z(L[b].fieldId);h.setDateSelectorStatus(a,c);if("1"===a.hasErrors){var d=
f.create();d.validateGetCreditCardTypeResult(a);if(d.hasErrors()){d.displayErrors(c.find("#cardErrors"),c);return}}d=c.find(".cup-card-field");if(0!==d.length){var e=a.specificFields;e&&1===e.securityCode&&1===e.mobileNumber?d.show():d.hide()}if(a&&(d=a.specificFields,e=c.find(".pincode-field"),0!==e.length)){var g=c.find(".cvv-field");0!==g.length&&(c=c.find("#cardType"),0!==c.length&&(c.val(a.issuer+a.brand),d&&1===d.pincode?(g.hide(),e.show()):(e.hide(),g.show())))}}}function J(a){if(!(a in L))return!0;
var b=L[a],c=z(b.fieldId),b=b.suffix,d=c.find('input[name\x3d"addCreditCardVerificationNumber'+b+'"]'),e=c.find('select[name\x3d"month'+b+'"]'),g=c.find('input[name\x3d"name'+b+'"]');a=c.find('input[name\x3d"addCreditCardNumber'+("brdc"===a?"":b)+'"]');var l=c.find('input[name\x3d"addCreditCardMobileNumber'+b+'"]'),h=c.find('select[name\x3d"year'+b+'"]'),p=c.find('input[name\x3d"addCreditCardPincode'+b+'"]'),n=f.create();d&&d.length&&d.is(":visible")&&(n.isAMEXCreditCard(a)?n.validateCreditCardCVV2(d,
d,"A"):n.validateCreditCardCVV2(d,d));l&&l.length&&l.is(":visible")&&n.validateCreditCardMobile(l,l);e.is(":disabled")||h.is(":disabled")||n.validateCreditCardDate(e,e.closest(".card-date").find(".a-button"),h,h.closest(".card-date").find(".a-button"));n.validateCreditCardName(g,g);n.validateCreditCardNumber(a,a);p&&p.length&&p.is(":visible")&&n.validateCreditCardPincode(p,p);n.displayErrors(c.find("#cardErrors"+b),c);0<z(".activateScrollToError").length&&0<z("#cardErrors").length&&z(k).scrollTop(z("#cardErrors").offset().top);
return n.hasErrors()}function y(){if(c.isMobileCX()&&Q){a.declarative("new-payment-methods",["click"],function(a){a.$event.preventDefault();c.makeAjaxCall(a.data.href,{},{successHandler:function(a){if(a){var b=c.pages["new-payment-methods"].pageId;d.slideShow(z(b),a);c.scrollTopTo(z(b))}}})});a.declarative("new-cc",["submit"],e);a.declarative("new-cc-inbox",["click"],w);a.declarative("new-dd",["submit"],K);a.declarative("new-invoice",["submit"],K);a.declarative("new-brdc",["submit"],e);a.declarative("new-verified-card",
["click"],t);a.declarative("check-card-type",["change"],F);a.declarative("redirect-cup",["click","touchend"],I);a.declarative("cup-popover-close",["click"],v);a.declarative("new-ba",["submit"],function(a){var b=a.$target;if(b.find("#check-account-number").val()!==b.find("#check-account-number-confirm").val())return b.find("#check-errors").show(),b.find("#addBankAccount_AccountNumberMismatch").show(),b.find("[error\x3daddBankAccount_AccountNumberMismatch]").addClass("a-form-error"),a.$event.preventDefault(),
!1;K(a)});var b;a.declarative("check-terms-show",["click"],function(c){b=z(document).scrollTop();a.$("#check-terms-content").show();z(document).scrollTop(0)});a.declarative("check-terms-close",["click"],function(c){z(document).scrollTop(b);a.$("#check-terms-content").hide()});a.declarative("new-gc-promo",["click"],M);a.declarative("invoice-policy",["click"],function(a){a=a.$declarativeParent;a.find("i.a-icon-touch-link").hide();a.find("span.policy-preview").hide();a.find("span.policy-full").show()});
Q=!1}}function M(a){var b=c.getInputValues(z("#new-gc-promo"));a.data.handler&&(b.handler=a.data.handler);c.makeAjaxCall(a.data.url,b,{successHandler:function(a,b,e){a&&(b=c.getPageId(e))&&d.slideShow(z(b),a)}});a.$event.preventDefault()}var z=a.$,L={cc:{fieldId:"#form-add-credit-card",suffix:""},vcc:{fieldId:"#new-verified-credit-card",suffix:"_VCC"},vdc:{fieldId:"#new-verified-debit-card",suffix:"_VDC"},brdc:{fieldId:"#form-add-br-debit-card",suffix:"_BRDC"}},Q=!0,N=z("input#isPipelinedPage");if(0<
N.length&&"1"===N.val())a.on("checkout:reload:payselect",y);else y()});m.when("A","page-main","ready").execute(function(a,c){var d=a.$,d=d("input#isPipelinedPage");if(0<d.length&&"1"===d.val())a.on("checkout:reload:payselect",c.init);else c.init()});m.when("A","page-rewards","ready").execute(function(a,c){var d=a.$,d=d("input#isPipelinedPage");if(0<d.length&&"1"===d.val())a.on("checkout:reload:payselect",c.init);else c.init()});m.when("A","page-financial-offer","ready").execute(function(a,c){var d=
a.$,d=d("input#isPipelinedPage");if(0<d.length&&"1"===d.val())a.on("checkout:reload:payselect",c.init);else c.init()});m.when("A","page-main","pay-common-util").register("jppoints-mobile",function(a,c,d){function f(){e.gcCheckbox.is(":checked")||(e.redeemableAmount.text(e.redeemableAmountWithoutGC.val()),e.redeemableValue.text(e.redeemableValueWithoutGC.val()));e.gcRadio&&e.gcRadio.is(":checked")&&b();e.redeemPoints.parents(".a-control-row").bind("click",p);e.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]').closest(".a-control-row").bind("click",
k);e.jpPointsCustomAmount.bind("keyup",m);e.jpPointsCustomAmount.bind("click",function(){e.useCustomPoints.attr("checked",!0);e.useCustomPoints.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");e.useMaxPoints.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active");g()||c.setContinueButtonStatus(!1)});e.gcCheckbox.parents(".a-control-row").bind("click",n);e.paymentRows.bind("click",function(){var a=v(this).find('input[type\x3d"radio"]');
a&&a.length&&("availablebalance"===a.val()?b():(e.redeemPoints.attr("disabled",!1),e.jppoints.find('input[type\x3d"radio"]').attr("disabled",!1),e.jppoints.find('input[type\x3d"checkbox"]').attr("disabled",!1),e.useCustomPoints.attr("disabled",!1),e.jpPointsCustomAmount.attr("disabled",!1),e.jppoints.find("#canApplyPoints").show(),e.jppoints.find("#cannotApplyPoints").hide()))})}function b(){e.redeemPoints.attr("checked",!1).attr("disabled",!0);e.redeemPoints.siblings("i").addClass("a-icon-touch-checkbox-inactive").removeClass("a-icon-touch-checkbox-active");
e.jppoints.find('input[type\x3d"radio"]').attr("checked",!1).attr("disabled",!0);e.jppoints.find('input[type\x3d"checkbox"]').attr("checked",!1).attr("disabled",!0);e.jppoints.find("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active");e.useCustomPoints.attr("disabled",!0);e.jpPointsCustomAmount.val("");e.jpPointsCustomAmount.attr("disabled",!0);e.jppoints.find("#canApplyPoints").hide();e.hiddenSection.hide();e.jppoints.find("#cannotApplyPoints").show()}function g(){return 0<
e.paymentRows.filter("[data-ischecked\x3d1]").length}function h(){var a=v('input[type\x3d"radio"][name\x3d"paymentMethod"]');a.attr("checked",!1);a.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active");a.closest("label").attr("ischecked",0)}function p(a){v(a.target);e.redeemPoints.siblings("i").toggleClass("a-icon-touch-checkbox-active").toggleClass("a-icon-touch-checkbox-inactive");e.redeemPoints.attr("checked",!e.redeemPoints.attr("checked"));if(e.redeemPoints.is(":checked")){e.hiddenSection.show();
e.useMaxPoints.attr("checked",!0);e.useMaxPoints.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");a=parseInt(e.redeemableAmount.text(),10);var b=parseInt(e.jpPointsConversionRate.val(),10),d=parseInt(e.purchaseTotalRaw.val(),10);e.gcCheckbox.is(":checked")&&(d-=parseInt(e.jpPointsCustomerGCValue.val(),10));b*a>=d?(h(),c.setContinueButtonStatus(!0)):g()||c.setContinueButtonStatus(!1)}else e.hiddenSection.hide(),e.useMaxPoints.attr("checked",!1),e.useMaxPoints.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active"),
e.useCustomPoints.attr("checked",!1),e.useCustomPoints.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active"),e.jpPointsCustomAmount.val(""),g()||c.setContinueButtonStatus(!1);return!1}function k(a){a=v(a.target);if(a.find("#jpPointsMax").length||a.siblings("#jpPointsMax").length){e.useMaxPoints.attr("checked",!0);e.jpPointsError.hide();e.jpPointsCustomAmount.val("");e.jpPointsCustomAmount.removeClass("a-form-error");e.useMaxPoints.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");
e.useCustomPoints.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active");a=parseInt(e.redeemableAmount.text(),10);var b=parseInt(e.jpPointsConversionRate.val(),10);a*=b;b=parseInt(e.purchaseTotalRaw.val(),10);e.gcCheckbox.is(":checked")&&(b-=parseInt(e.jpPointsCustomerGCValue.val(),10));a>=b?(h(),c.setContinueButtonStatus(!0)):g()||c.setContinueButtonStatus(!1)}else e.useCustomPoints.attr("checked",!0),e.useCustomPoints.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive"),
e.useMaxPoints.siblings("i").addClass("a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-active"),e.jpPointsCustomAmount.focus(),g()||c.setContinueButtonStatus(!1);return!1}function n(){var a=e.gcCheckbox;if(!a.length&&(a=v('input[type\x3d"radio"][value\x3d"availableBalance"]'),!a.length))return;var b;a.is(":checked")?(a=parseInt(e.redeemableAmountWithoutGC.val(),10),b=e.redeemableValueWithoutGC.val()):(a=parseInt(e.redeemableAmountWithGC.val(),10),b=e.redeemableValueWithGC.val());e.redeemableAmount.text(a);
e.redeemableValue.text(b);m()}function m(){var a=parseInt(e.jpPointsCustomAmount.val(),10);if(!a||0>a)e.jpPointsCustomAmount.val(""),e.jpPointsCustomAmount.removeClass("a-form-error"),e.jpPointsError.hide();else if(e.jpPointsCustomAmount.val(a),parseInt(e.redeemableAmount.text(),10)<a)e.jpPointsError.show(),e.jpPointsCustomAmount.addClass("a-form-error");else{e.jpPointsError.hide();e.jpPointsCustomAmount.removeClass("a-form-error");var b=parseInt(e.purchaseTotalRaw.val(),10),d=parseInt(e.jpPointsConversionRate.val(),
10),a=a*d;e.gcCheckbox.is(":checked")&&(d=parseInt(e.jpPointsCustomerGCValue.val(),10),a+=d);a>=b?(h(),c.setContinueButtonStatus(!0)):g()||c.setContinueButtonStatus(!1)}}var v=a.$,e={},w={jppoints:"#jppoints",gcCheckbox:'input[type\x3d"checkbox"][name\x3d"useAvailableBalance"]',gcRadio:'input[type\x3d"radio"][value\x3d"availablebalance"]',hiddenSection:"#hiddenSection",jpPointsConversionRate:'input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]',jpPointsCustomAmount:'input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]',
jpPointsCustomerGCValue:'input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]',jpPointsError:"#jpPointsError",purchaseTotalRaw:'input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]',redeemableAmount:"#redeemableAmount",redeemableAmountWithGC:'input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]',redeemableAmountWithoutGC:'input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]',redeemPoints:"#redeemPoints",redeemableValue:"#redeemableValue",redeemableValueWithGC:'input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]',
redeemableValueWithoutGC:'input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]',useCustomPoints:"#jpPointsCustom",useMaxPoints:"#jpPointsMax",paymentRows:"#select-payments-view .a-touch-radio"};a.on("checkout:reload:payselect",function(){d.isMobileCX()&&(d.refreshElements(e,w),e.jppoints&&e.jppoints.length&&f())})});m.when("A","pay-common-util").execute(function(a,c){function d(){f('.a-radio[data-isaddresschallenge\x3d"true"]').unbind("click").bind("click",function(){var a=f(this),c=a.find('input[type\x3d"radio"]').is(":checked"),
d="1"===a.attr("isfocused");a.attr("isfocused",c?1:0);d&&c&&a.find("#addCreditCardNumber").focus()})}var f=a.$;a.on("checkout:reload:payselect",function(){var a;if(a=k.P&&k.P.AUI_BUILD_DATE){a=parseFloat;var g;g=navigator.userAgent.toLowerCase();g=g.match(/android\/([0-9\.]*)/);a=4.4===a(g?g[1]:0)}a&&(a=f("#useFocusFixForTextBoxWithinRadio"),a=a.length&&"1"===a.val());a&&c.isMobileCX()&&d()})});"use strict";m.when("A","ready").register("purchase-order-number-trial",function(a){function c(){}function d(){}
var f=a.$;a.on("checkout:reload:payselect",function(){var a=f(".checkout-page-form");a&&0!==a.length&&parseInt(a.attr("data-trial-po-number"),10)&&f('#existing-loc-accounts input[type\x3d"text"]').each(function(a){var b=f(this);b.unbind("change").bind("change",function(){var a=b.val();if(a&&0!==a.length){var g;if(b.attr("name")){var k=b.attr("name").split(".");k&&2===k.length&&(g=k[1])}g&&0!==g.length&&f.ajax({type:"POST",url:"/gp/buy/payselect/handlers/set-po-number-trial.html",data:{purchaseOrderNumber:a,
paymentMethodId:g},dataType:"text",async:!0,success:c,error:d,cache:!1})}})})})});"use strict";m.when("A","safe-mash","a-dropdown","client-side-metrics","ready").execute(function(a,c,d,f){function b(){setTimeout(function(){h("#stop-mash-reappear").remove()},100)}function g(a,g){a.append('\x3cdiv id\x3d"stop-mash-reappear" /\x3e');h("#ccScannerUsed").val(1);var m=[1],v="undefined"!==typeof k.ue&&"undefined"!==typeof k.ue.count;v&&!c.showCardScanner?k.ue.count("ccScannerFailureMashFtNotFound",1):c.showCardScanner({cardTypes:m,
successCallback:function(c){if(c&&c.cardData){c=c.cardData;var m;h.isArray(c.number)&&c.number.length&&(m=c.number[0].value);if(m){v&&k.ue.count("ccScannerSuccess",1);a.find("#card-scanner-feature").addClass("aok-hidden");a.find("#addCreditCardNumber").val(m);m=null;if(h.isArray(c.expirationMonth)&&h.isArray(c.expirationYear)&&c.expirationMonth.length&&c.expirationYear.length){var l=parseInt(c.expirationYear[0].value,10);100>l&&(l+=2E3);l>=(new Date).getFullYear()&&(m={month:""+parseInt(c.expirationMonth[0].value,
10),year:""+l})}if(m){v&&k.ue.count("ccScannerSuccessWithMonth",1);var q=a.find("#ccMonth");c=a.find("#ccYear");if(0>=q.length||0>=c.length){b();g&&a.find("#confirm-card").trigger("click");return}p?(d.getSelect(q).val(m.month),d.getSelect(c).val(m.year)):(f.increaseCount("removeauijs34"),q.val(m.month),l=q.siblings("a.a-placeholder"),q=q.find("option[value\x3d"+m.month+"]").text(),l.html(q),c.val(m.year),l=c.siblings("a.a-placeholder"),c=c.find("option[value\x3d"+m.year+"]").text(),l.html(c))}c=!1;
l=a.find("#card-scanner-success-messages");h("#ccName").val()||(l.find("#cc-scan-missing-name").removeClass("aok-hidden"),c=!0);m||(l.find("#cc-scan-missing-exp-date").removeClass("aok-hidden"),c=!0);c&&l.removeClass("aok-hidden")}else v&&(k.ue.count("ccScannerFailure",1),k.ue.count("ccScannerFailureNoNum",1));b();g&&a.find("#confirm-card").trigger("click")}else b()},failCallback:function(a){v&&(k.ue.count("ccScannerFailure",1),k.ue.count("ccScannerFailureError",1));b()}})}var h=a.$,p=k.P&&k.P.AUI_BUILD_DATE;
a.declarative("card-scanner",["click"],function(a){a.$event.preventDefault();a=a.$currentTarget.parents("#add-new-cc, #new-cc, #new-cc-inbox");g(a,!1)});a.declarative("card-scanner-addr-challenge",["click"],function(a){a.$event.preventDefault();a=a.$currentTarget.parents(".payment-box, .payment-row");g(a,!0)})});"use strict";m.when("page-detector","A","ready").register("third-party-account-alternative",function(a,c){var d=c.$;c.declarative("a-third-party-payment-select",["click"],function(a){var b=
null;a.data&&a.data.value?b=a.data.value:(a=a.$target.closest(".payment-alternate"),a.length&&(b=a.data("value")));b&&d("#third-party-select").val(b)});c.on("checkout:reload:payselect",function(){if(a.isMobile()){var c=d(".payment-alternate");c.length&&(c=c.find("input[type\x3d'radio']:checked"),c.length&&c.click())}else if(c=d("#third-party-account").find(".payment-alternate"),0!==c.length){var b=d("#pm-third-party-account");b.length&&b.is(":checked")&&(b=d("#third-party-select").val(),c=c.filter("[data-value\x3d"+
b+"]"),c.length&&(c.addClass("payment-selected"),c.find("input").prop("checked",!0)))}})});"use strict";m.when("A","page-transition-controller","scroll-controller","checkout-modal-popover","page-conductor","checkout-general-utils","safe-mash").register("itemselect-controller",function(a,c,d,f,b,g,h){function p(a){I(a.data);a.$event.preventDefault();a=a.$target.closest(A?"button[type\x3dbutton]":"input[type\x3dbutton]");var b={};b[a.attr("name")]=a.val();m(b)}function m(a){c.show();var d=t("form#changeQuantityFormId"),
e=d.serialize(),e=e+("\x26"+t.param(a));t.ajax({type:"POST",url:d.attr("action"),data:e,dataType:"text",headers:{"x-amz-checkout-page":"itemselect"},error:b.ajaxRedirect,success:n})}function n(a,d,e){var f=e.getResponseHeader("x-amz-checkout-new-cart-quantity");g.updateCartByMash(f);f=e.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==f&&void 0!==f?(c.hide(),k.location=f):b.ajaxUpdatePage(a,d,e,{pushNewFrame:"false"})}function I(a){""!==a&&t("form#changeQuantityFormId").attr("action",a)}
function v(){c.hide();k.location="/gp/aw/c/ref\x3dox_spc_deal_expired?app-action\x3dcart"}function e(){d.toggleScrollOn();t("div.stma-line-item-hidden-fields input[name^\x3dpreviousQuantity]").each(function(){var a=t(this);if(a.attr("name")&&17<a.attr("name").length){var b=a.attr("name").substring(17);t('div.stma-line-item-details input[name\x3d"quantity.'+b+'"]').val(a.val())}})}function w(a){function b(a){var c=t("#stma-address-selector"),d=a.data("itemCount"),e=a.data("addressSelectorName"),f=
t("#address-item-id-"+d).val();a=a.data("ineligibleAddresses");t("#address-selector-selector").val(e);t("#address-selector-id").val(f);t("#address-selector-num").val(d);c.find(".addressLine").removeClass("a-active");c.find("."+f).addClass("a-active");t("#stma-page-container").hide();t("#stma-page-header").hide();A&&t("#stma-page-footer").hide();c.show();l(a)}K||(K={value:!1},"1"===t("#rmMultiaddress2ndBackApp").val()&&(K.value=h&&h.navigate&&t("#checkoutDisplayPage").data("useMashNavigateForTransitions")));
K.value?h.navigate({url:null,transitionEffect:"slide",successCallback:function(){b(a);k.history.pushState({multipleAddressPageMarker:!0},"");k.history.pushState(null,"");var c=k.onpopstate;k.onpopstate=function(a){a.state.multipleAddressPageMarker&&(F(),k.onpopstate=c,k.history.back())}},failCallback:function(a){}}):b(a)}function l(a){t(".addressLine").prop("disabled",!1);t("div#shouldHideIneligibleAddressesDiv").length?(t(".addressLine").show(),t(a.split(" ")).each(function(){t("#"+this).prop("disabled",
!0).hide()})):(t(".addressLine").css("color","black"),t(a.split(" ")).each(function(){t("#"+this).prop("disabled",!0).css("color","grey")}));var b=t("#filterMessage");a?b.show():b.hide()}function q(a){var b="#"+t("#address-selector-selector").val();if(t(b).hasClass("pantry-item")&&(b=t(".pantry-item"),!(2>b.length))){var c=a.data("addressid"),d=a.data("addresskey"),e=a.data("addresshtml");b.each(function(){var a=t(this);if(a.val()===d)return!0;var b,f=a.parents("a[data-item-count]")[0];f&&(b=t(f).attr("data-item-count"));
b&&(a.val(d),t("#address-item-id-"+b).val(c),t("#address-item-display-"+b).text(e))})}}function F(){t("#stma-page-header").show();t("#stma-page-container").show();A&&t("#stma-page-footer").show();t("#stma-address-selector").hide()}var t=a.$,A=k.P&&k.P.AUI_BUILD_DATE,K=null;a.on("checkout:reload:itemselect",function(){t("form#changeQuantityFormId").attr("action",t("form#changeQuantityFormId").attr("action")+"\x26action\x3dcontinue");a.defer(function(){t("html").hasClass("a-touch")&&t("a[target\x3d'AmazonHelp']").removeAttr("onclick")});
0<t("div.checkout-stma-tablet").length&&t(".quantity-field").unbind("keypress.stma-qty-field").bind("keypress.stma-qty-field",function(b){13===b.which&&(b.preventDefault(),c.show(),a.trigger("a:declarative:ship-to-multiple-continue:click"),t("form#changeQuantityFormId").submit())});var b=t("#addon-indicator");b.data("hasAddonItems")&&(b=b.data("addonWarningType"),b=t("#addon-warning-"+b+"-launcher"),b.length&&(t("#a-popover-addon-warning-normal .delete-title").show(),t("#a-popover-addon-warning-normal .reduce-title").hide(),
b.trigger("click"),d.scrollToTop(),d.toggleScrollOff()))});(function(){a.declarative("stma-delete-item",["click"],function(a){p(a)});a.declarative("ship-to-multiple-delete",["click"],function(a){0<t("div.checkout-stma").length&&(t(".quantity-delete-button[data-entity-id\x3d'"+a.$currentTarget.data("entityId")+"']"),k.confirm(t("#addressConfirmDeletion").val())?p(a):a.$event.preventDefault())});a.declarative("ship-to-multiple-continue",["click"],function(a){I(a.data)});a.declarative("stma-items",["click"],
function(a){a=a.$currentTarget;var b=t("#stma-address-selector"),c=a.data("addressid"),d=a.data("addresskey");b.find(".addressLine").removeClass("a-active");b.find("."+c).addClass("a-active");b="#"+t("#address-selector-selector").val();t(b).val(d);d=t("#address-selector-num").val();t("#address-item-id-"+d).val(c);c="#address-item-display-"+d;a=a.data("addresshtml");t(c).text(a);K.value?h.goBack():F()});a.declarative("stma-address-select",["click"],function(a){w(a.$currentTarget)});a.declarative("stma-back",
["click"],function(a){a.$event.preventDefault();F()});a.declarative("addon-return-to-cart",["click"],function(a){0<t("div.checkout-stma-mobile").length&&v()});a.declarative("addon-delete-items",["click","touchend"],function(a){0<t("div.checkout-stma").length&&(a.$event.preventDefault(),d.toggleScrollOn(),a=t("input#updateLinkAction").val(),I(a),m({"deleteAddon.x":1,"deleteAddon.y":1}))});a.declarative("addon-dont-delete",["click","touchend"],function(a){0<t("div.checkout-stma").length&&e()});a.declarative("stma-items",
["click"],function(a){q(a.$currentTarget)});a.on("a:popover:hide:addon-warning-normal",function(a){0<t("div.checkout-stma-mobile").length?v():0<t("div.checkout-stma-tablet").length&&e()});a.on("a:popover:hide:addon-warning-special",function(a){0<t("div.checkout-stma").length&&e()})})()});"use strict";m.when("A","checkout-general-utils").register("checkout-confirm-action",function(a,c){var d;a.declarative("a-checkout-confirm-action",["click","touchend"],function(d){if(!c.protectAgainstDoubleAction("checkout-confirm-action")){var b=
a.$("#rcx-confirm-"+d.data.confirmAction).find("#rcx-modal-trigger"),g=b.data("a-checkout-modal-popover");g.data=d.data;b.data("a-checkout-modal-popover",g);setTimeout(function(){b.trigger("click")},30)}});a.declarative("a-popover-confirm",["click","touchend"],function(f){c.protectAgainstDoubleAction("popover-confirm")||(f=f.data,d&&d.data&&f&&a.trigger("a:declarative:"+f,d.data),d&&d.$popover.find("button[data-action]\x3da-popover-close").trigger("click"))});a.on("a:popover:show:checkout-confirm",
function(c){d=c.popover;c=d.$popover.find(".a-popover-inner");var b=a.$("#rcx-confirm-"+d.data.confirmAction).find("#rcx-confirm-template").html();c.html(b);d.updatePosition()});a.on("a:popover:hide:checkout-confirm",function(){d=null})});"use strict";m.when("A").register("pip-controller",function(a){var c=a.$;a.on("checkout:reload:pip",function(){c(".checkout.checkout-pip").length||c("head .aui-page-asset").attr("disabled",!0);c("head .old-pipeline-asset").attr("disabled",!0);0<c("#disablePIPPrefetch").length?
(c(".prime-checkout-continue-link").removeClass("checkout-continue-link"),c(".prime-checkout-continue-form").removeClass("checkout-page-form")):(c(".prime-checkout-continue-link").addClass("checkout-continue-link"),c(".prime-checkout-continue-form").addClass("checkout-page-form"))})});"use strict";m.when("A","page-detector").register("locker-promo-controller",function(a,c){function d(){var a=b("#locker-search-link"),c=a.attr("href");a.attr("href",c+"\x26hasWorkingJavascript\x3d1");b("#locker-promo-checkbox-link").addClass("has-js")}
function f(){b("#locker-promo-checkbox-link").addClass("has-js");if(b("#locker-promo").hasClass("trigger-interstitial")){var a=b("#locker-high-vis-promo-title");setTimeout(function(){a.trigger("click")},50)}}var b=a.$;b("html").hasClass("a-ie6")||(a.on("checkout:reload:spc",d),a.on("checkout:reload:shipoptionselect",f))});"use strict";m.when("A","page-transition-controller","scroll-controller","loading-spinner-controller","page-conductor","checkout-general-utils").register("store-search-popover-controller",
function(a,c,d,f,b,g){function h(){if(0<z&&"undefined"!==typeof k.Map)try{k.Map.getMapAndIcons(),V=!0}catch(a){--z,setTimeout(h,500)}z=20}function p(){G=0;q.find("button.a-button-close").trigger("click")}function m(a){var b=l("#locker-promo");b.hasClass("trigger-interstitial")&&(b.removeClass("trigger-interstitial"),w(T),0<l("#lockerInterstitialHeader").length&&l("#lockerInterstitialHeader").hide(),l.ajax({type:"POST",url:"/gp/azbox/interstitial/handlers/interstitial-opt-out.html/ref\x3d"+a,dataType:"html",
cache:!1,headers:{"x-amz-checkout-page":"sosp"}}))}function n(a){a.filter("style").each(function(){var a=this.text||this.textContent||this.innerHTML||"";if(null!==a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));q.find("#storeResultContent").append(b)}})}function I(a){a.filter("script").each(function(){if(this.src)0<this.src.indexOf("mapcontrol")&&(K=this.src);else{var a=this.text||this.textContent||this.innerHTML||
"";if(null!==a){var b=document.createElement("script");b.type="text/javascript";b.text=a;q.find("#storeResultContent").append(b)}}})}function v(a,c){a.find("div#wrapper").css("width","100%");a.find("div#ft").hide();f.hideSpinner(J);J.show();J.html(a.find("div#wrapper"));J.css({"overflow-y":"scroll"});q.css("position","absolute");q.css("top","50px");l("#storeResultContent").css("height",L+"px");n(a);I(a);null!==K&&!1===V?l.ajax({url:K,async:!1,success:h,dataType:"script",error:function(a,c,d){b.ajaxRedirect(a,
c,d)}}):h();d.scrollToTop();d.toggleScrollOff()}function e(a){J=F.$popover.find("#storeResultContent");f.showSpinner(J);l.ajax({type:"POST",url:a,dataType:"html",data:{defaultStoreUpsellSelectedAddressId:P},async:!0,cache:!1,headers:{"x-amz-checkout-page":"sosp"},success:function(a,c,d){null!==a?(c=l(a),0<c.find("div.errorblock").length?(f.hideSpinner(J),J.show(),J.html(c.find("div.errorblock").parent())):0<c.find("input[name\x3drefineSearch]").length?(A=c.find("form[name\x3dlocationForm]"),null!==
A&&(A.find("input").attr("id","storeSearchRefineButton"),A.parent().find("h1").css("color","black")),v(c,a)):0<c.find("div#wrapper").length?(c.find("#wrapper").find("tr:first").children("td")[0].style.width="49%",c.find("#wrapper").find("tr:first").children("td")[1].style.width="2%",c.find("#wrapper").find("tr:first").children("td")[2].style.width="49%",c.find("#sl_map").css("width","100%"),c.find("#whatsThisPopoverLink").removeAttr("href"),c.find("#whatsThisPopoverLink").addClass("a-declarative"),
c.find("#whatsThisPopoverLink").css("a-declarative"),c.find("#whatsThisLink").addClass("a-declarative"),c.find("#whatsThisLink").attr("data-action","a-tooltip"),d='{"position":"triggerBottom","content":"'+M+'"}',c.find("#whatsThisLink").attr("data-a-tooltip",d),c.find("#whatsThisLink").css("max-width","100px"),c.find("input[name\x3dshipToThisAddress]").attr("src",y),c.find("input[name\x3dshipToThisAddress], span.default-store-upsell-selected-address").parent().css("text-align","center"),c.find("input[name\x3dshipToThisAddress], span.default-store-upsell-selected-address").parent().css("vertical-align",
"middle"),t=c.find("table.storesearchtable").parent(),t.find("label").css("display","inline"),c.find("table.storesearchtable").parent().append(N),c.find("table.storesearchtable").parent().find("div#lockerPromoPopover").show(),v(c,a)):k.location.reload()):b.ajaxRedirect()},error:function(a,c,d){b.ajaxRedirect(a,c,d)}})}function w(a){q.find("div.a-popover-header h4").text(a)}var l=a.$;if(!l("html").hasClass("a-ie6")){var q,F,t,A,K=null,V=!1,J,y,M,z=20,L,Q,N,T,G,S,P;a.on("a:popover:hide",function(a){a.popover&&
a.popover.name&&a.popover.name.indexOf("store-search-popover")});l(document).delegate("#storeResultContent input.storesearchprimaryinput","click",function(a){a.preventDefault();l(this).parent().parent().find("input[type\x3dradio]").attr("checked","checked")});l(document).delegate("#storeResultContent input[name\x3dshipToThisAddress]","click",function(a){a.preventDefault();a=l(this).parents().find("form")[0].action;a+="?usecase\x3dcheckout\x26hasWorkingJavascript\x3d1\x26shipToThisAddress\x3dContinue";
var b=l(this).parent().parent().find("input:hidden"),d,e;for(e=0;e<b.length;e++){d=b[e].name;var f=b[e].value;if(G&&S&&"storeUpsellAddressId"===d&&f){d=g.addQueryStringParameter(S,"storeUpsellSelectedAddressId",f);break}d=a=a+"\x26"+d+"\x3d"+f}p();c.show();g.redirectWithJavascript(d)});l(document).delegate("#storeResultContent input[name\x3dshowDetailedMap]","click",function(a){a=a.$target[0].id.replace("pinpointImage_idx_","");"undefined"!==typeof k.Map&&k.Map.selectPin(a-1)});l(document).delegate("#storeResultContent input[name\x3dsearchStoreByName]",
"click",function(a){a.preventDefault();A=q.find("form");a=A[0].action;a+="?usecase\x3dcheckout\x26hasWorkingJavascript\x3d1\x26searchStoreByName\x3dContinue";var b=A.find("input:hidden"),c;for(c=0;c<b.length;c++)a=a+"\x26"+b[c].name+"\x3d"+b[c].value;e(a)});l(document).delegate("#storeResultContent #storeSearchRefineButton","click",function(a){a.preventDefault();A=q.find("form[name\x3dlocationForm]");a=A[0].action;a+="?usecase\x3dcheckout\x26hasWorkingJavascript\x3d1\x26";var b=A.find("input:hidden"),
c;for(c=0;c<b.length;c++)a=a+"\x26"+b[c].name+"\x3d"+b[c].value;e(a)});l(document).delegate("#storeResultContent div.storesearchaction input","click",function(a){a.preventDefault();t=q.find("#new-store").parent().find("form");var b=t.find("input:checked")[0].value;a=t[0].action;var c=t.find("input:checked")[0].name,d=q.find("#"+b)[0].name,f=q.find("#"+b)[0].value;a=a+"?usecase\x3dcheckout\x26hasWorkingJavascript\x3d1\x26"+c+"\x3d"+b+"\x26"+d+"\x3d"+f;for(b=0;b<t.find("select").length;b++)c=t.find("select")[b].name,
d=t.find("option:checked")[b].value,a=a+"\x26"+c+"\x3d"+d;c=t.find("input:hidden");for(b=0;b<c.length;b++)a=a+"\x26"+c[b].name+"\x3d"+c[b].value;e(a)});l(document).delegate("div#promoFooter button","click",function(a){m("sosp_locker_tp_optout_nt");p()});l(document).delegate("div.a-popover-header button.a-button-close","click",function(a){m("sosp_locker_tp_optout_cb")});a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("store-search-popover")){var b=l(k).width(),
c=l(k).height(),b=parseInt(.88*b,10);L=parseInt(.62*c,10);var d=a.popover.$trigger.data("locker-search-url");q=a.popover.$popover;F=a.popover;T=q.find("div.a-popover-header h4").text();l("#locker-promo").hasClass("trigger-interstitial")&&(w(a.popover.$trigger.data("header-interstitial")),0<l("#lockerInterstitialHeader").length&&l("#lockerInterstitialHeader").show(),d=a.popover.$trigger.data("locker-search-url-interstitial"),L=parseInt(.45*c,10));l("#storeResultContent").css("height",L+"px");l("#storeResultContent").css("width",
b+"px");q.css("position","absolute");q.css("top","50px");F.updatePosition(!0);Q=q.find("div#lockerPromo");N=Q.clone(!0);N.attr("id","lockerPromoPopover");q.find("#storeResultContent").empty();y=a.popover.$trigger.data("locker-search-button");a.popover.$trigger.data("locker-search-disabled-button");M=a.popover.$trigger.data("restricted-locker-disclaimer-text");G=0;e(d)}});a.on("a:popover:show:store-upsell-ship-options",function(a){var b=l(k).width(),c=l(k).height(),b=parseInt(.88*b,10);L=parseInt(.62*
c,10);c=a.popover.$trigger.data("store-search-url");q=a.popover.$popover;F=a.popover;l("#storeResultContent").css("height",L+"px");l("#storeResultContent").css("width",b+"px");q.css("position","absolute");q.css("top","50px");F.updatePosition(!0);Q=q.find("div#store-upsell-pickup-instructions");N=Q.clone(!0);N.attr("id","lockerPromoPopover");q.find("#storeResultContent").empty();y=a.popover.$trigger.data("store-search-button-url");M=a.popover.$trigger.data("restricted-store-disclaimer-text");G=1;S=
a.popover.$trigger.data("store-select-pickup-url");P=a.popover.$trigger.data("default-store-upsell-selected-address-id");e(c)});a.on("a:popover:hide:store-upsell-ship-options",function(a){G=0})}});"use strict";m.when("A","page-detector-current-page","first-load-dependencies-base","client-side-metrics").register("first-load-dependencies",function(a,c,d,f){a=a.$;var b=["shared-kitchensink","page-transition-controller","page-conductor","page-conductor-mpp"];k.P&&k.P.AUI_BUILD_DATE||(f.increaseCount("removeauijs62"),
b.concat(["checkout-modal-popover","form-icon-controller"]));c={accesspoint:["accesspoint-search-controller"],deliverypreference:["delivery-preference-controller"],shipaddressselect:"as-controller as-faf-controller as-tablet-controller as-locker-mobile-controller address-book-controller address-utilities what-if-im-not-in-delivery-preferences weekend-availability-loader".split(" "),billingaddressselect:["as-controller","as-tablet-controller","address-book-controller"],editaddress:["as-controller",
"as-tablet-controller","weekend-availability-loader"],giftselect:["gift-form-controller","gift-form-del-opt-controller"],itemselect:["itemselect-controller","itemselect-quantity-controller","address-popovers","itemselect-address-controller","address-popovers"],newaddress:["what-if-im-not-in-delivery-preferences","weekend-availability-loader"],payselect:"pay-common-lib pay-common-util pay-validator pay-credit-card existing-payments jppoints page-slide page-main page-rewards mobile-new-payments jppoints-mobile purchase-order-number-trial otp-for-cod".split(" "),
payauth:["pay-auth"],pip:["pip-controller"],shipoptionselect:["shipoptionselect-controller","deliv-prefs-sosp","scheduled-delivery-readiness-checker"],spc:"delivery-preferences-controller gc-redeem-controller gift-popover-controller inline-address-popover-controller thirdparty-redirect-popover-controller inline-fps-balance-controller inline-points-controller order-summary-controller-mpp place-order-controller prime-decline-controller quantity-update-controller shipping-speed-selection-controller time-preferences-controller verification-checkbox-controller installments-controller china-invoice-controller-v2 pay-validator page-conductor toggle-pyo-button toggle-pyo-button-common".split(" "),
spclite:["verification-checkbox-controller","get-final-results-update"],throttle:["checkout-throttle-error"]}[c.getCurrentPage()]||[];c=a.merge(b,c);d.allDependenciesCheck(c)});"use strict";m.when("A","ready").execute(function(a){function c(){d()?h("span.#button_verify").removeClass("a-button-disabled").find('input[type\x3d"submit"]').removeAttr("disabled"):h("span.#button_verify").addClass("a-button-disabled").find('input[type\x3d"submit"]').attr("disabled","disabled")}function d(){var a=!0;h('input[type\x3d"text"]:visible').each(function(){var b=
h(this);a=b.val()?"documentNumber"===b.attr("name")&&10!==b.val().length||"birthdate"===b.attr("name")&&7!==b.val().length||"expiry"===b.attr("name")&&7!==b.val().length?!1:!0:!1;if(!a)return!1});return a}function f(){h('input[type\x3d"radio"][name\x3d"idType"]').change(function(){h(".container").removeClass("newGermanId oldGermanId passportId").addClass(this.value);h('input[type\x3d"text"]:visible').each(function(){h(this).val("")});c()})}function b(){a.on("a:dropdown:selected:idType",function(a){h(".container").removeClass("newGermanId oldGermanId passportId").addClass(a.value);
h('input[type\x3d"text"]:visible').each(function(){h(this).val("")});c()})}function g(){h("form").submit(function(a){h("#documentNumber").attr("name","");h("#expiry").attr("name","");return!0})}var h=a.$;a.on("checkout:reload",function(){if(0<h(".checkout-ageEntry").length){var a=0<h(".checkout-ageEntry-mobile").length;h(".checkout-age-verification-inputs").removeClass("nojs").addClass("js");a?(a=h("#idSelector option:selected").attr("value"),-1<["newGermanId","oldGermanId","passportId"].indexOf(a)?
h(".container").removeClass("newGermanId oldGermanId passportId").addClass(a):h(".container").removeClass("newGermanId oldGermanId passportId").addClass("newGermanId")):(a=h('input[type\x3d"radio"]:checked').val(),h(".container").removeClass("newGermanId oldGermanId passportId").addClass(a));c();-1<h(location).attr("href").indexOf("age-verification")&&k.history.replaceState({page:"ageDisplay"},"","/gp/buy/age-verification/handlers/display.html");h('input[type\x3d"text"]').keyup(c);f();b();g()}})});
"use strict";m.when("A","ready").execute(function(a){var c=a.$;c(document).ready(function(){c("#changeCORForm").find("#learnMorePopoverLinkPhoneNumber").remove()});c("#changeCORForm").submit(function(){var d={};c(this).find("input").each(function(a,b){d[b.name]=b.value});c(this).find("select").each(function(a,b){d[b.name]=b.options[b.selectedIndex].value||b.options[b.selectedIndex].innerHTML});a.ajax("/gp/buy/dsv/handlers/change-country-setting.html",{method:"post",params:d,success:function(a){a.success?
c("#continueCheckout").submit():"FormErrors"===a.error?c("#dsvAddressForm").html(a.newForm):"DependencyFailure"===a.error?c("#continueCheckout").submit():c("#showWereSorryPage").submit()},error:function(a){c("#continueCheckout").submit()}});return!1})});"use strict";m.when("A","client-side-metrics").execute(function(a,c){var d=a.$;a.declarative("imb-enter-cvv","click",function(a){c.increaseCount("checkout:spc:desktop:expresscheckout:imbclicked");(a=a.data)&&a.focusTarget&&(a=d("#"+a.focusTarget))&&
a.length&&a.focus()})});"use strict";m.when("A","place-order-controller","button-blocker","ready").register("toggle-pyo-button",function(a,c,d){var f=a.$;return{disable:function(){var a=f("form#spc-form");a&&a.length&&(a=a.find(".continue-button-blocker"))&&a.length&&(a=a.find("input").data("blockerText"),d.show("place-order-cvv-error",a))},enable:function(){var a=f("form#spc-form");a&&a.length&&d.hide("place-order-cvv-error")}}});"use strict";m.when("A","pay-validator","toggle-pyo-button","page-conductor").register("toggle-pyo-button-common",
function(a,c,d,f){function b(a){return n("\x3cinput\x3e").attr({type:"hidden",name:"returnjson",id:"returnjsonel",value:a})}function g(a){if(!v&&"1"!==k()){var c=b((new Date).getTime());c.appendTo(a);f.submitFormAjax(a,function(a){v=!1;try{var b=JSON.parse(a);if(b&&b.isOK){var c=b.responseTimestamp;c>I&&(I=c,h(b.isOK))}}catch(d){}},function(){v=!1;h(0)},void 0,{action:"/gp/buy/spc/handlers/set-payment.html"});v=!0;c.remove()}}function h(a){var b=n("input[name\x3dINExpressCheckoutSetPayment]");b&&
b.length&&b.val(a)}function k(){var a=n("input[name\x3dINExpressCheckoutSetPayment]");if(a&&a.length)return a.val()}function m(a,b,c){function f(a){var e=n("#spc-form"),k=n(a.currentTarget),m=parseInt(k.attr("maxlength"),10),p=m,k=k.val(),q=!1;k&&m&&!isNaN(m)&&(b===c.isValidCardCVV?q=b(k,m):b===c.isValidCardPincode&&(6===m&&(p=5),q=b(k,p,m)));q?(d.enable(),g(e)):(d.disable(),h(0));e&&e.length&&13===a.keyCode&&e.submit()}a.keyup(f);a.change(f)}var n=a.$,I=0,v=!1;a.on("checkout:reload:spc",function(){var a=
n("#spc-form");if(a&&a.length&&(a=n("input[name\x3disINExpressCheckoutCC]"))&&a.length&&1===parseInt(a.val(),10)){var a=c.create(),b=a.isValidCardCVV,f=n("#existingCvvNum"),f=f&&f.length?f:n("input[name\x3daddCreditCardVerificationNumber]");f&&0!==f.length||(f=(f=n("#addCreditCardPincode"))&&f.length?f:n("input[name\x3daddCreditCardPincode]"),b=a.isValidCardPincode);a=f&&0!==f.length?{inputEl:f,inputValidator:b,validator:a}:void 0;if(a){m(a.inputEl,a.inputValidator,a.validator);d.disable();return}}d.enable()})});
"use strict";m.when("A","mash","client-side-metrics","ready").register("gc-scan-to-claim",function(a,c,d){function f(){setTimeout(function(){k("#stop-mash-reappear").remove()},100)}function b(a){f();d.increaseCount("gcScannerOnRCXFailureError",1);a.code===c.cardScanError.CANNOT_OPEN_CAMERA?d.increaseCount("gcScannerOnRCXFailureError:cannotOpenCamera",1):a.code===c.cardScanError.INVALID_CARD_TYPE?d.increaseCount("gcScannerOnRCXFailureError:invalidCardType",1):a.code===c.cardScanError.NO_SUPPORTED_CARD_TYPES&&
d.increaseCount("gcScannerOnRCXFailureError:unsupportedCardType",1)}function g(b){b?(b=b.cardData)?(b=b.number)?(14>b.length&&d.increaseCount("gcScannerOnRCXMashError:invalidClaimCodeLength",1),b=14>b.length?b:b.replace(/^(.{4})(.{6})(.+)?$/,"$1-$2-$3"),(k("#spc-gcpromoinput").length?k("#spc-gcpromoinput"):k("#gcpromoinput")).val(b),d.increaseCount("gcScannerOnRCXSuccess:showClaimCode",1),(k("#apply-gc-button").length?k("#apply-gc-button"):k("#button-add-gcpromo")).trigger("click"),a.trigger("gc:scan:rcx:success")):
(d.increaseCount("gcScannerOnRCXMashError:noClaimCode",1),f()):(d.increaseCount("gcScannerOnRCXMashError:noCardData",1),f()):(d.increaseCount("gcScannerOnRCXMashError:noCardInfo",1),f())}function h(a){a.$event.preventDefault();k("#apply-gc-button-container").append('\x3cdiv id\x3d"stop-mash-reappear" /\x3e');d.increaseCount("gcScannerOnRCXSuccess:clickOnScanButton",1);c.showCardScanner({cardTypes:[2],successCallback:g,failCallback:b})}var k=a.$;a.declarative("gc-scan","click",h);a.declarative("gc-scan-input-box",
"keyup change",function(a){a=k("#spc-gcpromoinput").length?k("#spc-gcpromoinput"):k("#gcpromoinput");var b=k("#apply-gc-button-container");0<k.trim(a.val()).length?b.removeClass("hidden"):b.hasClass("hidden")||b.addClass("hidden")});return 0>=k("div#gc-promo-delay").length?{showScanner:a.constants.NOOP}:{showScanner:h}})});
/* ******** */
