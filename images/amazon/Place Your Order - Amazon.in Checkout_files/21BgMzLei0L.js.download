(function(f){var d=window.AmazonUIPageJS||window.P,k=d._namespace||d.attributeErrors,b=k?k("PrimeAcquisitionMetricsJS"):d;b.guardFatal?b.guardFatal(f)(b,window):b.execute(function(){f(b,window)})})(function(f,d,k){f.when("A","prime-page-state-helper").register("prime-forester-loggers",function(b,f,l){var c=function(a){a=a||{};var e=a.createEventData,b=a.channel,c=a.apiVersion||"1",n=a.version||"1",g=a.action||"OP";a=a.debug||!1;var f;if(e===l)throw Error("No createEventData function specified.");
if(b===l)throw Error("No channel specified.");ue!==l&&(f=ue_furl||ue.furl||l);a&&(g="TOP");this.createEventData=e;this.endpoint={protocol:"https",host:f||"fls-na.amazon.com",apiVersion:c,channel:b,version:n,action:g};this.runtime={sendMetricCount:0,logCount:0,logData:[],lastLoggedData:null,mostRecentLoggingIncomplete:!0};e=function(a,e,b){return function(c){a.resendLastData(b);try{e&&"function"===typeof e&&e(c)}catch(p){}}};d.onbeforeunload=e(this,d.onbeforeunload,"bu");d.onunload=e(this,d.onunload,
"u")},h=function(a){a=a||{};a.channel="prime-csm-metrics";a.version="1";a.pageState=a.pageState||"ms3-client-metadata";a.createEventData=function(e,c){var d={id:e,ac:c,et:b.now()};this.addCSMMetadata(d);this.addMS3Metadata(d,a.pageState);return d};c.call(this,a)},g=function(a){a=a||{};a.channel="prime-presentation-metrics";a.version="1";a.pageState=a.pageState||"ms3-client-metadata";a.createEventData=function(e,c){var d={id:e,pt:c,et:b.now()};this.addCSMMetadata(d);this.addMS3Metadata(d,a.pageState);
return d};c.call(this,a)};c.prototype.getEndpoint=function(){return this.endpoint.protocol+"://"+[this.endpoint.host,this.endpoint.apiVersion,this.endpoint.channel,this.endpoint.version,this.endpoint.action].join("/")};c.prototype.toJsonString=function(a){var e=d.JSON;return e&&e.stringify?e.stringify(a):"{"+b.reduce(a,function(a,e,b){e!==l&&(b='"'+b+'":',b=null===e||"[object Number]"==Object.prototype.toString.call(e)?b+e:b+('"'+e+'"'),a.push(b));return a},[]).join(",")+"}"};c.prototype.addMetric=
function(a){this.runtime.logCount+=1;a=this.createEventData(this.runtime.logCount,a);this.runtime.logData.push(a);this.runtime.lastLoggedData=a;b.delay(function(a){return function(){a.sendMetric()}}(this))};c.prototype.sendMetric=function(){for(var a=function(a,b){return function(){a.runtime.logData.push(b);a.runtime.mostRecentLoggingIncomplete=!0}};0<this.runtime.logData.length;){this.runtime.sendMetricCount+=1;var b=new Image,c=this.runtime.logData.shift();b.src=this.getEndpoint()+"/"+this.toJsonString(c)+
this.runtime.sendMetricCount;b.onabort=a(this,c)}};c.prototype.resendLastData=function(a){if(null!==this.runtime.lastLoggedData&&this.runtime.mostRecentLoggingIncomplete){var e=b.copy(this.runtime.lastLoggedData);e.le=a;this.runtime.logData.push(e);this.runtime.mostRecentLoggingIncomplete=!1;this.sendMetric()}};c.prototype.addCSMMetadata=function(a){if(ue!==l){if(ue_sid||ue.sid)a.s=ue_sid||ue.sid;ue.rid&&(a.r=ue.rid)}};c.prototype.addMS3Metadata=function(a,b){var c=f.get(b);c!==l&&(c.containerRequestID&&
(a.mgid=c.containerRequestID),c.customerID&&(a.cid=c.customerID),c.marketplaceID&&(a.mkt=c.marketplaceID))};Object&&Object.create?(h.prototype=Object.create(c.prototype),g.prototype=Object.create(c.prototype)):(h.prototype=b.copy(c.prototype),h.prototype.constructor=h,g.prototype=b.copy(c.prototype),g.prototype.constructor=g);return{BaseLogger:c,EventLogger:h,PresentationLogger:g}});f.when("A").register("prime-page-state-helper",function(b){return{get:function(d){var f={};b.each(b.$('script[type="a-state"]'),
function(c,h){b.$(c).data("a-state").key===d&&(f=b.parseJSON(b.$(c).html()))});return f}}})});
(function(f){var d=window.AmazonUIPageJS||window.P,k=d._namespace||d.attributeErrors,b=k?k("PrimeCheckoutAssets"):d;b.guardFatal?b.guardFatal(f)(b,window):b.execute(function(){f(b,window)})})(function(f,d,k){f.when("A","prime-forester-loggers","prime-page-state-helper","page-detector").register("prime-events",function(b,f,l,c){function h(){if(!a){var b=l.get("ms3-client-metadata");b&&(g=new f.EventLogger({marketplace:b.marketplaceID}),a=!0)}}var g,a=!1;c.isSpc()&&h();b.on("checkout:reload:spc",function(a){h()});
b.declarative("prime-event","click",function(a){g&&g.addMetric(a.data.metric)});b.$(document).delegate("[data-prime-metric]","click touchend",function(a){(a=b.$(this).data("prime-metric"))&&g.addMetric(a)});b.on("a:popover:dismiss:prime-acquisition-spc-popover",function(a){g&&g.addMetric("ac1")});b.on("a:popover:show:prime-acquisition-spc-popover",function(a){0===a.popover.$popover.find("form").length&&d.ue&&d.ue.tag&&d.uex&&(d.ue.tag("prime-spc-popover-fallback-hit"),d.uex("ld","primePopoverFallback"))});
return{getLogger:function(){return g}}});f.when("A","prime-forester-loggers","prime-page-state-helper","page-detector").register("prime-presentations",function(b,d,f,c){function h(b){var c=a[b];if(c)return c;c=new d.PresentationLogger({pageState:b});return a[b]=c}function g(a){return function(){var b,c;if(b=f.get(a))c=h(a),c.addMetric(b.pageType)}}var a={},e={SPC:"ms3-client-metadata",PCI:"ms3-client-metadata-pci"},k=g(e.SPC),m=g(e.PCI);c.isSpc()&&k();0<b.$("div#prime.spp-panel.expanded").length&&
m();b.on("checkout:reload:spc",k);b.on("checkout:reload:spp-prime",m);return{metadataKeys:e,getLogger:function(){return h(e.SPC)},getLoggerForPage:h,clearCache:function(){a={}}}})});